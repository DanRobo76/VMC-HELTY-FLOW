###########################################################################################################################################################################################################################
#                                                                                                                                                                                                                         #
#                                                          VMC HELTY FLOW PLUS/ELITE RELEASE [VEDERE VALORE INSERITO NEL SENSORE vmc_master_versione_corrente]                                                            #
#                                                                                                                                                                                                                         #
# SVILUPPATO DA ING. DANILO ROBOTTI, ALLE PRIME ARMI CON HOME ASSISTANT :)                                                                                                                                                #
#                                                                                                                                                                                                                         #
# LICENZA D'USO – USO PERSONALE NON COMMERCIALE                                                                                                                                                                           #
#                                                                                                                                                                                                                         #
# COPYRIGHT © ING. DANILO ROBOTTI                                                                                                                                                                                         #
#                                                                                                                                                                                                                         #
# TUTTI I DIRITTI RISERVATI.                                                                                                                                                                                              #
#                                                                                                                                                                                                                         #
# QUESTA LICENZA SI APPLICA A TUTTE LE VERSIONI DEL PRESENTE SOFTWARE CHE INCLUDE I SEGUENTI FILES:                                                                                                                       #
#   - VMC_CLONA.YAML                                                                                                                                                                                                      #
#   - VMC_CLONA_SCHEDA_MANUALE_INTERFACCIA.TXT                                                                                                                                                                            #
#   - VMC_MASTER.YAML                                                                                                                                                                                                     #
#   - VMC_MASTER_AUTOMAZIONE.TXT                                                                                                                                                                                          #
#   - VMC_MASTER_SCHEDA_MANUALE_INTERFACCIA.TXT                                                                                                                                                                           #
#   - VMC_MASTER_SCRIPT_CAMBIO_IP.SH                                                                                                                                                                                      #
#   - VMC_MASTER_SCRIPT_CAMBIO_NOME.SH                                                                                                                                                                                    #
#   - VMC_SCRIPT_CLONA.SH                                                                                                                                                                                                 #
# A PARTIRE DALLA PRIMA VERSIONE PUBBLICATA E SUCCESSIVE                                                                                                                                                                  #
#                                                                                                                                                                                                                         #
# È CONCESSO:                                                                                                                                                                                                             #
#  - L'UTILIZZO DEL SOFTWARE ESCLUSIVAMENTE PER FINI PERSONALI E NON COMMERCIALI                                                                                                                                          #
#  - LA DISTRIBUZIONE LIBERA, PURCHÉ VENGA MANTENUTO IL PRESENTE TESTO DI LICENZA E SIA RISPETTATO IL DIVIETO D'USO COMMERCIALE                                                                                           #
#                                                                                                                                                                                                                         #
# QUALSIASI USO NON AUTORIZZATO AD USO COMMERCIALE COSTITUISCE VIOLAZIONE DEL DIRITTO D'AUTORE E POTRÀ ESSERE PERSEGUITO LEGALMENTE                                                                                       #
#                                                                                                                                                                                                                         #
# PER RICHIESTE DI LICENZA COMMERCIALE O USI PARTICOLARI, CONTATTARE L’AUTORE: danilo.robotti@gmail.com                                                                                                                   #
#                                                                                                                                                                                                                         #
# VERSIONE LICENZA: 1.0                                                                                                                                                                                                   #
# DATA: 30 APRILE 2025                                                                                                                                                                                                    #
#                                                                                                                                                                                                                         #
# Esonero di Responsabilità                                                                                                                                                                                               #
# In nessun caso lo sviluppatore sarà responsabile di danneggiamenti diretti, indiretti o conseguenti, correlati a difetti del presente software                                                                          #
# L’usufruitore ha l’onere e la responsabilità della scelta, dell’installazione, dell’uso e della gestione del software al fine del raggiungimento del risultato prefissatosi                                             #
#                                                                                                                                                                                                                         #
###########################################################################################################################################################################################################################


################### Sensori della VMC  ####################################################################################################################################################################################
#                                                                                                                                                                                                                         #
# I SENSORI PRINCIPALI UTILIZZATI PER L'ESTRAZIONE DEI DATI CONTENUTI NELLA VMC SONO:                                                                                                                                     #
#                                                                                                                                                                                                                         #
# - VMC_MASTER_STATUS_IP                                                                                                                                                                                                  #
# - VMC_MASTER_STATUS_VENTOLA                                                                                                                                                                                             #
# - VMC_MASTER_SENSORI                                                                                                                                                                                                    #
# - VMC_MASTER_NOME                                                                                                                                                                                                       #
# - VMC_MASTER_LAN                                                                                                                                                                                                        #
#                                                                                                                                                                                                                         #
# I SENSORI SECONDARI PRINCIPALI UTILIZZATI PER LA RESTITUZIONE DELLA LETTURA DEI DATI ESTRATTI NELLA VMC:                                                                                                                #
#                                                                                                                                                                                                                         #
# - vmc_master_status_ip_interfaccia                                                                                                                                                                                      #
# - vmc_master_nome_status                                                                                                                                                                                                #
# - vmc_master_status_ventola_lettura_codice_interpretato                                                                                                                                                                 #
# - vmc_master_status_sensori_lettura_codice_interpretato                                                                                                                                                                 #
# - vmc_master_status_led_pannello_lettura_codice_interpretato                                                                                                                                                            #
# - vmc_master_temp_interna_positivo_negativo              [FORMULA DA VERIFICARE (INDICE ARRAY) E/O METODO , NON AVENDO MAI VISUALIZZATO UNA TEMPERATURA NEGATIVA]                                                       #
# - vmc_master_temp_esterna_positivo_negativo              [FORMULA DA VERIFICARE (INDICE ARRAY) E/O METODO , NON AVENDO MAI VISUALIZZATO UNA TEMPERATURA NEGATIVA]                                                       #
#                                                                                                                                                                                                                         #
# - vmc_master_temp_interna_status_senza_offset            [SENSORE DELLA VMC PER MONITORARE LA TEMPERATURA INTERNA]                                                                                                      #
# - vmc_master_temp_esterna_status_senza_offset            [SENSORE DELLA VMC PER MONITORARE LA TEMPERATURA ESTERNA]                                                                                                      #
# - vmc_master_co2_status_senza_offset                     [SENSORE DELLA VMC PER MONITORARE L'ANIDRIDE CARBONICA, PRESENTE SOLO NEL MODELLO VMC HELTY FLOW ELITE]                                                        #
# - vmc_master_voc_status_senza_offset                     [SENSORE DELLA VMC PER MONITORARE I COMPOSTI ORGANICI VOLATILI, PRESENTE SOLO NEL MODELLO VMC HELTY FLOW ELITE]                                                #
# - vmc_master_umidita_interna_status_senza_offset         [SENSORE DELLA VMC PER MONITORARE L'UMIDITA' INTERNA]                                                                                                          #
#                                                                                                                                                                                                                         #
#                                                                                                                                                                                                                         #
#                                                                                                                                                                                                                         #
# I COMANDI PER PILOTARE LA VMC [IMPIEGABILI TRAMITE AZIONI IN QUALSIASI AUTOMAZIONE] Es. Shell Command: vmc_master_velocita_0                                                                                            #
#                                                                                                                                                                                                                         #
# shell_command:                                                                                                                                                                                                          #
#  vmc_master_freecooling                                                                 # INVIO COMANDO Free Cool./Heat. ALLA VMC                                                                                       #
#  vmc_master_notturna                                                                    # INVIO COMANDO NOTTURNA         ALLA VMC                                                                                       #
#  vmc_master_iperventilazione                                                            # INVIO COMANDO IPERVENTILAZIONE ALLA VMC                                                                                       #
#  vmc_master_velocita_4                                                                  # INVIO COMANDO VELOCITA' 4      ALLA VMC                                                                                       #
#  vmc_master_velocita_3                                                                  # INVIO COMANDO VELOCITA' 3      ALLA VMC                                                                                       #
#  vmc_master_velocita_2                                                                  # INVIO COMANDO VELOCITA' 2      ALLA VMC                                                                                       #
#  vmc_master_velocita_1                                                                  # INVIO COMANDO VELOCITA' 1      ALLA VMC                                                                                       #
#  vmc_master_velocita_0                                                                  # INVIO COMANDO VELOCITA' 0      ALLA VMC                                                                                       #
#  vmc_master_pannello_led_on                                                             # INVIO COMANDO PANNELLO LED ON  ALLA VMC PER ATTIVARE    IL LED PANNELLO DEI COMANDI                                           #
#  vmc_master_pannello_led_off                                                            # INVIO COMANDO PANNELLO LED OFF ALLA VMC PER DISATTIVARE IL LED PANNELLO DEI COMANDI                                           #
#  vmc_master_sensori_on                                                                  # INVIO COMANDO SENSORI  ON  ALLA VMC PER ACCENDERE I SENSORI;   i valori rilevati dai sensori nella schermata INFO dell'App    #
#                                                                                           Mobile saranno disponibili e i relativi allarmi verrano segnalati                                                             #
#  vmc_master_sensori_off                                                                 # INVIO COMANDO SENSORI  OFF ALLA VMC PER DISATTIVARE I SENSORI; i valori rilevati dai sensori nella schermata INFO dell'App    #
#                                                                                           Mobile non saranno più disponibili e i relativi allarmi non verranno segnalati                                                #
#  vmc_master_reset_filtro                                                                # INVIO COMANDO RESET FILTRO     ALLA VMC                                                                                       #
#                                                                                                                                                                                                                         #
#                                                                                                                                                                                                                         #
#     LETTURA OGNI n SECONDI SULLO STATUS DELLA VENTOLA ATTRAVERSO IL SENSORE VMC_MASTER_STATUS_VENTOLA, CHE ASSUME IL VALORE LETTO NELL'INDICE [1] DELL'ARRAY, TRAMITE IL COMANDO PAYLOAD "VMGH?" INVIATO ALLA VMC       #
#                                                                                                                                                                                                                         #
#     ES: DI OUTPUT DI DEFAULT DELLA VMC:  VMGO,00001,00000,00000,00000,00000,00000,00000,00000,00000,00000,00000,00000,00000,00000,00000                                                                                 #
#     POSIZIONE INDICE ARRAY:              [0]  [1]   [2]   [3]   [4]   [5]   [6]   [7]   [8]   [9]   [10]  [11]  [12]  [13]  [14]  [15]                                                                                  #
#                                                                                                                                                                                                                         #
#                                               00000 = VELOCITA' 0     , ATTRAVERSO L'AUTOMAZIONE, LANCIA IL SERVIZIO: vmc_master_velocita_0                                                                             #
#                                               00001 = VELOCITA' 1     , ATTRAVERSO L'AUTOMAZIONE, LANCIA IL SERVIZIO: vmc_master_velocita_1                                                                             #
#                                               00002 = VELOCITA' 2     , ATTRAVERSO L'AUTOMAZIONE, LANCIA IL SERVIZIO: vmc_master_velocita_2                                                                             #
#                                               00003 = VELOCITA' 3     , ATTRAVERSO L'AUTOMAZIONE, LANCIA IL SERVIZIO: vmc_master_velocita_3                                                                             #
#                                               00004 = VELOCITA' 4     , ATTRAVERSO L'AUTOMAZIONE, LANCIA IL SERVIZIO: vmc_master_velocita_4                                                                             #
#                                               00005 = IPERVENTILAZIONE, ATTRAVERSO L'AUTOMAZIONE, LANCIA IL SERVIZIO: vmc_master_iperventilazione                                                                       #
#                                               00006 = NOTTE           , ATTRAVERSO L'AUTOMAZIONE, LANCIA IL SERVIZIO: vmc_master_notte                                                                                  #
#                                               00007 = FREECOOLING     , ATTRAVERSO L'AUTOMAZIONE, LANCIA IL SERVIZIO: vmc_master_freecooling                                                                            #
#                                                                                                                                                                                                                         #
###########################################################################################################################################################################################################################

################### Inizio Creazione Sensori di Lettura TEMPERATURA ESTERNA, INTERNA E UMIDITA' ESTERNA, INTERNA INSTALLATE IN HOME ASSISTANT  ###########################################################################
template:
  - sensor:
      - name: vmc_master_temperatura_esterna_selezionata                        # [CONFIGURAZIONE, 0 RICHIAMI] [INTERFACCIA, 0 RICHIAMI] [AUTOMAZIONE, 0 RICHIAMI]
        state: >
          {% set entity_id = states('input_select.vmc_master_selected_temp_external_entity') %}
          {% if entity_id.startswith('sensor.') %}
            {% if states(entity_id) not in ["sconosciuto", "unknown", "", none, "unavailable", "Non disponibile"] %}
              {{ states(entity_id) }}
            {% else %}
              -100
            {% endif %}
          {% elif entity_id.startswith('weather.') %}
            {% set temp = state_attr(entity_id, 'temperature') %}
            {% if temp is not none %}
              {{ temp }}
            {% else %}
              -100
            {% endif %}
          {% else %}
            -100
          {% endif %}
        unit_of_measurement: "°C"
        device_class: temperature

      - name: vmc_master_temperatura_interna_selezionata                        # [CONFIGURAZIONE, PIU' RICHIAMI] [INTERFACCIA, 0 RICHIAMI] [AUTOMAZIONE, 0 RICHIAMI]
        state: >
          {% set entity_id = states('input_select.vmc_master_selected_temp_internal_entity') %}
          {% if entity_id and states(entity_id) not in ["sconosciuto", "unknown", "", none, "unavailable", "Non disponibile"] %}
            {{ states(entity_id) }}
          {% else %}
            -100
          {% endif %}
        unit_of_measurement: "°C"
        device_class: temperature

      - name: vmc_master_umidita_esterna_selezionata                            # [CONFIGURAZIONE, PIU' RICHIAMI] [INTERFACCIA, 0 RICHIAMI] [AUTOMAZIONE, 0 RICHIAMI]
        state: >
          {% set entity_id = states('input_select.vmc_master_selected_humidity_external_entity') %}
          {% if entity_id.startswith('sensor.') %}
            {% if states(entity_id) not in ["sconosciuto", "unknown", "", none, "unavailable", "Non disponibile"] %}
              {{ states(entity_id) }}
            {% else %}
              -100
            {% endif %}
          {% elif entity_id.startswith('weather.') %}
            {% set hum = state_attr(entity_id, 'humidity') %}
            {% if hum is not none %}
              {{ hum }}
            {% else %}
              -100
            {% endif %}
          {% else %}
            -100
          {% endif %}
        unit_of_measurement: "%"
        device_class: humidity

      - name: vmc_master_umidita_interna_selezionata                            # [CONFIGURAZIONE, PIU' RICHIAMI] [INTERFACCIA, 0 RICHIAMI] [AUTOMAZIONE, 0 RICHIAMI]
        state: >
          {% set entity_id = states('input_select.vmc_master_selected_humidity_internal_entity') %}
          {% if entity_id and states(entity_id) not in ["sconosciuto", "unknown", "", none, "unavailable", "Non disponibile"] %}
            {{ states(entity_id) }}
          {% else %}
            -100
          {% endif %}
        unit_of_measurement: "%"
        device_class: humidity

      - name: vmc_master_co2_interna_selezionata                             # [CONFIGURAZIONE, PIU' RICHIAMI] [INTERFACCIA, 0 RICHIAMI] [AUTOMAZIONE, 0 RICHIAMI]
        state: >
          {% set entity_id = states('input_select.vmc_master_selected_co2_internal_entity') %}
          {% if entity_id and states(entity_id) not in ["sconosciuto", "unknown", "", none, "unavailable", "Non disponibile"] %}
            {% if states(entity_id) == '-' %}
              0
            {% else %}
              {{ states(entity_id) | float(default=-100) }}
            {% endif %}
          {% else %}
            -100
          {% endif %}
        unit_of_measurement: "ppm"
        device_class: carbon_dioxide
################### fINE Creazione Sensori di Lettura TEMPERATURA ESTERNA, INTERNA E UMIDITA' ESTERNA, INTERNA INSTALLATE IN HOME ASSISTANT  ###############################################################################

################### Inizio Creazione Sensori Principali della VMC  ########################################################################################################################################################
command_line:
  - sensor:
      name: VMC_MASTER_STATUS_IP                # [CONFIGURAZIONE, PIù RICHIAMI] [INTERFACCIA, PIù RICHIAMI] [AUTOMAZIONE, PIù RICHIAMI] IN CASO DI CONFLITTO OVVERO CHE NELLO STESSO TEMPO LA VMC VIENE INTERROGATA SIA DAL SENSORE STESSO CHE DAL SENSORE (VMC_MASTER_STATUS_VENTOLA OPPURE VMC_MASTER_SENSORI OPPURE VMC_MASTER_NOME OPPURE VMC_MASTER_LAN) ATTENDE ULTERIORI n° SECONDI PRIMI DI ESEGUIRE IL PING
      # Qui inline il tuo lock + ping
      command: >-
        bash -c "
          exec 200>/config/packages/vmc_helty_flow/master/vmc_master_ping.lock;
          flock 200;
          attempt=0; max_attempts=3;
          while [ \$attempt -lt \$max_attempts ]; do
            if ping -c 1 -W 3 192.168.1.160 >/dev/null; then
              echo 'ON-Line'; exit 0;
            fi;
            attempt=\$(( attempt + 1 ));
            sleep 1;
          done;
          echo 'OFF-Line'
        "
      scan_interval:
        seconds: 5
      # opzione: se vuoi ignorare ogni output che non sia ON-Line/OFF-Line
      value_template: "{{ value }}"


sensor:
  - platform: tcp
    name: VMC_MASTER_STATUS_VENTOLA            # [CONFIGURAZIONE, PIù RICHIAMI] [INTERFACCIA, PIù RICHIAMI] [AUTOMAZIONE, PIù RICHIAMI] CREAZIONE DEL SENSORE LETTURA STATI DI VENTILAZIONE; N.b non tutti i valori sono identificabili
    host: 192.168.1.160                        # INDIRIZZO IP DELLA VMC MASTER
    port: 5001                                 # PORTA 5001 DELLA VMC IMPOSTAZIONE DI DEFAULT
    timeout: 15
    payload: "VMGH?"                           # INVIO COMANDO VMGH? ALLA VMC MASTER, PER OTTENERE INFORMAZIONI SULLO STATO DI VENTILAZIONE DELLA VMC]
    scan_interval:                             # OGNI n SECONDI RIPETE LA SCANSIONE [SE SI COMANDA LA VMC CON IL TELECOMANDO L'AUTOMAZIONE LO RILEVERA' AD OGNI scan_interval -> seconds]
      seconds: 3                               # OGNI N° SECONDI RIPETE LA SCANSIONE

  - platform: tcp
    name: VMC_MASTER_SENSORI                   # [CONFIGURAZIONE, PIù RICHIAMI] [INTERFACCIA, PIù RICHIAMI] [AUTOMAZIONE, PIù RICHIAMI] CREAZIONE DEL SENSORE LETTURA SENSORI; N.b non tutti i valori sono identificabili
    host: 192.168.1.160                        # INDIRIZZO IP DELLA VMC MASTER
    port: 5001                                 # PORTA 5001 DELLA VMC IMPOSTAZIONE DI DEFAULT
    timeout: 15
    payload: "VMGI?"                           # INVIO COMANDO VMGI? ALLA VMC MASTER, PER OTTENERE INFORMAZIONI SUI SENSORI DELLA VMC]
    scan_interval:
      seconds: 1227                            # OGNI N° SECONDI RIPETE LA SCANSIONE [20 MINUTI + 27 secondi di margine]

  - platform: tcp
    name: VMC_MASTER_NOME                      # [CONFIGURAZIONE, PIù RICHIAMI] [INTERFACCIA, PIù RICHIAMI] [AUTOMAZIONE, PIù RICHIAMI] CREAZIONE DEL SENSORE LETTURA NOME DELLA VMC
    host: 192.168.1.160                        # INDIRIZZO IP DELLA VMC MASTER
    port: 5001                                 # PORTA 5001 DELLA VMC IMPOSTAZIONE DI DEFAULT
    timeout: 15
    payload: "VMNM?"                           # INVIO COMANDO VMNM? ALLA VMC MASTER, PER OTTENERE INFORMAZIONI SUL NOME DELLA VMC]
    scan_interval:
      seconds: 43227                           # OGNI N° SECONDI RIPETE LA SCANSIONE [12 ORE + 27 secondi di margine]

  - platform: tcp
    name: VMC_MASTER_LAN                       # [CONFIGURAZIONE, PIù RICHIAMI] [INTERFACCIA, PIù RICHIAMI] [AUTOMAZIONE, 0 RICHIAMI] CREAZIONE DEL SENSORE LETTURA DATI LAN DELLA VMC; N.b non tutti i valori sono identificabili
    host: 192.168.1.160                        # INDIRIZZO IP DELLA VMC MASTER
    port: 5001                                 # PORTA 5001 DELLA VMC IMPOSTAZIONE DI DEFAULT
    timeout: 15
    payload: "VMSL?"                           # INVIO COMANDO VMSL? ALLA VMC MASTER, PER OTTENERE INFORMAZIONI SUI DATI LAN DELLA VMC]
    scan_interval:
      seconds: 57641                           # OGNI N° SECONDI RIPETE LA SCANSIONE [16 ORE + 41 secondi di margine]

  - platform: rest
    name: vmc_master_versione_repository       # [CONFIGURAZIONE 0 RICHIAMI] [INTERFACCIA, PIU' RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI] SENSORE PER VISUALIZZARE LA VERSIONE CORRENTE NEL REPOSITORY DI GITHUB: https://github.com/DanRobo76/VMC-HELTY-FLOW DA CONFRONTARE CON LA VERSIONE CORRENTE INSTALLATA IN HOME ASSISTANT TRAMITE AUTOMAZIONE
    resource: https://api.github.com/repos/DanRobo76/VMC-HELTY-FLOW/releases/latest
    value_template: >-
      {% if value_json and value_json.tag_name %}
        {{ value_json.tag_name }}
      {% else %}
        Errore Connessione
      {% endif %}
    headers:
      Accept: application/vnd.github.v3+json
      Content-Type: application/json
      User-Agent: Home Assistant REST sensor
    scan_interval: 86400                        # OGNI N° SECONDI RIPETE LA SCANSIONE
    timeout: 15
################### Fine Creazione Sensori Principali della VMC  ##########################################################################################################################################################

################### Inizio Creazione Sensori Statistici per la Valutazione Formazione Muffa [Vedere Sensori di Monitoraggio Muffa] ########################################################################################
  - platform: statistics
    name: vmc_master_temp_interna_4w
    entity_id: sensor.vmc_master_temp_interna_numeric
    state_characteristic: mean
    max_age:
      days: 28

  - platform: statistics
    name: vmc_master_hum_interna_4w
    entity_id: sensor.vmc_master_hum_interna_numeric
    state_characteristic: mean
    max_age:
      days: 28

  - platform: statistics
    name: vmc_master_temp_interna_8w
    entity_id: sensor.vmc_master_temp_interna_numeric
    state_characteristic: mean
    max_age:
      days: 56

  - platform: statistics
    name: vmc_master_hum_interna_8w
    entity_id: sensor.vmc_master_hum_interna_numeric
    state_characteristic: mean
    max_age:
      days: 56

  - platform: statistics
    name: vmc_master_temp_interna_12w
    entity_id: sensor.vmc_master_temp_interna_numeric
    state_characteristic: mean
    max_age:
      days: 84

  - platform: statistics
    name: vmc_master_hum_interna_12w
    entity_id: sensor.vmc_master_hum_interna_numeric
    state_characteristic: mean
    max_age:
      days: 84
################### Fine Creazione Sensori Statistici per la Valutazione Formazione Muffa [Vedere Sensori di Monitoraggio Muffa] ##########################################################################################

################### Inizio Creazione Sensori di Lettura Collegamento tramite Status IP, Nome, Stato Ventola, Stato Sensoristico, Stato Led Pannello della VMC  ############################################################
  - platform: template
    sensors:
      vmc_master_versione_corrente:                                            # [CONFIGURAZIONE PIù RICHIAMI] [INTERFACCIA, PIU' RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI] SENSORE PER VISUALIZZARE LA VERSIONE CORRENTE INSTALLATA IN HOME ASSISTANT DA CONFRONTARE NEL REPOSITORY DI GITHUB: https://github.com/DanRobo76/VMC-HELTY-FLOW IN Releases TRAMITE AUTOMAZIONE
        friendly_name: "Package Ver."
        value_template: >
            v.8.1.0
        icon_template: mdi:check-decagram-outline

      vmc_master_verifica_ip_inserito:                                        # [CONFIGURAZIONE, 0 RICHIAMI] [INTERFACCIA, 0 RICHIAMI] [AUTOMAZIONE, PIU' RICHIAMI] VERIFICA DEL VALORE INSERIO NEL SENSORE "vmc_master_ip_insert" E' UN INDIRIZZO IP
        friendly_name: "IP"
        value_template: >
          {% if states.input_text.vmc_master_ip_insert.state is match("^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$") %}
            {{ states.input_text.vmc_master_ip_insert.state }}
          {% else %}
            IP non Valido    
          {% endif %}
        icon_template: mdi:ip    

      vmc_master_ip:                                                           # [CONFIGURAZIONE PIù RICHIAMI] [INTERFACCIA PIU’ RICHIAMI] [AUTOMAZIONE, 0 RICHIAMI] SENSORE PER VISUALIZZARE L'IP NELL'INTERFACCIA
        friendly_name: "IP configurato su Porta 5001"
        value_template: >
            192.168.1.160
        icon_template: mdi:ip

      vmc_master_status_ip_interfaccia:                                        # [CONFIGURAZIONE 0 RICHIAMI] [INTERFACCIA, PIU’ RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI] SENSORE IMPIEGATO PER LA VISUALIZZAZIONE NELL'INTERFACCIA SE LA VMC E' IN RETE O MENO
        friendly_name: "Status VMC"
        value_template: >
          {% set stati = ['OFF-Line'] %}
          {{ 'OFF-Line' if states('sensor.vmc_master_status_ip') in stati else 'ON-Line' }}
        icon_template: >
          {% if states('sensor.vmc_master_status_ip') == 'OFF-Line' %}
            mdi:fan-alert
          {% else %}
            mdi:fan-chevron-down
          {% endif %}

      vmc_master_nome_status:                                                  # [CONFIGURAZIONE 0 RICHIAMI] [INTERFACCIA PIU’ RICHIAMI] [AUTOMAZIONE, 0 RICHIAMI] SENSORE DI VERIFICA DI AVVENUTA LETTURA NOME MEMORIZZATA NELLA VMC
        friendly_name: "Nome"
        value_template: >
          {% set stati = ["sconosciuto", "unknown", "", none, "unavailable", "Non disponibile"] %}
          {% set vmc_nome = states('sensor.vmc_master_nome') %}
          {% if vmc_nome.split(" ")|length >= 2 %}
            {{ vmc_nome.split(" ")[1] }}
          {% else %}
            Non disponibile
          {% endif %}
        icon_template: mdi:label-variant

      vmc_master_status_ventola_lettura_codice:                                # [CONFIGURAZIONE 0 RICHIAMI] [INTERFACCIA 0 RICHIAMI] [AUTOMAZIONE, 0 RICHIAMI] SENSORE DI LETTURA DEI DATI "VELOCITA'" MEMORIZZATI NELLA VMC, PREVIA VERIFICA DI AVVENUTA LETTURA DEI DATI "VELOCITA'" MEMORIZZATI NELLA VMC
        friendly_name: "Codice Status Ventilazione"
        value_template: >
          {% set stati = ["sconosciuto", "unknown", "", none, "unavailable", "Non disponibile"] %}
          {% set valid_stati = ['00000', '00001', '00002', '00003', '00004', '00005', '00006', '00007'] %}
          {% if states('sensor.vmc_master_status_ventola') in stati %}
            Non disponibile
          {% else %}
            {% set componenti = states('sensor.vmc_master_status_ventola').split(',') %}
            {% if componenti | length > 1 %}
              {% set codice_status = componenti[1] %}
              {{ codice_status if codice_status in valid_stati else 'Non disponibile' }}
            {% else %}
              Non disponibile
            {% endif %}
          {% endif %}
        icon_template: mdi:code-array

      vmc_master_status_ventola_lettura_codice_interpretato:                   # [CONFIGURAZIONE PIU' RICHIAMI] [INTERFACCIA PIù RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI] SENSORE DI INTERPRETAZIONE DELLA LETTURA DEI DATI "VELOCITA'" MEMORIZZATI NELLA VMC CONVERITA IN "STRINGA", PREVIA VERIFICA DI AVVENUTA LETTURA DEI DATI "VELOCITA'"" MEMORIZZATI NELLA VMC
        friendly_name: "Status Ventilazione"
        value_template: >
          {% set stati = ["sconosciuto", "unknown", "", none, "unavailable", "Non disponibile"] %}
          {% set codici = {'00000': 'Velocità 0', '00001': 'Velocità 1', '00002': 'Velocità 2', '00003': 'Velocità 3', 
                           '00004': 'Velocità 4', '00005': 'Iperventilazione', '00006': 'Notturna', '00007': 'Free Cooling'} %}
          {% if states('sensor.vmc_master_status_ventola') in stati %}
            Non disponibile
          {% else %}
            {% set componenti = states('sensor.vmc_master_status_ventola').split(',') %}
            {% if componenti | length > 1 %}
              {% set codice = componenti[1] %}
              {{ codici.get(codice, 'Non disponibile') }}
            {% else %}
              Non disponibile
            {% endif %}
          {% endif %}
        icon_template: mdi:fan

      vmc_master_status_ventola_lettura_codice_interpretato_interfaccia:       # [CONFIGURAZIONE 0 RICHIAMI] [INTERFACCIA, PIU’ RICHIAMI] [AUTOMAZIONE PIù RICHIAMI] SENSORE DI INTERPRETAZIONE DELLA LETTURA DEI DATI "VELOCITA'" MEMORIZZATI NELLA VMC CONVERITA IN "STRINGA" CON LA POSSIBILITA' DI VISUALIZZARE FREE COOLING O FREE HEATING O FREE C./H. (IN FUNZIONE DEL VALORE LETTO DEL SENSORE vmc_master_status_mese_corrente_freeheating_o_freecooling), PREVIA VERIFICA DI AVVENUTA LETTURA DEI DATI "VELOCITA'"" MEMORIZZATI NELLA VMC
        friendly_name: "Status Ventilazione"
        value_template: >
          {% set stati = ["sconosciuto", "unknown", "", none, "unavailable", "Non disponibile"] %}
          {% set codici_base = {'00000': 'Velocità 0', '00001': 'Velocità 1', '00002': 'Velocità 2', '00003': 'Velocità 3',
                                '00004': 'Velocità 4', '00005': 'Iperventilazione', '00006': 'Notturna', '00007': 'Free Cooling'} %}
          {% set free_h_c= states('sensor.vmc_master_alert_monitoraggio_free_heating_o_free_cooling') %}
          {% if is_state('sensor.vmc_master_status_mese_corrente_freeheating_o_freecooling', 'Free Heating') and free_h_c != "[Non Calcolabile]" %}
            {% set codici = {'00000': 'Velocità 0', '00001': 'Velocità 1', '00002': 'Velocità 2', '00003': 'Velocità 3',
                             '00004': 'Velocità 4', '00005': 'Iperventilazione', '00006': 'Notturna', '00007': 'Free Heating'} %}
          {% elif is_state('sensor.vmc_master_status_mese_corrente_freeheating_o_freecooling', 'Free Cooling') and free_h_c != "[Non Calcolabile]" %}
            {% set codici = codici_base %}
          {% elif ( is_state('sensor.vmc_master_status_mese_corrente_freeheating_o_freecooling', 'Disabilitata') or free_h_c == "[Non Calcolabile]") %}
            {% set codici = {'00000': 'Velocità 0', '00001': 'Velocità 1', '00002': 'Velocità 2', '00003': 'Velocità 3',
                             '00004': 'Velocità 4', '00005': 'Iperventilazione', '00006': 'Notturna', '00007': 'Free Cool./Heat.'} %}
          {% else %}
            {% set codici = codici_base %}
          {% endif %}
          {% if states('sensor.vmc_master_status_ventola') in stati %}
            Non disponibile
          {% else %}
            {% set componenti = states('sensor.vmc_master_status_ventola').split(',') %}
            {% if componenti | length > 1 %}
              {% set codice = componenti[1] %}
              {{ codici.get(codice, 'Non disponibile') }}
            {% else %}
              Non disponibile
            {% endif %}
          {% endif %}
        icon_template: mdi:fan

      vmc_master_status_sensori_lettura_codice_interpretato:                   # [CONFIGURAZIONE 0 RICHIAMI] [INTERFACCIA PIU’ RICHIAMI] [AUTOMAZIONE 0 RICHIAMI] SENSORE DI INTERPRETAZIONE DELL'ATTIVAZIONE O MENO DELLE ROUTINE MEMORIZZATE NELLA VMC (ES. SE PRESENTE ALLARME UMIDITA' -> MASSIMA VELOCITA'), CORRELATE AI SENSORI DELLA VMC CONVERITA IN "STRINGA", PREVIA VERIFICA DI AVVENUTA LETTURA DEI DATI "VELOCITA'" MEMORIZZATI NELLA VMC
        friendly_name: "Status Routine Sensori"
        value_template: >
          {% set stati = ["sconosciuto", "unknown", "", none, "unavailable", "Non disponibile"] %}
          {% set codici = {'00003': 'Spenti', '00001': 'Accesi', '00002': 'Spenti', '00000': 'Accesi'} %}
          {% if states('sensor.vmc_master_status_ventola') in stati %}
            Non disponibile
          {% else %}
            {% set componenti = states('sensor.vmc_master_status_ventola').split(',') %}
            {% if componenti | length > 4 %}
              {% set codice = componenti[4] %}
              {{ codici.get(codice, 'Non disponibile') }}
            {% else %}
              Non disponibile
            {% endif %}
          {% endif %}
        icon_template: mdi:chip

      vmc_master_status_led_pannello_lettura_codice_interpretato:              # [CONFIGURAZIONE 0 RICHIAMI] [INTERFACCIA PIU’ RICHIAMI] [AUTOMAZIONE 0 RICHIAMI] SENSORE DI INTERPRETAZIONE DELLA LETTURA DELL'ATTIVAZIONE O MENO DEL PANNELLO LED MEMORIZZATI NELLA VMC, PREVIA VERIFICA DI AVVENUTA LETTURA DEI DATI "VELOCITA'" MEMORIZZATI NELLA VMC
        friendly_name: "Status Led Pannello"
        value_template: >
          {% set stati = ["sconosciuto", "unknown", "", none, "unavailable", "Non disponibile"] %}
          {% if states('sensor.vmc_master_status_ventola') in stati %}
            Non disponibile
          {% else %}
            {% set componenti = states('sensor.vmc_master_status_ventola').split(',') %}
            {% if componenti | length > 14 %}
              {% set codice = componenti[14] %}
              {% if codice == '00000' %}
                Spento
              {% elif codice == '00032' %}
                Verificare Filtro
              {% else %}
                Acceso
              {% endif %}
            {% else %}
              Non disponibile
            {% endif %}
          {% endif %}
        icon_template: mdi:led-on 
################### Fine Creazione Sensori di Lettura Collegamento tramite Status IP, Nome, Stato Ventola, Stato Sensoristico, Stato Led Pannello della VMC  #################################################################

################### Inizio Creazione Sensori di Lettura Temp. Interna, Esterna, Umidità, CO₂ e VOC della VMC E SENSORI SELEZIONATI  #################################################################################################################
      vmc_master_temp_esterna_positivo_negativo:                               # [CONFIGURAZIONE PIù RICHIAMI] [INTERFACCIA 0 RICHIAMI] [AUTOMAZIONE 0 RICHIAMI]SENSORE PER DETERMINARE SE IL VALORE DELLA TEMEPARTURA ESTERNA SARA' POSITIVA O NEGATIVA; ATTENZIONE E' UNA PRESUNZIONE DELLO SCRIVENTE IN QUANTO NON HO MAI VISUALIZZATO UNA TEMPERATURA NEGATIVA NELLA VMC, VERIFICA CHE NELLA POSIZIONE DELL'ARRAY [2] IL PRIMO NUMERO E' 1 ES. [10300], OVVERO -30,0 °C
        friendly_name: "Segno Temperatura Esterna"
        value_template: >
          {% set stati = ["sconosciuto", "unknown", "", none, "unavailable", "Non disponibile"] %}
          {% if states('sensor.vmc_master_sensori') in stati %}
            Non disponibile
          {% else %}
            {% set componenti = states('sensor.vmc_master_sensori').split(',') %}
            {% if componenti | length > 2 %}
              {% set first_digit = componenti[2][0] %}
              {% if first_digit == '1' %}
                negativo
              {% else %}
                positivo
              {% endif %}
            {% else %}
              Non disponibile
            {% endif %}
          {% endif %}
        icon_template: mdi:home-thermometer-outline

      vmc_master_temp_interna_positivo_negativo:                               # [CONFIGURAZIONE PIù RICHIAMI] [INTERFACCIA 0 RICHIAMI] [AUTOMAZIONE 0 RICHIAMI]SENSORE PER DETERMINARE SE IL VALORE DELLA TEMEPARTURA INTERNA SARA' POSITIVA O NEGATIVA; ATTENZIONE E' UNA PRESUNZIONE DELLO SCRIVENTE IN QUANTO NON HO MAI VISUALIZZATO UNA TEMPERATURA NEGATIVA NELLA VMC, VERIFICA CHE NELLA POSIZIONE DELL'ARRAY [1] IL PRIMO NUMERO E' 1 ES. [10200], OVVERO -20,0 °C
        friendly_name: "Segno Temperatura Interna"
        value_template: >
          {% set stati = ["sconosciuto", "unknown", "", none, "unavailable", "Non disponibile"] %}
          {% if states('sensor.vmc_master_sensori') in stati %}
            Non disponibile
          {% else %}
            {% set componenti = states('sensor.vmc_master_sensori').split(',') %}
            {% if componenti | length > 1 %}
              {% set first_digit = componenti[1][0] %}
              {% if first_digit == '1' %}
                negativo
              {% else %}
                positivo
              {% endif %}
            {% else %}
              Non disponibile
            {% endif %}
          {% endif %}
        icon_template: mdi:home-thermometer

      vmc_master_temp_esterna_status:                                          # [CONFIGURAZIONE, PIù RICHIAMI] [INTERFACCIA, PIU’ RICHIAMI] [AUTOMAZIONE PIù RICHIAMI] SENSORE DI LETTURA TEMPERATUIRA ESTERNA  MEMORIZZATA NEL SENSORE vmc_master_temperatura_esterna_selezionata + OFFSET MANUALE, PREVIA VERIFICA DI AVVENUTA LETTURA DEI DATI "SENSORI" MEMORIZZATI NELLA VMC
        friendly_name: "Temperatura Ext. [°C]"
        value_template: >
          {% set stati = ['unknown', 'unavailable', '-100', 'Non disponibile'] %}
          {% set temp_ext = states('sensor.vmc_master_temperatura_esterna_selezionata') %}
          {% if temp_ext in stati %}
            Non disponibile
          {% else %}
            {% set temp_float = temp_ext | float(default=none) %}
            {% if temp_float == none %}
              [Non Calcolabile]
            {% else %}
              {{ temp_float + float(states('input_number.vmc_master_offset_temp_esterna')) | round(1)}}
            {% endif %}
          {% endif %}
        icon_template: mdi:home-thermometer-outline

      vmc_master_temp_esterna_status_senza_offset:                         # [CONFIGURAZIONE, 0 RICHIAMO] [INTERFACCIA, 1 RICHIAMO] [AUTOMAZIONE 0 RICHIAMI] SENSORE DI LETTURA TEMPERATUIRA ESTERNA  MEMORIZZATA NEL SENSORE DELLA VMC, PREVIA VERIFICA DI AVVENUTA LETTURA DEI DATI "SENSORI" MEMORIZZATI NELLA VMC; ATTENZIONE NELLA PRESUNZIONE NEL CALCOLO DI VERIFICA SE LA TEMPERATURA E' POSITIVA O NEGATIVA; SE IL PRIMO VALORE DEL SECONDO CAMPO [2] DELL'ARRAY E' 1 IL CALCOLO VERRA' ESEGUITO ESCLUDENDO IL PRIMO VALORE [2][1:] ES. 10200 -> 0200 -> -20,0 °C
        friendly_name: "Temperatura Ext. [°C]"
        value_template: >
          {% set stati = ['unknown', 'unavailable', '-100', 'Non disponibile'] %}
          {% set sensor_value = states('sensor.vmc_master_sensori') %}
          {% set temp_sign = states('sensor.vmc_master_temp_esterna_positivo_negativo') %}
          {% if sensor_value not in stati and temp_sign in ['positivo', 'negativo'] %}
            {% set componenti = sensor_value.split(',') %}
            {% if componenti | length > 2 %}
              {% set raw_temp = componenti[2] %}
              {% if raw_temp.isdigit() or (raw_temp.startswith('1') and raw_temp[1:].isdigit()) %}
                {% if temp_sign == "negativo" %}
                  {% set temp_value = - (float(int(raw_temp[1:]) / 10)) %}
                {% else %}
                  {% set temp_value = float(int(raw_temp) / 10) %}
                {% endif %}
                {{ temp_value | round(1) }}
              {% else %}
                Non disponibile
              {% endif %}
            {% else %}
              Non disponibile
            {% endif %}
          {% else %}
            Non disponibile
          {% endif %}
        icon_template: mdi:home-thermometer-outline

      vmc_master_temp_interna_status:                                          # [CONFIGURAZIONE, PIU’ RICHIAMI] [INTERFACCIA, PIU’ RICHIAMI] [AUTOMAZIONE 0 RICHIAMI] SENSORE DI LETTURA TEMPERATURA INTERNA MEMORIZZATA NEL SENSORE vmc_master_temperatura_interna_selezionata + OFFSET MANUALE
        friendly_name: "Temperatura Int. [°C]"
        value_template: >
          {% set stati = ['unknown', 'unavailable', '-100', 'Non disponibile'] %}
          {% set temp_int = states('sensor.vmc_master_temperatura_interna_selezionata') %}
          {% if temp_int in stati %}
            Non disponibile
          {% else %}
            {% set temp_float = temp_int | float(default=none) %}
            {% if temp_float == none %}
              [Non Calcolabile]
            {% else %}
              {{ temp_float + float(states('input_number.vmc_master_offset_temp_interna')) | round(1)}}
            {% endif %}
          {% endif %}
        icon_template: mdi:home-thermometer

      vmc_master_temp_interna_status_senza_offset:                             # [CONFIGURAZIONE, PIU’ RICHIAMI] [INTERFACCIA, 1 RICHIAMO] [AUTOMAZIONE 0 RICHIAMI] SENSORE DI LETTURA TEMPERATURA INTERNA MEMORIZZATA NELLA VMC SENZA OFFSET MANUALE, PREVIA VERIFICA DI AVVENUTA LETTURA DEI DATI "SENSORI" MEMORIZZATI NELLA VMC; ATTENZIONE NELLA PRESUNZIONE NEL CALCOLO DI VERIFICA SE LA TEMPERATURA E' POSITIVA O NEGATIVA; SE IL PRIMO VALORE DEL PRIMO CAMPO [1] DELL'ARRAY E' 1 IL CALCOLO VERRA' ESEGUITO ESCLUDENDO IL PRIMO VALORE [1][1:] ES. 10200 -> 0200 -> -20,0 °C
        friendly_name: "Temperatura Int. [°C]"
        value_template: >
          {% set stati = ['unknown', 'unavailable', '-100', 'Non disponibile'] %}
          {% set sensor_value = states('sensor.vmc_master_sensori') %}
          {% set temp_sign = states('sensor.vmc_master_temp_interna_positivo_negativo') %}
          {% if sensor_value not in stati and temp_sign in ['positivo', 'negativo'] %}
            {% set componenti = sensor_value.split(',') %}
            {% if componenti | length > 1 %}
              {% set raw_temp = componenti[1] %}
              {% if raw_temp.isdigit() or (raw_temp.startswith('1') and raw_temp[1:].isdigit()) %}
                {% if temp_sign == "negativo" %}
                  {% set temp_value = - (float(int(raw_temp[1:]) / 10)) %}
                {% else %}
                  {% set temp_value = float(int(raw_temp) / 10) %}
                {% endif %}
                {{ temp_value | round(1) }}
              {% else %}
                Non disponibile
              {% endif %}
            {% else %}
              Non disponibile
            {% endif %}
          {% else %}
            Non disponibile
          {% endif %}
        icon_template: mdi:home-thermometer

      vmc_master_umidita_esterna_status:                                       # [CONFIGURAZIONE, PIU’ RICHIAMI] [INTERFACCIA, PIU’ RICHIAMI] [AUTOMAZIONE 0 RICHIAMI] SENSORE DI LETTURA UMIDITA' ESTERNA  MEMORIZZATA NEL SENSORE vmc_master_umidita_esterna_selezionata + OFFSET MANUALE, PREVIA VERIFICA DI AVVENUTA LETTURA DEI DATI "SENSORI" MEMORIZZATI NELLA VMC
        friendly_name: "Umidità Ext. [%]"
        value_template: >
          {% set stati = ['unknown', 'unavailable', '-100', 'Non disponibile'] %}
          {% if states('sensor.vmc_master_umidita_esterna_selezionata') in stati %}
            Non disponibile
          {% else %}
            {% set humidity = states('sensor.vmc_master_umidita_esterna_selezionata') %}
            {% if humidity | float == none %}
              [Non Calcolabile]
            {% else %}
              {% set umidita_relativa_esterna = humidity | float + float(states('input_number.vmc_master_offset_umidita_esterna')) %}
              {% if umidita_relativa_esterna > 0 and umidita_relativa_esterna <= 100 %}
                {{ umidita_relativa_esterna }}
              {% elif umidita_relativa_esterna <= 0 %}
                [Non Calcolabile]
              {% else %}
                100
              {% endif %}
            {% endif %}
          {% endif %}
        icon_template: mdi:cloud-percent-outline

      vmc_master_umidita_interna_status:                                       # [CONFIGURAZIONE, PIU’ RICHIAMI] [INTERFACCIA, PIU’ RICHIAMI] [AUTOMAZIONE 0 RICHIAMI] SENSORE DI LETTURA UMIDITA' INTERNA MEMORIZZATA NEL SENSORE vmc_master_umidita_interna_selezionata + OFFSET MANUALE, PREVIA VERIFICA DI AVVENUTA LETTURA DEI DATI "SENSORI" MEMORIZZATI NELLA VMC
        friendly_name: "Umidità Int. [%]"
        value_template: >
          {% set stati = ['unknown', 'unavailable', '-100', 'Non disponibile'] %}
          {% set umidita_int = states('sensor.vmc_master_umidita_interna_selezionata') %}
          {% set offset = float(states('input_number.vmc_master_offset_umidita_interna')) %}
          {% if states('sensor.vmc_master_umidita_interna_selezionata') in stati %}
            Non disponibile
          {% else %}
            {% set umidita_float = umidita_int | float(default=none) %}
            {% if umidita_float is none %}
              [Non Calcolabile]
            {% else %}
              {% set umidita_relativa = umidita_float + offset %}
              {% if umidita_relativa > 100 %}
                100
              {% elif umidita_relativa <= 0 %}
                [Non Calcolabile]
              {% else %}
                {{ umidita_relativa | round(1) }}
              {% endif %}
            {% endif %}
          {% endif %}
        icon_template: mdi:cloud-percent

      vmc_master_umidita_interna_status_senza_offset:                            # [CONFIGURAZIONE 0 RICHIAMI] [INTERFACCIA, 1 RICHIAM0] [AUTOMAZIONE 0 RICHIAMI] SENSORE DI LETTURA UMIDITA' INTERNA MEMORIZZATA NELLA VMC SENZA OFFSET MANUALE, PREVIA VERIFICA DI AVVENUTA LETTURA DEI DATI "SENSORI" MEMORIZZATI NELLA VMC
        friendly_name: "Umidità Int. [%]"
        value_template: >
          {% set stati = ['unknown', 'unavailable', '-100', 'Non disponibile'] %}
          {% set dati_sensori = states('sensor.vmc_master_sensori') %}
          {% if dati_sensori in stati %}
            Non disponibile
          {% else %}
            {% set componenti = dati_sensori.split(',') %}
            {% if componenti|length > 3 %}
              {% set umidita_relativa = (float(componenti[3]) / 10) %}
              {% if umidita_relativa > 100 %}
                100
              {% elif umidita_relativa <= 0 %}
                [Non Calcolabile]
              {% else %}
                {{ umidita_relativa | round(1) }}
              {% endif %}
            {% else %}
              Non disponibile
            {% endif %}
          {% endif %}
        icon_template: mdi:cloud-percent

      vmc_master_co2_status:                                                   # [CONFIGURAZIONE, PIU’ RICHIAMI] [INTERFACCIA, PIU’ RICHIAMI] [AUTOMAZIONE 0 RICHIAMI] SENSORE DI LETTURA ANIDIRDE CARBONICA INTERNA MEMORIZZATA NEL SENSORE vmc_master_co2_interna_selezionata + OFFSET MANUALE, PREVIA VERIFICA DI AVVENUTA LETTURA DEI DATI "SENSORI" MEMORIZZATI NELLA VMC
        friendly_name: "CO₂ Int. [ppm]"
        value_template: >
          {% set stati = ['unknown', 'unavailable', '-100', 'Non disponibile'] %}
          {% set co2_int = states('sensor.vmc_master_co2_interna_selezionata') %}
          {% if co2_int == '-100' %}
            -
          {% elif co2_int in stati %}
            Non disponibile
          {% else %}
            {% set co2_float = co2_int | float(default=0) %}
            {% set co2_with_offset = (co2_float + states('input_number.vmc_master_offset_co2') | float(default=0)) | round(0) %}
            {% if co2_with_offset == 0 %}
              -
            {% elif co2_with_offset > 0 %}
              {{ co2_with_offset }}
            {% elif co2_with_offset < 0 %}
              -
            {% else %}
              Non disponibile
            {% endif %}
          {% endif %}
        icon_template: mdi:molecule-co2

      vmc_master_co2_status_senza_offset:                                        # [CONFIGURAZIONE, 0 RICHIAMI] [INTERFACCIA, 1 RICHIAMO] [AUTOMAZIONE 0 RICHIAMI] SENSORE DI LETTURA ANIDRIDE CARBONICA INTERNA MEMORIZZATA NELLA VMC SENZA OFFSET MANUALE, PREVIA VERIFICA DI AVVENUTA LETTURA DEI DATI "SENSORI" MEMORIZZATI NELLA VMC
        friendly_name: "Anidride Carbonica, CO₂ Int. [ppm]"
        value_template: >
          {% set stati = ["sconosciuto", "unknown", "", none, "unavailable", "Non disponibile"] %}
          {% set dati_sensori = states('sensor.vmc_master_sensori') %}
          {% if dati_sensori in stati %}
            Non disponibile
          {% else %}
            {% set componenti = dati_sensori.split(',') %}
            {% if componenti|length > 4 %}
              {% set co2 = float(componenti[4]) %}
              {% if co2 > 0 %}
                {{ co2|round(0) }}
              {% else %}
                -
              {% endif %}
            {% else %}
              Non disponibile
            {% endif %}
          {% endif %}
        icon_template: mdi:molecule-co2

      vmc_master_voc_status:                                                    # [CONFIGURAZIONE, PIU’ RICHIAMI] [INTERFACCIA, PIU’ RICHIAMI] [AUTOMAZIONE 0 RICHIAMI]  SENSORE DI LETTURA COMPOSTI ORGANICI VOLATICI INTERNI MEMORIZZATI NELLA VMC + OFFSET MANUALE TRASFORMATI DA PPB [DEFAULT VMC] IN PPM, PREVIA VERIFICA DI AVVENUTA LETTURA DEI DATI "SENSORI" MEMORIZZATI NELLA VMC
        friendly_name: "VOC Int. [ppb]"
        value_template: >
          {% set stati = ["sconosciuto", "unknown", "", none, "unavailable", "Non disponibile"] %}
          {% set dati_sensori = states('sensor.vmc_master_sensori') %}
          {% if dati_sensori in stati %}
            Non disponibile
          {% else %}
            {% set componenti = dati_sensori.split(',') %}
            {% if componenti|length > 11 %}
              {% set voc = float(componenti[11]) + float(states('input_number.vmc_master_offset_voc')) %}
              {% if voc > 0 %}
                {{ voc|round(0) }}
              {% else %}
                -
              {% endif %}
            {% else %}
              Non disponibile
            {% endif %}
          {% endif %}
        icon_template: mdi:weather-dust

      vmc_master_voc_status_senza_offset:                                       # [CONFIGURAZIONE, 0 RICHIAMI] [INTERFACCIA, 1 RICHIAMO] [AUTOMAZIONE 0 RICHIAMI]  SENSORE DI LETTURA COMPOSTI ORGANICI VOLATICI INTERNI MEMORIZZATI NELLA VMC SENZA OFFSET MANUALE TRASFORMATI DA PPB [DEFAULT VMC] IN PPM, PREVIA VERIFICA DI AVVENUTA LETTURA DEI DATI "SENSORI" MEMORIZZATI NELLA VMC
        friendly_name: "Composti Organici Volatici, VOC Int. [ppb]"
        value_template: >
          {% set stati = ["sconosciuto", "unknown", "", none, "unavailable", "Non disponibile"] %}
          {% set dati_sensori = states('sensor.vmc_master_sensori') %}
          {% if dati_sensori in stati %}
            Non disponibile
          {% else %}
            {% set componenti = dati_sensori.split(',') %}
            {% if componenti|length > 11 %}
              {% set voc = float(componenti[11]) %}
              {% if voc > 0 %}
                {{ voc|round(0) }}
              {% else %}
                -
              {% endif %}
            {% else %}
              Non disponibile
            {% endif %}
          {% endif %}
        icon_template: mdi:weather-dust
################### Fine Creazione Sensori di Lettura Temp. Interna, Esterna, Umidità, CO₂ e VOC della VMC E SENSORI SELEZIONATI  ################################################################################################################################################

################### Inizio Creazione Sensori per l'INTERFACCIA per la Lettura Umidità Verifica Superamento Lim. Δ P. di Rugiada, VMC Congelamento ≤ -18 [°C] Temp. Esterna ?, VMC Sensori Int. Δ Temp. > 23 [°C] ? della VMC ATTRAVERSO I SENSORI SELEZIONATI TRAMITE INTERFACCIA ###################
      vmc_master_umidita_interna_status_verifica_soglia_valore:                # [CONFIGURAZIONE 0 RICHIAMI] [INTERFACCIA, PIU’ RICHIAMI] [AUTOMAZIONE 0 RICHIAMI] SENSORE MONITORAGGIO UMIDITA' INTERNA LETTA DALLA VMC
        friendly_name: "Livello di Umidità"
        value_template: >
          {% set stati = ["sconosciuto", "unknown", "", none, "unavailable", "Non disponibile"] %}
          {% set umidita_soglia = states('sensor.vmc_master_umidita_interna_status') %}
          {% set umidita_soglia_limite = states('input_number.vmc_master_umidita_avvio') | float %}
          {% if umidita_soglia in stati %}
            [Non Calcolabile]
          {% else %}
            {% set umidita_soglia_float = umidita_soglia | float(default=none) %}
            {% if umidita_soglia_float is none %}
              [Non Calcolabile]
            {% else %}
              {% if umidita_soglia_float > 0 and umidita_soglia_float <= 35 %}
                UMIDITÀ AL {{ umidita_soglia_float }}%. POSSIBILE SECCHEZZA, DISIDRATAZIONE. SI CONSIGLIA DI UMIDIFICARE L'AMBIENTE.
              {% elif umidita_soglia_float > 35 and umidita_soglia_float < umidita_soglia_limite %}
                UMIDITÀ AL {{ umidita_soglia_float }}%. SITUAZIONE NORMALE.
              {% elif umidita_soglia_float >= umidita_soglia_limite and umidita_soglia_float <= 100 %}
                UMIDITÀ AL {{ umidita_soglia_float }}%. POTREBBE VERIFICARSI UNA PROLIFERAZIONE DI MUFFE E BATTERI. SI CONSIGLIA DI DEUMIDIFICARE L'AMBIENTE.
              {% else %}
                [Non Calcolabile]
              {% endif %}
            {% endif %}
          {% endif %}
        icon_template: mdi:water-percent

      vmc_master_punto_di_rugiada_verifica_confronto_valore:                   # [CONFIGURAZIONE 0 RICHIAMI] [INTERFACCIA, PIU’ RICHIAMI] [AUTOMAZIONE 0 RICHIAMI] SENSORE DI MONITORAGGIO DEL PUNTO DI RUGIADA ESTERNO - PUNTO DI RUGIADA INTERNO < DELTA (OVVERO IL VALORE DEL SENSORE vmc_master_offset_verifica_impiego_vmc [°C]); DIVERSAMENTE NON DEVE ESSERE IMPIEGATA LA VMC
        friendly_name: "Verifica Superamento Lim. Δ P. di Rugiada"
        value_template: >
          {% set stati = ["sconosciuto", "unknown", "", none, "unavailable", "Non disponibile"] %}
          {% if states('sensor.vmc_master_sensori') in stati %}
            Non disponibile
          {% else %}
            {# Leggiamo i valori dei punti di rugiada #}
            {% set PdRi_str = states('sensor.vmc_master_punto_di_rugiada_interno') %}
            {% set PdRe_str = states('sensor.vmc_master_punto_di_rugiada_esterno') %}
            {% set calcolabilita = states('sensor.vmc_master_punto_di_rugiada_interno_esterno_non_calcolabile') %}
            
            {# Se non è calcolabile l'insieme interno-esterno #}
            {% if calcolabilita == '[Non Calcolabile]' %}
              [Non Calcolabile]
            {% else %}
              {# Verifica stati dei singoli sensori di rugiada #}
              {% if PdRi_str in ['Non disponibile'] or PdRe_str in ['Non disponibile'] %}
                Non disponibile
              {% elif PdRi_str == '[Non Calcolabile]' or PdRe_str == '[Non Calcolabile]' %}
                [Non Calcolabile]
              {% else %}
                {# Proviamo a convertire i valori in numeri #}
                {% set PdRi_val = PdRi_str | float(default=none) %}
                {% set PdRe_val = PdRe_str | float(default=none) %}
                
                {# Se non sono numeri validi #}
                {% if PdRi_val is none or PdRe_val is none %}
                  [Non Calcolabile]
                {% else %}
                  {# Leggiamo Delta con float(default=none) per gestire meglio indisponibilità o errori #}
                  {% set Delta = states('input_number.vmc_master_offset_verifica_impiego_vmc') | float(default=none) %}
                  
                  {# Se Delta non è disponibile o non numerico #}
                  {% if Delta is none %}
                    [Non Calcolabile]
                  {% else %}
                    {% set diff = (PdRe_val - PdRi_val) | round(2) %}
                    {% if diff < Delta %}
                      Δ PUNTO DI RUGIADA RILEVATO {{ diff }} °C MINORE DI {{ Delta }} °C DEL VALORE SETTATO.
                    {% elif diff == Delta %}
                      Δ PUNTO DI RUGIADA RILEVATO {{ diff }} °C UGUALE A {{ Delta }} °C DEL VALORE SETTATO.
                    {% else %}
                      Δ PUNTO DI RUGIADA RILEVATO {{ diff }} °C MAGGIORE DI {{ Delta }} °C DEL VALORE SETTATO.
                    {% endif %}
                  {% endif %}
                {% endif %}
              {% endif %}
            {% endif %}
          {% endif %}
        icon_template: mdi:hvac

      vmc_master_punto_di_rugiada_valore:                                       # [CONFIGURAZIONE 0 RICHIAMI] [INTERFACCIA, 1 RICHIAMO] [AUTOMAZIONE, 0 RICHIAMI] [INTERFACCIA, PIU’ RICHIAMI] SENSORE DI MONITORAGGIO DEL PUNTO DI RUGIADA ESTERNO - PUNTO DI RUGIADA INTERNO
        friendly_name: "Δ Punto di Rugiada [Ext-Int] [°C]"
        value_template: >
          {% set stati = ["sconosciuto", "unknown", "", none, "unavailable", "Non disponibile"] %}
          {% if states('sensor.vmc_master_sensori') in stati %}
            Non disponibile
          {% else %}
            {% set PdRi_str = states('sensor.vmc_master_punto_di_rugiada_interno') %}
            {% set PdRe_str = states('sensor.vmc_master_punto_di_rugiada_esterno') %}
            {% set calcolabilita = states('sensor.vmc_master_punto_di_rugiada_interno_esterno_non_calcolabile') %}
      
            {# Valuta lo stato di calcolabilità #}
            {% if calcolabilita == 'Non disponibile' %}
              Non disponibile
            {% elif calcolabilita == '[Non Calcolabile]' %}
              [Non Calcolabile]
            {% elif calcolabilita == 'Si può impiegare' %}
              {# Se calcolabile, verifichiamo i singoli sensori interno ed esterno #}
              {% if PdRi_str == 'Non disponibile' or PdRe_str == 'Non disponibile' %}
                Non disponibile
              {% elif PdRi_str == '[Non Calcolabile]' or PdRe_str == '[Non Calcolabile]' %}
                [Non Calcolabile]
              {% else %}
                {% set PdRi_val = PdRi_str | float(default=none) %}
                {% set PdRe_val = PdRe_str | float(default=none) %}
                
                {% if PdRi_val is none or PdRe_val is none %}
                  [Non Calcolabile]
                {% else %}
                  {{ (PdRe_val - PdRi_val) | round(2) }}
                {% endif %}
              {% endif %}
            {% else %}
              {# Nel caso in cui calcolabilità non sia nessuno degli stati attesi #}
              [Non Calcolabile]
            {% endif %}
          {% endif %}
        icon_template: mdi:hvac
################### Fine Creazione Sensori per l'INTERFACCIA per la Lettura Umidità, Verifica Superamento Lim. Δ P. di Rugiada, VMC Congelamento ≤ -18 [°C] Temp. Esterna ?, VMC Sensori Int. Δ Temp. > 23 [°C] ? della VMC ATTRAVERSO I SENSORI SELEZIONATI TRAMITE INTERFACCIA ###################

################### Inizio Creazione Sensori di Monitoraggio per fare scattare i PopUp ove richiesto #############################################################################################################################
      vmc_master_umidita_interna_status_verifica_soglia:                       # [CONFIGURAZIONE PIù RICHIAMI] [INTERFACCIA, 1 RICHIAMO] [AUTOMAZIONE, 0 RICHIAMI] SENSORE MONITORAGGIO UMIDITA' INTERNA LETTA DALLA VMC
        friendly_name: "Livello di Umidità"
        value_template: >
          {% set stati = ["sconosciuto", "unknown", "", none, "unavailable", "Non disponibile"] %}
          {% if states('sensor.vmc_master_sensori') in stati %}
            Non disponibile
          {% else %}
            {% set umidita_soglia = states('sensor.vmc_master_umidita_interna_status') %}
            {% set umidita_soglia_limite = states('input_number.vmc_master_umidita_avvio') | float %}
            {% if umidita_soglia not in ['unknown', 'unavailable', '[Non Calcolabile]'] %}
              {% set umidita_float = umidita_soglia | float(default=none) %}
              {% if umidita_float is none %}
                [Non Calcolabile]
              {% else %}
                {% if umidita_float >= 1 and umidita_float <= 35 %}
                  Possibile Secchezza, Disidratazione
                {% elif umidita_float > 35 and umidita_float < umidita_soglia_limite %}
                  Normale
                {% elif umidita_float >= umidita_soglia_limite and umidita_float <= 100 %}
                  Possibile Muffe, Batteri
                {% else %}
                  [Non Calcolabile]
                {% endif %}
              {% endif %}
            {% else %}
              [Non Calcolabile]
            {% endif %}
          {% endif %}
        icon_template: mdi:alarm-light-outline

      vmc_master_co2_status_verifica_soglia:                                   # [CONFIGURAZIONE PIù RICHIAMI] [INTERFACCIA, PIù RICHIAMO] [AUTOMAZIONE, 0 RICHIAMI] SENSORE DI MONITORAGIO DELLA CONCENTRAZIONE DI ANIDRIDE CARBONICA, IN FUNZIONE DEL VALORE LETTO NEL SENSORE vmc_master_co2_status , FORNENDO UN LIVELLO DI ATTENZIONE; VALORE DI SOGLIA IMPOSTATO NELLA VMC DI DEFAULT 1200 PPM 
        friendly_name: "Livello di Concentrazione CO₂ [ppm]"
        value_template: >
          {% set co2_raw = states('sensor.vmc_master_co2_status') %}
          {% set stati = ["sconosciuto", "unknown", "", none, "unavailable", "Non disponibile"] %}
          {% if states('sensor.vmc_master_sensori') in stati %}
            Non disponibile
          {% else %}
            {% if co2_raw == '-' %}
              -
            {% else %}
              {% set co2 = co2_raw | float(default=none) %}
              {% if co2 is none %}
                [Non Disponibile]
              {% elif co2 <= 0 %}
                -
              {% elif co2 > 0 and co2 <= 350 %}
                Bassa Concentrazione
              {% elif co2 > 350 and co2 <= 600 %}
                Moderata Concentrazione
              {% elif co2 > 600 and co2 < 1200 %}
                Alta Concentrazione
              {% else %}
                Pessima Concentrazione
              {% endif %}
            {% endif %}
          {% endif %}
        icon_template: mdi:alarm-light-outline

      vmc_master_voc_status_verifica_soglia:                                   # [CONFIGURAZIONE PIù RICHIAMI] [INTERFACCIA, PIù RICHIAMO] [AUTOMAZIONE, 0 RICHIAMI] SENSORE DI MONITORAGIO DELLA CONCENTRAZIONE DEI COMPOSTI ORGANICI VOLATICI INTERNI, IN FUNZIONE DEL VALORE LETTO NEL SENSORE vmc_master_voc_status , FORNENDO UN LIVELLO DI ATTENZIONE; VALORE DI SOGLIA IMPOSTATO NELLA VMC DI DEFAULT 600 PPB
        friendly_name: "Livello di Concentrazione VOC [ppb]"
        value_template: >
          {% set voc_raw = states('sensor.vmc_master_voc_status') %}
          {% set stati = ["sconosciuto", "unknown", "", none, "unavailable", "Non disponibile"] %}
          {% if states('sensor.vmc_master_sensori') in stati %}
            Non disponibile
          {% else %}
            {% if voc_raw == '-' %}
              -
            {% else %}
              {% set voc = voc_raw | float(default=none) %}
              {% if voc is none %}
                [Non Disponibile]
              {% elif voc <= 0 %}
                -
              {% elif voc > 0 and voc <= 300 %}
                Bassa Concentrazione
              {% elif voc > 300 and voc <= 600 %}
                Moderata Concentrazione
              {% else %}
                Pessima Concentrazione
              {% endif %}
            {% endif %}
          {% endif %}
        icon_template: mdi:alarm-light-outline

      vmc_master_congelamento_verifica_soglia:                                 # [CONFIGURAZIONE 1 RICHIAMO] [INTERFACCIA, PIù RICHIAMO] [AUTOMAZIONE, 0 RICHIAMI] SENSORE MONITORAGGIO CONGELAMENTO - ATTENZIONE LEGGE IL SENSORE TEMPERATURA ESTERNA SELEZIONATA DALL'INTERFACCIA
        friendly_name: "VMC Congelamento ≤ -18 [°C] Temp. Esterna ?"
        value_template: >
          {% set stati = ["sconosciuto", "unknown", "", none, "unavailable", "Non disponibile"] %}
          {% if states('sensor.vmc_master_sensori') in stati %}
            Non disponibile
          {% else %}
            {% set congelamento = states('sensor.vmc_master_temp_esterna_status') | float(default=none) %}
            {% set congelamento_vmc = states('sensor.vmc_master_temp_esterna_status_senza_offset') | float(default=none) %}
            {% if congelamento is none or congelamento_vmc is none %}
              [Non Disponibile]
            {% elif congelamento <= -18 or congelamento_vmc <= -18 %}
              Si
            {% elif (congelamento > -18 and congelamento <= -15) or (congelamento_vmc > -18 and congelamento_vmc <= -15) %}
              [No ma Prossimo]
            {% else %}
              No
            {% endif %}
          {% endif %}
        icon_template: mdi:alarm-light-outline

      vmc_master_delta_temp_verifica_soglia:                                   # [CONFIGURAZIONE 1 RICHIAMO] [INTERFACCIA, PIù RICHIAMO] [AUTOMAZIONE, 0 RICHIAMI] SENSORE MONITORAGGIO DIFFERENZA DI TEMPERATURA (> 23 GRADI [°C]) NELLA VMC -> VELOCITA' 1 DELL'UNITA' PER DEFAULT, IMPARTITO DAL COSTRUTTORE - ATTENZIONE I SENSORI IMPIEGATI SONO CORRELATI ALLA VMC
        friendly_name: "VMC Sensori Int. Δ Temp. > 23 [°C] ?"
        value_template: >
          {% set stati = ["sconosciuto", "unknown", "", none, "unavailable", "Non disponibile"] %}
          {% if states('sensor.vmc_master_sensori') in stati %}
            Non disponibile
          {% else %}
            {% set temperatura_esterna = states('sensor.vmc_master_temp_esterna_status') | float(default=none) %}
            {% set temperatura_interna = states('sensor.vmc_master_temp_interna_status') | float(default=none) %}
            {% set temperatura_esterna_vmc = states('sensor.vmc_master_temp_esterna_status_senza_offset') | float(default=none) %}
            {% set temperatura_interna_vmc = states('sensor.vmc_master_temp_interna_status_senza_offset') | float(default=none) %}
            {% set congelamento = temperatura_esterna %}
            {% set congelamento_vmc = temperatura_esterna_vmc %}
            {% if temperatura_esterna is none or temperatura_interna is none or congelamento is none or congelamento_vmc is none %}
              [Non Disponibile]
            {% elif (congelamento <= -18 or congelamento_vmc <= -18) %}
              -                                                               
            {% else %}
              {% set delta = (temperatura_interna - temperatura_esterna) | round(1) %}
              {% set delta_vmc = (temperatura_interna_vmc - temperatura_esterna_vmc) | round(1) %}
              {% if (delta > 23 or delta_vmc > 23) %}
                Si
              {% elif ((delta >= 20 and delta <= 23) or (delta_vmc >= 20 and delta_vmc <= 23)) %}
                [No ma Prossimo]
              {% else %}
                No
              {% endif %}
            {% endif %}
          {% endif %}
        icon_template: mdi:alarm-light-outline

      vmc_master_punto_di_rugiada_interno:                                     # [CONFIGURAZIONE, PIU’ RICHIAMI] [INTERFACCIA, PIU’ RICHIAMI] [AUTOMAZIONE, 0 RICHIAMI] SENSORE DI MONITORAGIO DEL PUNTO DI RUGIADA INTERNO, IN FUNZIONE DELLA TEMEPRATURA INTERNA ED UMIDITA' INTERNA LETTA DALLA VMC
        friendly_name: "Punto di Rugiada Int. [°C]"
        value_template: >
          {% set stati = ['unknown','unavailable'] %}
          {% if states('sensor.vmc_master_sensori') in stati %}
            Non disponibile
          {% else %}
            {% set Rh = states('sensor.vmc_master_umidita_interna_status') | float(default=none) %}
            {% set Tc = states('sensor.vmc_master_temp_interna_status') | float(default=none) %}
            {% if Rh is none or Tc is none %}
              [Non Disponibile]
            {% else %}
              {% set Es = 6.11 * 10**((7.5*Tc)/(237.7+Tc)) %}
              {% set E = (Es * Rh) / 100 %}
              {% if Rh > 0 and Rh <= 100 and E > 0 %}
                {% set Dp = (-430.22 + 237.7 * log(E)) / (-log(E) + 19.08) %}
                {{ Dp|round(2) }}
              {% else %}
                [Non Calcolabile]
              {% endif %}
            {% endif %}
          {% endif %}
        icon_template: mdi:thermometer-water

      vmc_master_punto_di_rugiada_esterno:                                     # [CONFIGURAZIONE, PIU’ RICHIAMI] [INTERFACCIA, PIU’ RICHIAMI] [AUTOMAZIONE, 0 RICHIAMI] SENSORE DI MONITORAGIO DEL PUNTO DI RUGIADA ESTERNO, IN FUNZIONE DELLA TEMEPRATURA ESTERNA LETTA DALLA VMC E DALL'UMNIDITA' ESTERNA LETTA DAL SENSORE vmc_master_selected_weather_entity
        friendly_name: "Punto di Rugiada Ext. [°C]"
        value_template: >
          {% set stati = ["sconosciuto", "unknown", "", none, "unavailable", "Non disponibile"] %}
          {% if states('sensor.vmc_master_sensori') in stati %}
            Non disponibile
          {% else %}
            {% set Rh = states('sensor.vmc_master_umidita_esterna_status') | float(default=none) %}
            {% set Tc = states('sensor.vmc_master_temp_esterna_status') | float(default=none) %}
      
            {% if Rh is none or Tc is none %}
              [Non Disponibile]
            {% else %}
              {% set Es = 6.11 * 10**((7.5*Tc)/(237.7+Tc)) %}
              {% set E = Es * Rh / 100 %}
      
              {% if Rh > 0 and Rh <= 100 and E > 0 %}
                {% set Dp = (-430.22 + 237.7 * log(E)) / (-log(E) + 19.08) %}
                {{ Dp|round(2) }}
              {% else %}
                [Non Calcolabile]
              {% endif %}
            {% endif %}
          {% endif %}
        icon_template: mdi:water-thermometer-outline

      vmc_master_punto_di_rugiada_interno_esterno_non_calcolabile:             # [CONFIGURAZIONE PIU’ RICHIAMI] [INTERFACCIA, 0 RICHIAMI] [AUTOMAZIONE, 0 RICHIAMI] SENSORE DI MONITORAGGIO DEL PUNTO DI RUGIADA ESTERNO E PUNTO DI RUGIADA INTERNO DIVERSO DA "NON CALCOLABILE"
        friendly_name: "Verifica Punto di Rugiada Ext o Int se Calcolabile"
        value_template: >
          {% set stati = ["sconosciuto", "unknown", "", none, "unavailable", "Non disponibile"] %}
          {% if states('sensor.vmc_master_sensori') in stati %}
            Non disponibile
          {% else %}
            {% set PdRi = states('sensor.vmc_master_punto_di_rugiada_interno') %}
            {% set PdRe = states('sensor.vmc_master_punto_di_rugiada_esterno') %}
            
            {% if PdRi == '[Non Calcolabile]' or PdRe == '[Non Calcolabile]' %}
              [Non Calcolabile]
            {% elif PdRi == 'Non disponibile' or PdRe == 'Non disponibile' %}
              Non disponibile
            {% else %}
              Si può impiegare
            {% endif %}
          {% endif %}
        icon_template: mdi:hvac

      vmc_master_punto_di_rugiada_verifica_confronto:                          #  [CONFIGURAZIONE PIU’ RICHIAMI] [INTERFACCIA, PIù RICHIAMI] [AUTOMAZIONE, PIù RICHIAMI] SENSORE DI MONITORAGGIO DEL PUNTO DI RUGIADA ESTERNO - PUNTO DI RUGIADA INTERNO < DELTA (OVVERO IL VALORE DEL SENSORE vmc_master_offset_verifica_impiego_vmc [°C]); DIVERSAMENTE NON DEVE ESSERE IMPIEGATA LA VMC
        friendly_name: "Verifica Lim. Δ P. di Rugiada"
        value_template: >
          {% set stati = ["sconosciuto", "unknown", "", none, "unavailable", "Non disponibile"] %}
          {% if states('sensor.vmc_master_sensori') in stati %}
            Non disponibile
          {% else %}
            {% set PdRi = states('sensor.vmc_master_punto_di_rugiada_interno') %}
            {% set PdRe = states('sensor.vmc_master_punto_di_rugiada_esterno') %}
            {% set Delta = states('input_number.vmc_master_offset_verifica_impiego_vmc') | float(default=none) %}
            {% set calcolabile = states('sensor.vmc_master_punto_di_rugiada_interno_esterno_non_calcolabile') %}
            {% if calcolabile == '[Non Calcolabile]' %}
              [Non Calcolabile]
            {% else %}
              {% set PdRi_val = PdRi | float(default=none) %}
              {% set PdRe_val = PdRe | float(default=none) %}
              {% if PdRi_val is none or PdRe_val is none or Delta is none %}
                [Non Disponibile]
              {% else %}
                {% if (PdRe_val - PdRi_val) < Delta %}
                  Si può impiegare
                {% else %}
                  Se ne sconsiglia l'impiego
                {% endif %}
              {% endif %}
            {% endif %}
          {% endif %}
        icon_template: mdi:alarm-light-outline

      vmc_master_umidita_assoluta_interna:                                     # [CONFIGURAZIONE O RICHIAMI] [INTERFACCIA, PIU’ RICHIAMI] [AUTOMAZIONE, 0 RICHIAMI] SENSORE DI MONITORAGGIO DELL' UMIDITA' ASSOLUTA INTERNA
        friendly_name: "Umidità Assoluta Int. [g/m³]"
        value_template: >
          {% set stati = ["sconosciuto", "unknown", "", none, "unavailable", "Non disponibile"] %}
          {% if states('sensor.vmc_master_sensori') in stati %}
            Non disponibile
          {% else %}
            {% set h_str = states('sensor.vmc_master_umidita_interna_status') %}
            {% set t_str = states('sensor.vmc_master_temp_interna_status') %}
      
            {# Controllo se i sensori di temperatura/umidità sono disponibili e calcolabili #}
            {% if h_str == 'Non disponibile' or t_str == 'Non disponibile' %}
              Non disponibile
            {% elif h_str == '[Non Calcolabile]' or t_str == '[Non Calcolabile]' %}
              [Non Calcolabile]
            {% else %}
              {# Prova a convertire i valori in float #}
              {% set h_val = h_str | float(default=none) %}
              {% set t_val = t_str | float(default=none) %}
      
              {# Se la conversione non riesce o i valori non sono positivi, non sono calcolabili #}
              {% if h_val is none or t_val is none or h_val <= 0 or t_val <= 0 %}
                [Non Calcolabile]
              {% else %}
                {# Calcolo dell'umidità assoluta:
                   Umidità Assoluta (g/m³) = (h * 6.112 * 2.1674 * exp((17.67*t)/(t+243.5))) / (t+273.15)
                   Nota: h in %, t in °C
                #}
                {{ ((h_val * 6.112 * 2.1674 * e**((17.67 * t_val)/(t_val + 243.5))) / (t_val + 273.15)) | round(2) }}
              {% endif %}
            {% endif %}
          {% endif %}
        icon_template: mdi:cloud-percent

      vmc_master_umidita_assoluta_esterna:                                     # [CONFIGURAZIONE O RICHIAMI] [INTERFACCIA, PIU’ RICHIAMI] [AUTOMAZIONE, 0 RICHIAMI]  SENSORE DI MONITORAGGIO DELL' UMIDITA' ASSOLUTA INTERNA
        friendly_name: "Umidità Assoluta Ext. [g/m³]"
        value_template: >
          {% set stati = ["sconosciuto", "unknown", "", none, "unavailable", "Non disponibile"] %}
          {% if states('sensor.vmc_master_sensori') in stati %}
            Non disponibile
          {% else %}
            {% set h_str = states('sensor.vmc_master_umidita_esterna_status') %}
            {% set t_str = states('sensor.vmc_master_temp_esterna_status') %}
      
            {# Controllo disponibilità #}
            {% if h_str == 'Non disponibile' or t_str == 'Non disponibile' %}
              Non disponibile
            {# Controllo se uno dei due è [Non Calcolabile] #}
            {% elif h_str == '[Non Calcolabile]' or t_str == '[Non Calcolabile]' %}
              [Non Calcolabile]
            {% else %}
              {# Conversione a float #}
              {% set h_val = h_str | float(default=none) %}
              {% set t_val = t_str | float(default=none) %}
      
              {# Se non numerico o ≤0, non si può calcolare #}
              {% if h_val is none or t_val is none or h_val <= 0 or t_val <= 0 %}
                [Non Calcolabile]
              {% else %}
                {# Calcolo dell'umidità assoluta: 
                   UA = (h% * 6.112 * 2.1674 * exp((17.67*t)/(t+243.5))) / (t+273.15)
                #}
                {{ ((h_val * 6.112 * 2.1674 * e**((17.67 * t_val)/(t_val + 243.5))) / (t_val + 273.15)) | round(2) }}
              {% endif %}
            {% endif %}
          {% endif %}
        icon_template: mdi:cloud-percent-outline
#### Fine Creazione Sensori di Monitoraggio per fare scattare i PopUp ove richiesto ###################################################################################################################

#### Inizio Creazione Sensore Confort Interno #########################################################################################################################################################
      vmc_master_calcolo_confort_interno:
        friendly_name: "Indice di Benessere Int."
        value_template: >-
          {%- set stati = ["sconosciuto", "unknown", "", none, "unavailable", "Non disponibile"] -%}
          {# 1) Se la VMC segnala sensori non disponibili --------------- #}
          {%- if states('sensor.vmc_master_sensori') in stati -%}
            Non disponibile
          {# 2) Prelevo il Punto di Rugiada calcolato ------------------- #}
          {%- else -%}
            {%- set dp_raw = states('sensor.vmc_master_punto_di_rugiada_interno') | trim -%}
    
            {# 2a) Idratazione non calcolabile / non disponibile -------- #}
            {%- if dp_raw in stati or dp_raw.startswith('[') -%}
              {{ dp_raw }}
            {# 2b) Valore numerico valido ------------------------------- #}
            {%- else -%}
              {%- set dp = dp_raw | float(default=none) -%}
    
              {%- if dp is none -%}
                [Non Calcolabile]
              {%- else -%}
                {# 3) Mappatura intervalli secondo la tabella ------------ #}
                {%- if    dp >= 29  -%} –
                {%- elif  dp >= 25  -%} Molto fastidioso, Liv. 2
                {%- elif  dp >= 22  -%} Molto fastidioso, Liv. 1
                {%- elif  dp >= 19  -%} Fastidioso
                {%- elif  dp >= 16  -%} Accettabile
                {%- elif  dp >= 13  -%} Confortevole, Liv. 2
                {%- elif  dp >= 10  -%} Confortevole, Liv. 1
                {%- elif  dp >= 7   -%} Umido
                {%- else              -%} –
                {%- endif -%}
    
              {%- endif -%}
            {%- endif -%}
          {%- endif -%}
        icon_template: mdi:water-thermometer
#### Fine Creazione Sensore Confort Interno ###########################################################################################################################################################

################### Inizio Creazione Sensori di Monitoraggio Muffa ####################################################################################################################################
      vmc_master_temp_interna_numeric:
        friendly_name: "Temp Interna Numerica"
        unit_of_measurement: "°C"
        value_template: >-
          {% set v = states('sensor.vmc_master_temp_interna_status') | float(none) %}
          {{ v if v is not none else none }}

      vmc_master_hum_interna_numeric:
        friendly_name: "Umidità Interna Numerica"
        unit_of_measurement: "%"
        value_template: >-
          {% set v = states('sensor.vmc_master_umidita_interna_status') | float(none) %}
          {{ v if v is not none else none }}

      # Rischio Muffa 4 Settimane
      vmc_master_calcolo_rischio_muffa_4w:
        friendly_name: "Rischio Muffa (Ultime 4 Settimane)"
        value_template: >-
          {%- set stati = ["sconosciuto", "unknown", "", none, "unavailable", "Non disponibile"] -%}
          {# 1) Se la VMC segnala sensori non disponibili #}
          {%- if states('sensor.vmc_master_sensori') in stati -%}
            Non disponibile
          {%- else -%}
            {% set temp = states('sensor.vmc_master_temp_interna_4w') | float(none) %}
            {% set hum  = states('sensor.vmc_master_hum_interna_4w')  | float(none) %}
            {% if temp is none or hum is none %}
              [Non Calcolabile]
            {% else %}
              {% set c1 = ([72, (20 * (2.718281828459045 ** (-0.15 * temp)) + 73), 100] | sort)[1] %}
              {% set c2 = ([79, (17 * (2.718281828459045 ** (-0.11 * temp)) + 80), 100] | sort)[1] %}
              {% set c3 = ([84, (15 * (2.718281828459045 ** (-0.10 * temp)) + 85), 100] | sort)[1] %}

              {% if temp < 0 or temp > 50 %}
                Rischio assente (condizioni estreme)
              {% elif hum <= c1 %}
                Liv. 0: nessuna crescita di muffa
              {% elif hum <= c2 %}
                Liv. 1: crescita possibile in > 8 Settimane
              {% elif hum <= c3 %}
                Liv. 2: crescita possibile in 4–8 Settimane
              {% else %}
                Liv. 3: crescita possibile in < 4 Settimane
              {% endif %}
            {% endif %}
          {%- endif %}
        icon_template: mdi:virus

      # Rischio Muffa 8 Settimane
      vmc_master_calcolo_rischio_muffa_8w:
        friendly_name: "Rischio Muffa (Ultime 8 Settimane)"
        value_template: >-
          {%- set stati = ["sconosciuto", "unknown", "", none, "unavailable", "Non disponibile"] -%}
          {%- if states('sensor.vmc_master_sensori') in stati -%}
            Non disponibile
          {%- else -%}
            {% set temp = states('sensor.vmc_master_temp_interna_8w') | float(none) %}
            {% set hum  = states('sensor.vmc_master_hum_interna_8w')  | float(none) %}
            {% if temp is none or hum is none %}
              [Non Calcolabile]
            {% else %}
              {% set c1 = ([72, (20 * (2.718281828459045 ** (-0.15 * temp)) + 73), 100] | sort)[1] %}
              {% set c2 = ([79, (17 * (2.718281828459045 ** (-0.11 * temp)) + 80), 100] | sort)[1] %}
              {% set c3 = ([84, (15 * (2.718281828459045 ** (-0.10 * temp)) + 85), 100] | sort)[1] %}

              {% if temp < 0 or temp > 50 %}
                Rischio assente (condizioni estreme)
              {% elif hum <= c1 %}
                Liv. 0: nessuna crescita di muffa
              {% elif hum <= c2 %}
                Liv. 1: crescita possibile in > 8 Settimane
              {% elif hum <= c3 %}
                Liv. 2: crescita possibile in 4–8 Settimane
              {% else %}
                Liv. 3: crescita possibile in < 4 Settimane
              {% endif %}
            {% endif %}
          {%- endif %}
        icon_template: mdi:virus

      # Rischio Muffa 12 Settimane
      vmc_master_calcolo_rischio_muffa_12w:
        friendly_name: "Rischio Muffa (Ultime 12 Settimane)"
        value_template: >-
          {%- set stati = ["sconosciuto", "unknown", "", none, "unavailable", "Non disponibile"] -%}
          {%- if states('sensor.vmc_master_sensori') in stati -%}
            Non disponibile
          {%- else -%}
            {% set temp = states('sensor.vmc_master_temp_interna_12w') | float(none) %}
            {% set hum  = states('sensor.vmc_master_hum_interna_12w')  | float(none) %}
            {% if temp is none or hum is none %}
              [Non Calcolabile]
            {% else %}
              {% set c1 = ([72, (20 * (2.718281828459045 ** (-0.15 * temp)) + 73), 100] | sort)[1] %}
              {% set c2 = ([79, (17 * (2.718281828459045 ** (-0.11 * temp)) + 80), 100] | sort)[1] %}
              {% set c3 = ([84, (15 * (2.718281828459045 ** (-0.10 * temp)) + 85), 100] | sort)[1] %}

              {% if temp < 0 or temp > 50 %}
                Rischio assente (condizioni estreme)
              {% elif hum <= c1 %}
                Liv. 0: nessuna crescita di muffa
              {% elif hum <= c2 %}
                Liv. 1: crescita possibile in > 8 Settimane
              {% elif hum <= c3 %}
                Liv. 2: crescita possibile in 4–8 Settimane
              {% else %}
                Liv. 3: crescita possibile in < 4 Settimane
              {% endif %}
            {% endif %}
          {%- endif %}
        icon_template: mdi:virus

      # Andamento Rischio Muffa (Trend)
      vmc_master_trend_muffa:
        friendly_name: "Andamento Rischio Muffa"
        value_template: >-
          {%- set stati = ["sconosciuto", "unknown", "", none, "unavailable", "Non disponibile"] -%}
          {# 1) Se la VMC segnala sensori non disponibili #}
          {%- if states('sensor.vmc_master_sensori') in stati -%}
            Non disponibile
          {%- else -%}
            {% set map = {
              'Rischio assente (condizioni estreme)': 0,
              'Liv. 0: nessuna crescita di muffa':      0,
              'Liv. 1: crescita possibile in > 8 Settimane': 1,
              'Liv. 2: crescita possibile in 4–8 Settimane': 2,
              'Liv. 3: crescita possibile in < 4 Settimane': 3
            } %}
            {% set s12 = map.get(states('sensor.vmc_master_calcolo_rischio_muffa_12w'), none) %}
            {% set s8  = map.get(states('sensor.vmc_master_calcolo_rischio_muffa_8w'),  none) %}
            {% set s4  = map.get(states('sensor.vmc_master_calcolo_rischio_muffa_4w'),  none) %}

            {% if s12 is none or s8 is none or s4 is none %}
              [Non Calcolabile]
            {% elif s4 == s12 and s4 != s8 %}
              Stabile a Liv. {{ s4 }} con Oscillazione
            {% elif s4 > s8 %}
              Peggioramento - Rischio Aumentato a Liv. {{ s4 }}
            {% elif s4 < s8 %}
              Miglioramento - Rischio Diminuito a Liv. {{ s4 }}
            {% else %}
              Stabile a Liv. {{ s4 }}
            {% endif %}
          {%- endif %}
        icon_template: mdi:virus

      vmc_master_trend_muffa_level:
        friendly_name: "Andamento Rischio Muffa (0 Assente–3 Max)"
        unique_id: vmc_master_trend_muffa_level
        value_template: >-
          {%- set stati = ["sconosciuto","unknown","","unavailable",none,"Non disponibile", "[Non Calcolabile]"] -%}
          {# 1) Se la VMC segnala sensori non disponibili #}
          {%- if states('sensor.vmc_master_sensori') in stati -%}
            Non disponibile
          {%- else -%}
            {# 2) Prendo il testo del trend #}
            {%- set txt = states('sensor.vmc_master_trend_muffa') -%}
            {%- if txt in stati -%}
              [Non Calcolabile]
            {%- else -%}
              {# 3) Mappa testo → numero #}
              {%- set m = {
                'Stabile a Liv. 0': 0,
                'Stabile a Liv. 0 con Oscillazione': 0,
                'Stabile a Liv. 1': 1,
                'Stabile a Liv. 1 con Oscillazione': 1,
                'Stabile a Liv. 2': 2,
                'Stabile a Liv. 2 con Oscillazione': 2,
                'Stabile a Liv. 3': 3,
                'Stabile a Liv. 3 con Oscillazione': 3,
                'Peggioramento - Rischio Aumentato a Liv. 1': 1,
                'Peggioramento - Rischio Aumentato a Liv. 2': 2,
                'Peggioramento - Rischio Aumentato a Liv. 3': 3,
                'Miglioramento - Rischio Diminuito a Liv. 0': 0,
                'Miglioramento - Rischio Diminuito a Liv. 1': 1,
                'Miglioramento - Rischio Diminuito a Liv. 2': 2
              } -%}
              {{ m.get(txt, '[Non Calcolabile]') }}
            {%- endif %}
          {%- endif %}
        icon_template: mdi:virus
################### Inizio Creazione Sensori di Monitoraggio Muffa ####################################################################################################################################

################### Inizio Creazione Sensori di Monitoraggio Portata Aria #############################################################################################################################
      vmc_master_status_portata_ventola_lettura_codice_interpretato:           # [CONFIGURAZIONE, PIU’ RICHIAMI] [INTERFACCIA, 1 RICHIAMO] [AUTOMAZIONE, 0 RICHIAMI] SENSORE DI LETTURA DEI DATI "VELOCITA'" MEMORIZZATI NELLA VMC CONVERITA IN PORTATA D'ARIA m3/h [AD ESCLUSIONE DELLA VELOCITA' NOTTURNA E Free Cool./Heat.], PREVIA VERIFICA DI AVVENUTA LETTURA DEI DATI "VELOCITA'"" MEMORIZZATI NELLA VMC
        friendly_name: "Portata d'Aria [M³/h]"
        value_template: >
          {% set stati = ["sconosciuto", "unknown", "", none, "unavailable", "Non disponibile"] %}
          {% if states('sensor.vmc_master_status_ventola') in stati %}
            Non disponibile
          {% else %}
            {% set componenti = states('sensor.vmc_master_status_ventola').split(',') %}
            {% if componenti | length > 1 %}
              {% set codice = componenti[1] %}
              {% set codici = {'00000': '-', '00001': '10', '00002': '17', '00003': '26', '00004': '37', '00005': '42', '00006': '10', '00007': '26'} %}
              {{ codici.get(codice, 'Non disponibile') }}
            {% else %}
              -
            {% endif %}
          {% endif %}
        icon_template: mdi:window-open-variant

      vmc_master_status_calcolo_portata_ventola:                               # [CONFIGURAZIONE, PIU’ RICHIAMI] [INTERFACCIA, 1 RICHIAMO] [AUTOMAZIONE, 0 RICHIAMI] SENSORE PER IL CALCOLO IN MINUTI NECESSARI PER UN CAMBIO TOTALE DELL'AMBIENTE
        friendly_name: "Tempo ricambio aria"
        value_template: >
          {% set stati_invalidi = ["sconosciuto", "unknown", "", none, "unavailable", "Non disponibile"] %}
          {% set portata_str = states('sensor.vmc_master_status_portata_ventola_lettura_codice_interpretato') %}
          {% set volume_str = states('input_number.vmc_master_volume_da_inserire') %}
          {% if portata_str in stati_invalidi or volume_str in stati_invalidi %}
            Non disponibile
          {% else %}
            {% set portata = portata_str | float(0) %}
            {% set volume = volume_str | float(0) %}
            {% if portata <= 0 or volume <= 0 %}
              -
            {% else %}
              {% set tempo_sec = ((volume / portata) * 3600) | round(0) %}
              {% set ore = tempo_sec // 3600 %}
              {% set minuti = (tempo_sec % 3600) // 60 %}
              {% set secondi = tempo_sec % 60 %}
              {% if ore > 0 %}
                {{ ore }} ore{{ ", " if minuti > 0 or secondi > 0 else "" }}
                {{ minuti ~ " minuti" if minuti > 0 else "" }}
                {{ " e " if secondi > 0 and minuti > 0 else "" }}
                {{ secondi ~ " secondi" if secondi > 0 else "" }}
              {% elif minuti > 0 %}
                {{ minuti }} minuti{{ " e " if secondi > 0 else "" }}
                {{ secondi ~ " secondi" if secondi > 0 else "" }}
              {% else %}
                {{ secondi }} secondi
              {% endif %}
            {% endif %}
          {% endif %}
        icon_template: mdi:home-clock-outline

      vmc_master_status_calcolo_aria_scambiata_totale:
        friendly_name: "Totale Aria Scambiata al Giorno"
        unit_of_measurement: 'm³'
        value_template: >
          {{
            (
              states('input_number.vmc_master_aria_scambiata_v1') | float(0) +
              states('input_number.vmc_master_aria_scambiata_v2') | float(0) +
              states('input_number.vmc_master_aria_scambiata_v3') | float(0) +
              states('input_number.vmc_master_aria_scambiata_v4') | float(0) +
              states('input_number.vmc_master_aria_scambiata_iperventilazione') | float(0) +
              states('input_number.vmc_master_aria_scambiata_notte') | float(0) +
              states('input_number.vmc_master_aria_scambiata_freecooling') | float(0)
            ) | round(3)
          }}
        icon_template: mdi:home-clock-outline

      vmc_master_cicli_ricambio_aria:
        friendly_name: "Totale N° Ricambi Aria al Giorno"
        unit_of_measurement: 'Ricambi'
        value_template: >
          {% set volume = states('input_number.vmc_master_volume_da_inserire') | float(1) %}
          {% set aria_totale = states('sensor.vmc_master_status_calcolo_aria_scambiata_totale') | float(0) %}
          {% if volume > 0 %}
            {{ (aria_totale / volume) | round(2) }}
          {% else %}
            0
          {% endif %}
        icon_template: mdi:counter

      vmc_master_tempo_mancante_ricambio:
        friendly_name: "Tempo Mancante al Prossimo Ricambio"
        icon_template: mdi:progress-clock
        value_template: >
          {% set portata_str = states('sensor.vmc_master_status_portata_ventola_lettura_codice_interpretato') %}
          {% set volume_str = states('input_number.vmc_master_volume_da_inserire') %}
          {% set ricambiato_str = states('input_number.vmc_master_aria_scambiata_ricomincio') %}
          {% set reset = states('input_text.vmc_master_tempo_mancante_reset') == 'reset' %}
          {% set invalidi = ['unknown', 'unavailable', '', 'none', None, 'Non disponibile'] %}
      
          {% if portata_str in invalidi or volume_str in invalidi or ricambiato_str in invalidi %}
            Non disponibile
          {% else %}
            {% set portata = portata_str | float(0) %}
            {% set volume = volume_str | float(0) %}
            {% set ricambiato = ricambiato_str | float(0) %}
            {% set residuo = volume - ricambiato %}
            {% if residuo < 0 %}
              {% set residuo = 0 %}
            {% endif %}
      
            {% if portata <= 0 or volume <= 0 %}
              -
            {% else %}
              {% if reset or residuo == 0 %}
                {% set tempo_sec_float = (volume / portata) * 3600 %}
              {% else %}
                {% set tempo_sec_float = (residuo / portata) * 3600 %}
              {% endif %}
      
              {% set tempo_sec = tempo_sec_float | round(0) | int %}
              {% set ore = (tempo_sec // 3600) %}
              {% set minuti = (tempo_sec % 3600) // 60 %}
              {% set secondi = (tempo_sec % 60) %}
      
              {% if ore == 0 and minuti == 0 %}
                {{ secondi }} secondi
              {% elif ore == 0 %}
                {{ minuti }} minuti
              {% elif minuti == 0 %}
                {{ ore }} ore
              {% else %}
                {{ ore }} ore e {{ minuti }} minuti
              {% endif %}
            {% endif %}
          {% endif %}
################### Fine Creazione Sensori di Monitoraggio Portata Aria #############################################################################################################################

########################################################################################### INIZIO SENSORI PER POP-UP MONITORAGGIO ##################################################################
      vmc_master_alert_monitoraggio_umidita:                                    # [CONFIGURAZIONE, PIU’ RICHIAMI] [INTERFACCIA, PIù RICHIAMI] [AUTOMAZIONE, 0 RICHIAMI]  SENSORE POP-UP MONITORAGGIO UMIDITA'; SENSORE MONITORAGGIO SCHEDA AVVISI 
        friendly_name: "Monitoraggio Umidità"
        value_template: >
          {% set stati = ["sconosciuto", "unknown", "", none, "unavailable", "Non disponibile"] %}
          {% if states('sensor.vmc_master_sensori') in stati %}
            Non disponibile
          {% else %}
            {% set umidità = states('sensor.vmc_master_umidita_interna_status_verifica_soglia') %}
            {% if (umidità == 'Possibile Secchezza, Disidratazione') or (umidità == 'Possibile Muffe, Batteri') %}
              Allerta
            {% else %}
              Nessuna Allerta
            {% endif %}
          {% endif %}
        icon_template: mdi:alarm-light-outline

      vmc_master_alert_monitoraggio_co2:                                        # [CONFIGURAZIONE, PIU’ RICHIAMI] [INTERFACCIA, PIù RICHIAMI] [AUTOMAZIONE, PIù RICHIAMI] SENSORE POP-UP MONITORAGGIO SUPERAMENTO DEL Livello di Concentrazione CO₂ [ppm]
        friendly_name: "Monitoraggio CO₂"
        value_template: >
          {% set stati = ["sconosciuto", "unknown", "", none, "unavailable", "Non disponibile"] %}
          {% if states('sensor.vmc_master_sensori') in stati %}
            Non disponibile
          {% else %}
            {% set co2 = states('sensor.vmc_master_co2_status_verifica_soglia') %}
            {% if ( (co2 == 'Moderata Concentrazione') or (co2 == 'Alta Concentrazione') or (co2 == 'Pessima Concentrazione') ) %}
              Allerta
            {% else %}
              Nessuna Allerta
            {% endif %}
          {% endif %}
        icon_template: mdi:alarm-light-outline

      vmc_master_alert_monitoraggio_voc:                                        # [CONFIGURAZIONE, PIU’ RICHIAMI] [INTERFACCIA, PIù RICHIAMI] [AUTOMAZIONE, PIù RICHIAMI] SENSORE POP-UP MONITORAGGIO SUPERAMENTO DEL Livello di Concentrazione VOC [ppb]
        friendly_name: "Monitoraggio VOC"
        value_template: >
          {% set stati = ["sconosciuto", "unknown", "", none, "unavailable", "Non disponibile"] %}
          {% if states('sensor.vmc_master_sensori') in stati %}
            Non disponibile
          {% else %}
            {% set voc = states('sensor.vmc_master_voc_status_verifica_soglia') %}
            {% if ( (voc == 'Moderata Concentrazione') or (voc == 'Pessima Concentrazione') ) %}
              Allerta
            {% else %}
              Nessuna Allerta
            {% endif %}
          {% endif %}
        icon_template: mdi:alarm-light-outline

      vmc_master_alert_monitoraggio_pdr:                                        # [CONFIGURAZIONE, PIU’ RICHIAMI] [INTERFACCIA, PIù RICHIAMI] [AUTOMAZIONE, 0 RICHIAMI] SENSORE POP-UP MONITORAGGIO Verifica uso VMC? OVVERO SUPERAMENTO DEL Set Lim. Δ Punto di Rugiada; SENSORE MONITORAGGIO SCHEDA AVVISI 
        friendly_name: "Superamento Lim. Δ Punto di Rugiada"
        value_template: >
          {% set stati_non_validi = ["sconosciuto", "unknown", "", none, "unavailable", "Non disponibile"] %}
          {% set PdRvc = states('sensor.vmc_master_punto_di_rugiada_verifica_confronto') %}
          {% if states('sensor.vmc_master_sensori') in stati_non_validi %}
            Non disponibile
          {% else %}
            {% if PdRvc == 'Se ne sconsiglia l\'impiego' %}
              Allerta
            {% elif PdRvc in ['[Non Calcolabile]', '[Non Disponibile]'] %}
              {{ PdRvc }}
            {% else %}
              Nessuna Allerta
            {% endif %}
          {% endif %}
        icon_template: mdi:alarm-light-outline

      vmc_master_alert_monitoraggio_congelamento:                               # [CONFIGURAZIONE, 1 RICHIAMO] [INTERFACCIA, 1 RICHIAM0] [AUTOMAZIONE, 0 RICHIAMI] SENSORE POP-UP MONITORAGGIO VMC Congelamento ≤ -18 [°C] Temp. Esterna ?; SENSORE MONITORAGGIO SCHEDA AVVISI    - NOTA: Entrambi i sensori vmc_master_alert_monitoraggio_congelamento e vmc_master_alert_monitoraggio_delta risultano in stato "Allerta" quando: Temperatura esterna ≤ -18°C e Temperatura interna > 5°C PERTANTO VERRA' DATA TRAMITE AUTOMAZIONE PRIORITA' A: Temperatura esterna ≤ -18°C
        friendly_name: "Monitoraggio Congelamento"
        value_template: >
          {% set stati = ["sconosciuto", "unknown", "", none, "unavailable", "Non disponibile"] %}
          {% if states('sensor.vmc_master_sensori') in stati %}
            Non disponibile
          {% else %}
            {% set congelamento = states('sensor.vmc_master_congelamento_verifica_soglia') %}            
            {% if ( (congelamento == 'Si') ) %}
              Allerta
            {% else %}
              Nessuna Allerta
            {% endif %}
          {% endif %}
        icon_template: mdi:alarm-light-outline

      vmc_master_alert_monitoraggio_delta:                                      # [CONFIGURAZIONE, 1 RICHIAMO] [INTERFACCIA, 1 RICHIAM0] [AUTOMAZIONE, 0 RICHIAMI] SENSORE POP-UP MONITORAGGIO VMC Sensori Int. Δ Temp. > 23 [°C] ?; SENSORE MONITORAGGIO SCHEDA AVVISI    - NOTA: Entrambi i sensori vmc_master_alert_monitoraggio_congelamento e vmc_master_alert_monitoraggio_delta risultano in stato "Allerta" quando: Temperatura esterna ≤ -18°C e Temperatura interna > 5°C PERTANTO VERRA' DATA TRAMITE AUTOMAZIONE PRIORITA' A: Temperatura esterna ≤ -18°C
        friendly_name: "Monitoraggio Diff. Temp. Int-Est > 23 [°C]"
        value_template: >
          {% set stati = ["sconosciuto", "unknown", "", none, "unavailable", "Non disponibile"] %}
          {% if states('sensor.vmc_master_sensori') in stati %}
            Non disponibile
          {% else %}
            {% set delta = states('sensor.vmc_master_delta_temp_verifica_soglia') %}
            {% if ( (delta == 'Si') ) %}
              Allerta
            {% else %}
              Nessuna Allerta
            {% endif %}
          {% endif %}
        icon_template: mdi:alarm-light-outline

      vmc_master_alert_monitoraggio_free_heating_o_free_cooling:                                      # [CONFIGURAZIONE, 0 RICHIAMI] [INTERFACCIA, 0 RICHIAM0] [AUTOMAZIONE, PIU’ RICHIAMI] [INTERFACCIA, 0 RICHIAMI] SENSORE MONITORAGGIO IMPIEGO DELLA VELOCITA' FREE HEATING/ FREE COOLING
        friendly_name: "Monitoraggio Free H./C."
        value_template: >
          {% set stati = ["sconosciuto", "unknown", "", none, "unavailable", "Non disponibile"] %}
          {% if states('sensor.vmc_master_sensori') in stati %}
            Non disponibile
          {% else %}
            {% set automazione_free_cooling = states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_freecooling') %}
            {% set automazione_free_heating = states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_freeheating') %}
            {% set tipologia = states('sensor.vmc_master_status_mese_corrente_freeheating_o_freecooling') %}
            {% set velocita = states('sensor.vmc_master_status_ventola_lettura_codice_interpretato') %}
            {% set temp_interna_str = states('sensor.vmc_master_temp_interna_status') %}
            {% set temp_esterna_str = states('sensor.vmc_master_temp_esterna_status') %}
      
            {# Gestione stati non disponibili o non calcolabili per tipologia e velocita #}
            {% if tipologia == 'Non disponibile' or velocita == 'Non disponibile' %}
              Non disponibile
            {% elif tipologia == '[Non Calcolabile]' or velocita == '[Non Calcolabile]' %}
              [Non Calcolabile]
            {% else %}
              {# Se tipologia e velocita sono 'normali' #}
              {# Controllo anche le temperature. Se sono "Non disponibile" o "[Non Calcolabile]" non possiamo calcolare #}
              {% if temp_interna_str in ['Non disponibile', '[Non Calcolabile]'] or temp_esterna_str in ['Non disponibile', '[Non Calcolabile]'] %}
                [Non Calcolabile]
              {% else %}
                {# Proviamo a convertire le temperature in numeri #}
                {% set temp_interna = temp_interna_str | float(default=none) %}
                {% set temp_esterna = temp_esterna_str | float(default=none) %}
      
                {% if temp_interna is none or temp_esterna is none %}
                  [Non Calcolabile]
                {% else %}
                  {# Ora che abbiamo tutti i dati, applichiamo la logica originale #}
                  {% if (tipologia == "Free Heating") and (velocita == "Free Cooling") and (automazione_free_heating == "on") and (temp_interna > temp_esterna) %}
                    Allerta Free Heating Programmato (Raffrescamento in atto)
                  {% elif (tipologia == "Free Heating") and (velocita == "Free Cooling") and (temp_interna > temp_esterna) %}
                    Allerta Raffrescamento in atto
                  {% elif (tipologia == "Free Cooling") and (velocita == "Free Cooling") and (automazione_free_cooling == "on") and (temp_esterna > temp_interna) %}
                    Allerta Free Cooling Programmato (Riscaldamento in atto)
                  {% elif (tipologia == "Free Cooling") and (velocita == "Free Cooling") and (temp_esterna > temp_interna) %}
                    Allerta Riscaldamento in atto
                  {% elif (tipologia == "Disabilitata") and (velocita == "Free Cooling") and (temp_interna > temp_esterna) %}
                    Raffrescamento in atto
                  {% elif (tipologia == "Disabilitata") and (velocita == "Free Cooling") and (temp_esterna > temp_interna) %}
                    Riscaldamento in atto
                  {% else %}
                    Nessuna Allerta
                  {% endif %}
                {% endif %}
              {% endif %}
            {% endif %}
          {% endif %}
        icon_template: mdi:alarm-light-outline

      vmc_master_alert_monitoraggio_free_heating_o_free_cooling_allert_interfaccia_avvisi:           # [CONFIGURAZIONE, PIU' RICHIAMI] [INTERFACCIA, PIU’ RICHIAMI] [AUTOMAZIONE, PIù RICHIAMI] SENSORE MONITORAGGIO IMPIEGO DELLA VELOCITA' FREE HEATING/ FREE COOLING -- IMPIEGO DEGLI AVVISI NEI POP-UP INTERFACCIA (VEDERE NUMERAZIONE)
        friendly_name: "Free H./C."
        value_template: >
          {% set stati = ["sconosciuto", "unknown", "", none, "unavailable", "Non disponibile"] %}
          {% if states('sensor.vmc_master_sensori') in stati %}
            Non disponibile
          {% else %}
            {% set spia_free_cooling = states('input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio_per_programmazione_freecooling') %}
            {% set spia_free_heating = states('input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio_per_programmazione_freeheating') %}
            {% set co2 = states('sensor.vmc_master_alert_monitoraggio_co2') %}
            {% set voc = states('sensor.vmc_master_alert_monitoraggio_voc') %}
            {% set automazione_free_cooling = states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_freecooling') %}
            {% set automazione_free_heating = states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_freeheating') %}
            {% set tipologia = states('sensor.vmc_master_status_mese_corrente_freeheating_o_freecooling') %}
            {% set velocita = states('sensor.vmc_master_status_ventola_lettura_codice_interpretato') %}
            {% set temp_interna_str = states('sensor.vmc_master_temp_interna_status') %}
            {% set temp_esterna_str = states('sensor.vmc_master_temp_esterna_status') %}
      
            {# Controllo disponibilità e calcolabilità di tipologia e velocità #}
            {% if tipologia in ['Non disponibile'] or velocita in ['Non disponibile'] %}
              Non disponibile
            {% elif tipologia in ['[Non Calcolabile]'] or velocita in ['[Non Calcolabile]'] %}
              [Non Calcolabile]
            {% else %}
              {# Controllo disponibilità e calcolabilità delle temperature #}
              {% if temp_interna_str in ['Non disponibile','[Non Calcolabile]'] or temp_esterna_str in ['Non disponibile','[Non Calcolabile]'] %}
                [Non Calcolabile]
              {% else %}
                {% set temp_interna = temp_interna_str | float(default=none) %}
                {% set temp_esterna = temp_esterna_str | float(default=none) %}
      
                {% if temp_interna is none or temp_esterna is none %}
                  [Non Calcolabile]
                {% else %}
                
                  {# ------------------------------------- INIZIO FREE HEATING ------------------------------ #}
                  {# 1 #}
                  {% if ( tipologia == "Free Heating" and velocita == "Velocità 0" and automazione_free_heating == "on" and temp_interna > temp_esterna | float(0) and spia_free_heating=="on" and ((co2 !="Allerta") and (voc !="Allerta")) ) %}
                    Allerta Free Heating Programmato (Raffrescamento Arrestato)
                  {# 2 #}
                  {% elif ( tipologia == "Free Heating" and velocita == "Free Cooling" and automazione_free_heating == "on" and temp_interna > temp_esterna | float(0) and spia_free_heating=="on" and ((co2 =="Allerta") or (voc =="Allerta")) ) %}
                    Allerta Free Heating Programmato (Raffrescamento in atto, Presenza di Inquinanti)
                  {# 3 #}
                  {% elif ( tipologia == "Free Heating" and velocita == "Velocità 0" and automazione_free_heating == "on" and temp_interna > temp_esterna | float(0) and spia_free_heating=="on" and ((co2 =="Allerta") or (voc =="Allerta")) ) %}
                    Allerta Free Heating Programmato (Raffrescamento Arrestato, Presenza di Inquinanti)
                  {# 4 #}
                  {% elif ( tipologia == "Free Heating" and velocita == "Free Cooling" and automazione_free_heating == "on" and temp_interna > temp_esterna | float(0) and spia_free_heating=="on" and ((co2 !="Allerta") and (voc !="Allerta")) ) %}
                    Allerta Free Heating Programmato (Raffrescamento in atto)
                  {# 5 #}
                  {% elif ( tipologia == "Free Heating" and velocita == "Free Cooling" and automazione_free_heating == "on" and temp_interna > temp_esterna | float(0) and spia_free_heating=="off" and ((co2 =="Allerta") or (voc =="Allerta")) ) %}
                    Allerta Free Heating Programmato (Raffrescamento in atto, Presenza di Inquinanti)
                  {# 6 #}
                  {% elif ( tipologia == "Free Heating" and velocita == "Free Cooling" and automazione_free_heating == "on" and temp_interna > temp_esterna | float(0) and spia_free_heating=="off" and ((co2 !="Allerta") and (voc !="Allerta")) ) %}
                    Allerta Free Heating Programmato (Raffrescamento in atto)
                  {# 7 #}
                  {% elif ( tipologia == "Free Heating" and velocita != "Velocità 0" and  velocita != "Free Cooling" and automazione_free_heating == "on" and temp_interna > temp_esterna | float(0) and spia_free_heating=="on" and ((co2 !="Allerta") and (voc !="Allerta")) ) %}
                    Allerta Free Heating Programmato (Raffrescamento Arrestato)
                  {# 8 #}
                  {% elif ( tipologia == "Free Heating" and velocita != "Velocità 0" and  velocita != "Free Cooling" and automazione_free_heating == "on" and temp_interna > temp_esterna | float(0) and spia_free_heating=="on" and ((co2 =="Allerta") or (voc =="Allerta")) ) %}
                    Allerta Free Heating Programmato (Raffrescamento Arrestato, Presenza di Inquinanti)
                  {# 9 #}
                  {% elif ( tipologia == "Free Heating" and velocita == "Free Cooling" and automazione_free_heating == "on" and temp_interna <= temp_esterna | float(0) and ((co2 !="Allerta") and (voc !="Allerta")) ) %}
                    Nessuna Allerta Free Heating Programmato
                  {# 10 #}
                  {% elif ( tipologia == "Free Heating" and velocita == "Free Cooling" and automazione_free_heating == "on" and temp_interna <= temp_esterna | float(0) and ((co2 =="Allerta") or (voc =="Allerta")) ) %}
                    Nessuna Allerta Free Heating Programmato, Presenza di Inquinanti
                  {# 11 #}
                  {% elif ( tipologia == "Free Heating" and velocita == "Velocità 0" and automazione_free_heating == "on" and temp_interna <= temp_esterna | float(0) and ((co2 !="Allerta") and (voc !="Allerta")) ) %}
                    Nessuna Allerta Free Heating Programmato
                  {# 12 #}
                  {% elif ( tipologia == "Free Heating" and velocita == "Velocità 0" and automazione_free_heating == "on" and temp_interna <= temp_esterna | float(0) and ((co2 =="Allerta") or (voc =="Allerta")) ) %}
                    Nessuna Allerta Free Heating Programmato, Presenza di Inquinanti
                  {# 13 #}
                  {% elif ( tipologia == "Free Heating" and velocita != "Free Cooling" and automazione_free_heating == "on" and temp_interna > temp_esterna | float(0) and spia_free_heating=="off") and ((co2 !="Allerta") and (voc !="Allerta"))%}
                    Non Avviare in Velocità Free Heating Programmato (Allerta Raffrescamento)
                  {# 14 #}
                  {% elif ( tipologia == "Free Heating" and velocita != "Free Cooling" and automazione_free_heating == "on" and temp_interna > temp_esterna | float(0) and spia_free_heating=="off") and ((co2 =="Allerta") or (voc =="Allerta"))%}
                    Non Avviare in Velocità Free Heating Programmato (Allerta Raffrescamento, Presenza di Inquinanti)
                  {# 15 #}
                  {% elif ( tipologia == "Free Heating" and velocita != "Velocità 0" and  velocita != "Free Cooling" and automazione_free_heating == "on" and temp_interna <= temp_esterna | float(0) and ((co2 !="Allerta") and (voc !="Allerta")) ) %}
                    Nessuna Allerta Free Heating Programmato
                  {# 16 #}
                  {% elif ( tipologia == "Free Heating" and velocita != "Velocità 0" and  velocita != "Free Cooling" and automazione_free_heating == "on" and temp_interna <= temp_esterna | float(0) and ((co2 =="Allerta") or (voc =="Allerta")) ) %}
                    Nessuna Allerta Free Heating Programmato, Presenza di Inquinanti
      
                  {# ------------------------------------- INIZIO FREE COOLING ------------------------------ #}
                  {# 1 #}
                  {% elif ( tipologia == "Free Cooling" and velocita == "Velocità 0" and automazione_free_cooling == "on" and temp_esterna > temp_interna | float(0) and spia_free_cooling=="on" and ((co2 !="Allerta") and (voc !="Allerta")) ) %}
                    Allerta Free Cooling Programmato (Riscaldamento Arrestato)
                  {# 2 #}
                  {% elif ( tipologia == "Free Cooling" and velocita == "Free Cooling" and automazione_free_cooling == "on" and temp_esterna > temp_interna | float(0) and spia_free_cooling=="on" and ((co2 =="Allerta") or (voc =="Allerta")) ) %}
                    Allerta Free Cooling Programmato (Riscaldamento in atto, Presenza di Inquinanti)
                  {# 3 #}
                  {% elif ( tipologia == "Free Cooling" and velocita == "Velocità 0" and automazione_free_cooling == "on" and temp_esterna > temp_interna | float(0) and spia_free_cooling=="on" and ((co2 =="Allerta") or (voc =="Allerta")) ) %}
                    Allerta Free Cooling Programmato (Riscaldamento Arrestato, Presenza di Inquinanti)
                  {# 4 #}
                  {% elif ( tipologia == "Free Cooling" and velocita == "Free Cooling" and automazione_free_cooling == "on" and temp_esterna > temp_interna | float(0) and spia_free_cooling=="on" and ((co2 !="Allerta") and (voc !="Allerta")) ) %}
                    Allerta Free Cooling Programmato (Riscaldamento in atto)
                  {# 5 #}
                  {% elif ( tipologia == "Free Cooling" and velocita == "Free Cooling" and automazione_free_cooling == "on" and temp_esterna > temp_interna | float(0) and spia_free_cooling=="off" and ((co2 =="Allerta") or (voc =="Allerta")) ) %}
                    Allerta Free Cooling Programmato (Riscaldamento in atto, Presenza di Inquinanti)
                  {# 6 #}
                  {% elif ( tipologia == "Free Cooling" and velocita == "Free Cooling" and automazione_free_cooling == "on" and temp_esterna > temp_interna | float(0) and spia_free_cooling=="off" and ((co2 !="Allerta") and (voc !="Allerta")) ) %}
                    Allerta Free Cooling Programmato (Riscaldamento in atto)
                  {# 7 #}
                  {% elif ( tipologia == "Free Cooling" and velocita != "Velocità 0" and  velocita != "Free Cooling" and automazione_free_cooling == "on" and temp_esterna > temp_interna | float(0) and spia_free_cooling=="on" and ((co2 !="Allerta") and (voc !="Allerta")) ) %}
                    Allerta Free Cooling Programmato (Riscaldamento Arrestato)
                  {# 8 #}
                  {% elif ( tipologia == "Free Cooling" and velocita != "Velocità 0" and  velocita != "Free Cooling" and automazione_free_cooling == "on" and temp_esterna > temp_interna | float(0) and spia_free_cooling=="on" and ((co2 =="Allerta") or (voc =="Allerta")) ) %}
                    Allerta Free Cooling Programmato (Riscaldamento Arrestato, Presenza di Inquinanti)
                  {# 9 #}
                  {% elif ( tipologia == "Free Cooling" and velocita == "Free Cooling" and automazione_free_cooling == "on" and temp_esterna <= temp_interna | float(0) and ((co2 !="Allerta") and (voc !="Allerta")) ) %}
                    Nessuna Allerta Free Cooling Programmato
                  {# 10 #}
                  {% elif ( tipologia == "Free Cooling" and velocita == "Free Cooling" and automazione_free_cooling == "on" and temp_esterna <= temp_interna | float(0) and ((co2 =="Allerta") or (voc =="Allerta")) ) %}
                    Nessuna Allerta Free Cooling Programmato, Presenza di Inquinanti
                  {# 11 #}
                  {% elif ( tipologia == "Free Cooling" and velocita == "Velocità 0" and automazione_free_cooling == "on" and temp_esterna <= temp_interna | float(0) and ((co2 !="Allerta") and (voc !="Allerta")) ) %}
                    Nessuna Allerta Free Cooling Programmato
                  {# 12 #}
                  {% elif ( tipologia == "Free Cooling" and velocita == "Velocità 0" and automazione_free_cooling == "on" and temp_esterna <= temp_interna | float(0) and ((co2 =="Allerta") or (voc =="Allerta")) ) %}
                    Nessuna Allerta Free Cooling Programmato, Presenza di Inquinanti
                  {# 13 #}
                  {% elif ( tipologia == "Free Cooling" and velocita != "Free Cooling" and automazione_free_cooling == "on" and temp_esterna > temp_interna | float(0) and spia_free_cooling=="off") and ((co2 !="Allerta") and (voc !="Allerta"))%}
                    Non Avviare in Velocità Free Cooling Programmato (Allerta Riscaldamento)
                  {# 14 #}
                  {% elif ( tipologia == "Free Cooling" and velocita != "Free Cooling" and automazione_free_cooling == "on" and temp_esterna > temp_interna | float(0) and spia_free_cooling=="off") and ((co2 =="Allerta") or (voc =="Allerta"))%}
                    Non Avviare in Velocità Free Cooling Programmato (Allerta Riscaldamento, Presenza di Inquinanti)
                  {# 15 #}
                  {% elif ( tipologia == "Free Cooling" and velocita != "Velocità 0" and  velocita != "Free Cooling" and automazione_free_cooling == "on" and temp_esterna <= temp_interna | float(0) and ((co2 !="Allerta") and (voc !="Allerta")) ) %}
                    Nessuna Allerta Free Cooling Programmato
                  {# 16 #}
                  {% elif ( tipologia == "Free Cooling" and velocita != "Velocità 0" and  velocita != "Free Cooling" and automazione_free_cooling == "on" and temp_esterna <= temp_interna | float(0) and ((co2 =="Allerta") or (voc =="Allerta")) ) %}
                    Nessuna Allerta Free Cooling Programmato, Presenza di Inquinanti
      
      
                  {# ------------------------------------- INIZIO FREE HEATING, FREE HEATING DISABILITATO ------------------------------ #}
                  {# 33 #}
                  {% elif ( tipologia == "Disabilitata" and velocita == "Free Cooling" and temp_interna > temp_esterna | float(0) and ((co2 !="Allerta") and (voc !="Allerta")) ) %}
                    Allerta Raffrescamento in atto
                  {# 34 #}
                  {% elif ( tipologia == "Disabilitata" and velocita == "Free Cooling" and temp_interna > temp_esterna | float(0) and ((co2 =="Allerta") or (voc =="Allerta")) ) %}
                    Allerta Raffrescamento in atto, Presenza di Inquinanti
                  {# 35 #}
                  {% elif ( tipologia == "Disabilitata" and velocita == "Free Cooling" and temp_esterna > temp_interna | float(0) and ((co2 !="Allerta") and (voc !="Allerta")) ) %}
                    Allerta Riscaldamento in atto
                  {# 36 #}
                  {% elif ( tipologia == "Disabilitata" and velocita == "Free Cooling" and temp_esterna > temp_interna | float(0) and ((co2 =="Allerta") or (voc =="Allerta")) ) %}
                    Allerta Riscaldamento in atto, Presenza di Inquinanti
                  {# 37 #}
                  {% elif ( tipologia == "Disabilitata" and velocita == "Free Cooling" and temp_interna == temp_esterna | float(0) and ((co2 !="Allerta") and (voc !="Allerta")) ) %}
                    Nessuna Allerta
                  {# 38 #}
                  {% elif ( tipologia == "Disabilitata" and velocita == "Free Cooling" and temp_interna ==temp_esterna | float(0) and ((co2 =="Allerta") or (voc =="Allerta")) ) %}
                    Nessuna Allerta, Presenza di Inquinanti
                  {# 39 #}
                  {% elif ( tipologia == "Disabilitata" and velocita != "Free Cooling" and temp_interna > temp_esterna | float(0) and ((co2 !="Allerta") and (voc !="Allerta")) ) %}
                    Se Avviata in Velocità Free Cool./Heat. (Allerta Raffrescamento)
                  {# 40 #}
                  {% elif ( tipologia == "Disabilitata" and velocita != "Free Cooling" and temp_interna > temp_esterna | float(0) and ((co2 =="Allerta") or (voc =="Allerta")) ) %}
                    Se Avviata in Velocità Free Cool./Heat. (Allerta Raffrescamento, Presenza di Inquinanti)
                  {# 41 #}
                  {% elif ( tipologia == "Disabilitata" and  velocita != "Free Cooling" and temp_esterna > temp_interna | float(0) and ((co2 !="Allerta") and (voc !="Allerta")) ) %}
                    Se Avviata in Velocità Free Cool./Heat. (Allerta Riscaldamento)
                  {# 42 #}
                  {% elif ( tipologia == "Disabilitata" and velocita != "Free Cooling" and temp_esterna > temp_interna | float(0) and ((co2 =="Allerta") or (voc =="Allerta")) ) %}
                    Se Avviata in Velocità Free Cool./Heat. (Allerta Riscaldamento, Presenza di Inquinanti)
                  {# 43 #}
                  {% elif ( tipologia == "Disabilitata" and  velocita != "Free Cooling" and temp_esterna == temp_interna | float(0) and ((co2 !="Allerta") and (voc !="Allerta")) ) %}
                    Nessuna Allerta
                  {# 44 #}
                  {% elif ( tipologia == "Disabilitata" and  velocita != "Free Cooling" and temp_esterna == temp_interna | float(0) and ((co2 =="Allerta") or (voc =="Allerta")) ) %}
                    Nessuna Allerta, Presenza di Inquinanti
                  {% else %}
                    Nessuna Allerta
                  {% endif %}
                {% endif %}
              {% endif %}
            {% endif %}
          {% endif %}
        icon_template: mdi:alarm-light-outline

      vmc_master_alert_monitoraggio_free_heating_o_free_cooling_disabilitato:        # [CONFIGURAZIONE, PIU’ RICHIAMI] [INTERFACCIA, PIU' RICHIAMI] [AUTOMAZIONE, 0 RICHIAMI] SENSORE CHE RACCHIUDE TUTTE LE ALLERTE DOVUTE ALL' IMPIEGO DELLA VELOCITA' FREE HEATING/ FREE COOLING DISABILITATO (AD ECCEZZIONE "Nessuna Allerta, Presenza di Inquinanti")
        friendly_name: "Verifica Allerte Free H./C."
        value_template: >
          {% set stati = ["sconosciuto", "unknown", "", none, "unavailable", "Non disponibile"] %}
          {% if states('sensor.vmc_master_sensori') in stati %}
            Non disponibile
          {% else %}
            {% set avviso_disabilitato = states('sensor.vmc_master_alert_monitoraggio_free_heating_o_free_cooling_allert_interfaccia_avvisi') %}
            {% if avviso_disabilitato == "Allerta Free Heating Programmato (Raffrescamento Arrestato)" or
               avviso_disabilitato == "Allerta Free Heating Programmato (Raffrescamento in atto)" or
               avviso_disabilitato == "Allerta Free Heating Programmato (Raffrescamento in atto, Presenza di Inquinanti)" or
               avviso_disabilitato == "Allerta Free Heating Programmato (Raffrescamento Arrestato, Presenza di Inquinanti)" or
               avviso_disabilitato == "Allerta Free Cooling Programmato (Riscaldamento in atto)" or
               avviso_disabilitato == "Allerta Free Cooling Programmato (Riscaldamento Arrestato)" or
               avviso_disabilitato == "Allerta Free Cooling Programmato (Riscaldamento Arrestato, Presenza di Inquinanti)" or
               avviso_disabilitato == "Allerta Free Cooling Programmato (Riscaldamento in atto, Presenza di Inquinanti)" or
               avviso_disabilitato == "Allerta Raffrescamento in atto" or
               avviso_disabilitato == "Allerta Riscaldamento in atto" or
               avviso_disabilitato == "Allerta Riscaldamento in atto, Presenza di Inquinanti" or
               avviso_disabilitato == "Allerta Raffrescamento in atto, Presenza di Inquinanti" or
               avviso_disabilitato == "Non Avviare in Velocità Free Heating Programmato (Allerta Raffrescamento)" or
               avviso_disabilitato == "Non Avviare in Velocità Free Heating Programmato (Allerta Raffrescamento, Presenza di Inquinanti)" or
               avviso_disabilitato == "Non Avviare in Velocità Free Cooling Programmato (Allerta Riscaldamento)" or
               avviso_disabilitato == "Non Avviare in Velocità Free Cooling Programmato (Allerta Riscaldamento, Presenza di Inquinanti)" or
               avviso_disabilitato == "Se Avviata in Velocità Free Cool./Heat. (Allerta Raffrescamento)" or
               avviso_disabilitato == "Se Avviata in Velocità Free Cool./Heat. (Allerta Riscaldamento)" or
               avviso_disabilitato == "Se Avviata in Velocità Free Cool./Heat. (Allerta Raffrescamento, Presenza di Inquinanti)" or
               avviso_disabilitato == "Se Avviata in Velocità Free Cool./Heat. (Allerta Riscaldamento, Presenza di Inquinanti)" %}
              OK
            {% else %}
              NOT OK
            {% endif %}   
          {% endif %}
        icon_template: mdi:alarm-light-outline

      vmc_master_alert_monitoraggio_offset_tutti_min:                          # [CONFIGURAZIONE, 1 RICHIAMO] [INTERFACCIA, PIU’ RICHIAMI] [AUTOMAZIONE, 0 RICHIAMI] SENSORE POP-UP CHE VERIFICA SE GLI OFFSET SONO TUTTI AL MINIMO
        friendly_name: "Verifica Offset se sono settati tutti al Minimo"
        value_template: >
          {% set stati = ["sconosciuto", "unknown", "", none, "unavailable", "Non disponibile"] %}
          {% if states('sensor.vmc_master_sensori') in stati %}
            Non disponibile
          {% else %}
            {% set valore_minimo_temp_esterna = state_attr('input_number.vmc_master_offset_temp_esterna', 'min') | float %}
            {% set valore_minimo_temp_interna = state_attr('input_number.vmc_master_offset_temp_interna', 'min') | float %}
            {% set valore_minimo_umidita_esterna = state_attr('input_number.vmc_master_offset_umidita_esterna', 'min') | float %}
            {% set valore_minimo_umidita_interna = state_attr('input_number.vmc_master_offset_umidita_interna', 'min') | float %}
            {% set valore_minimo_co2 = state_attr('input_number.vmc_master_offset_co2', 'min') | float %}
            {% set valore_minimo_voc = state_attr('input_number.vmc_master_offset_voc', 'min') | float %}
            {% if (states('input_number.vmc_master_offset_temp_interna') | float == valore_minimo_temp_interna and 
                   states('input_number.vmc_master_offset_temp_esterna') | float == valore_minimo_temp_esterna and 
                   states('input_number.vmc_master_offset_umidita_interna') | float == valore_minimo_umidita_interna and 
                   states('input_number.vmc_master_offset_umidita_esterna') | float == valore_minimo_umidita_esterna and
                   states('input_number.vmc_master_offset_co2') | float == valore_minimo_co2 and 
                   states('input_number.vmc_master_offset_voc') | float == valore_minimo_voc) %}
              NOT OK
            {% else %}
              OK
            {% endif %}
          {% endif %}
        icon_template: mdi:alarm-light-outline

      vmc_master_alert_monitoraggio_black_out:                                 # [CONFIGURAZIONE, PIU’ RICHIAMI] [AUTOMAZIONE, 0 RICHIAMI] [INTERFACCIA, PIU’ RICHIAMI] SENSORE DI AVVISO PER UN BLACK-OUT
        friendly_name: "Verifica Black-Out"
        value_template: >
          {% set stati = ["sconosciuto", "unknown", "", none, "unavailable", "Non disponibile"] %}
          {% if states('sensor.vmc_master_sensori') in stati %}
            Non disponibile
          {% else %}
            {% if (
              states('vmc_master_status_ip_interfaccia')=='OFF-Line' or
              is_state('input_boolean.vmc_master_spia_velocita_0', 'on') or
              is_state('input_boolean.vmc_master_spia_velocita_1', 'on') or
              is_state('input_boolean.vmc_master_spia_velocita_2', 'on') or
              is_state('input_boolean.vmc_master_spia_velocita_3', 'on') or
              is_state('input_boolean.vmc_master_spia_velocita_4', 'on') or
              is_state('input_boolean.vmc_master_spia_velocita_notturna', 'on') or
              is_state('input_boolean.vmc_master_spia_velocita_freecooling', 'on') or
              is_state('input_boolean.vmc_master_spia_velocita_iperventilazione', 'on')
            ) %}
              Rilevato
            {% else %}
              Non Rilevato
            {% endif %}
          {% endif %}
        icon_template: mdi:alarm-light-outline

      vmc_master_alert_monitoraggio_totale:                                    # [CONFIGURAZIONE 1 RICHIAMO] [INTERFACCIA, 0 RICHIAMI] [AUTOMAZIONE, PIù RICHIAMI] SENSORE ALLERTA MONITORAGGIO TOTALE: Umidità, CO₂, VOC, PdR, Congelamento, Delta, Free Heating Programmato e Free Cooling Programmato
        friendly_name: "Status Monitoraggio"
        value_template: >
          {% set stati = ["sconosciuto", "unknown", "", none, "unavailable", "Non disponibile"] %}
          {% if states('sensor.vmc_master_sensori') in stati %}
            Non disponibile
          {% else %}
            {% set umidità = states('sensor.vmc_master_alert_monitoraggio_umidita') %}
            {% set umidità_non_calcolabile = states('sensor.vmc_master_umidita_interna_status') %}
            {% set umidità_esterna_non_calcolabile = states('sensor.vmc_master_umidita_esterna_status') %}
            {% set co2 = states('sensor.vmc_master_alert_monitoraggio_co2') %}
            {% set voc = states('sensor.vmc_master_alert_monitoraggio_voc') %}            
            {% set PdRvc = states('sensor.vmc_master_alert_monitoraggio_pdr') %}
            {% set congelamento = states('sensor.vmc_master_alert_monitoraggio_congelamento') %}
            {% set limite_congelamento = states('sensor.vmc_master_congelamento_verifica_soglia') %}
            {% set delta = states('sensor.vmc_master_alert_monitoraggio_delta') %}
            {% set limite_delta = states('sensor.vmc_master_delta_temp_verifica_soglia') %}
            {% set offset = states('sensor.vmc_master_alert_monitoraggio_offset_tutti_min') %}
            {% set freeheating_freecooling = states('sensor.vmc_master_alert_monitoraggio_free_heating_o_free_cooling_disabilitato') %}
            {% set black_out = states('sensor.vmc_master_alert_monitoraggio_black_out') %}
            {% if ( (black_out == 'Rilevato') or (umidità == 'Allerta' ) or (umidità_non_calcolabile == '[Non Calcolabile]') or (umidità_esterna_non_calcolabile == '[Non Calcolabile]') or (co2 =='Allerta') or (voc =='Allerta') or (PdRvc =='Allerta') or (congelamento == 'Allerta') or (limite_congelamento == '[No ma Prossimo]')  or (delta == 'Allerta') or (limite_delta == '[No ma Prossimo]') or (freeheating_freecooling == 'OK') or (offset == 'NOT OK')) %}
              Allerta
            {% else %}
              Nessuna Allerta
            {% endif %}
          {% endif %}
        icon_template: mdi:incognito-circle

      vmc_master_spia_pannello_alert_monitoraggio_totale:                      # [CONFIGURAZIONE 0 RICHIAMI] [INTERFACCIA, 1 RICHIAMO] [AUTOMAZIONE, 0 RICHIAMI] SENSORE PER MOSTRARE ALLERTA MONITORAGGIO TOTALE: Umidità, CO₂, VOC, PdR, Congelamento, Delta, Free Heating e Free Cooling
        friendly_name: "Avvisi"
        value_template: >
          {% set stati = ["sconosciuto", "unknown", "", none, "unavailable", "Non disponibile"] %}
          {% if states('sensor.vmc_master_sensori') in stati %}
            Non disponibile
          {% else %}
            {% set monitoraggio = states('sensor.vmc_master_alert_monitoraggio_totale') %}
            {% set spia_avvisi = states('input_boolean.vmc_master_opzioni_accendi_spegni_avvisi') %}
            {% if monitoraggio == 'Nessuna Allerta' %}
              Non Presenti
            {% elif monitoraggio == 'Allerta' and spia_avvisi == "on" %}
              Presenti
            {% elif monitoraggio == 'Allerta' and spia_avvisi == "off" %}
              Presenti ma Disabilitati
            {% endif %}
          {% endif %}
        icon_template: mdi:alert-rhombus-outline
########################################################################################### FINE SENSORI PER POP-UP MONITORAGGIO #####################################################################################################

################### Inizio Creazione Sensori Interfaccia Calendario  #################################################################################################################################################################
########################################################################################################################
# LOGICA DI FUNZIONAMENTO DEGLI ORARI NELLE FASCE DI INSERIMENTO NEL CALENDARIO, LE VERIFICHE DEVONO ESSERE TUTTE TRUE #
# Accensione  1° <  Spegnimento 1° True                                                                                #
# Accensione  1° <  Accensione  2° True                                                                                #
# Spegnimento 1° <  Spegnimento 2° True                                                                                #
# Accensiore  2° <  Spegnimento 2° True                                                                                #
# Accensiore  2° >  Spegnimento 1° True                                                                                #
# Accensione  1° <> Spegnimento 1° True                                                                                #
# Accensione  1° <> Accensione  2° True                                                                                #
# Spegnimento 1° <> Spegnimento 2° True                                                                                #
# Spegnimento 1° <> Accensione  2° True                                                                                #
# Accensione  2° <> Spegnimento 2° True                                                                                #
# Verifica Calendario Acceso:      True                                                                                #
########################################################################################################################

      vmc_master_status_accensione_vmc_tramite_calendario_interfaccia:                     # [CONFIGURAZIONE 0 RICHIAMI] [INTERFACCIA, 1 RICHIAMO] [AUTOMAZIONE 0] SENSORE DI VERIFICA 1° FASCIA ACCENSIONE SE GLI ORARI SONO STATI INSERITI CORRETTAMENTE, DIVERSAMENTE MOSTRERA' "DISABILITATA"
        friendly_name: "1° Accensione programmata"
        value_template: >-
          {% set stati = ["sconosciuto", "unknown", "", none, "unavailable", "Non disponibile"] %}
          {% if states('sensor.vmc_master_sensori') in stati %}
            Non disponibile
          {% else %}        
            {% set weekday = now().weekday() %}
            {% if weekday == 0 and states('input_datetime.vmc_master_accensione_lunedi') < states('input_datetime.vmc_master_spegnimento_lunedi') and states('input_datetime.vmc_master_accensione_lunedi') != states('input_datetime.vmc_master_spegnimento_lunedi') and states('input_datetime.vmc_master_accensione_lunedi_2') < states('input_datetime.vmc_master_spegnimento_lunedi_2') and states('input_datetime.vmc_master_accensione_lunedi_2') != states('input_datetime.vmc_master_spegnimento_lunedi_2') and states('input_datetime.vmc_master_accensione_lunedi') < states('input_datetime.vmc_master_accensione_lunedi_2') and states('input_datetime.vmc_master_spegnimento_lunedi') < states('input_datetime.vmc_master_spegnimento_lunedi_2') and states('input_datetime.vmc_master_accensione_lunedi') != states('input_datetime.vmc_master_accensione_lunedi_2') and states('input_datetime.vmc_master_spegnimento_lunedi') != states('input_datetime.vmc_master_spegnimento_lunedi_2') and states('input_datetime.vmc_master_spegnimento_lunedi') != states('input_datetime.vmc_master_accensione_lunedi_2') and states('input_datetime.vmc_master_accensione_lunedi_2') > states('input_datetime.vmc_master_spegnimento_lunedi') and states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_calendario') == 'on' %}
              Lunedi, {{ states('input_datetime.vmc_master_accensione_lunedi')[0:5] }}
            {% elif weekday == 1 and states('input_datetime.vmc_master_accensione_martedi') < states('input_datetime.vmc_master_spegnimento_martedi') and states('input_datetime.vmc_master_accensione_martedi') != states('input_datetime.vmc_master_spegnimento_martedi') and states('input_datetime.vmc_master_accensione_martedi_2') < states('input_datetime.vmc_master_spegnimento_martedi_2') and states('input_datetime.vmc_master_accensione_martedi_2') != states('input_datetime.vmc_master_spegnimento_martedi_2') and states('input_datetime.vmc_master_accensione_martedi') < states('input_datetime.vmc_master_accensione_martedi_2') and states('input_datetime.vmc_master_spegnimento_martedi') < states('input_datetime.vmc_master_spegnimento_martedi_2') and states('input_datetime.vmc_master_accensione_martedi') != states('input_datetime.vmc_master_accensione_martedi_2') and states('input_datetime.vmc_master_spegnimento_martedi') != states('input_datetime.vmc_master_spegnimento_martedi_2') and states('input_datetime.vmc_master_spegnimento_martedi') != states('input_datetime.vmc_master_accensione_martedi_2') and states('input_datetime.vmc_master_accensione_martedi_2') > states('input_datetime.vmc_master_spegnimento_martedi') and states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_calendario') == 'on' %}
              Martedi, {{ states('input_datetime.vmc_master_accensione_martedi')[0:5] }}
            {% elif weekday == 2 and states('input_datetime.vmc_master_accensione_mercoledi') < states('input_datetime.vmc_master_spegnimento_mercoledi') and states('input_datetime.vmc_master_accensione_mercoledi') != states('input_datetime.vmc_master_spegnimento_mercoledi') and states('input_datetime.vmc_master_accensione_mercoledi_2') < states('input_datetime.vmc_master_spegnimento_mercoledi_2') and states('input_datetime.vmc_master_accensione_mercoledi_2') != states('input_datetime.vmc_master_spegnimento_mercoledi_2') and states('input_datetime.vmc_master_accensione_mercoledi') < states('input_datetime.vmc_master_accensione_mercoledi_2') and states('input_datetime.vmc_master_spegnimento_mercoledi') < states('input_datetime.vmc_master_spegnimento_mercoledi_2') and states('input_datetime.vmc_master_accensione_mercoledi') != states('input_datetime.vmc_master_accensione_mercoledi_2') and states('input_datetime.vmc_master_spegnimento_mercoledi') != states('input_datetime.vmc_master_spegnimento_mercoledi_2') and states('input_datetime.vmc_master_spegnimento_mercoledi') != states('input_datetime.vmc_master_accensione_mercoledi_2') and states('input_datetime.vmc_master_accensione_mercoledi_2') > states('input_datetime.vmc_master_spegnimento_mercoledi') and states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_calendario') == 'on' %}
              Mercoledi, {{ states('input_datetime.vmc_master_accensione_mercoledi')[0:5] }}
            {% elif weekday == 3 and states('input_datetime.vmc_master_accensione_giovedi') < states('input_datetime.vmc_master_spegnimento_giovedi') and states('input_datetime.vmc_master_accensione_giovedi') != states('input_datetime.vmc_master_spegnimento_giovedi') and states('input_datetime.vmc_master_accensione_giovedi_2') < states('input_datetime.vmc_master_spegnimento_giovedi_2') and states('input_datetime.vmc_master_accensione_giovedi_2') != states('input_datetime.vmc_master_spegnimento_giovedi_2') and states('input_datetime.vmc_master_accensione_giovedi') < states('input_datetime.vmc_master_accensione_giovedi_2') and states('input_datetime.vmc_master_spegnimento_giovedi') < states('input_datetime.vmc_master_spegnimento_giovedi_2') and states('input_datetime.vmc_master_accensione_giovedi') != states('input_datetime.vmc_master_accensione_giovedi_2') and states('input_datetime.vmc_master_spegnimento_giovedi') != states('input_datetime.vmc_master_spegnimento_giovedi_2') and states('input_datetime.vmc_master_spegnimento_giovedi') != states('input_datetime.vmc_master_accensione_giovedi_2') and states('input_datetime.vmc_master_accensione_giovedi_2') > states('input_datetime.vmc_master_spegnimento_giovedi') and states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_calendario') == 'on' %}
              Giovedi, {{ states('input_datetime.vmc_master_accensione_giovedi')[0:5] }}
            {% elif weekday == 4 and states('input_datetime.vmc_master_accensione_venerdi') < states('input_datetime.vmc_master_spegnimento_venerdi') and states('input_datetime.vmc_master_accensione_venerdi') != states('input_datetime.vmc_master_spegnimento_venerdi') and states('input_datetime.vmc_master_accensione_venerdi_2') < states('input_datetime.vmc_master_spegnimento_venerdi_2') and states('input_datetime.vmc_master_accensione_venerdi_2') != states('input_datetime.vmc_master_spegnimento_venerdi_2') and states('input_datetime.vmc_master_accensione_venerdi') < states('input_datetime.vmc_master_accensione_venerdi_2') and states('input_datetime.vmc_master_spegnimento_venerdi') < states('input_datetime.vmc_master_spegnimento_venerdi_2') and states('input_datetime.vmc_master_accensione_venerdi') != states('input_datetime.vmc_master_accensione_venerdi_2') and states('input_datetime.vmc_master_spegnimento_venerdi') != states('input_datetime.vmc_master_spegnimento_venerdi_2') and states('input_datetime.vmc_master_spegnimento_venerdi') != states('input_datetime.vmc_master_accensione_venerdi_2') and states('input_datetime.vmc_master_accensione_venerdi_2') > states('input_datetime.vmc_master_spegnimento_venerdi') and states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_calendario') == 'on' %}
              Venerdi, {{ states('input_datetime.vmc_master_accensione_venerdi')[0:5] }}
            {% elif weekday == 5 and states('input_datetime.vmc_master_accensione_sabato') < states('input_datetime.vmc_master_spegnimento_sabato') and states('input_datetime.vmc_master_accensione_sabato') != states('input_datetime.vmc_master_spegnimento_sabato') and states('input_datetime.vmc_master_accensione_sabato_2') < states('input_datetime.vmc_master_spegnimento_sabato_2') and states('input_datetime.vmc_master_accensione_sabato_2') != states('input_datetime.vmc_master_spegnimento_sabato_2') and states('input_datetime.vmc_master_accensione_sabato') < states('input_datetime.vmc_master_accensione_sabato_2') and states('input_datetime.vmc_master_spegnimento_sabato') < states('input_datetime.vmc_master_spegnimento_sabato_2') and states('input_datetime.vmc_master_accensione_sabato') != states('input_datetime.vmc_master_accensione_sabato_2') and states('input_datetime.vmc_master_spegnimento_sabato') != states('input_datetime.vmc_master_spegnimento_sabato_2') and states('input_datetime.vmc_master_spegnimento_sabato') != states('input_datetime.vmc_master_accensione_sabato_2') and states('input_datetime.vmc_master_accensione_sabato_2') > states('input_datetime.vmc_master_spegnimento_sabato') and states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_calendario') == 'on' %}
              Sabato, {{ states('input_datetime.vmc_master_accensione_sabato')[0:5] }}
            {% elif weekday == 6 and states('input_datetime.vmc_master_accensione_domenica') < states('input_datetime.vmc_master_spegnimento_domenica') and states('input_datetime.vmc_master_accensione_domenica') != states('input_datetime.vmc_master_spegnimento_domenica') and states('input_datetime.vmc_master_accensione_domenica_2') < states('input_datetime.vmc_master_spegnimento_domenica_2') and states('input_datetime.vmc_master_accensione_domenica_2') != states('input_datetime.vmc_master_spegnimento_domenica_2') and states('input_datetime.vmc_master_accensione_domenica') < states('input_datetime.vmc_master_accensione_domenica_2') and states('input_datetime.vmc_master_spegnimento_domenica') < states('input_datetime.vmc_master_spegnimento_domenica_2') and states('input_datetime.vmc_master_accensione_domenica') != states('input_datetime.vmc_master_accensione_domenica_2') and states('input_datetime.vmc_master_spegnimento_domenica') != states('input_datetime.vmc_master_spegnimento_domenica_2') and states('input_datetime.vmc_master_spegnimento_domenica') != states('input_datetime.vmc_master_accensione_domenica_2') and states('input_datetime.vmc_master_accensione_domenica_2') > states('input_datetime.vmc_master_spegnimento_domenica') and states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_calendario') == 'on' %}
              Domenica, {{ states('input_datetime.vmc_master_accensione_domenica')[0:5] }}
              {% else %}
                Disabilitata
              {% endif %}
          {% endif %}            
        icon_template: mdi:timer-play-outline

      vmc_master_status_accensione_vmc_tramite_calendario_2_interfaccia:                    # [CONFIGURAZIONE 0 RICHIAMI] [INTERFACCIA, 1 RICHIAMO] [AUTOMAZIONE 0] SENSORE DI VERIFICA 2° FASCIA ACCENSIONE SE GLI ORARI SONO STATI INSERITI CORRETTAMENTE, DIVERSAMENTE MOSTRERA' "DISABILITATA"
        friendly_name: "2° Accensione programmata"
        value_template: >-
          {% set stati = ["sconosciuto", "unknown", "", none, "unavailable", "Non disponibile"] %}
          {% if states('sensor.vmc_master_sensori') in stati %}
            Non disponibile
          {% else %}        
            {% set weekday = now().weekday() %}
            {% if weekday == 0 and states('input_datetime.vmc_master_accensione_lunedi') < states('input_datetime.vmc_master_spegnimento_lunedi') and states('input_datetime.vmc_master_accensione_lunedi') != states('input_datetime.vmc_master_spegnimento_lunedi') and states('input_datetime.vmc_master_accensione_lunedi_2') < states('input_datetime.vmc_master_spegnimento_lunedi_2') and states('input_datetime.vmc_master_accensione_lunedi_2') != states('input_datetime.vmc_master_spegnimento_lunedi_2') and states('input_datetime.vmc_master_accensione_lunedi') < states('input_datetime.vmc_master_accensione_lunedi_2') and states('input_datetime.vmc_master_spegnimento_lunedi') < states('input_datetime.vmc_master_spegnimento_lunedi_2') and states('input_datetime.vmc_master_accensione_lunedi') != states('input_datetime.vmc_master_accensione_lunedi_2') and states('input_datetime.vmc_master_spegnimento_lunedi') != states('input_datetime.vmc_master_spegnimento_lunedi_2') and states('input_datetime.vmc_master_spegnimento_lunedi') != states('input_datetime.vmc_master_accensione_lunedi_2') and states('input_datetime.vmc_master_accensione_lunedi_2') > states('input_datetime.vmc_master_spegnimento_lunedi') and states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_calendario') == 'on' %}
              Lunedi, {{ states('input_datetime.vmc_master_accensione_lunedi_2')[0:5] }}
            {% elif weekday == 1 and states('input_datetime.vmc_master_accensione_martedi') < states('input_datetime.vmc_master_spegnimento_martedi') and states('input_datetime.vmc_master_accensione_martedi') != states('input_datetime.vmc_master_spegnimento_martedi') and states('input_datetime.vmc_master_accensione_martedi_2') < states('input_datetime.vmc_master_spegnimento_martedi_2') and states('input_datetime.vmc_master_accensione_martedi_2') != states('input_datetime.vmc_master_spegnimento_martedi_2') and states('input_datetime.vmc_master_accensione_martedi') < states('input_datetime.vmc_master_accensione_martedi_2') and states('input_datetime.vmc_master_spegnimento_martedi') < states('input_datetime.vmc_master_spegnimento_martedi_2') and states('input_datetime.vmc_master_accensione_martedi') != states('input_datetime.vmc_master_accensione_martedi_2') and states('input_datetime.vmc_master_spegnimento_martedi') != states('input_datetime.vmc_master_spegnimento_martedi_2') and states('input_datetime.vmc_master_spegnimento_martedi') != states('input_datetime.vmc_master_accensione_martedi_2') and states('input_datetime.vmc_master_accensione_martedi_2') > states('input_datetime.vmc_master_spegnimento_martedi') and states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_calendario') == 'on' %}
              Martedi, {{ states('input_datetime.vmc_master_accensione_martedi_2')[0:5] }}
            {% elif weekday == 2 and states('input_datetime.vmc_master_accensione_mercoledi') < states('input_datetime.vmc_master_spegnimento_mercoledi') and states('input_datetime.vmc_master_accensione_mercoledi') != states('input_datetime.vmc_master_spegnimento_mercoledi') and states('input_datetime.vmc_master_accensione_mercoledi_2') < states('input_datetime.vmc_master_spegnimento_mercoledi_2') and states('input_datetime.vmc_master_accensione_mercoledi_2') != states('input_datetime.vmc_master_spegnimento_mercoledi_2') and states('input_datetime.vmc_master_accensione_mercoledi') < states('input_datetime.vmc_master_accensione_mercoledi_2') and states('input_datetime.vmc_master_spegnimento_mercoledi') < states('input_datetime.vmc_master_spegnimento_mercoledi_2') and states('input_datetime.vmc_master_accensione_mercoledi') != states('input_datetime.vmc_master_accensione_mercoledi_2') and states('input_datetime.vmc_master_spegnimento_mercoledi') != states('input_datetime.vmc_master_spegnimento_mercoledi_2') and states('input_datetime.vmc_master_spegnimento_mercoledi') != states('input_datetime.vmc_master_accensione_mercoledi_2') and states('input_datetime.vmc_master_accensione_mercoledi_2') > states('input_datetime.vmc_master_spegnimento_mercoledi') and states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_calendario') == 'on' %}
              Mercoledi, {{ states('input_datetime.vmc_master_accensione_mercoledi_2')[0:5] }}
            {% elif weekday == 3 and states('input_datetime.vmc_master_accensione_giovedi') < states('input_datetime.vmc_master_spegnimento_giovedi') and states('input_datetime.vmc_master_accensione_giovedi') != states('input_datetime.vmc_master_spegnimento_giovedi') and states('input_datetime.vmc_master_accensione_giovedi_2') < states('input_datetime.vmc_master_spegnimento_giovedi_2') and states('input_datetime.vmc_master_accensione_giovedi_2') != states('input_datetime.vmc_master_spegnimento_giovedi_2') and states('input_datetime.vmc_master_accensione_giovedi') < states('input_datetime.vmc_master_accensione_giovedi_2') and states('input_datetime.vmc_master_spegnimento_giovedi') < states('input_datetime.vmc_master_spegnimento_giovedi_2') and states('input_datetime.vmc_master_accensione_giovedi') != states('input_datetime.vmc_master_accensione_giovedi_2') and states('input_datetime.vmc_master_spegnimento_giovedi') != states('input_datetime.vmc_master_spegnimento_giovedi_2') and states('input_datetime.vmc_master_spegnimento_giovedi') != states('input_datetime.vmc_master_accensione_giovedi_2') and states('input_datetime.vmc_master_accensione_giovedi_2') > states('input_datetime.vmc_master_spegnimento_giovedi') and states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_calendario') == 'on' %}
              Giovedi, {{ states('input_datetime.vmc_master_accensione_giovedi_2')[0:5] }}
            {% elif weekday == 4 and states('input_datetime.vmc_master_accensione_venerdi') < states('input_datetime.vmc_master_spegnimento_venerdi') and states('input_datetime.vmc_master_accensione_venerdi') != states('input_datetime.vmc_master_spegnimento_venerdi') and states('input_datetime.vmc_master_accensione_venerdi_2') < states('input_datetime.vmc_master_spegnimento_venerdi_2') and states('input_datetime.vmc_master_accensione_venerdi_2') != states('input_datetime.vmc_master_spegnimento_venerdi_2') and states('input_datetime.vmc_master_accensione_venerdi') < states('input_datetime.vmc_master_accensione_venerdi_2') and states('input_datetime.vmc_master_spegnimento_venerdi') < states('input_datetime.vmc_master_spegnimento_venerdi_2') and states('input_datetime.vmc_master_accensione_venerdi') != states('input_datetime.vmc_master_accensione_venerdi_2') and states('input_datetime.vmc_master_spegnimento_venerdi') != states('input_datetime.vmc_master_spegnimento_venerdi_2') and states('input_datetime.vmc_master_spegnimento_venerdi') != states('input_datetime.vmc_master_accensione_venerdi_2') and states('input_datetime.vmc_master_accensione_venerdi_2') > states('input_datetime.vmc_master_spegnimento_venerdi') and states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_calendario') == 'on' %}
              Venerdi, {{ states('input_datetime.vmc_master_accensione_venerdi_2')[0:5] }}
            {% elif weekday == 5 and states('input_datetime.vmc_master_accensione_sabato') < states('input_datetime.vmc_master_spegnimento_sabato') and states('input_datetime.vmc_master_accensione_sabato') != states('input_datetime.vmc_master_spegnimento_sabato') and states('input_datetime.vmc_master_accensione_sabato_2') < states('input_datetime.vmc_master_spegnimento_sabato_2') and states('input_datetime.vmc_master_accensione_sabato_2') != states('input_datetime.vmc_master_spegnimento_sabato_2') and states('input_datetime.vmc_master_accensione_sabato') < states('input_datetime.vmc_master_accensione_sabato_2') and states('input_datetime.vmc_master_spegnimento_sabato') < states('input_datetime.vmc_master_spegnimento_sabato_2') and states('input_datetime.vmc_master_accensione_sabato') != states('input_datetime.vmc_master_accensione_sabato_2') and states('input_datetime.vmc_master_spegnimento_sabato') != states('input_datetime.vmc_master_spegnimento_sabato_2') and states('input_datetime.vmc_master_spegnimento_sabato') != states('input_datetime.vmc_master_accensione_sabato_2') and states('input_datetime.vmc_master_accensione_sabato_2') > states('input_datetime.vmc_master_spegnimento_sabato') and states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_calendario') == 'on' %}
              Sabato, {{ states('input_datetime.vmc_master_accensione_sabato_2')[0:5] }}
            {% elif weekday == 6 and states('input_datetime.vmc_master_accensione_domenica') < states('input_datetime.vmc_master_spegnimento_domenica') and states('input_datetime.vmc_master_accensione_domenica') != states('input_datetime.vmc_master_spegnimento_domenica') and states('input_datetime.vmc_master_accensione_domenica_2') < states('input_datetime.vmc_master_spegnimento_domenica_2') and states('input_datetime.vmc_master_accensione_domenica_2') != states('input_datetime.vmc_master_spegnimento_domenica_2') and states('input_datetime.vmc_master_accensione_domenica') < states('input_datetime.vmc_master_accensione_domenica_2') and states('input_datetime.vmc_master_spegnimento_domenica') < states('input_datetime.vmc_master_spegnimento_domenica_2') and states('input_datetime.vmc_master_accensione_domenica') != states('input_datetime.vmc_master_accensione_domenica_2') and states('input_datetime.vmc_master_spegnimento_domenica') != states('input_datetime.vmc_master_spegnimento_domenica_2') and states('input_datetime.vmc_master_spegnimento_domenica') != states('input_datetime.vmc_master_accensione_domenica_2') and states('input_datetime.vmc_master_accensione_domenica_2') > states('input_datetime.vmc_master_spegnimento_domenica') and states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_calendario') == 'on' %}
              Domenica, {{ states('input_datetime.vmc_master_accensione_domenica_2')[0:5] }}
              {% else %}
                Disabilitata
              {% endif %}
          {% endif %}            
        icon_template: mdi:timer-play-outline

      vmc_master_status_spegnimento_vmc_tramite_calendario_interfaccia:                   # [CONFIGURAZIONE 0 RICHIAMI] [INTERFACCIA, 1 RICHIAMO] [AUTOMAZIONE 0] SENSORE DI VERIFICA 1° FASCIA SPEGNIMENTO SE GLI ORARI SONO STATI INSERITI CORRETTAMENTE, DIVERSAMENTE MOSTRERA' "DISABILITATO"
        friendly_name: "1° Spegnimento programmato"
        value_template: >-
          {% set stati = ["sconosciuto", "unknown", "", none, "unavailable", "Non disponibile"] %}
          {% if states('sensor.vmc_master_sensori') in stati %}
            Non disponibile
          {% else %}        
            {% set weekday = now().weekday() %}
            {% if weekday == 0 and states('input_datetime.vmc_master_accensione_lunedi') < states('input_datetime.vmc_master_spegnimento_lunedi') and states('input_datetime.vmc_master_accensione_lunedi') != states('input_datetime.vmc_master_spegnimento_lunedi') and states('input_datetime.vmc_master_accensione_lunedi_2') < states('input_datetime.vmc_master_spegnimento_lunedi_2') and states('input_datetime.vmc_master_accensione_lunedi_2') != states('input_datetime.vmc_master_spegnimento_lunedi_2') and states('input_datetime.vmc_master_accensione_lunedi') < states('input_datetime.vmc_master_accensione_lunedi_2') and states('input_datetime.vmc_master_spegnimento_lunedi') < states('input_datetime.vmc_master_spegnimento_lunedi_2') and states('input_datetime.vmc_master_accensione_lunedi') != states('input_datetime.vmc_master_accensione_lunedi_2') and states('input_datetime.vmc_master_spegnimento_lunedi') != states('input_datetime.vmc_master_spegnimento_lunedi_2') and states('input_datetime.vmc_master_spegnimento_lunedi') != states('input_datetime.vmc_master_accensione_lunedi_2') and states('input_datetime.vmc_master_accensione_lunedi_2') > states('input_datetime.vmc_master_spegnimento_lunedi') and states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_calendario') == 'on' %}
              Lunedi, {{ states('input_datetime.vmc_master_spegnimento_lunedi')[0:5] }}
            {% elif weekday == 1 and states('input_datetime.vmc_master_accensione_martedi') < states('input_datetime.vmc_master_spegnimento_martedi') and states('input_datetime.vmc_master_accensione_martedi') != states('input_datetime.vmc_master_spegnimento_martedi') and states('input_datetime.vmc_master_accensione_martedi_2') < states('input_datetime.vmc_master_spegnimento_martedi_2') and states('input_datetime.vmc_master_accensione_martedi_2') != states('input_datetime.vmc_master_spegnimento_martedi_2') and states('input_datetime.vmc_master_accensione_martedi') < states('input_datetime.vmc_master_accensione_martedi_2') and states('input_datetime.vmc_master_spegnimento_martedi') < states('input_datetime.vmc_master_spegnimento_martedi_2') and states('input_datetime.vmc_master_accensione_martedi') != states('input_datetime.vmc_master_accensione_martedi_2') and states('input_datetime.vmc_master_spegnimento_martedi') != states('input_datetime.vmc_master_spegnimento_martedi_2') and states('input_datetime.vmc_master_spegnimento_martedi') != states('input_datetime.vmc_master_accensione_martedi_2') and states('input_datetime.vmc_master_accensione_martedi_2') > states('input_datetime.vmc_master_spegnimento_martedi') and states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_calendario') == 'on' %}
              Martedi, {{ states('input_datetime.vmc_master_spegnimento_martedi')[0:5] }}
            {% elif weekday == 2 and states('input_datetime.vmc_master_accensione_mercoledi') < states('input_datetime.vmc_master_spegnimento_mercoledi') and states('input_datetime.vmc_master_accensione_mercoledi') != states('input_datetime.vmc_master_spegnimento_mercoledi') and states('input_datetime.vmc_master_accensione_mercoledi_2') < states('input_datetime.vmc_master_spegnimento_mercoledi_2') and states('input_datetime.vmc_master_accensione_mercoledi_2') != states('input_datetime.vmc_master_spegnimento_mercoledi_2') and states('input_datetime.vmc_master_accensione_mercoledi') < states('input_datetime.vmc_master_accensione_mercoledi_2') and states('input_datetime.vmc_master_spegnimento_mercoledi') < states('input_datetime.vmc_master_spegnimento_mercoledi_2') and states('input_datetime.vmc_master_accensione_mercoledi') != states('input_datetime.vmc_master_accensione_mercoledi_2') and states('input_datetime.vmc_master_spegnimento_mercoledi') != states('input_datetime.vmc_master_spegnimento_mercoledi_2') and states('input_datetime.vmc_master_spegnimento_mercoledi') != states('input_datetime.vmc_master_accensione_mercoledi_2') and states('input_datetime.vmc_master_accensione_mercoledi_2') > states('input_datetime.vmc_master_spegnimento_mercoledi') and states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_calendario') == 'on' %}
              Mercoledi, {{ states('input_datetime.vmc_master_spegnimento_mercoledi')[0:5] }}
            {% elif weekday == 3 and states('input_datetime.vmc_master_accensione_giovedi') < states('input_datetime.vmc_master_spegnimento_giovedi') and states('input_datetime.vmc_master_accensione_giovedi') != states('input_datetime.vmc_master_spegnimento_giovedi') and states('input_datetime.vmc_master_accensione_giovedi_2') < states('input_datetime.vmc_master_spegnimento_giovedi_2') and states('input_datetime.vmc_master_accensione_giovedi_2') != states('input_datetime.vmc_master_spegnimento_giovedi_2') and states('input_datetime.vmc_master_accensione_giovedi') < states('input_datetime.vmc_master_accensione_giovedi_2') and states('input_datetime.vmc_master_spegnimento_giovedi') < states('input_datetime.vmc_master_spegnimento_giovedi_2') and states('input_datetime.vmc_master_accensione_giovedi') != states('input_datetime.vmc_master_accensione_giovedi_2') and states('input_datetime.vmc_master_spegnimento_giovedi') != states('input_datetime.vmc_master_spegnimento_giovedi_2') and states('input_datetime.vmc_master_spegnimento_giovedi') != states('input_datetime.vmc_master_accensione_giovedi_2') and states('input_datetime.vmc_master_accensione_giovedi_2') > states('input_datetime.vmc_master_spegnimento_giovedi') and states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_calendario') == 'on' %}
              Giovedi, {{ states('input_datetime.vmc_master_spegnimento_giovedi')[0:5] }}
            {% elif weekday == 4 and states('input_datetime.vmc_master_accensione_venerdi') < states('input_datetime.vmc_master_spegnimento_venerdi') and states('input_datetime.vmc_master_accensione_venerdi') != states('input_datetime.vmc_master_spegnimento_venerdi') and states('input_datetime.vmc_master_accensione_venerdi_2') < states('input_datetime.vmc_master_spegnimento_venerdi_2') and states('input_datetime.vmc_master_accensione_venerdi_2') != states('input_datetime.vmc_master_spegnimento_venerdi_2') and states('input_datetime.vmc_master_accensione_venerdi') < states('input_datetime.vmc_master_accensione_venerdi_2') and states('input_datetime.vmc_master_spegnimento_venerdi') < states('input_datetime.vmc_master_spegnimento_venerdi_2') and states('input_datetime.vmc_master_accensione_venerdi') != states('input_datetime.vmc_master_accensione_venerdi_2') and states('input_datetime.vmc_master_spegnimento_venerdi') != states('input_datetime.vmc_master_spegnimento_venerdi_2') and states('input_datetime.vmc_master_spegnimento_venerdi') != states('input_datetime.vmc_master_accensione_venerdi_2') and states('input_datetime.vmc_master_accensione_venerdi_2') > states('input_datetime.vmc_master_spegnimento_venerdi') and states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_calendario') == 'on' %}
              Venerdi, {{ states('input_datetime.vmc_master_spegnimento_venerdi')[0:5] }}
            {% elif weekday == 5 and states('input_datetime.vmc_master_accensione_sabato') < states('input_datetime.vmc_master_spegnimento_sabato') and states('input_datetime.vmc_master_accensione_sabato') != states('input_datetime.vmc_master_spegnimento_sabato') and states('input_datetime.vmc_master_accensione_sabato_2') < states('input_datetime.vmc_master_spegnimento_sabato_2') and states('input_datetime.vmc_master_accensione_sabato_2') != states('input_datetime.vmc_master_spegnimento_sabato_2') and states('input_datetime.vmc_master_accensione_sabato') < states('input_datetime.vmc_master_accensione_sabato_2') and states('input_datetime.vmc_master_spegnimento_sabato') < states('input_datetime.vmc_master_spegnimento_sabato_2') and states('input_datetime.vmc_master_accensione_sabato') != states('input_datetime.vmc_master_accensione_sabato_2') and states('input_datetime.vmc_master_spegnimento_sabato') != states('input_datetime.vmc_master_spegnimento_sabato_2') and states('input_datetime.vmc_master_spegnimento_sabato') != states('input_datetime.vmc_master_accensione_sabato_2') and states('input_datetime.vmc_master_accensione_sabato_2') > states('input_datetime.vmc_master_spegnimento_sabato') and states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_calendario') == 'on' %}
              Sabato, {{ states('input_datetime.vmc_master_spegnimento_sabato')[0:5] }}
            {% elif weekday == 6 and states('input_datetime.vmc_master_accensione_domenica') < states('input_datetime.vmc_master_spegnimento_domenica') and states('input_datetime.vmc_master_accensione_domenica') != states('input_datetime.vmc_master_spegnimento_domenica') and states('input_datetime.vmc_master_accensione_domenica_2') < states('input_datetime.vmc_master_spegnimento_domenica_2') and states('input_datetime.vmc_master_accensione_domenica_2') != states('input_datetime.vmc_master_spegnimento_domenica_2') and states('input_datetime.vmc_master_accensione_domenica') < states('input_datetime.vmc_master_accensione_domenica_2') and states('input_datetime.vmc_master_spegnimento_domenica') < states('input_datetime.vmc_master_spegnimento_domenica_2') and states('input_datetime.vmc_master_accensione_domenica') != states('input_datetime.vmc_master_accensione_domenica_2') and states('input_datetime.vmc_master_spegnimento_domenica') != states('input_datetime.vmc_master_spegnimento_domenica_2') and states('input_datetime.vmc_master_spegnimento_domenica') != states('input_datetime.vmc_master_accensione_domenica_2') and states('input_datetime.vmc_master_accensione_domenica_2') > states('input_datetime.vmc_master_spegnimento_domenica') and states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_calendario') == 'on' %}
              Domenica, {{ states('input_datetime.vmc_master_spegnimento_domenica')[0:5] }}
              {% else %}
                Disabilitata
              {% endif %}
          {% endif %}         
        icon_template: mdi:timer-stop-outline

      vmc_master_status_spegnimento_vmc_tramite_calendario_2_interfaccia:                 # [CONFIGURAZIONE 0 RICHIAMI] [INTERFACCIA, 1 RICHIAMO] [AUTOMAZIONE 0] SENSORE DI VERIFICA 2° FASCIA SPEGNIMENTO SE GLI ORARI SONO STATI INSERITI CORRETTAMENTE, DIVERSAMENTE MOSTRERA' "DISABILITATO"
        friendly_name: "2° Spegnimento programmato"
        value_template: >-
          {% set stati = ["sconosciuto", "unknown", "", none, "unavailable", "Non disponibile"] %}
          {% if states('sensor.vmc_master_sensori') in stati %}
            Non disponibile
          {% else %}        
            {% set weekday = now().weekday() %}
            {% if weekday == 0 and states('input_datetime.vmc_master_accensione_lunedi') < states('input_datetime.vmc_master_spegnimento_lunedi') and states('input_datetime.vmc_master_accensione_lunedi') != states('input_datetime.vmc_master_spegnimento_lunedi') and states('input_datetime.vmc_master_accensione_lunedi_2') < states('input_datetime.vmc_master_spegnimento_lunedi_2') and states('input_datetime.vmc_master_accensione_lunedi_2') != states('input_datetime.vmc_master_spegnimento_lunedi_2') and states('input_datetime.vmc_master_accensione_lunedi') < states('input_datetime.vmc_master_accensione_lunedi_2') and states('input_datetime.vmc_master_spegnimento_lunedi') < states('input_datetime.vmc_master_spegnimento_lunedi_2') and states('input_datetime.vmc_master_accensione_lunedi') != states('input_datetime.vmc_master_accensione_lunedi_2') and states('input_datetime.vmc_master_spegnimento_lunedi') != states('input_datetime.vmc_master_spegnimento_lunedi_2') and states('input_datetime.vmc_master_spegnimento_lunedi') != states('input_datetime.vmc_master_accensione_lunedi_2') and states('input_datetime.vmc_master_accensione_lunedi_2') > states('input_datetime.vmc_master_spegnimento_lunedi') and states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_calendario') == 'on' %}
              Lunedi, {{ states('input_datetime.vmc_master_spegnimento_lunedi_2')[0:5] }}
            {% elif weekday == 1 and states('input_datetime.vmc_master_accensione_martedi') < states('input_datetime.vmc_master_spegnimento_martedi') and states('input_datetime.vmc_master_accensione_martedi') != states('input_datetime.vmc_master_spegnimento_martedi') and states('input_datetime.vmc_master_accensione_martedi_2') < states('input_datetime.vmc_master_spegnimento_martedi_2') and states('input_datetime.vmc_master_accensione_martedi_2') != states('input_datetime.vmc_master_spegnimento_martedi_2') and states('input_datetime.vmc_master_accensione_martedi') < states('input_datetime.vmc_master_accensione_martedi_2') and states('input_datetime.vmc_master_spegnimento_martedi') < states('input_datetime.vmc_master_spegnimento_martedi_2') and states('input_datetime.vmc_master_accensione_martedi') != states('input_datetime.vmc_master_accensione_martedi_2') and states('input_datetime.vmc_master_spegnimento_martedi') != states('input_datetime.vmc_master_spegnimento_martedi_2') and states('input_datetime.vmc_master_spegnimento_martedi') != states('input_datetime.vmc_master_accensione_martedi_2') and states('input_datetime.vmc_master_accensione_martedi_2') > states('input_datetime.vmc_master_spegnimento_martedi') and states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_calendario') == 'on' %}
              Martedi, {{ states('input_datetime.vmc_master_spegnimento_martedi_2')[0:5] }}
            {% elif weekday == 2 and states('input_datetime.vmc_master_accensione_mercoledi') < states('input_datetime.vmc_master_spegnimento_mercoledi') and states('input_datetime.vmc_master_accensione_mercoledi') != states('input_datetime.vmc_master_spegnimento_mercoledi') and states('input_datetime.vmc_master_accensione_mercoledi_2') < states('input_datetime.vmc_master_spegnimento_mercoledi_2') and states('input_datetime.vmc_master_accensione_mercoledi_2') != states('input_datetime.vmc_master_spegnimento_mercoledi_2') and states('input_datetime.vmc_master_accensione_mercoledi') < states('input_datetime.vmc_master_accensione_mercoledi_2') and states('input_datetime.vmc_master_spegnimento_mercoledi') < states('input_datetime.vmc_master_spegnimento_mercoledi_2') and states('input_datetime.vmc_master_accensione_mercoledi') != states('input_datetime.vmc_master_accensione_mercoledi_2') and states('input_datetime.vmc_master_spegnimento_mercoledi') != states('input_datetime.vmc_master_spegnimento_mercoledi_2') and states('input_datetime.vmc_master_spegnimento_mercoledi') != states('input_datetime.vmc_master_accensione_mercoledi_2') and states('input_datetime.vmc_master_accensione_mercoledi_2') > states('input_datetime.vmc_master_spegnimento_mercoledi') and states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_calendario') == 'on' %}
              Mercoledi, {{ states('input_datetime.vmc_master_spegnimento_mercoledi_2')[0:5] }}
            {% elif weekday == 3 and states('input_datetime.vmc_master_accensione_giovedi') < states('input_datetime.vmc_master_spegnimento_giovedi') and states('input_datetime.vmc_master_accensione_giovedi') != states('input_datetime.vmc_master_spegnimento_giovedi') and states('input_datetime.vmc_master_accensione_giovedi_2') < states('input_datetime.vmc_master_spegnimento_giovedi_2') and states('input_datetime.vmc_master_accensione_giovedi_2') != states('input_datetime.vmc_master_spegnimento_giovedi_2') and states('input_datetime.vmc_master_accensione_giovedi') < states('input_datetime.vmc_master_accensione_giovedi_2') and states('input_datetime.vmc_master_spegnimento_giovedi') < states('input_datetime.vmc_master_spegnimento_giovedi_2') and states('input_datetime.vmc_master_accensione_giovedi') != states('input_datetime.vmc_master_accensione_giovedi_2') and states('input_datetime.vmc_master_spegnimento_giovedi') != states('input_datetime.vmc_master_spegnimento_giovedi_2') and states('input_datetime.vmc_master_spegnimento_giovedi') != states('input_datetime.vmc_master_accensione_giovedi_2') and states('input_datetime.vmc_master_accensione_giovedi_2') > states('input_datetime.vmc_master_spegnimento_giovedi') and states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_calendario') == 'on' %}
              Giovedi, {{ states('input_datetime.vmc_master_spegnimento_giovedi_2')[0:5] }}
            {% elif weekday == 4 and states('input_datetime.vmc_master_accensione_venerdi') < states('input_datetime.vmc_master_spegnimento_venerdi') and states('input_datetime.vmc_master_accensione_venerdi') != states('input_datetime.vmc_master_spegnimento_venerdi') and states('input_datetime.vmc_master_accensione_venerdi_2') < states('input_datetime.vmc_master_spegnimento_venerdi_2') and states('input_datetime.vmc_master_accensione_venerdi_2') != states('input_datetime.vmc_master_spegnimento_venerdi_2') and states('input_datetime.vmc_master_accensione_venerdi') < states('input_datetime.vmc_master_accensione_venerdi_2') and states('input_datetime.vmc_master_spegnimento_venerdi') < states('input_datetime.vmc_master_spegnimento_venerdi_2') and states('input_datetime.vmc_master_accensione_venerdi') != states('input_datetime.vmc_master_accensione_venerdi_2') and states('input_datetime.vmc_master_spegnimento_venerdi') != states('input_datetime.vmc_master_spegnimento_venerdi_2') and states('input_datetime.vmc_master_spegnimento_venerdi') != states('input_datetime.vmc_master_accensione_venerdi_2') and states('input_datetime.vmc_master_accensione_venerdi_2') > states('input_datetime.vmc_master_spegnimento_venerdi') and states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_calendario') == 'on' %}
              Venerdi, {{ states('input_datetime.vmc_master_spegnimento_venerdi_2')[0:5] }}
            {% elif weekday == 5 and states('input_datetime.vmc_master_accensione_sabato') < states('input_datetime.vmc_master_spegnimento_sabato') and states('input_datetime.vmc_master_accensione_sabato') != states('input_datetime.vmc_master_spegnimento_sabato') and states('input_datetime.vmc_master_accensione_sabato_2') < states('input_datetime.vmc_master_spegnimento_sabato_2') and states('input_datetime.vmc_master_accensione_sabato_2') != states('input_datetime.vmc_master_spegnimento_sabato_2') and states('input_datetime.vmc_master_accensione_sabato') < states('input_datetime.vmc_master_accensione_sabato_2') and states('input_datetime.vmc_master_spegnimento_sabato') < states('input_datetime.vmc_master_spegnimento_sabato_2') and states('input_datetime.vmc_master_accensione_sabato') != states('input_datetime.vmc_master_accensione_sabato_2') and states('input_datetime.vmc_master_spegnimento_sabato') != states('input_datetime.vmc_master_spegnimento_sabato_2') and states('input_datetime.vmc_master_spegnimento_sabato') != states('input_datetime.vmc_master_accensione_sabato_2') and states('input_datetime.vmc_master_accensione_sabato_2') > states('input_datetime.vmc_master_spegnimento_sabato') and states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_calendario') == 'on' %}
              Sabato, {{ states('input_datetime.vmc_master_spegnimento_sabato_2')[0:5] }}
            {% elif weekday == 6 and states('input_datetime.vmc_master_accensione_domenica') < states('input_datetime.vmc_master_spegnimento_domenica') and states('input_datetime.vmc_master_accensione_domenica') != states('input_datetime.vmc_master_spegnimento_domenica') and states('input_datetime.vmc_master_accensione_domenica_2') < states('input_datetime.vmc_master_spegnimento_domenica_2') and states('input_datetime.vmc_master_accensione_domenica_2') != states('input_datetime.vmc_master_spegnimento_domenica_2') and states('input_datetime.vmc_master_accensione_domenica') < states('input_datetime.vmc_master_accensione_domenica_2') and states('input_datetime.vmc_master_spegnimento_domenica') < states('input_datetime.vmc_master_spegnimento_domenica_2') and states('input_datetime.vmc_master_accensione_domenica') != states('input_datetime.vmc_master_accensione_domenica_2') and states('input_datetime.vmc_master_spegnimento_domenica') != states('input_datetime.vmc_master_spegnimento_domenica_2') and states('input_datetime.vmc_master_spegnimento_domenica') != states('input_datetime.vmc_master_accensione_domenica_2') and states('input_datetime.vmc_master_accensione_domenica_2') > states('input_datetime.vmc_master_spegnimento_domenica') and states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_calendario') == 'on' %}
              Domenica, {{ states('input_datetime.vmc_master_spegnimento_domenica_2')[0:5] }}
              {% else %}
                Disabilitata
              {% endif %}
          {% endif %}         
        icon_template: mdi:timer-stop-outline
        
      vmc_master_status_accensione_vmc_tramite_calendario:                     # [CONFIGURAZIONE 0 RICHIAMI] [INTERFACCIA, 0 RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI] SENSORE DI VERIFICA 1° FASCIA ACCENSIONE SE GLI ORARI SONO STATI INSERITI CORRETTAMENTE, DIVERSAMENTE MOSTRERA' "DISABILITATA"
        friendly_name: "1° Accensione programmata"
        value_template: >-
          {% set stati = ["sconosciuto", "unknown", "", none, "unavailable", "Non disponibile"] %}
          {% if states('sensor.vmc_master_sensori') in stati %}
            Non disponibile
          {% else %}        
            {% set weekday = now().weekday() %}
            {% if weekday == 0 and states('input_datetime.vmc_master_accensione_lunedi') < states('input_datetime.vmc_master_spegnimento_lunedi') and states('input_datetime.vmc_master_accensione_lunedi') != states('input_datetime.vmc_master_spegnimento_lunedi') and states('input_datetime.vmc_master_accensione_lunedi_2') < states('input_datetime.vmc_master_spegnimento_lunedi_2') and states('input_datetime.vmc_master_accensione_lunedi_2') != states('input_datetime.vmc_master_spegnimento_lunedi_2') and states('input_datetime.vmc_master_accensione_lunedi') < states('input_datetime.vmc_master_accensione_lunedi_2') and states('input_datetime.vmc_master_spegnimento_lunedi') < states('input_datetime.vmc_master_spegnimento_lunedi_2') and states('input_datetime.vmc_master_accensione_lunedi') != states('input_datetime.vmc_master_accensione_lunedi_2') and states('input_datetime.vmc_master_spegnimento_lunedi') != states('input_datetime.vmc_master_spegnimento_lunedi_2') and states('input_datetime.vmc_master_spegnimento_lunedi') != states('input_datetime.vmc_master_accensione_lunedi_2') and states('input_datetime.vmc_master_accensione_lunedi_2') > states('input_datetime.vmc_master_spegnimento_lunedi') and states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_calendario') == 'on' %}
              Lunedi
            {% elif weekday == 1 and states('input_datetime.vmc_master_accensione_martedi') < states('input_datetime.vmc_master_spegnimento_martedi') and states('input_datetime.vmc_master_accensione_martedi') != states('input_datetime.vmc_master_spegnimento_martedi') and states('input_datetime.vmc_master_accensione_martedi_2') < states('input_datetime.vmc_master_spegnimento_martedi_2') and states('input_datetime.vmc_master_accensione_martedi_2') != states('input_datetime.vmc_master_spegnimento_martedi_2') and states('input_datetime.vmc_master_accensione_martedi') < states('input_datetime.vmc_master_accensione_martedi_2') and states('input_datetime.vmc_master_spegnimento_martedi') < states('input_datetime.vmc_master_spegnimento_martedi_2') and states('input_datetime.vmc_master_accensione_martedi') != states('input_datetime.vmc_master_accensione_martedi_2') and states('input_datetime.vmc_master_spegnimento_martedi') != states('input_datetime.vmc_master_spegnimento_martedi_2') and states('input_datetime.vmc_master_spegnimento_martedi') != states('input_datetime.vmc_master_accensione_martedi_2') and states('input_datetime.vmc_master_accensione_martedi_2') > states('input_datetime.vmc_master_spegnimento_martedi') and states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_calendario') == 'on' %}
              Martedi
            {% elif weekday == 2 and states('input_datetime.vmc_master_accensione_mercoledi') < states('input_datetime.vmc_master_spegnimento_mercoledi') and states('input_datetime.vmc_master_accensione_mercoledi') != states('input_datetime.vmc_master_spegnimento_mercoledi') and states('input_datetime.vmc_master_accensione_mercoledi_2') < states('input_datetime.vmc_master_spegnimento_mercoledi_2') and states('input_datetime.vmc_master_accensione_mercoledi_2') != states('input_datetime.vmc_master_spegnimento_mercoledi_2') and states('input_datetime.vmc_master_accensione_mercoledi') < states('input_datetime.vmc_master_accensione_mercoledi_2') and states('input_datetime.vmc_master_spegnimento_mercoledi') < states('input_datetime.vmc_master_spegnimento_mercoledi_2') and states('input_datetime.vmc_master_accensione_mercoledi') != states('input_datetime.vmc_master_accensione_mercoledi_2') and states('input_datetime.vmc_master_spegnimento_mercoledi') != states('input_datetime.vmc_master_spegnimento_mercoledi_2') and states('input_datetime.vmc_master_spegnimento_mercoledi') != states('input_datetime.vmc_master_accensione_mercoledi_2') and states('input_datetime.vmc_master_accensione_mercoledi_2') > states('input_datetime.vmc_master_spegnimento_mercoledi') and states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_calendario') == 'on' %}
              Mercoledi
            {% elif weekday == 3 and states('input_datetime.vmc_master_accensione_giovedi') < states('input_datetime.vmc_master_spegnimento_giovedi') and states('input_datetime.vmc_master_accensione_giovedi') != states('input_datetime.vmc_master_spegnimento_giovedi') and states('input_datetime.vmc_master_accensione_giovedi_2') < states('input_datetime.vmc_master_spegnimento_giovedi_2') and states('input_datetime.vmc_master_accensione_giovedi_2') != states('input_datetime.vmc_master_spegnimento_giovedi_2') and states('input_datetime.vmc_master_accensione_giovedi') < states('input_datetime.vmc_master_accensione_giovedi_2') and states('input_datetime.vmc_master_spegnimento_giovedi') < states('input_datetime.vmc_master_spegnimento_giovedi_2') and states('input_datetime.vmc_master_accensione_giovedi') != states('input_datetime.vmc_master_accensione_giovedi_2') and states('input_datetime.vmc_master_spegnimento_giovedi') != states('input_datetime.vmc_master_spegnimento_giovedi_2') and states('input_datetime.vmc_master_spegnimento_giovedi') != states('input_datetime.vmc_master_accensione_giovedi_2') and states('input_datetime.vmc_master_accensione_giovedi_2') > states('input_datetime.vmc_master_spegnimento_giovedi') and states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_calendario') == 'on' %}
              Giovedi
            {% elif weekday == 4 and states('input_datetime.vmc_master_accensione_venerdi') < states('input_datetime.vmc_master_spegnimento_venerdi') and states('input_datetime.vmc_master_accensione_venerdi') != states('input_datetime.vmc_master_spegnimento_venerdi') and states('input_datetime.vmc_master_accensione_venerdi_2') < states('input_datetime.vmc_master_spegnimento_venerdi_2') and states('input_datetime.vmc_master_accensione_venerdi_2') != states('input_datetime.vmc_master_spegnimento_venerdi_2') and states('input_datetime.vmc_master_accensione_venerdi') < states('input_datetime.vmc_master_accensione_venerdi_2') and states('input_datetime.vmc_master_spegnimento_venerdi') < states('input_datetime.vmc_master_spegnimento_venerdi_2') and states('input_datetime.vmc_master_accensione_venerdi') != states('input_datetime.vmc_master_accensione_venerdi_2') and states('input_datetime.vmc_master_spegnimento_venerdi') != states('input_datetime.vmc_master_spegnimento_venerdi_2') and states('input_datetime.vmc_master_spegnimento_venerdi') != states('input_datetime.vmc_master_accensione_venerdi_2') and states('input_datetime.vmc_master_accensione_venerdi_2') > states('input_datetime.vmc_master_spegnimento_venerdi') and states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_calendario') == 'on' %}
              Venerdi
            {% elif weekday == 5 and states('input_datetime.vmc_master_accensione_sabato') < states('input_datetime.vmc_master_spegnimento_sabato') and states('input_datetime.vmc_master_accensione_sabato') != states('input_datetime.vmc_master_spegnimento_sabato') and states('input_datetime.vmc_master_accensione_sabato_2') < states('input_datetime.vmc_master_spegnimento_sabato_2') and states('input_datetime.vmc_master_accensione_sabato_2') != states('input_datetime.vmc_master_spegnimento_sabato_2') and states('input_datetime.vmc_master_accensione_sabato') < states('input_datetime.vmc_master_accensione_sabato_2') and states('input_datetime.vmc_master_spegnimento_sabato') < states('input_datetime.vmc_master_spegnimento_sabato_2') and states('input_datetime.vmc_master_accensione_sabato') != states('input_datetime.vmc_master_accensione_sabato_2') and states('input_datetime.vmc_master_spegnimento_sabato') != states('input_datetime.vmc_master_spegnimento_sabato_2') and states('input_datetime.vmc_master_spegnimento_sabato') != states('input_datetime.vmc_master_accensione_sabato_2') and states('input_datetime.vmc_master_accensione_sabato_2') > states('input_datetime.vmc_master_spegnimento_sabato') and states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_calendario') == 'on' %}
              Sabato
            {% elif weekday == 6 and states('input_datetime.vmc_master_accensione_domenica') < states('input_datetime.vmc_master_spegnimento_domenica') and states('input_datetime.vmc_master_accensione_domenica') != states('input_datetime.vmc_master_spegnimento_domenica') and states('input_datetime.vmc_master_accensione_domenica_2') < states('input_datetime.vmc_master_spegnimento_domenica_2') and states('input_datetime.vmc_master_accensione_domenica_2') != states('input_datetime.vmc_master_spegnimento_domenica_2') and states('input_datetime.vmc_master_accensione_domenica') < states('input_datetime.vmc_master_accensione_domenica_2') and states('input_datetime.vmc_master_spegnimento_domenica') < states('input_datetime.vmc_master_spegnimento_domenica_2') and states('input_datetime.vmc_master_accensione_domenica') != states('input_datetime.vmc_master_accensione_domenica_2') and states('input_datetime.vmc_master_spegnimento_domenica') != states('input_datetime.vmc_master_spegnimento_domenica_2') and states('input_datetime.vmc_master_spegnimento_domenica') != states('input_datetime.vmc_master_accensione_domenica_2') and states('input_datetime.vmc_master_accensione_domenica_2') > states('input_datetime.vmc_master_spegnimento_domenica') and states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_calendario') == 'on' %}
              Domenica
              {% else %}
                Disabilitata
              {% endif %}
          {% endif %}            
        icon_template: mdi:timer-play-outline

      vmc_master_status_accensione_vmc_tramite_calendario_2:                   # [CONFIGURAZIONE 0 RICHIAMI] [INTERFACCIA, 0 RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI] SENSORE DI VERIFICA 2° FASCIA ACCENSIONE SE GLI ORARI SONO STATI INSERITI CORRETTAMENTE, DIVERSAMENTE MOSTRERA' "DISABILITATA"
        friendly_name: "2° Accensione programmata"
        value_template: >-
          {% set stati = ["sconosciuto", "unknown", "", none, "unavailable", "Non disponibile"] %}
          {% if states('sensor.vmc_master_sensori') in stati %}
            Non disponibile
          {% else %}        
            {% set weekday = now().weekday() %}
            {% if weekday == 0 and states('input_datetime.vmc_master_accensione_lunedi') < states('input_datetime.vmc_master_spegnimento_lunedi') and states('input_datetime.vmc_master_accensione_lunedi') != states('input_datetime.vmc_master_spegnimento_lunedi') and states('input_datetime.vmc_master_accensione_lunedi_2') < states('input_datetime.vmc_master_spegnimento_lunedi_2') and states('input_datetime.vmc_master_accensione_lunedi_2') != states('input_datetime.vmc_master_spegnimento_lunedi_2') and states('input_datetime.vmc_master_accensione_lunedi') < states('input_datetime.vmc_master_accensione_lunedi_2') and states('input_datetime.vmc_master_spegnimento_lunedi') < states('input_datetime.vmc_master_spegnimento_lunedi_2') and states('input_datetime.vmc_master_accensione_lunedi') != states('input_datetime.vmc_master_accensione_lunedi_2') and states('input_datetime.vmc_master_spegnimento_lunedi') != states('input_datetime.vmc_master_spegnimento_lunedi_2') and states('input_datetime.vmc_master_spegnimento_lunedi') != states('input_datetime.vmc_master_accensione_lunedi_2') and states('input_datetime.vmc_master_accensione_lunedi_2') > states('input_datetime.vmc_master_spegnimento_lunedi') and states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_calendario') == 'on' %}
              Lunedi
            {% elif weekday == 1 and states('input_datetime.vmc_master_accensione_martedi') < states('input_datetime.vmc_master_spegnimento_martedi') and states('input_datetime.vmc_master_accensione_martedi') != states('input_datetime.vmc_master_spegnimento_martedi') and states('input_datetime.vmc_master_accensione_martedi_2') < states('input_datetime.vmc_master_spegnimento_martedi_2') and states('input_datetime.vmc_master_accensione_martedi_2') != states('input_datetime.vmc_master_spegnimento_martedi_2') and states('input_datetime.vmc_master_accensione_martedi') < states('input_datetime.vmc_master_accensione_martedi_2') and states('input_datetime.vmc_master_spegnimento_martedi') < states('input_datetime.vmc_master_spegnimento_martedi_2') and states('input_datetime.vmc_master_accensione_martedi') != states('input_datetime.vmc_master_accensione_martedi_2') and states('input_datetime.vmc_master_spegnimento_martedi') != states('input_datetime.vmc_master_spegnimento_martedi_2') and states('input_datetime.vmc_master_spegnimento_martedi') != states('input_datetime.vmc_master_accensione_martedi_2') and states('input_datetime.vmc_master_accensione_martedi_2') > states('input_datetime.vmc_master_spegnimento_martedi') and states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_calendario') == 'on' %}
              Martedi
            {% elif weekday == 2 and states('input_datetime.vmc_master_accensione_mercoledi') < states('input_datetime.vmc_master_spegnimento_mercoledi') and states('input_datetime.vmc_master_accensione_mercoledi') != states('input_datetime.vmc_master_spegnimento_mercoledi') and states('input_datetime.vmc_master_accensione_mercoledi_2') < states('input_datetime.vmc_master_spegnimento_mercoledi_2') and states('input_datetime.vmc_master_accensione_mercoledi_2') != states('input_datetime.vmc_master_spegnimento_mercoledi_2') and states('input_datetime.vmc_master_accensione_mercoledi') < states('input_datetime.vmc_master_accensione_mercoledi_2') and states('input_datetime.vmc_master_spegnimento_mercoledi') < states('input_datetime.vmc_master_spegnimento_mercoledi_2') and states('input_datetime.vmc_master_accensione_mercoledi') != states('input_datetime.vmc_master_accensione_mercoledi_2') and states('input_datetime.vmc_master_spegnimento_mercoledi') != states('input_datetime.vmc_master_spegnimento_mercoledi_2') and states('input_datetime.vmc_master_spegnimento_mercoledi') != states('input_datetime.vmc_master_accensione_mercoledi_2') and states('input_datetime.vmc_master_accensione_mercoledi_2') > states('input_datetime.vmc_master_spegnimento_mercoledi') and states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_calendario') == 'on' %}
              Mercoledi
            {% elif weekday == 3 and states('input_datetime.vmc_master_accensione_giovedi') < states('input_datetime.vmc_master_spegnimento_giovedi') and states('input_datetime.vmc_master_accensione_giovedi') != states('input_datetime.vmc_master_spegnimento_giovedi') and states('input_datetime.vmc_master_accensione_giovedi_2') < states('input_datetime.vmc_master_spegnimento_giovedi_2') and states('input_datetime.vmc_master_accensione_giovedi_2') != states('input_datetime.vmc_master_spegnimento_giovedi_2') and states('input_datetime.vmc_master_accensione_giovedi') < states('input_datetime.vmc_master_accensione_giovedi_2') and states('input_datetime.vmc_master_spegnimento_giovedi') < states('input_datetime.vmc_master_spegnimento_giovedi_2') and states('input_datetime.vmc_master_accensione_giovedi') != states('input_datetime.vmc_master_accensione_giovedi_2') and states('input_datetime.vmc_master_spegnimento_giovedi') != states('input_datetime.vmc_master_spegnimento_giovedi_2') and states('input_datetime.vmc_master_spegnimento_giovedi') != states('input_datetime.vmc_master_accensione_giovedi_2') and states('input_datetime.vmc_master_accensione_giovedi_2') > states('input_datetime.vmc_master_spegnimento_giovedi') and states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_calendario') == 'on' %}
              Giovedi
            {% elif weekday == 4 and states('input_datetime.vmc_master_accensione_venerdi') < states('input_datetime.vmc_master_spegnimento_venerdi') and states('input_datetime.vmc_master_accensione_venerdi') != states('input_datetime.vmc_master_spegnimento_venerdi') and states('input_datetime.vmc_master_accensione_venerdi_2') < states('input_datetime.vmc_master_spegnimento_venerdi_2') and states('input_datetime.vmc_master_accensione_venerdi_2') != states('input_datetime.vmc_master_spegnimento_venerdi_2') and states('input_datetime.vmc_master_accensione_venerdi') < states('input_datetime.vmc_master_accensione_venerdi_2') and states('input_datetime.vmc_master_spegnimento_venerdi') < states('input_datetime.vmc_master_spegnimento_venerdi_2') and states('input_datetime.vmc_master_accensione_venerdi') != states('input_datetime.vmc_master_accensione_venerdi_2') and states('input_datetime.vmc_master_spegnimento_venerdi') != states('input_datetime.vmc_master_spegnimento_venerdi_2') and states('input_datetime.vmc_master_spegnimento_venerdi') != states('input_datetime.vmc_master_accensione_venerdi_2') and states('input_datetime.vmc_master_accensione_venerdi_2') > states('input_datetime.vmc_master_spegnimento_venerdi') and states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_calendario') == 'on' %}
              Venerdi
            {% elif weekday == 5 and states('input_datetime.vmc_master_accensione_sabato') < states('input_datetime.vmc_master_spegnimento_sabato') and states('input_datetime.vmc_master_accensione_sabato') != states('input_datetime.vmc_master_spegnimento_sabato') and states('input_datetime.vmc_master_accensione_sabato_2') < states('input_datetime.vmc_master_spegnimento_sabato_2') and states('input_datetime.vmc_master_accensione_sabato_2') != states('input_datetime.vmc_master_spegnimento_sabato_2') and states('input_datetime.vmc_master_accensione_sabato') < states('input_datetime.vmc_master_accensione_sabato_2') and states('input_datetime.vmc_master_spegnimento_sabato') < states('input_datetime.vmc_master_spegnimento_sabato_2') and states('input_datetime.vmc_master_accensione_sabato') != states('input_datetime.vmc_master_accensione_sabato_2') and states('input_datetime.vmc_master_spegnimento_sabato') != states('input_datetime.vmc_master_spegnimento_sabato_2') and states('input_datetime.vmc_master_spegnimento_sabato') != states('input_datetime.vmc_master_accensione_sabato_2') and states('input_datetime.vmc_master_accensione_sabato_2') > states('input_datetime.vmc_master_spegnimento_sabato') and states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_calendario') == 'on' %}
              Sabato
            {% elif weekday == 6 and states('input_datetime.vmc_master_accensione_domenica') < states('input_datetime.vmc_master_spegnimento_domenica') and states('input_datetime.vmc_master_accensione_domenica') != states('input_datetime.vmc_master_spegnimento_domenica') and states('input_datetime.vmc_master_accensione_domenica_2') < states('input_datetime.vmc_master_spegnimento_domenica_2') and states('input_datetime.vmc_master_accensione_domenica_2') != states('input_datetime.vmc_master_spegnimento_domenica_2') and states('input_datetime.vmc_master_accensione_domenica') < states('input_datetime.vmc_master_accensione_domenica_2') and states('input_datetime.vmc_master_spegnimento_domenica') < states('input_datetime.vmc_master_spegnimento_domenica_2') and states('input_datetime.vmc_master_accensione_domenica') != states('input_datetime.vmc_master_accensione_domenica_2') and states('input_datetime.vmc_master_spegnimento_domenica') != states('input_datetime.vmc_master_spegnimento_domenica_2') and states('input_datetime.vmc_master_spegnimento_domenica') != states('input_datetime.vmc_master_accensione_domenica_2') and states('input_datetime.vmc_master_accensione_domenica_2') > states('input_datetime.vmc_master_spegnimento_domenica') and states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_calendario') == 'on' %}
              Domenica
              {% else %}
                Disabilitata
              {% endif %}
          {% endif %}            
        icon_template: mdi:timer-play-outline

      vmc_master_status_spegnimento_vmc_tramite_calendario:                    # [CONFIGURAZIONE 0 RICHIAMI] [INTERFACCIA, 0 RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI] SENSORE DI VERIFICA 1° FASCIA SPEGNIMENTO SE GLI ORARI SONO STATI INSERITI CORRETTAMENTE, DIVERSAMENTE MOSTRERA' "DISABILITATO"
        friendly_name: "1° Spegnimento programmato"
        value_template: >-
          {% set stati = ["sconosciuto", "unknown", "", none, "unavailable", "Non disponibile"] %}
          {% if states('sensor.vmc_master_sensori') in stati %}
            Non disponibile
          {% else %}        
            {% set weekday = now().weekday() %}
            {% if weekday == 0 and states('input_datetime.vmc_master_accensione_lunedi') < states('input_datetime.vmc_master_spegnimento_lunedi') and states('input_datetime.vmc_master_accensione_lunedi') != states('input_datetime.vmc_master_spegnimento_lunedi') and states('input_datetime.vmc_master_accensione_lunedi_2') < states('input_datetime.vmc_master_spegnimento_lunedi_2') and states('input_datetime.vmc_master_accensione_lunedi_2') != states('input_datetime.vmc_master_spegnimento_lunedi_2') and states('input_datetime.vmc_master_accensione_lunedi') < states('input_datetime.vmc_master_accensione_lunedi_2') and states('input_datetime.vmc_master_spegnimento_lunedi') < states('input_datetime.vmc_master_spegnimento_lunedi_2') and states('input_datetime.vmc_master_accensione_lunedi') != states('input_datetime.vmc_master_accensione_lunedi_2') and states('input_datetime.vmc_master_spegnimento_lunedi') != states('input_datetime.vmc_master_spegnimento_lunedi_2') and states('input_datetime.vmc_master_spegnimento_lunedi') != states('input_datetime.vmc_master_accensione_lunedi_2') and states('input_datetime.vmc_master_accensione_lunedi_2') > states('input_datetime.vmc_master_spegnimento_lunedi') and states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_calendario') == 'on' %}
              Lunedi
            {% elif weekday == 1 and states('input_datetime.vmc_master_accensione_martedi') < states('input_datetime.vmc_master_spegnimento_martedi') and states('input_datetime.vmc_master_accensione_martedi') != states('input_datetime.vmc_master_spegnimento_martedi') and states('input_datetime.vmc_master_accensione_martedi_2') < states('input_datetime.vmc_master_spegnimento_martedi_2') and states('input_datetime.vmc_master_accensione_martedi_2') != states('input_datetime.vmc_master_spegnimento_martedi_2') and states('input_datetime.vmc_master_accensione_martedi') < states('input_datetime.vmc_master_accensione_martedi_2') and states('input_datetime.vmc_master_spegnimento_martedi') < states('input_datetime.vmc_master_spegnimento_martedi_2') and states('input_datetime.vmc_master_accensione_martedi') != states('input_datetime.vmc_master_accensione_martedi_2') and states('input_datetime.vmc_master_spegnimento_martedi') != states('input_datetime.vmc_master_spegnimento_martedi_2') and states('input_datetime.vmc_master_spegnimento_martedi') != states('input_datetime.vmc_master_accensione_martedi_2') and states('input_datetime.vmc_master_accensione_martedi_2') > states('input_datetime.vmc_master_spegnimento_martedi') and states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_calendario') == 'on' %}
              Martedi
            {% elif weekday == 2 and states('input_datetime.vmc_master_accensione_mercoledi') < states('input_datetime.vmc_master_spegnimento_mercoledi') and states('input_datetime.vmc_master_accensione_mercoledi') != states('input_datetime.vmc_master_spegnimento_mercoledi') and states('input_datetime.vmc_master_accensione_mercoledi_2') < states('input_datetime.vmc_master_spegnimento_mercoledi_2') and states('input_datetime.vmc_master_accensione_mercoledi_2') != states('input_datetime.vmc_master_spegnimento_mercoledi_2') and states('input_datetime.vmc_master_accensione_mercoledi') < states('input_datetime.vmc_master_accensione_mercoledi_2') and states('input_datetime.vmc_master_spegnimento_mercoledi') < states('input_datetime.vmc_master_spegnimento_mercoledi_2') and states('input_datetime.vmc_master_accensione_mercoledi') != states('input_datetime.vmc_master_accensione_mercoledi_2') and states('input_datetime.vmc_master_spegnimento_mercoledi') != states('input_datetime.vmc_master_spegnimento_mercoledi_2') and states('input_datetime.vmc_master_spegnimento_mercoledi') != states('input_datetime.vmc_master_accensione_mercoledi_2') and states('input_datetime.vmc_master_accensione_mercoledi_2') > states('input_datetime.vmc_master_spegnimento_mercoledi') and states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_calendario') == 'on' %}
              Mercoledi
            {% elif weekday == 3 and states('input_datetime.vmc_master_accensione_giovedi') < states('input_datetime.vmc_master_spegnimento_giovedi') and states('input_datetime.vmc_master_accensione_giovedi') != states('input_datetime.vmc_master_spegnimento_giovedi') and states('input_datetime.vmc_master_accensione_giovedi_2') < states('input_datetime.vmc_master_spegnimento_giovedi_2') and states('input_datetime.vmc_master_accensione_giovedi_2') != states('input_datetime.vmc_master_spegnimento_giovedi_2') and states('input_datetime.vmc_master_accensione_giovedi') < states('input_datetime.vmc_master_accensione_giovedi_2') and states('input_datetime.vmc_master_spegnimento_giovedi') < states('input_datetime.vmc_master_spegnimento_giovedi_2') and states('input_datetime.vmc_master_accensione_giovedi') != states('input_datetime.vmc_master_accensione_giovedi_2') and states('input_datetime.vmc_master_spegnimento_giovedi') != states('input_datetime.vmc_master_spegnimento_giovedi_2') and states('input_datetime.vmc_master_spegnimento_giovedi') != states('input_datetime.vmc_master_accensione_giovedi_2') and states('input_datetime.vmc_master_accensione_giovedi_2') > states('input_datetime.vmc_master_spegnimento_giovedi') and states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_calendario') == 'on' %}
              Giovedi
            {% elif weekday == 4 and states('input_datetime.vmc_master_accensione_venerdi') < states('input_datetime.vmc_master_spegnimento_venerdi') and states('input_datetime.vmc_master_accensione_venerdi') != states('input_datetime.vmc_master_spegnimento_venerdi') and states('input_datetime.vmc_master_accensione_venerdi_2') < states('input_datetime.vmc_master_spegnimento_venerdi_2') and states('input_datetime.vmc_master_accensione_venerdi_2') != states('input_datetime.vmc_master_spegnimento_venerdi_2') and states('input_datetime.vmc_master_accensione_venerdi') < states('input_datetime.vmc_master_accensione_venerdi_2') and states('input_datetime.vmc_master_spegnimento_venerdi') < states('input_datetime.vmc_master_spegnimento_venerdi_2') and states('input_datetime.vmc_master_accensione_venerdi') != states('input_datetime.vmc_master_accensione_venerdi_2') and states('input_datetime.vmc_master_spegnimento_venerdi') != states('input_datetime.vmc_master_spegnimento_venerdi_2') and states('input_datetime.vmc_master_spegnimento_venerdi') != states('input_datetime.vmc_master_accensione_venerdi_2') and states('input_datetime.vmc_master_accensione_venerdi_2') > states('input_datetime.vmc_master_spegnimento_venerdi') and states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_calendario') == 'on' %}
              Venerdi
            {% elif weekday == 5 and states('input_datetime.vmc_master_accensione_sabato') < states('input_datetime.vmc_master_spegnimento_sabato') and states('input_datetime.vmc_master_accensione_sabato') != states('input_datetime.vmc_master_spegnimento_sabato') and states('input_datetime.vmc_master_accensione_sabato_2') < states('input_datetime.vmc_master_spegnimento_sabato_2') and states('input_datetime.vmc_master_accensione_sabato_2') != states('input_datetime.vmc_master_spegnimento_sabato_2') and states('input_datetime.vmc_master_accensione_sabato') < states('input_datetime.vmc_master_accensione_sabato_2') and states('input_datetime.vmc_master_spegnimento_sabato') < states('input_datetime.vmc_master_spegnimento_sabato_2') and states('input_datetime.vmc_master_accensione_sabato') != states('input_datetime.vmc_master_accensione_sabato_2') and states('input_datetime.vmc_master_spegnimento_sabato') != states('input_datetime.vmc_master_spegnimento_sabato_2') and states('input_datetime.vmc_master_spegnimento_sabato') != states('input_datetime.vmc_master_accensione_sabato_2') and states('input_datetime.vmc_master_accensione_sabato_2') > states('input_datetime.vmc_master_spegnimento_sabato') and states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_calendario') == 'on' %}
              Sabato
            {% elif weekday == 6 and states('input_datetime.vmc_master_accensione_domenica') < states('input_datetime.vmc_master_spegnimento_domenica') and states('input_datetime.vmc_master_accensione_domenica') != states('input_datetime.vmc_master_spegnimento_domenica') and states('input_datetime.vmc_master_accensione_domenica_2') < states('input_datetime.vmc_master_spegnimento_domenica_2') and states('input_datetime.vmc_master_accensione_domenica_2') != states('input_datetime.vmc_master_spegnimento_domenica_2') and states('input_datetime.vmc_master_accensione_domenica') < states('input_datetime.vmc_master_accensione_domenica_2') and states('input_datetime.vmc_master_spegnimento_domenica') < states('input_datetime.vmc_master_spegnimento_domenica_2') and states('input_datetime.vmc_master_accensione_domenica') != states('input_datetime.vmc_master_accensione_domenica_2') and states('input_datetime.vmc_master_spegnimento_domenica') != states('input_datetime.vmc_master_spegnimento_domenica_2') and states('input_datetime.vmc_master_spegnimento_domenica') != states('input_datetime.vmc_master_accensione_domenica_2') and states('input_datetime.vmc_master_accensione_domenica_2') > states('input_datetime.vmc_master_spegnimento_domenica') and states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_calendario') == 'on' %}
              Domenica
              {% else %}
                Disabilitata
              {% endif %}
          {% endif %}         
        icon_template: mdi:timer-stop-outline

      vmc_master_status_spegnimento_vmc_tramite_calendario_2:                  # [CONFIGURAZIONE 0 RICHIAMI] [INTERFACCIA, 0 RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI] SENSORE DI VERIFICA 2° FASCIA SPEGNIMENTO SE GLI ORARI SONO STATI INSERITI CORRETTAMENTE, DIVERSAMENTE MOSTRERA' "DISABILITATO"
        friendly_name: "2° Spegnimento programmato"
        value_template: >-
          {% set stati = ["sconosciuto", "unknown", "", none, "unavailable", "Non disponibile"] %}
          {% if states('sensor.vmc_master_sensori') in stati %}
            Non disponibile
          {% else %}        
            {% set weekday = now().weekday() %}
            {% if weekday == 0 and states('input_datetime.vmc_master_accensione_lunedi') < states('input_datetime.vmc_master_spegnimento_lunedi') and states('input_datetime.vmc_master_accensione_lunedi') != states('input_datetime.vmc_master_spegnimento_lunedi') and states('input_datetime.vmc_master_accensione_lunedi_2') < states('input_datetime.vmc_master_spegnimento_lunedi_2') and states('input_datetime.vmc_master_accensione_lunedi_2') != states('input_datetime.vmc_master_spegnimento_lunedi_2') and states('input_datetime.vmc_master_accensione_lunedi') < states('input_datetime.vmc_master_accensione_lunedi_2') and states('input_datetime.vmc_master_spegnimento_lunedi') < states('input_datetime.vmc_master_spegnimento_lunedi_2') and states('input_datetime.vmc_master_accensione_lunedi') != states('input_datetime.vmc_master_accensione_lunedi_2') and states('input_datetime.vmc_master_spegnimento_lunedi') != states('input_datetime.vmc_master_spegnimento_lunedi_2') and states('input_datetime.vmc_master_spegnimento_lunedi') != states('input_datetime.vmc_master_accensione_lunedi_2') and states('input_datetime.vmc_master_accensione_lunedi_2') > states('input_datetime.vmc_master_spegnimento_lunedi') and states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_calendario') == 'on' %}
              Lunedi
            {% elif weekday == 1 and states('input_datetime.vmc_master_accensione_martedi') < states('input_datetime.vmc_master_spegnimento_martedi') and states('input_datetime.vmc_master_accensione_martedi') != states('input_datetime.vmc_master_spegnimento_martedi') and states('input_datetime.vmc_master_accensione_martedi_2') < states('input_datetime.vmc_master_spegnimento_martedi_2') and states('input_datetime.vmc_master_accensione_martedi_2') != states('input_datetime.vmc_master_spegnimento_martedi_2') and states('input_datetime.vmc_master_accensione_martedi') < states('input_datetime.vmc_master_accensione_martedi_2') and states('input_datetime.vmc_master_spegnimento_martedi') < states('input_datetime.vmc_master_spegnimento_martedi_2') and states('input_datetime.vmc_master_accensione_martedi') != states('input_datetime.vmc_master_accensione_martedi_2') and states('input_datetime.vmc_master_spegnimento_martedi') != states('input_datetime.vmc_master_spegnimento_martedi_2') and states('input_datetime.vmc_master_spegnimento_martedi') != states('input_datetime.vmc_master_accensione_martedi_2') and states('input_datetime.vmc_master_accensione_martedi_2') > states('input_datetime.vmc_master_spegnimento_martedi') and states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_calendario') == 'on' %}
              Martedi
            {% elif weekday == 2 and states('input_datetime.vmc_master_accensione_mercoledi') < states('input_datetime.vmc_master_spegnimento_mercoledi') and states('input_datetime.vmc_master_accensione_mercoledi') != states('input_datetime.vmc_master_spegnimento_mercoledi') and states('input_datetime.vmc_master_accensione_mercoledi_2') < states('input_datetime.vmc_master_spegnimento_mercoledi_2') and states('input_datetime.vmc_master_accensione_mercoledi_2') != states('input_datetime.vmc_master_spegnimento_mercoledi_2') and states('input_datetime.vmc_master_accensione_mercoledi') < states('input_datetime.vmc_master_accensione_mercoledi_2') and states('input_datetime.vmc_master_spegnimento_mercoledi') < states('input_datetime.vmc_master_spegnimento_mercoledi_2') and states('input_datetime.vmc_master_accensione_mercoledi') != states('input_datetime.vmc_master_accensione_mercoledi_2') and states('input_datetime.vmc_master_spegnimento_mercoledi') != states('input_datetime.vmc_master_spegnimento_mercoledi_2') and states('input_datetime.vmc_master_spegnimento_mercoledi') != states('input_datetime.vmc_master_accensione_mercoledi_2') and states('input_datetime.vmc_master_accensione_mercoledi_2') > states('input_datetime.vmc_master_spegnimento_mercoledi') and states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_calendario') == 'on' %}
              Mercoledi
            {% elif weekday == 3 and states('input_datetime.vmc_master_accensione_giovedi') < states('input_datetime.vmc_master_spegnimento_giovedi') and states('input_datetime.vmc_master_accensione_giovedi') != states('input_datetime.vmc_master_spegnimento_giovedi') and states('input_datetime.vmc_master_accensione_giovedi_2') < states('input_datetime.vmc_master_spegnimento_giovedi_2') and states('input_datetime.vmc_master_accensione_giovedi_2') != states('input_datetime.vmc_master_spegnimento_giovedi_2') and states('input_datetime.vmc_master_accensione_giovedi') < states('input_datetime.vmc_master_accensione_giovedi_2') and states('input_datetime.vmc_master_spegnimento_giovedi') < states('input_datetime.vmc_master_spegnimento_giovedi_2') and states('input_datetime.vmc_master_accensione_giovedi') != states('input_datetime.vmc_master_accensione_giovedi_2') and states('input_datetime.vmc_master_spegnimento_giovedi') != states('input_datetime.vmc_master_spegnimento_giovedi_2') and states('input_datetime.vmc_master_spegnimento_giovedi') != states('input_datetime.vmc_master_accensione_giovedi_2') and states('input_datetime.vmc_master_accensione_giovedi_2') > states('input_datetime.vmc_master_spegnimento_giovedi') and states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_calendario') == 'on' %}
              Giovedi
            {% elif weekday == 4 and states('input_datetime.vmc_master_accensione_venerdi') < states('input_datetime.vmc_master_spegnimento_venerdi') and states('input_datetime.vmc_master_accensione_venerdi') != states('input_datetime.vmc_master_spegnimento_venerdi') and states('input_datetime.vmc_master_accensione_venerdi_2') < states('input_datetime.vmc_master_spegnimento_venerdi_2') and states('input_datetime.vmc_master_accensione_venerdi_2') != states('input_datetime.vmc_master_spegnimento_venerdi_2') and states('input_datetime.vmc_master_accensione_venerdi') < states('input_datetime.vmc_master_accensione_venerdi_2') and states('input_datetime.vmc_master_spegnimento_venerdi') < states('input_datetime.vmc_master_spegnimento_venerdi_2') and states('input_datetime.vmc_master_accensione_venerdi') != states('input_datetime.vmc_master_accensione_venerdi_2') and states('input_datetime.vmc_master_spegnimento_venerdi') != states('input_datetime.vmc_master_spegnimento_venerdi_2') and states('input_datetime.vmc_master_spegnimento_venerdi') != states('input_datetime.vmc_master_accensione_venerdi_2') and states('input_datetime.vmc_master_accensione_venerdi_2') > states('input_datetime.vmc_master_spegnimento_venerdi') and states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_calendario') == 'on' %}
              Venerdi
            {% elif weekday == 5 and states('input_datetime.vmc_master_accensione_sabato') < states('input_datetime.vmc_master_spegnimento_sabato') and states('input_datetime.vmc_master_accensione_sabato') != states('input_datetime.vmc_master_spegnimento_sabato') and states('input_datetime.vmc_master_accensione_sabato_2') < states('input_datetime.vmc_master_spegnimento_sabato_2') and states('input_datetime.vmc_master_accensione_sabato_2') != states('input_datetime.vmc_master_spegnimento_sabato_2') and states('input_datetime.vmc_master_accensione_sabato') < states('input_datetime.vmc_master_accensione_sabato_2') and states('input_datetime.vmc_master_spegnimento_sabato') < states('input_datetime.vmc_master_spegnimento_sabato_2') and states('input_datetime.vmc_master_accensione_sabato') != states('input_datetime.vmc_master_accensione_sabato_2') and states('input_datetime.vmc_master_spegnimento_sabato') != states('input_datetime.vmc_master_spegnimento_sabato_2') and states('input_datetime.vmc_master_spegnimento_sabato') != states('input_datetime.vmc_master_accensione_sabato_2') and states('input_datetime.vmc_master_accensione_sabato_2') > states('input_datetime.vmc_master_spegnimento_sabato') and states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_calendario') == 'on' %}
              Sabato
            {% elif weekday == 6 and states('input_datetime.vmc_master_accensione_domenica') < states('input_datetime.vmc_master_spegnimento_domenica') and states('input_datetime.vmc_master_accensione_domenica') != states('input_datetime.vmc_master_spegnimento_domenica') and states('input_datetime.vmc_master_accensione_domenica_2') < states('input_datetime.vmc_master_spegnimento_domenica_2') and states('input_datetime.vmc_master_accensione_domenica_2') != states('input_datetime.vmc_master_spegnimento_domenica_2') and states('input_datetime.vmc_master_accensione_domenica') < states('input_datetime.vmc_master_accensione_domenica_2') and states('input_datetime.vmc_master_spegnimento_domenica') < states('input_datetime.vmc_master_spegnimento_domenica_2') and states('input_datetime.vmc_master_accensione_domenica') != states('input_datetime.vmc_master_accensione_domenica_2') and states('input_datetime.vmc_master_spegnimento_domenica') != states('input_datetime.vmc_master_spegnimento_domenica_2') and states('input_datetime.vmc_master_spegnimento_domenica') != states('input_datetime.vmc_master_accensione_domenica_2') and states('input_datetime.vmc_master_accensione_domenica_2') > states('input_datetime.vmc_master_spegnimento_domenica') and states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_calendario') == 'on' %}
              Domenica
              {% else %}
                Disabilitata
              {% endif %}
          {% endif %}         
        icon_template: mdi:timer-stop-outline

################### Fine Creazione Sensori Interfaccia Calendario  #################################################################################################################################################################

################### Inizio Creazione Sensori Interfaccia Free Heating - Free Cooling ###############################################################################################################################################

      vmc_master_status_check_freeheating_freecooling:                          # [CONFIGURAZIONE PIù RICHIAMI] [INTERFACCIA, 0 RICHIAMI] [AUTOMAZIONE, 0 RICHIAMI] 
        friendly_name: "Check Range Free Heating e Free Cooling"
        value_template: >
          {% set stati = ["sconosciuto", "unknown", "", none, "unavailable", "Non disponibile"] %}
          {% if states('sensor.vmc_master_sensori') in stati %}
            Non disponibile
          {% else %}
            {% set input1 = states('sensor.vmc_master_mese_1_fascia_freeheating') %}
            {% set input2 = states('sensor.vmc_master_mese_2_fascia_freeheating') %}
            {% set input3 = states('sensor.vmc_master_mese_1_fascia_freecooling') %}
            {% set input4 = states('sensor.vmc_master_mese_2_fascia_freecooling') %}
            {% if input1 in stati or input2 in stati or input3 in stati or input4 in stati %}
              Non disponibile
            {% else %}      
              {% if input1=='Gennaio'%}
                {% set month_numbers = {'Gennaio': 1, 'Febbraio': 2, 'Marzo': 3, 'Aprile': 4, 'Maggio': 5, 'Giugno': 6, 'Luglio': 7, 'Agosto': 8, 'Settembre': 9, 'Ottobre': 10, 'Novembre': 11, 'Dicembre': 12} %}
                {% set month_number1 = month_numbers.get(input1) | int%}
                {% set month_number2 = month_numbers.get(input2) | int%}
                {% set month_number3 = month_numbers.get(input3) | int%}
                {% set month_number4 = month_numbers.get(input4) | int%}
              {% elif input1=='Febbraio'%}   
                {% set month_numbers = {'Gennaio': 12, 'Febbraio': 1, 'Marzo': 2, 'Aprile': 3, 'Maggio': 4, 'Giugno': 5, 'Luglio': 6, 'Agosto': 7, 'Settembre': 8, 'Ottobre': 9, 'Novembre': 10, 'Dicembre': 11} %} 
                {% set month_number1 = month_numbers.get(input1) | int%}
                {% set month_number2 = month_numbers.get(input2) | int%}
                {% set month_number3 = month_numbers.get(input3) | int%}
                {% set month_number4 = month_numbers.get(input4) | int%}
              {% elif input1=='Marzo'%}   
                {% set month_numbers = {'Gennaio': 11, 'Febbraio': 12, 'Marzo': 1, 'Aprile': 2, 'Maggio': 3, 'Giugno': 4, 'Luglio': 5, 'Agosto': 6, 'Settembre': 7, 'Ottobre': 8, 'Novembre': 9, 'Dicembre': 10} %}   
                {% set month_number1 = month_numbers.get(input1) | int%}
                {% set month_number2 = month_numbers.get(input2) | int%}
                {% set month_number3 = month_numbers.get(input3) | int%}
                {% set month_number4 = month_numbers.get(input4) | int%}
              {% elif input1=='Aprile'%}   
                {% set month_numbers = {'Gennaio': 10, 'Febbraio': 11, 'Marzo': 12, 'Aprile': 1, 'Maggio': 2, 'Giugno': 3, 'Luglio': 4, 'Agosto': 5, 'Settembre': 6, 'Ottobre': 7, 'Novembre': 8, 'Dicembre': 9} %}  
                {% set month_number1 = month_numbers.get(input1) | int%}
                {% set month_number2 = month_numbers.get(input2) | int%}
                {% set month_number3 = month_numbers.get(input3) | int%}
                {% set month_number4 = month_numbers.get(input4) | int%}
              {% elif input1=='Maggio'%}   
                {% set month_numbers = {'Gennaio': 9, 'Febbraio': 10, 'Marzo': 11, 'Aprile': 12, 'Maggio': 1, 'Giugno': 2, 'Luglio': 3, 'Agosto': 4, 'Settembre': 5, 'Ottobre': 6, 'Novembre': 7, 'Dicembre': 8} %}  
                {% set month_number1 = month_numbers.get(input1) | int%}
                {% set month_number2 = month_numbers.get(input2) | int%}
                {% set month_number3 = month_numbers.get(input3) | int%}
                {% set month_number4 = month_numbers.get(input4) | int%}
              {% elif input1=='Giugno'%}   
                {% set month_numbers = {'Gennaio': 8, 'Febbraio': 9, 'Marzo': 10, 'Aprile': 11, 'Maggio': 12, 'Giugno': 1, 'Luglio': 2, 'Agosto': 3, 'Settembre': 4, 'Ottobre': 5, 'Novembre': 6, 'Dicembre': 7} %}  
                {% set month_number1 = month_numbers.get(input1) | int%}
                {% set month_number2 = month_numbers.get(input2) | int%}
                {% set month_number3 = month_numbers.get(input3) | int%}
                {% set month_number4 = month_numbers.get(input4) | int%}
              {% elif input1=='Luglio'%}   
                {% set month_numbers = {'Gennaio': 7, 'Febbraio': 8, 'Marzo': 9, 'Aprile': 10, 'Maggio': 11, 'Giugno': 12, 'Luglio': 1, 'Agosto': 2, 'Settembre': 3, 'Ottobre': 4, 'Novembre': 5, 'Dicembre': 6} %}  
                {% set month_number1 = month_numbers.get(input1) | int%}
                {% set month_number2 = month_numbers.get(input2) | int%}
                {% set month_number3 = month_numbers.get(input3) | int%}
                {% set month_number4 = month_numbers.get(input4) | int%}
              {% elif input1=='Agosto'%}   
                {% set month_numbers = {'Gennaio': 6, 'Febbraio': 7, 'Marzo': 8, 'Aprile': 9, 'Maggio': 10, 'Giugno': 11, 'Luglio': 12, 'Agosto': 1, 'Settembre': 2, 'Ottobre': 3, 'Novembre': 4, 'Dicembre': 5} %}  
                {% set month_number1 = month_numbers.get(input1) | int%}
                {% set month_number2 = month_numbers.get(input2) | int%}
                {% set month_number3 = month_numbers.get(input3) | int%}
                {% set month_number4 = month_numbers.get(input4) | int%}
              {% elif input1=='Settembre'%}   
                {% set month_numbers = {'Gennaio': 5, 'Febbraio': 6, 'Marzo': 7, 'Aprile': 8, 'Maggio': 9, 'Giugno': 10, 'Luglio': 11, 'Agosto': 12, 'Settembre': 1, 'Ottobre': 2, 'Novembre': 3, 'Dicembre': 4} %}  
                {% set month_number1 = month_numbers.get(input1) | int%}
                {% set month_number2 = month_numbers.get(input2) | int%}
                {% set month_number3 = month_numbers.get(input3) | int%}
                {% set month_number4 = month_numbers.get(input4) | int%}
              {% elif input1=='Ottobre'%}   
                {% set month_numbers = {'Gennaio': 4, 'Febbraio': 5, 'Marzo': 6, 'Aprile': 7, 'Maggio': 8, 'Giugno': 9, 'Luglio': 10, 'Agosto': 11, 'Settembre': 12, 'Ottobre': 1, 'Novembre': 2, 'Dicembre': 3} %}  
                {% set month_number1 = month_numbers.get(input1) | int%}
                {% set month_number2 = month_numbers.get(input2) | int%}
                {% set month_number3 = month_numbers.get(input3) | int%}
                {% set month_number4 = month_numbers.get(input4) | int%}
              {% elif input1=='Novembre'%}   
                {% set month_numbers = {'Gennaio': 3, 'Febbraio': 4, 'Marzo': 5, 'Aprile': 6, 'Maggio': 7, 'Giugno': 8, 'Luglio': 9, 'Agosto': 10, 'Settembre': 11, 'Ottobre': 12, 'Novembre': 1, 'Dicembre': 2} %}  
                {% set month_number1 = month_numbers.get(input1) | int%}
                {% set month_number2 = month_numbers.get(input2) | int%}
                {% set month_number3 = month_numbers.get(input3) | int%}
                {% set month_number4 = month_numbers.get(input4) | int%}
              {% elif input1=='Dicembre'%}   
                {% set month_numbers = {'Gennaio': 2, 'Febbraio': 3, 'Marzo': 4, 'Aprile': 5, 'Maggio': 6, 'Giugno': 7, 'Luglio': 8, 'Agosto': 9, 'Settembre': 10, 'Ottobre': 11, 'Novembre': 12, 'Dicembre': 1} %} 
                {% set month_number1 = month_numbers.get(input1) | int%}
                {% set month_number2 = month_numbers.get(input2) | int%}
                {% set month_number3 = month_numbers.get(input3) | int%}
                {% set month_number4 = month_numbers.get(input4) | int%}
              {% endif %}
              {% if month_number1 != month_number2 and month_number2 != month_number3 and month_number3 != month_number4 and month_number1 < month_number2 and month_number2 < month_number3 and month_number3 < month_number4 %}
                OK
              {% else %}
                NOT OK
              {% endif %}
            {% endif %}
          {% endif %}
        icon_template: mdi:checkbox-marked

      vmc_master_status_freeheating:                                           # [CONFIGURAZIONE 1 RICHIAMO] [INTERFACCIA, 0 RICHIAMI] [AUTOMAZIONE, 0 RICHIAMI] 
        friendly_name: "Check Free Heating"
        value_template: >
          {% set stati = ["sconosciuto", "unknown", "", none, "unavailable", "Non disponibile"] %}
          {% if states('sensor.vmc_master_sensori') in stati %}
            Non disponibile
          {% else %}
            {% set input1_freeheating = states('sensor.vmc_master_mese_1_fascia_freeheating') %}
            {% set input2_freeheating = states('sensor.vmc_master_mese_2_fascia_freeheating') %}
            {% set check = states('sensor.vmc_master_status_check_freeheating_freecooling') %}
            {% set mese_corrente = now().strftime('%B') %}
            {% if input1_freeheating in stati or input2_freeheating in stati or check in stati %}
              Non disponibile
            {% else %}      
              {% if mese_corrente == 'January' %}
                {% set mese_corrente = 'Gennaio' %}
              {% elif mese_corrente == 'February' %}
                {% set mese_corrente = 'Febbraio' %}
              {% elif mese_corrente == 'March' %}
                {% set mese_corrente = 'Marzo' %}
              {% elif mese_corrente == 'April' %}
                {% set mese_corrente = 'Aprile' %}
              {% elif mese_corrente == 'May' %}
                {% set mese_corrente = 'Maggio' %}
              {% elif mese_corrente == 'June' %}
                {% set mese_corrente = 'Giugno' %}
              {% elif mese_corrente == 'July' %}
                {% set mese_corrente = 'Luglio' %}
              {% elif mese_corrente == 'August' %}
                {% set mese_corrente = 'Agosto' %}
              {% elif mese_corrente == 'September' %}
                {% set mese_corrente = 'Settembre' %}
              {% elif mese_corrente == 'October' %}
                {% set mese_corrente = 'Ottobre' %}
              {% elif mese_corrente == 'November' %}
                {% set mese_corrente = 'Novembre' %}
              {% elif mese_corrente == 'December' %}
                {% set mese_corrente = 'Dicembre' %}
              {% endif %}
              {% if input1_freeheating=='Gennaio'%}
                {% set months_freeheating = ['Gennaio', 'Febbraio', 'Marzo', 'Aprile', 'Maggio', 'Giugno', 'Luglio', 'Agosto', 'Settembre', 'Ottobre', 'Novembre', 'Dicembre'] %}
                {% set interval_1_freeheating = months_freeheating[months_freeheating.index(input1_freeheating):months_freeheating.index(input2_freeheating)+1] %}
              {% elif input1_freeheating=='Febbraio'%}
                {% set months_freeheating = ['Febbraio', 'Marzo', 'Aprile', 'Maggio', 'Giugno', 'Luglio', 'Agosto', 'Settembre', 'Ottobre', 'Novembre', 'Dicembre', 'Gennaio'] %}
                {% set interval_1_freeheating = months_freeheating[months_freeheating.index(input1_freeheating):months_freeheating.index(input2_freeheating)+1] %}
              {% elif input1_freeheating=='Marzo'%}
                {% set months_freeheating = ['Marzo', 'Aprile', 'Maggio', 'Giugno', 'Luglio', 'Agosto', 'Settembre', 'Ottobre', 'Novembre', 'Dicembre', 'Gennaio', 'Febbraio'] %}
                {% set interval_1_freeheating = months_freeheating[months_freeheating.index(input1_freeheating):months_freeheating.index(input2_freeheating)+1] %}
              {% elif input1_freeheating=='Aprile'%}
                {% set months_freeheating = ['Aprile', 'Maggio', 'Giugno', 'Luglio', 'Agosto', 'Settembre', 'Ottobre', 'Novembre', 'Dicembre', 'Gennaio', 'Febbraio', 'Marzo'] %}
                {% set interval_1_freeheating = months_freeheating[months_freeheating.index(input1_freeheating):months_freeheating.index(input2_freeheating)+1] %}
              {% elif input1_freeheating=='Maggio'%}
                {% set months_freeheating = ['Maggio', 'Giugno', 'Luglio', 'Agosto', 'Settembre', 'Ottobre', 'Novembre', 'Dicembre', 'Gennaio', 'Febbraio', 'Marzo', 'Aprile'] %}
                {% set interval_1_freeheating = months_freeheating[months_freeheating.index(input1_freeheating):months_freeheating.index(input2_freeheating)+1] %}
              {% elif input1_freeheating=='Giugno'%}
                {% set months_freeheating = ['Giugno', 'Luglio', 'Agosto', 'Settembre', 'Ottobre', 'Novembre', 'Dicembre', 'Gennaio', 'Febbraio', 'Marzo', 'Aprile', 'Maggio'] %}
                {% set interval_1_freeheating = months_freeheating[months_freeheating.index(input1_freeheating):months_freeheating.index(input2_freeheating)+1] %}
              {% elif input1_freeheating=='Luglio'%}
                {% set months_freeheating = ['Luglio', 'Agosto', 'Settembre', 'Ottobre', 'Novembre', 'Dicembre', 'Gennaio', 'Febbraio', 'Marzo', 'Aprile', 'Maggio', 'Giugno'] %}
                {% set interval_1_freeheating = months_freeheating[months_freeheating.index(input1_freeheating):months_freeheating.index(input2_freeheating)+1] %}
              {% elif input1_freeheating=='Agosto'%}
                {% set months_freeheating = ['Agosto', 'Settembre', 'Ottobre', 'Novembre', 'Dicembre', 'Gennaio', 'Febbraio', 'Marzo', 'Aprile', 'Maggio', 'Giugno', 'Luglio'] %}
                {% set interval_1_freeheating = months_freeheating[months_freeheating.index(input1_freeheating):months_freeheating.index(input2_freeheating)+1] %}
              {% elif input1_freeheating=='Settembre'%}
                {% set months_freeheating = ['Settembre', 'Ottobre', 'Novembre', 'Dicembre', 'Gennaio', 'Febbraio', 'Marzo', 'Aprile', 'Maggio', 'Giugno', 'Luglio', 'Agosto'] %}
                {% set interval_1_freeheating = months_freeheating[months_freeheating.index(input1_freeheating):months_freeheating.index(input2_freeheating)+1] %}
              {% elif input1_freeheating=='Ottobre'%}
                {% set months_freeheating = ['Ottobre', 'Novembre', 'Dicembre', 'Gennaio', 'Febbraio', 'Marzo', 'Aprile', 'Maggio', 'Giugno', 'Luglio', 'Agosto', 'Settembre'] %}
                {% set interval_1_freeheating = months_freeheating[months_freeheating.index(input1_freeheating):months_freeheating.index(input2_freeheating)+1] %}
              {% elif input1_freeheating=='Novembre'%}
                {% set months_freeheating = ['Novembre', 'Dicembre', 'Gennaio', 'Febbraio', 'Marzo', 'Aprile', 'Maggio', 'Giugno', 'Luglio', 'Agosto','Settembre', 'Ottobre'] %}
                {% set interval_1_freeheating = months_freeheating[months_freeheating.index(input1_freeheating):months_freeheating.index(input2_freeheating)+1] %}
              {% elif input1_freeheating=='Dicembre'%}
                {% set months_freeheating = ['Dicembre', 'Gennaio', 'Febbraio', 'Marzo', 'Aprile', 'Maggio', 'Giugno', 'Luglio', 'Agosto','Settembre','Ottobre', 'Novembre'] %}
                {% set interval_1_freeheating = months_freeheating[months_freeheating.index(input1_freeheating):months_freeheating.index(input2_freeheating)+1] %}
              {% endif %}
              {% if check == "OK" %}
                {% if mese_corrente in interval_1_freeheating %}
                  OK
                {% else %}
                  -
                {% endif %}
              {% else %}
                NOT OK
              {% endif %}
            {% endif %}      
          {% endif %}
        icon_template: mdi:checkbox-marked

      vmc_master_status_freecooling:                                           # [CONFIGURAZIONE 1 RICHIAMO] [INTERFACCIA, 0 RICHIAMI] [AUTOMAZIONE, 0 RICHIAMI] 
        friendly_name: "Check Free Cooling"
        value_template: >
          {% set stati = ["sconosciuto", "unknown", "", none, "unavailable", "Non disponibile"] %}
          {% if states('sensor.vmc_master_sensori') in stati %}
            Non disponibile
          {% else %}
            {% set input1_freecooling = states('sensor.vmc_master_mese_1_fascia_freecooling') %}
            {% set input2_freecooling = states('sensor.vmc_master_mese_2_fascia_freecooling') %}
            {% set check = states('sensor.vmc_master_status_check_freeheating_freecooling') %}
            {% set mese_corrente = now().strftime('%B') %}
            {% if input1_freecooling in stati or input2_freecooling in stati or check in stati %}
              Non disponibile
            {% else %}      
              {% if mese_corrente == 'January' %}
                {% set mese_corrente = 'Gennaio' %}
              {% elif mese_corrente == 'February' %}
                {% set mese_corrente = 'Febbraio' %}
              {% elif mese_corrente == 'March' %}
                {% set mese_corrente = 'Marzo' %}
              {% elif mese_corrente == 'April' %}
                {% set mese_corrente = 'Aprile' %}
              {% elif mese_corrente == 'May' %}
                {% set mese_corrente = 'Maggio' %}
              {% elif mese_corrente == 'June' %}
                {% set mese_corrente = 'Giugno' %}
              {% elif mese_corrente == 'July' %}
                {% set mese_corrente = 'Luglio' %}
              {% elif mese_corrente == 'August' %}
                {% set mese_corrente = 'Agosto' %}
              {% elif mese_corrente == 'September' %}
                {% set mese_corrente = 'Settembre' %}
              {% elif mese_corrente == 'October' %}
                {% set mese_corrente = 'Ottobre' %}
              {% elif mese_corrente == 'November' %}
                {% set mese_corrente = 'Novembre' %}
              {% elif mese_corrente == 'December' %}
                {% set mese_corrente = 'Dicembre' %}
              {% endif %}
              {% if input1_freecooling=='Gennaio'%}
                {% set months_freecooling = ['Gennaio', 'Febbraio', 'Marzo', 'Aprile', 'Maggio', 'Giugno', 'Luglio', 'Agosto', 'Settembre', 'Ottobre', 'Novembre', 'Dicembre'] %}
                {% set interval_1_freecooling = months_freecooling[months_freecooling.index(input1_freecooling):months_freecooling.index(input2_freecooling)+1] %}
              {% elif input1_freecooling=='Febbraio'%}
                {% set months_freecooling = ['Febbraio', 'Marzo', 'Aprile', 'Maggio', 'Giugno', 'Luglio', 'Agosto', 'Settembre', 'Ottobre', 'Novembre', 'Dicembre', 'Gennaio'] %}
                {% set interval_1_freecooling = months_freecooling[months_freecooling.index(input1_freecooling):months_freecooling.index(input2_freecooling)+1] %}
              {% elif input1_freecooling=='Marzo'%}
                {% set months_freecooling = ['Marzo', 'Aprile', 'Maggio', 'Giugno', 'Luglio', 'Agosto', 'Settembre', 'Ottobre', 'Novembre', 'Dicembre', 'Gennaio', 'Febbraio'] %}
                {% set interval_1_freecooling = months_freecooling[months_freecooling.index(input1_freecooling):months_freecooling.index(input2_freecooling)+1] %}
              {% elif input1_freecooling=='Aprile'%}
                {% set months_freecooling = ['Aprile', 'Maggio', 'Giugno', 'Luglio', 'Agosto', 'Settembre', 'Ottobre', 'Novembre', 'Dicembre', 'Gennaio', 'Febbraio', 'Marzo'] %}
                {% set interval_1_freecooling = months_freecooling[months_freecooling.index(input1_freecooling):months_freecooling.index(input2_freecooling)+1] %}
              {% elif input1_freecooling=='Maggio'%}
                {% set months_freecooling = ['Maggio', 'Giugno', 'Luglio', 'Agosto', 'Settembre', 'Ottobre', 'Novembre', 'Dicembre', 'Gennaio', 'Febbraio', 'Marzo', 'Aprile'] %}
                {% set interval_1_freecooling = months_freecooling[months_freecooling.index(input1_freecooling):months_freecooling.index(input2_freecooling)+1] %}
              {% elif input1_freecooling=='Giugno'%}
                {% set months_freecooling = ['Giugno', 'Luglio', 'Agosto', 'Settembre', 'Ottobre', 'Novembre', 'Dicembre', 'Gennaio', 'Febbraio', 'Marzo', 'Aprile', 'Maggio'] %}
                {% set interval_1_freecooling = months_freecooling[months_freecooling.index(input1_freecooling):months_freecooling.index(input2_freecooling)+1] %}
              {% elif input1_freecooling=='Luglio'%}
                {% set months_freecooling = ['Luglio', 'Agosto', 'Settembre', 'Ottobre', 'Novembre', 'Dicembre', 'Gennaio', 'Febbraio', 'Marzo', 'Aprile', 'Maggio', 'Giugno'] %}
                {% set interval_1_freecooling = months_freecooling[months_freecooling.index(input1_freecooling):months_freecooling.index(input2_freecooling)+1] %}
              {% elif input1_freecooling=='Agosto'%}
                {% set months_freecooling = ['Agosto', 'Settembre', 'Ottobre', 'Novembre', 'Dicembre', 'Gennaio', 'Febbraio', 'Marzo', 'Aprile', 'Maggio', 'Giugno', 'Luglio'] %}
                {% set interval_1_freecooling = months_freecooling[months_freecooling.index(input1_freecooling):months_freecooling.index(input2_freecooling)+1] %}
              {% elif input1_freecooling=='Settembre'%}
                {% set months_freecooling = ['Settembre', 'Ottobre', 'Novembre', 'Dicembre', 'Gennaio', 'Febbraio', 'Marzo', 'Aprile', 'Maggio', 'Giugno', 'Luglio', 'Agosto'] %}
                {% set interval_1_freecooling = months_freecooling[months_freecooling.index(input1_freecooling):months_freecooling.index(input2_freecooling)+1] %}
              {% elif input1_freecooling=='Ottobre'%}
                {% set months_freecooling = ['Ottobre', 'Novembre', 'Dicembre', 'Gennaio', 'Febbraio', 'Marzo', 'Aprile', 'Maggio', 'Giugno', 'Luglio', 'Agosto', 'Settembre'] %}
                {% set interval_1_freecooling = months_freecooling[months_freecooling.index(input1_freecooling):months_freecooling.index(input2_freecooling)+1] %}
              {% elif input1_freecooling=='Novembre'%}
                {% set months_freecooling = ['Novembre', 'Dicembre', 'Gennaio', 'Febbraio', 'Marzo', 'Aprile', 'Maggio', 'Giugno', 'Luglio', 'Agosto','Settembre', 'Ottobre'] %}
                {% set interval_1_freecooling = months_freecooling[months_freecooling.index(input1_freecooling):months_freecooling.index(input2_freecooling)+1] %}
              {% elif input1_freecooling=='Dicembre'%}
                {% set months_freecooling = ['Dicembre', 'Gennaio', 'Febbraio', 'Marzo', 'Aprile', 'Maggio', 'Giugno', 'Luglio', 'Agosto','Settembre','Ottobre', 'Novembre'] %}
                {% set interval_1_freecooling = months_freecooling[months_freecooling.index(input1_freecooling):months_freecooling.index(input2_freecooling)+1] %}
              {% endif %}
              {% if check == "OK" %}
                {% if mese_corrente in interval_1_freecooling %}
                  OK
                {% else %}
                  -
                {% endif %}
              {% else %}
                NOT OK
              {% endif %}
            {% endif %}      
          {% endif %}
        icon_template: mdi:checkbox-marked

      vmc_master_status_mese_corrente_freeheating_o_freecooling:                # [CONFIGURAZIONE 1 RICHIAMO] [INTERFACCIA, PIù RICHIAMI] [AUTOMAZIONE, PIù RICHIAMI] 
        friendly_name: "Mese Corrente Programmato:"
        value_template: >
          {% set stati = ["sconosciuto", "unknown", "", none, "unavailable", "Non disponibile"] %}
          {% if states('sensor.vmc_master_sensori') in stati %}
            Non disponibile
          {% else %}
            {% set input1 = states('sensor.vmc_master_status_freeheating') %}
            {% set input2 = states('sensor.vmc_master_status_freecooling') %}
            {% set interruttore_freecooling = states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_freecooling') %}
            {% set interruttore_freeheating = states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_freeheating') %}   
            {% if input1_freecooling in stati or input2_freecooling in stati %}
              Non disponibile
            {% else %}     
              {% if input1 == "OK" and interruttore_freeheating == 'on' %}
                Free Heating
              {% elif input2 == "OK" and interruttore_freecooling == 'on' %}
                Free Cooling
              {% else %}
                Disabilitata
              {% endif %}
            {% endif %}    
          {% endif %}
        icon_template: mdi:calendar-month-outline
################### Fine Creazione Sensori Interfaccia Free Heating - Free Cooling ##########################################################################################################################################

################### Inizio Creazione Lettura Valore Etichette ###############################################################################################################################################################
      vmc_master_speed_1_fascia_calendario:                                    # [CONFIGURAZIONE 0 RICHIAMI] SENSORE DI LETTURA DEL VALORE INSERITO TRAMITE INTERFACCIA, NEL SENSORE input_select vmc_master_speed
        friendly_name: "Set Velocità 1° Fascia Calendario"
        value_template: "{{ states('input_select.vmc_master_speed_1_fascia_calendario') | default('') }}"

      vmc_master_speed_2_fascia_calendario:                                    # [CONFIGURAZIONE 0 RICHIAMI] SENSORE DI LETTURA DEL VALORE INSERITO TRAMITE INTERFACCIA, NEL SENSORE input_select vmc_master_speed
        friendly_name: "Set Velocità 2° Fascia Calendario"
        value_template: "{{ states('input_select.vmc_master_speed_2_fascia_calendario') | default('') }}"

      vmc_master_mese_1_fascia_freeheating:                                    # [CONFIGURAZIONE 0 RICHIAMI] SENSORE DI LETTURA DEL VALORE INSERITO TRAMITE INTERFACCIA, NEL SENSORE input_select.vmc_master_mese_1_fascia_freeheating
        friendly_name: "Set Mese 1° Fascia Free Heating"
        value_template: "{{ states('input_select.vmc_master_mese_1_fascia_freeheating') | default('') }}"

      vmc_master_mese_2_fascia_freeheating:                                    # [CONFIGURAZIONE 0 RICHIAMI] SENSORE DI LETTURA DEL VALORE INSERITO TRAMITE INTERFACCIA, NEL SENSORE input_select.vmc_master_mese_2_fascia_freeheating
        friendly_name: "Set Mese 2° Fascia Free Heating"
        value_template: "{{ states('input_select.vmc_master_mese_2_fascia_freeheating') | default('') }}"

      vmc_master_mese_1_fascia_freecooling:                                    # [CONFIGURAZIONE 0 RICHIAMI] SENSORE DI LETTURA DEL VALORE INSERITO TRAMITE INTERFACCIA, NEL SENSORE input_select.vmc_master_mese_1_fascia_freeheating
        friendly_name: "Set Mese 1° Fascia Free Cooling"
        value_template: "{{ states('input_select.vmc_master_mese_1_fascia_freecooling') | default('') }}"

      vmc_master_mese_2_fascia_freecooling:                                    # [CONFIGURAZIONE 0 RICHIAMI] SENSORE DI LETTURA DEL VALORE INSERITO TRAMITE INTERFACCIA, NEL SENSORE input_select.vmc_master_mese_2_fascia_freeheating
        friendly_name: "Set Mese 2° Fascia Free Cooling"
        value_template: "{{ states('input_select.vmc_master_mese_2_fascia_freecooling') | default('') }}"
################### Fine Creazione Lettura Valore Etichette ###############################################################################################################################################################

################### Inizio Creazione Etichette Interfaccia Lovelace #######################################################################################################################################################
input_text:
  vmc_master_nome_da_inserire:                                                 # [CONFIGURAZIONE 1 RICHIAMO] [AUTOMAZIONE, PIU' RICHIAMI] [INTERFACCIA, PIU' RICHIAMI] SENSORE DI MEMORIZZAZIONE DEL NOE DELLA VMC CHE SI DESIDERA IMPOSTARE NELLA VMC
    name: "VMC Rinomina"
    initial: ""
    min: 0
    max: 10
    icon: mdi:form-textbox
        
  vmc_master_ip_insert:
    name: IP da configurare su Porta 5001 della VMC (Riavvio di H.A.)
    initial: ""
    icon: mdi:form-textbox

  vmc_master_last_temp_external_entity:
    name: "Ultima Entità Temperatura esterna Selezionata"
    icon: mdi:form-textbox

  vmc_master_last_temp_internal_entity:
    name: "Ultima Entità Temperatura interna Selezionata"
    icon: mdi:form-textbox
    
  vmc_master_last_humidity_external_entity:
    name: "Ultima Entità Umidità esterna Selezionata"
    icon: mdi:form-textbox

  vmc_master_last_humidity_internal_entity:
    name: "Ultima Entità Umidità interna Selezionata"
    icon: mdi:form-textbox

  vmc_master_last_co2_internal_entity:
    name: "Ultima Entità CO₂ interna Selezionata"
    icon: mdi:form-textbox

  vmc_master_last_notification_device:
    name: "Ultimo Dispositivo per Invio Notifica Selezionato"
    icon: mdi:form-textbox

  vmc_master_tempo_mancante_reset:                                             # SENSORE PER RIALLINEARE AL MASSIMO VALORE IL SENSORE vmc_master_tempo_mancante_ricambio QUANDO SI PREME RESET OVVERO SI AVVIA LO SCRIPT vmc_master_azzera_aria_scambiata
     name: Reset Countdown Ricambio
     icon: mdi:form-textbox

  vmc_master_velocita_precedente:
    name: Velocità precedente VMC
    initial: ""
    max: 20
    
  vmc_master_last_media_player_entity:
    name: "Ultima Entità Media Player Selezionato"
    icon: mdi:form-textbox

input_select:
  vmc_master_speed_1_fascia_calendario:                                        # [CONFIGURAZIONE PIù RICHIAMI] [AUTOMAZIONE, PIU' RICHIAMI] [INTERFACCIA, PIU' RICHIAMI] SENSORE DI MEMORIZZAZIONE DELLA VELOCITA' CHE SI DESIDERA IMPOSTARE NELLA VMC
    name: "Set Velocità 1° Fascia Calendario"
    options:
      - Velocità 0
      - Velocità 1
      - Velocità 2
      - Velocità 3
      - Velocità 4
      - Notturna
      - Iperventilazione
      - Free Cool./Heat.
    icon: mdi:fan    

  vmc_master_speed_2_fascia_calendario:                                        # [CONFIGURAZIONE PIù RICHIAMI] [AUTOMAZIONE, PIU' RICHIAMI] [INTERFACCIA, PIU' RICHIAMI] SENSORE DI MEMORIZZAZIONE DELLA VELOCITA' CHE SI DESIDERA IMPOSTARE NELLA VMC
    name: "Set Velocità 2° Fascia Calendario"
    options:
      - Velocità 0
      - Velocità 1
      - Velocità 2
      - Velocità 3
      - Velocità 4
      - Notturna
      - Iperventilazione
      - Free Cool./Heat.
    icon: mdi:fan    

  vmc_master_mese_1_fascia_freeheating:                                        # [CONFIGURAZIONE PIù RICHIAMI] [AUTOMAZIONE, PIU' RICHIAMI] [INTERFACCIA, PIU' RICHIAMI] SENSORE DI MEMORIZZAZIONE INIZIO 1°RANGE, PER AVVIO VELOCITà FREECOOLING
    name: "Set Inizio Mese Free Heating"
    options:
      - Gennaio
      - Febbraio
      - Marzo
      - Aprile
      - Maggio
      - Giugno
      - Luglio
      - Agosto
      - Settembre
      - Ottobre
      - Novembre
      - Dicembre
    icon: mdi:calendar-month-outline    

  vmc_master_mese_2_fascia_freeheating:                                        # [CONFIGURAZIONE PIù RICHIAMI] [AUTOMAZIONE, PIU' RICHIAMI] [INTERFACCIA, PIU' RICHIAMI] SENSORE DI MEMORIZZAZIONE FINE 1°RANGE, PER AVVIO VELOCITà FREECOOLING (FREEHEATING)
    name: "Set Fine Mese Free Heating"
    options:
      - Gennaio
      - Febbraio
      - Marzo
      - Aprile
      - Maggio
      - Giugno
      - Luglio
      - Agosto
      - Settembre
      - Ottobre
      - Novembre
      - Dicembre
    icon: mdi:calendar-month-outline    

  vmc_master_mese_1_fascia_freecooling:                                        # [CONFIGURAZIONE PIù RICHIAMI] [AUTOMAZIONE, PIU' RICHIAMI] [INTERFACCIA, PIU' RICHIAMI] SENSORE DI MEMORIZZAZIONE INIZIO 1°RANGE, PER AVVIO VELOCITà FREECOOLING
    name: "Set Inizio Mese Free Cooling"
    options:
      - Gennaio
      - Febbraio
      - Marzo
      - Aprile
      - Maggio
      - Giugno
      - Luglio
      - Agosto
      - Settembre
      - Ottobre
      - Novembre
      - Dicembre
    icon: mdi:calendar-month-outline    

  vmc_master_mese_2_fascia_freecooling:                                        # [CONFIGURAZIONE PIù RICHIAMI] [AUTOMAZIONE, PIU' RICHIAMI] [INTERFACCIA, PIU' RICHIAMI] SENSORE DI MEMORIZZAZIONE FINE 1°RANGE, PER AVVIO VELOCITà FREECOOLING (FREEHEATING)
    name: "Set Fine Mese Free Cooling"
    options:
      - Gennaio
      - Febbraio
      - Marzo
      - Aprile
      - Maggio
      - Giugno
      - Luglio
      - Agosto
      - Settembre
      - Ottobre
      - Novembre
      - Dicembre
    icon: mdi:calendar-month-outline  

  vmc_master_speed_umidita:                                                    # [CONFIGURAZIONE PIù RICHIAMI] [AUTOMAZIONE, PIU' RICHIAMI] [INTERFACCIA, PIU' RICHIAMI] SENSORE DI MEMORIZZAZIONE DELLA VELOCITA' CHE SI DESIDERA IMPOSTARE NELLA VMC
    name: "Set Velocità Umidità di Avvio"
    options:
      - Velocità 0
      - Velocità 1
      - Velocità 2
      - Velocità 3
      - Velocità 4
      - Notturna
      - Iperventilazione
      - Free Cool./Heat.
    icon: mdi:fan 

  vmc_master_selected_temp_external_entity:                                    # [CONFIGURAZIONE PIU' RICHIAMI] [AUTOMAZIONE, PIU' RICHIAMI] [INTERFACCIA, PIU' RICHIAMI] SENSORE DI MEMORIZZAZIONE DI TUTTE LE ENTITA' DI TEMPERATURA INSTALLATI IN HOME ASSISTANT
    name: Seleziona Entità Temperatura Esterna
    options:
      - "Aggiorna Elenco Entità Temperatura Esterna"
    icon: mdi:form-textbox

  vmc_master_selected_temp_internal_entity:                                    # [CONFIGURAZIONE PIU' RICHIAMI] [AUTOMAZIONE, PIU' RICHIAMI] [INTERFACCIA, PIU' RICHIAMI] SENSORE DI MEMORIZZAZIONE DI TUTTE LE ENTITA' DI TEMPERATURA INSTALLATI IN HOME ASSISTANT
    name: Seleziona Entità Temperatura Interna
    options:
      - "Aggiorna Elenco Entità Temperatura Interna"
    icon: mdi:form-textbox

  vmc_master_selected_humidity_external_entity:                                # [CONFIGURAZIONE PIU' RICHIAMI] [AUTOMAZIONE, PIU' RICHIAMI] [INTERFACCIA, PIU' RICHIAMI] SENSORE DI MEMORIZZAZIONE DI TUTTE LE ENTITA' DI UMIDITA' INSTALLATI IN HOME ASSISTANT
    name: Seleziona Entità Umidità Esterna
    options:
      - "Aggiorna Elenco Entità Umidità Esterna"
    icon: mdi:form-textbox

  vmc_master_selected_humidity_internal_entity:                                # [CONFIGURAZIONE PIU' RICHIAMI] [AUTOMAZIONE, PIU' RICHIAMI] [INTERFACCIA, PIU' RICHIAMI] SENSORE DI MEMORIZZAZIONE DI TUTTE LE ENTITA' DI UMIDITA' INSTALLATI IN HOME ASSISTANT
    name: Seleziona Entità Umidità Interna
    options:
      - "Aggiorna Elenco Entità Umidità Interna"
    icon: mdi:form-textbox

  vmc_master_selected_co2_internal_entity:                                    # [CONFIGURAZIONE PIU' RICHIAMI] [AUTOMAZIONE, PIU' RICHIAMI] [INTERFACCIA, PIU' RICHIAMI] SENSORE DI MEMORIZZAZIONE DI TUTTE LE ENTITA' DI CO₂ INSTALLATI IN HOME ASSISTANT
    name: Seleziona Entità CO₂ Interna
    options:
      - "Aggiorna Elenco Entità CO₂ Interna"
    icon: mdi:form-textbox

  vmc_master_selected_notification_device:                                    # [CONFIGURAZIONE PIU' RICHIAMI] [AUTOMAZIONE, PIU' RICHIAMI] [INTERFACCIA, PIU' RICHIAMI] SENSORE DI MEMORIZZAZIONE DI TUTTE LE ENTITA' DI CO₂ INSTALLATI IN HOME ASSISTANT
    name: Seleziona Dispositivo per Invio Notifica
    options:
      - "Aggiorna Elenco Dispositivi per Invio Notifica"
    icon: mdi:form-textbox

  vmc_master_selected_media_player_entity:
    name: Seleziona Media Player
    options:
      - "Aggiorna Elenco Media Player"
    icon: mdi:form-textbox

input_number:
  vmc_master_aria_scambiata_v1:
    name: Aria Scambiata a Velocità 1
    initial: 0
    min: 0
    max: 10000000000000
    step: 0.01
    unit_of_measurement: 'm³'

  vmc_master_aria_scambiata_v2:
    name: Aria Scambiata a Velocità 2
    initial: 0
    min: 0
    max: 10000000000000
    step: 0.01
    unit_of_measurement: 'm³'

  vmc_master_aria_scambiata_v3:
    name: Aria Scambiata a Velocità 3
    initial: 0
    min: 0
    max: 10000000000000
    step: 0.01
    unit_of_measurement: 'm³'

  vmc_master_aria_scambiata_v4:
    name: Aria Scambiata a Velocità 4
    initial: 0
    min: 0
    max: 10000000000000
    step: 0.01
    unit_of_measurement: 'm³'

  vmc_master_aria_scambiata_iperventilazione:
    name: Aria Scambiata a Vel. Iperventilazione
    initial: 0
    min: 0
    max: 10000000000000
    step: 0.01
    unit_of_measurement: 'm³'

  vmc_master_aria_scambiata_notte:
    name: Aria Scambiata a Vel. Notturna
    initial: 0
    min: 0
    max: 10000000000000
    step: 0.01
    unit_of_measurement: 'm³'

  vmc_master_aria_scambiata_freecooling:
    name: Aria Scambiata a Vel. Free Heating/Cooling
    initial: 0
    min: 0
    max: 10000000000000
    step: 0.01
    unit_of_measurement: 'm³'

  vmc_master_aria_scambiata_ricomincio:
    name: Aria Scambiata Ricomincio
    initial: 0
    min: 0
    max: 10000000000000000000000  # o un valore sufficientemente grande per il volume
    step: 0.0001

  vmc_master_offset_temp_interna:                                              # [CONFIGURAZIONE, PIU’ RICHIAMI] [INTERFACCIA PIU’ RICHIAMI] SENSORE DI MEMORIZZAZIONE DELL'OFFSET PER LA TEMPERATURA INTERNA CHE VERRA' SOMMATA NEL SENSORE vmc_master_temp_interna_status
    name: "Offset Temperatura"
    min: -50
    max: 50
    step: 0.1
    unit_of_measurement: "°C"
    icon: mdi:counter

  vmc_master_offset_temp_esterna:                                              # [CONFIGURAZIONE, PIU’ RICHIAMI] [INTERFACCIA PIU’ RICHIAMI] SENSORE DI MEMORIZZAZIONE DELL'OFFSET PER LA TEMPERATURA ESTERNA CHE VERRA' SOMMATA NEL SENSORE vmc_master_temp_esterna_status
    name: "Offset Temperatura Ext."
    min: -50
    max: 50
    step: 0.1
    unit_of_measurement: "°C"
    icon: mdi:counter

  vmc_master_offset_umidita_interna:                                           # [CONFIGURAZIONE, PIU’ RICHIAMI] [INTERFACCIA PIU’ RICHIAMI] SENSORE DI MEMORIZZAZIONE DELL'OFFSET PER L'UMIDITA' INTERNA CHE VERRA' SOMMATA NEL SENSORE vmc_master_umidita_interna_status
    name: "Offset Umidità Int."
    min: -100
    max: 100
    step: 0.1
    unit_of_measurement: "%"
    icon: mdi:counter
    
  vmc_master_offset_umidita_esterna:                                           # [CONFIGURAZIONE, PIU’ RICHIAMI] [INTERFACCIA PIU’ RICHIAMI] SENSORE DI MEMORIZZAZIONE DELL'OFFSET PER L'UMIDITA' ESTERNA CHE VERRA' SOMMATA NEL SENSORE vmc_master_umidita_esterna_status
    name: "Offset Umidità Ext."
    min: -100
    max: 100
    step: 0.1
    unit_of_measurement: "%"
    icon: mdi:counter

  vmc_master_offset_co2:                                                       # [CONFIGURAZIONE, PIù RICHIAMI] [INTERFACCIA PIU’ RICHIAMI] SENSORE DI MEMORIZZAZIONE DELL'OFFSET PER L'ANIDRIDE CARBONICA CHE VERRA' SOMMATA NEL SENSORE vmc_master_co2_status
    name: "Offset CO₂ Int."
    min: -1500
    max: 1500
    step: 1
    unit_of_measurement: "ppm"
    icon: mdi:counter
    
  vmc_master_offset_voc:                                                       # [CONFIGURAZIONE, PIù RICHIAMI] [INTERFACCIA PIU’ RICHIAMI] SENSORE DI MEMORIZZAZIONE DELL'OFFSET PER I COMPOSTI ORGANICI VOLATICI ESPRESSO IN PPM [DI DEFAULT NELLA VMC SONO ESPRESSI IN PPB] CHE VERRANNO SOMMATI NEL SENSORE vmc_master_voc_status
    name: "Offset VOC Int."
    min: -1000
    max: 1000
    step: 1
    unit_of_measurement: "ppb"
    icon: mdi:counter  

  vmc_master_offset_verifica_impiego_vmc:                                      # [CONFIGURAZIONE, PIU’ RICHIAMI] [INTERFACCIA PIU’ RICHIAMI]  SENSORE DI CONFRONTO CON LA DIFFERENZA TRA IL PUNTO DI RUGIADA ESTERNO - IL PUNTO DI RUGIADA INTERNO, SE MINORE SI PUO' IMPIEGARE LA VMC, DIVERSAMENTE NON SI PUO' IMPIEGARE LA VMC
    name: "Set Lim. Δ Punto di Rugiada"
    min: -10
    max: 10
    step: 1
    unit_of_measurement: "°C"
    icon: mdi:counter

  vmc_master_volume_da_inserire:                                               # [CONFIGURAZIONE, PIU’ RICHIAMI] [INTERFACCIA PIU’ RICHIAMI]  SENSORE PER L'ACQUISIZIONE DEL VOLUME IMPIEGATO PER IL CALCOLO DEL TEMPO NECESSARIO PER RINNOVARE TUTTA L'ARIA, TRAMITE IL SENSORE vmc_master_status_calcolo_portata_ventola
    name: "Volume ambiente Int."
    min: 0
    max: 1000
    step: 0.5
    mode: box
    unit_of_measurement: "[M³]"
    icon: mdi:cube-scan

  vmc_master_umidita_avvio:                                           # [CONFIGURAZIONE, PIU’ RICHIAMI] [INTERFACCIA PIU’ RICHIAMI] SENSORE DI AVVIO DELLA VMC PER L'UMIDITA' INTERNA RILEVATA
    name: "Avvio VMC per Umidità ≥"
    min: 65
    max: 100
    step: 0.1
    unit_of_measurement: "%"
    icon: mdi:counter

  vmc_master_audio_volume:                                           # [CONFIGURAZIONE, PIU’ RICHIAMI] [INTERFACCIA PIU’ RICHIAMI] SENSORE DI MEMORIZZAZIONE DEL VOLUME DA IMPIEGARE NEL MEDIA PLAYER SELEZIONATO
    name: Volume Media Player
    min: 0
    max: 1
    step: 0.05
    mode: slider
    unit_of_measurement: "volume"
    icon: mdi:knob
################### Fine Creazione Etichette Interfaccia Lovelace  ############################################################################################################################################################################

################### Inizio Creazione Switch Booleani impiegati nell'Interfaccia Lovelace per mostrare o meno le Opzioni ####################################################################################
input_boolean:
  vmc_master_opzioni_avvisi:                                                  # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU' RICHIAMI] [INTERFACCIA, PIU' RICHIAMI]
    name: "Avvisi"
    initial: false
    icon: mdi:alert-rhombus-outline

  vmc_master_opzioni_avvisi_grafici:                                          # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU' RICHIAMI] [INTERFACCIA, PIU' RICHIAMI]
    name: "Grafici"
    initial: false
    icon: mdi:chart-bell-curve-cumulative

  vmc_master_opzioni_vmc:                                                      # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU' RICHIAMI] [INTERFACCIA, PIU' RICHIAMI]
    name: "Telecomando"
    initial: false
    icon: mdi:remote-tv

  vmc_master_opzioni_offset_sensori:                                           # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU' RICHIAMI] [INTERFACCIA, PIU' RICHIAMI]
    name: "Opzioni"
    initial: false
    icon: mdi:format-list-checkbox

  vmc_master_opzioni_interruttore_offset_sensori:                              # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU' RICHIAMI] [INTERFACCIA, PIU' RICHIAMI]
    name: "Sensori - Offset"
    initial: false
    icon: mdi:format-list-checkbox

  vmc_master_opzioni_monitoraggio_sensori:                                     # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU' RICHIAMI] [INTERFACCIA, PIU' RICHIAMI]
    name: "Sensori"
    initial: false
    icon: mdi:memory

  vmc_master_opzioni_interruttore_monitoraggio_sensori_extra:                  # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU' RICHIAMI] [INTERFACCIA, PIU' RICHIAMI]
    name: "Sensori - Extra"
    initial: false
    icon: mdi:memory

  vmc_master_opzioni_calendario_main:                                          # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU' RICHIAMI] [INTERFACCIA, PIU' RICHIAMI]
    name: "Calendario"
    initial: false
    icon: mdi:calendar-multiselect

  vmc_master_opzioni_calendario:                                               # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU' RICHIAMI] [INTERFACCIA, PIU' RICHIAMI]
    name: "Programmazione Calendario"
    initial: false
    icon: mdi:calendar-clock-outline

  vmc_master_opzioni_punto_di_rugiada:                                         # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU' RICHIAMI] [INTERFACCIA, PIU' RICHIAMI]
    name: "Lim. Δ P. di Rugiada"
    initial: false
    icon: mdi:thermometer-water

  vmc_master_opzioni_free_heating_o_free_cooling:                              # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU' RICHIAMI] [INTERFACCIA, PIU' RICHIAMI]
    name: "Calendario Free Heating / Free Cooling"
    initial: false
    icon: mdi:sun-snowflake-variant

  vmc_master_opzioni_interruttore_calendario:                                  # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU' RICHIAMI] [INTERFACCIA, PIU' RICHIAMI]
    name: "Status Programmazione Giornaliera"
    initial: false
    icon: mdi:calendar-today

  vmc_master_opzioni_lettura_sensori:                                          # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU' RICHIAMI] [INTERFACCIA, PIU' RICHIAMI]
    name: "Informazioni"
    initial: false
    icon: mdi:information-slab-box-outline

  vmc_master_opzioni_scelta_sensori:                                          # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU' RICHIAMI] [INTERFACCIA, PIU' RICHIAMI]
    name: "Sensori Opzionati"
    initial: false
    icon: mdi:memory

  vmc_master_opzioni_elementi_chimici:                                        # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU' RICHIAMI] [INTERFACCIA, PIU' RICHIAMI]
    name: "Elementi Chimici"
    initial: false
    icon: mdi:test-tube

  vmc_master_opzioni_accendi_spegni_vmc_vs_pdr:                                # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU' RICHIAMI] [INTERFACCIA, PIU' RICHIAMI]  VERIFICA IL VALORE DEL SENZORE vmc_master_punto_di_rugiada_verifica_confronto OVVERO SE IL VALORE DIVENTE "SE NE SCONSIGLIA L'IMPIEGO"; SOLAMENTE SE VIENE ACCESO (ON), LA VMC VERRA' SPENTA IN AUTOMATICO SE IL VALORE DIVENTA "SE NE SCONSIGLIA L'IMPIEGO" 
    name: "VMC ON/OFF, in Funzione del Lim. Δ P. di Rugiada"
    icon: mdi:light-switch-off

  vmc_master_opzioni_accendi_spegni_vmc_vs_calendario:                         # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU' RICHIAMI] [INTERFACCIA, PIU' RICHIAMI]  VERIFICA SE RENDERE AUTONOMA LA VMC, SE "ON" VERRA' IMPIEGATO IL CALENDARIO AVVIANDO IN AUTONOMIA L'ACCENSIONE E LO SPEGNIMENTO; SE "OFF" NON VERRA' IMPIEGATO IL CALENDARIO PERTENDO L'AUTONOMIA DI ACCENSIONE E SPEGNIMENTO AUTOMATICO
    name: "VMC ON/OFF, in Funzione del Calendario"
    icon: mdi:light-switch-off

  vmc_master_opzioni_accendi_spegni_vmc_vs_freeheating:                        # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU' RICHIAMI] [INTERFACCIA, PIU' RICHIAMI]  
    name: "VMC ON/OFF, in Funzione della Vel. Free Heating"
    icon: mdi:light-switch-off

  vmc_master_opzioni_accendi_spegni_vmc_vs_freecooling:                        # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU' RICHIAMI] [INTERFACCIA, PIU' RICHIAMI]  
    name: "VMC ON/OFF, in Funzione della Vel. Free Cooling"
    icon: mdi:light-switch-off

  vmc_master_opzioni_accendi_spegni_avvisi:                                    # [CONFIGURAZIONE PIU' RICHIAMI] [AUTOMAZIONE, PIU' RICHIAMI] [INTERFACCIA, PIU' RICHIAMI]  
    name: "Mostra o Nascondi gli Avvisi"
    icon: mdi:light-switch-off

  vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc:                          # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU' RICHIAMI] [INTERFACCIA, PIU' RICHIAMI]  VERIFICA IL VALORE DI PERICOLOSITA' DEI SENZORE CO2 E VOC; SOLAMENTE; LA VMC VERRA' SI AVVIERA' IN AUTOMATICO SE VIENE ACCESO (ON), QUALORA I VALORI RISULTINO PERICOLOSI  
    name: "VMC ON/OFF, in Funzione del Lim. CO₂ e/o VOC"
    icon: mdi:light-switch-off

  vmc_master_opzioni_accendi_spegni_avvisi_spia:                               # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU' RICHIAMI] [INTERFACCIA, PIU' RICHIAMI]  
    name: "Spia Avvisi"
    icon: mdi:alert-rhombus-outline

  vmc_master_opzioni_accendi_spegni_vmc_vs_umidita:                            # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU' RICHIAMI] [INTERFACCIA, PIU' RICHIAMI]  VERIFICA IL VALORE DI PERICOLOSITA' DELL'UMIDITA' SETTATA; LA VMC VERRA' SI AVVIERA' IN AUTOMATICO SE VIENE ACCESO (ON), QUALORA IL VALORE RISULTI PERICOLOSO  
    name: "VMC ON/OFF, in Funzione dell'Umidità Interna"
    icon: mdi:light-switch-off
################### Fine Creazione Switch Booleani impiegati nell'Interfaccia Lovelace per mostrare o meno le Opzioni ####################################################################################
  vmc_master_popup_versione_corrente_vs_repository:                             # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI] SENSORE TRACCIAMENTO POPUP AGGIORNAMENTO
    name: "PopUp Notifica Aggiornamento Package"
    initial: false
    icon: mdi:human-handsup
################### Inizio Creazione Switch Booleani impiegati nell'Automazione, per valutare la Velocità in caso di Black-Out e/o SUPERAMENTO DEL Set Lim. Δ Punto di Rugiada ##############################################################
  vmc_master_spia_velocita_0:                                                  # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI] SENSORE TRACCIAMENTO VELOCITA' 0, IN CASO DI BLACK-OUT
    name: "Spia Velocità 0"
    icon: mdi:memory

  vmc_master_spia_velocita_1:                                                  # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI] SENSORE TRACCIAMENTO VELOCITA' 1, IN CASO DI BLACK-OUT
    name: "Spia Velocità 1"
    icon: mdi:memory

  vmc_master_spia_velocita_2:                                                  # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI] SENSORE TRACCIAMENTO VELOCITA' 2, IN CASO DI BLACK-OUT
    name: "Spia Velocità 2"
    icon: mdi:memory

  vmc_master_spia_velocita_3:                                                  # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI] SENSORE TRACCIAMENTO VELOCITA' 3, IN CASO DI BLACK-OUT
    name: "Spia Velocità 3"
    icon: mdi:memory
    
  vmc_master_spia_velocita_4:                                                  # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI] SENSORE TRACCIAMENTO VELOCITA' 4, IN CASO DI BLACK-OUT
    name: "Spia Velocità 4"
    icon: mdi:memory

  vmc_master_spia_velocita_iperventilazione:                                   # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI] SENSORE TRACCIAMENTO VELOCITA' IPERVENTILAZIONE, IN CASO DI BLACK-OUT
    name: "Spia Velocità Iperventilazione"
    icon: mdi:memory

  vmc_master_spia_velocita_notturna:                                           # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI] SENSORE TRACCIAMENTO VELOCITA' NOTTURNA, IN CASO DI BLACK-OUT
    name: "Spia Velocità Notturna"
    icon: mdi:memory

  vmc_master_spia_velocita_freecooling:                                        # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI] SENSORE TRACCIAMENTO VELOCITA' FREE-COOLING, IN CASO DI BLACK-OUT
    name: "Spia Velocità Free Cool./Heat."
    icon: mdi:memory    

  vmc_master_spia_calendario_lunedi_1:                                        # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU' RICHIAMI] SENSORE TRACCIAMENTO, QUANDO SI E' ALL'INTERNO DEL LUNEDì 1° FASCIA DEL CALENDARIO
    name: "Spia all'interno del Calendario Lunedì 1°"
    icon: mdi:memory

  vmc_master_spia_calendario_lunedi_2:                                        # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU' RICHIAMI] SENSORE TRACCIAMENTO, QUANDO SI E' ALL'INTERNO DEL LUNEDì 2° FASCIA DEL CALENDARIO
    name: "Spia all'interno del Calendario Lunedì 2°"
    icon: mdi:memory

  vmc_master_spia_calendario_martedi_1:                                        # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU' RICHIAMI] SENSORE TRACCIAMENTO, QUANDO SI E' ALL'INTERNO DEL MARTEDì 1° FASCIA DEL CALENDARIO
    name: "Spia all'interno del Calendario Martedì 1°"
    icon: mdi:memory

  vmc_master_spia_calendario_martedi_2:                                        # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU' RICHIAMI] SENSORE TRACCIAMENTO, QUANDO SI E' ALL'INTERNO DEL MARTEDì 2° FASCIA DEL CALENDARIO
    name: "Spia all'interno del Calendario Martedì 2°"
    icon: mdi:memory

  vmc_master_spia_calendario_mercoledi_1:                                        # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU' RICHIAMI] SENSORE TRACCIAMENTO, QUANDO SI E' ALL'INTERNO DEL MERCOLEDì 1° FASCIA DEL CALENDARIO
    name: "Spia all'interno del Calendario Mercoledì 1°"
    icon: mdi:memory

  vmc_master_spia_calendario_mercoledi_2:                                        # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU' RICHIAMI] SENSORE TRACCIAMENTO, QUANDO SI E' ALL'INTERNO DEL MERCOLEDì 2° FASCIA DEL CALENDARIO
    name: "Spia all'interno del Calendario Mercoledì 2°"
    icon: mdi:memory

  vmc_master_spia_calendario_giovedi_1:                                        # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU' RICHIAMI] SENSORE TRACCIAMENTO, QUANDO SI E' ALL'INTERNO DEL GIOVEDì 1° FASCIA DEL CALENDARIO
    name: "Spia all'interno del Calendario Giovedì 1°"
    icon: mdi:memory

  vmc_master_spia_calendario_giovedi_2:                                        # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU' RICHIAMI] SENSORE TRACCIAMENTO, QUANDO SI E' ALL'INTERNO DEL GIOVEDì 2° FASCIA DEL CALENDARIO
    name: "Spia all'interno del Calendario Giovedì 2°"
    icon: mdi:memory

  vmc_master_spia_calendario_venerdi_1:                                        # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU' RICHIAMI] SENSORE TRACCIAMENTO, QUANDO SI E' ALL'INTERNO DEL VENERDì 1° FASCIA DEL CALENDARIO
    name: "Spia all'interno del Calendario Venerdì 1°"
    icon: mdi:memory

  vmc_master_spia_calendario_venerdi_2:                                        # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU' RICHIAMI] SENSORE TRACCIAMENTO, QUANDO SI E' ALL'INTERNO DEL VENERDì 2° FASCIA DEL CALENDARIO
    name: "Spia all'interno del Calendario Venerdì 2°"
    icon: mdi:memory

  vmc_master_spia_calendario_sabato_1:                                        # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU' RICHIAMI] SENSORE TRACCIAMENTO, QUANDO SI E' ALL'INTERNO DEL SABATO 1° FASCIA DEL CALENDARIO
    name: "Spia all'interno del Calendario Sabato 1°"
    icon: mdi:memory

  vmc_master_spia_calendario_sabato_2:                                        # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU' RICHIAMI] SENSORE TRACCIAMENTO, QUANDO SI E' ALL'INTERNO DEL SABATO 2° FASCIA DEL CALENDARIO
    name: "Spia all'interno del Calendario Sabato 2°"
    icon: mdi:memory

  vmc_master_spia_calendario_domenica_1:                                        # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU' RICHIAMI] SENSORE TRACCIAMENTO, QUANDO SI E' ALL'INTERNO DEL DOMENICA 1° FASCIA DEL CALENDARIO
    name: "Spia all'interno del Calendario Domenica 1°"
    icon: mdi:memory

  vmc_master_spia_calendario_domenica_2:                                        # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU' RICHIAMI] SENSORE TRACCIAMENTO, QUANDO SI E' ALL'INTERNO DEL DOMENICA 2° FASCIA DEL CALENDARIO
    name: "Spia all'interno del Calendario Domenica 2°"
    icon: mdi:memory

  vmc_master_spia_velocita_0_un_solo_avvio:                                    # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU' RICHIAMI] SENSORE DI SUPPORTO NELL'AUTOMAZIONE PER IL RIPRISTINO DELLA VELOCITA' 0, IN CASO SUPERAMENTO del Lim. Δ P. di Rugiada
    name: "Spia Velocità 0 1° Avvio"
    icon: mdi:memory

  vmc_master_spia_velocita_1_un_solo_avvio:                                    # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU' RICHIAMI] SENSORE DI SUPPORTO NELL'AUTOMAZIONE PER IL RIPRISTINO DELLA VELOCITA' 1, IN CASO SUPERAMENTO del Lim. Δ P. di Rugiada
    name: "Spia Velocità 1 1° Avvio"
    icon: mdi:memory

  vmc_master_spia_velocita_2_un_solo_avvio:                                    # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU' RICHIAMI] SENSORE DI SUPPORTO NELL'AUTOMAZIONE PER IL RIPRISTINO DELLA VELOCITA' 2, IN CASO SUPERAMENTO del Lim. Δ P. di Rugiada
    name: "Spia Velocità 2 1° Avvio"
    icon: mdi:memory

  vmc_master_spia_velocita_3_un_solo_avvio:                                    # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU' RICHIAMI] SENSORE DI SUPPORTO NELL'AUTOMAZIONE PER IL RIPRISTINO DELLA VELOCITA' 3, IN CASO SUPERAMENTO del Lim. Δ P. di Rugiada
    name: "Spia Velocità 3 1° Avvio"
    icon: mdi:memory

  vmc_master_spia_velocita_4_un_solo_avvio:                                    # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU' RICHIAMI] SENSORE DI SUPPORTO NELL'AUTOMAZIONE PER IL RIPRISTINO DELLA VELOCITA' 4, IN CASO SUPERAMENTO del Lim. Δ P. di Rugiada
    name: "Spia Velocità 4 1° Avvio"
    icon: mdi:memory

  vmc_master_spia_velocita_iperventilazione_un_solo_avvio:                     # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU' RICHIAMI] SENSORE DI SUPPORTO NELL'AUTOMAZIONE PER IL RIPRISTINO DELLA VELOCITA' IPERVENTILAZIONE, IN CASO SUPERAMENTO del Lim. Δ P. di Rugiada
    name: "Spia Velocità Iperventilazione 1° Avvio"
    icon: mdi:memory

  vmc_master_spia_velocita_notturna_un_solo_avvio:                             # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU' RICHIAMI] SENSORE DI SUPPORTO NELL'AUTOMAZIONE PER IL RIPRISTINO DELLA VELOCITA' NOTTURNA, IN CASO SUPERAMENTO del Lim. Δ P. di Rugiada
    name: "Spia Velocità notturna 1° Avvio"
    icon: mdi:memory

  vmc_master_spia_velocita_freecooling_un_solo_avvio:                          # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU' RICHIAMI] SENSORE DI SUPPORTO NELL'AUTOMAZIONE PER IL RIPRISTINO DELLA VELOCITA' FREE-COOLING, IN CASO SUPERAMENTO del Lim. Δ P. di Rugiada
    name: "Spia Velocità freecooling 1° Avvio"
    icon: mdi:memory

  vmc_master_spia_velocita_freecooling_un_solo_avvio_per_programmazione_freecooling:  # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU' RICHIAMI] SENSORE DI SUPPORTO NELL'AUTOMAZIONE PER IL RIPRISTINO DELLA VELOCITA' FREE-COOLING, IN CASO DI ALLERTA PROGRAMMATA DEL FREE COOLING
    name: "Spia su Programmazione Velocità Free Cooling 1° Avvio"
    icon: mdi:memory

  vmc_master_spia_velocita_freecooling_un_solo_avvio_per_programmazione_freeheating:  # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU' RICHIAMI] SENSORE DI SUPPORTO NELL'AUTOMAZIONE PER IL RIPRISTINO DELLA VELOCITA' FREE-COOLING, IN CASO DI ALLERTA PROGRAMMATA DEL FREE HEATING
    name: "Spia su Programmazione Velocità Free Heating 1° Avvio"
    icon: mdi:memory

  vmc_master_spia_umidita_velocita_0:                                           # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU' RICHIAMI] SENSORE DI SUPPORTO NELL'AUTOMAZIONE PER IL RIPRISTINO DELLA VELOCITA' 0, IN CASO DI ALLERTA UMIDITA'
    name: "Spia Umidità Velocità 0"
    icon: mdi:memory

  vmc_master_spia_umidita_velocita_1:                                           # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU' RICHIAMI] SENSORE DI SUPPORTO NELL'AUTOMAZIONE PER IL RIPRISTINO DELLA VELOCITA' 1, IN CASO DI ALLERTA UMIDITA'
    name: "Spia Umidità Velocità 1"
    icon: mdi:memory

  vmc_master_spia_umidita_velocita_2:                                           # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU' RICHIAMI] SENSORE DI SUPPORTO NELL'AUTOMAZIONE PER IL RIPRISTINO DELLA VELOCITA' 2, IN CASO DI ALLERTA UMIDITA'
    name: "Spia Umidità Velocità 2"
    icon: mdi:memory

  vmc_master_spia_umidita_velocita_3:                                           # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU' RICHIAMI] SENSORE DI SUPPORTO NELL'AUTOMAZIONE PER IL RIPRISTINO DELLA VELOCITA' 3, IN CASO DI ALLERTA UMIDITA'
    name: "Spia Umidità Velocità 3"
    icon: mdi:memory

  vmc_master_spia_umidita_velocita_4:                                           # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU' RICHIAMI] SENSORE DI SUPPORTO NELL'AUTOMAZIONE PER IL RIPRISTINO DELLA VELOCITA' 4, IN CASO DI ALLERTA UMIDITA'
    name: "Spia Umidità Velocità 4"
    icon: mdi:memory

  vmc_master_spia_umidita_velocita_iperventilazione:                            # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU' RICHIAMI] SENSORE DI SUPPORTO NELL'AUTOMAZIONE PER IL RIPRISTINO DELLA VELOCITA' IPERVENTILAZIONE, IN CASO DI ALLERTA UMIDITA'
    name: "Spia Umidità Velocità Iperventilazione"
    icon: mdi:memory

  vmc_master_spia_umidita_velocita_notturna:                                    # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU' RICHIAMI] SENSORE DI SUPPORTO NELL'AUTOMAZIONE PER IL RIPRISTINO DELLA VELOCITA' NOTTURNA, IN CASO DI ALLERTA UMIDITA'
    name: "Spia Umidità Velocità Notturna"
    icon: mdi:memory

  vmc_master_spia_umidita_velocita_freecooling:                                 # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU' RICHIAMI] SENSORE DI SUPPORTO NELL'AUTOMAZIONE PER IL RIPRISTINO DELLA VELOCITA' FREE COOL./HEAT, IN CASO DI ALLERTA UMIDITA'
    name: "Spia Umidità Velocità Free Cool./Heat."
    icon: mdi:memory
################### Fine Creazione Switch Booleani impiegati nell'Automazione, per valutare la Velocità in caso di Black-Out e/o SUPERAMENTO DEL Set Lim. Δ Punto di Rugiada ##############################################
################### Inizio Creazione Switch Booleani impiegati nell'Automazione, per valutare gli inquinanti CO2 e VOC ##############################################

  vmc_master_spia_co2_o_voc:                                                   # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU' RICHIAMI] SENSORE DI SUPPORTO NELL'AUTOMAZIONE PER LA VERIFICA DI INQUINANTI CO2 E VOC
    name: "Spia Inquinanti CO₂ e/o VOC"
    icon: mdi:memory

  vmc_master_spia_co2_o_voc_partenza_ritorno_velocita_0:                       # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU' RICHIAMI] SENSORE DI SUPPORTO NELL'AUTOMAZIONE PER LA VERIFICA DI INQUINANTI CO2 E VOC PARTENZA DA VELOCITA' 0 E RITORNO A VELOCITA' 0
    name: "Spia di Richiamo Vel. 0 CO₂ e/o VOC "
    icon: mdi:memory

  vmc_master_spia_velocita_0_co2_o_voc:                                        # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI] SENSORE TRACCIAMENTO VELOCITA' 0, IN CASO DI INQUINANTI CO2 E VOC
    name: "Spia Velocità 0 CO₂ e/o VOC"
    icon: mdi:memory

  vmc_master_spia_velocita_1_co2_o_voc:                                        # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI] SENSORE TRACCIAMENTO VELOCITA' 1, IN CASO DI INQUINANTI CO2 E VOCT
    name: "Spia Velocità 1 CO₂ e/o VOC"
    icon: mdi:memory

  vmc_master_spia_velocita_2_co2_o_voc:                                        # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI] SENSORE TRACCIAMENTO VELOCITA' 2, IN CASO DI INQUINANTI CO2 E VOC
    name: "Spia Velocità 2 CO₂ e/o VOC"
    icon: mdi:memory

  vmc_master_spia_velocita_3_co2_o_voc:                                        # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI] SENSORE TRACCIAMENTO VELOCITA' 3, IN CASO DI INQUINANTI CO2 E VOC
    name: "Spia Velocità 3 CO₂ e/o VOC"
    icon: mdi:memory
    
  vmc_master_spia_velocita_4_co2_o_voc:                                        # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI] SENSORE TRACCIAMENTO VELOCITA' 4, IN CASO DI INQUINANTI CO2 E VOC
    name: "Spia Velocità 4 CO₂ e/o VOC"
    icon: mdi:memory

  vmc_master_spia_velocita_iperventilazione_co2_o_voc:                         # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI] SENSORE TRACCIAMENTO VELOCITA' IPERVENTILAZIONE, IN CASO DI INQUINANTI CO2 E VOC
    name: "Spia Velocità Iperventilazione CO₂ e/o VOC"
    icon: mdi:memory

  vmc_master_spia_velocita_notturna_co2_o_voc:                                 # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI] SENSORE TRACCIAMENTO VELOCITA' NOTTURNA, IN CASO DI INQUINANTI CO2 E VOC
    name: "Spia Velocità Notturna CO₂ e/o VOC"
    icon: mdi:memory

  vmc_master_spia_velocita_freecooling_co2_o_voc:                              # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI] SENSORE TRACCIAMENTO VELOCITA' FREE-COOLING, IN CASO DI INQUINANTI CO2 E VOC
    name: "Spia Velocità Free Cool./Heat. CO₂ e/o VOC"
    icon: mdi:memory        

  vmc_master_spia_velocita_1_co2_o_voc_pdr:                                    # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI] SENSORE TRACCIAMENTO VELOCITA' 1, IN CASO DI AVVIO PUNTO DI RUGIADA A VELOCITA 1 E INQUINANTI CO2 E VOC ASSENTI MA PRECEDENTEMENTE PRESENTI A VELOCITA 0
    name: "Spia Velocità 1 CO₂ e/o VOC Vs PdR"
    icon: mdi:memory

################### Fine Creazione Switch Booleani impiegati nell'Automazione, per valutare gli inquinanti CO2 e VOC ##############################################


################### Inizio Creazione Switch Booleani impiegati nell'Automazione, per valutare CONGELAMENTO ############################

  vmc_master_congelamento_verifica_soglia_valore_spia:                         # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI] SENSORE TRACCIAMENTO CONGELAMENTO
    name: "Spia VMC Congelamento ≤ -18 [°C] Temp. Esterna ?"
    icon: mdi:memory

  vmc_master_spia_velocita_0_congelamento:                                     # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI] SENSORE TRACCIAMENTO VELOCITA' 0, IN CASO DI CONGELAMENTO
    name: "Spia Velocità 0 Congelamento"
    icon: mdi:memory

  vmc_master_spia_velocita_1_congelamento:                                     # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI] SENSORE TRACCIAMENTO VELOCITA' 1, IN CASO DI CONGELAMENTO
    name: "Spia Velocità 1 Congelamento"
    icon: mdi:memory

  vmc_master_spia_velocita_2_congelamento:                                     # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI] SENSORE TRACCIAMENTO VELOCITA' 2, IN CASO DI CONGELAMENTO
    name: "Spia Velocità 2 Congelamento"
    icon: mdi:memory

  vmc_master_spia_velocita_3_congelamento:                                     # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI] SENSORE TRACCIAMENTO VELOCITA' 3, IN CASO DI CONGELAMENTO
    name: "Spia Velocità 3 Congelamento"
    icon: mdi:memory
    
  vmc_master_spia_velocita_4_congelamento:                                     # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI] SENSORE TRACCIAMENTO VELOCITA' 4, IN CASO DI CONGELAMENTO
    name: "Spia Velocità 4 Congelamento"
    icon: mdi:memory

  vmc_master_spia_velocita_iperventilazione_congelamento:                      # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI] SENSORE TRACCIAMENTO VELOCITA' IPERVENTILAZIONE, IN CASO DI CONGELAMENTO
    name: "Spia Velocità Iperventilazione Congelamento"
    icon: mdi:memory

  vmc_master_spia_velocita_notturna_congelamento:                              # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI] SENSORE TRACCIAMENTO VELOCITA' NOTTURNA, IN CASO DI CONGELAMENTO
    name: "Spia Velocità Notturna Congelamento"
    icon: mdi:memory

  vmc_master_spia_velocita_freecooling_congelamento:                           # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI] SENSORE TRACCIAMENTO VELOCITA' FREE-COOLING, IN CASO DI CONGELAMENTO
    name: "Spia Velocità Free Cool./Heat. Congelamento"
    icon: mdi:memory        

################### Fine Creazione Switch Booleani impiegati nell'Automazione, per valutare CONGELAMENTO #############################

################### Inizio Creazione Switch Booleani impiegati nell'Automazione, per valutare UMIDITA' ############################

  vmc_master_umidita_verifica_soglia_valore_spia:                             # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI] SENSORE TRACCIAMENTO umidità
    name: "Spia VMC Umidità"
    icon: mdi:memory

################### Fine Creazione Switch Booleani impiegati nell'Automazione, per valutare UMIDITA' #############################

################### Inizio Creazione Switch Booleani impiegati nell'Automazione, per valutare DIFFERENZA DI TEMPERATURA ############################

  vmc_master_delta_temp_verifica_soglia_valore_spia:                           # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI] SENSORE TRACCIAMENTO DIFFERENZA DI TEMPERATURA > 23 °C
    name: "Spia VMC Sensori Int. Δ Temp. > 23 [°C] ?"
    icon: mdi:memory

  vmc_master_spia_velocita_0_delta_temp_verifica_soglia_valore:                # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI] SENSORE TRACCIAMENTO VELOCITA' 0, IN CASO DI DIFFERENZA DI TEMPERATURA > 23 °C
    name: "Spia Velocità 0 Diff. Temp. Int-Est > 23 [°C]"
    icon: mdi:memory

  vmc_master_spia_velocita_1_delta_temp_verifica_soglia_valore:                # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI] SENSORE TRACCIAMENTO VELOCITA' 1, IN CASO DI DIFFERENZA DI TEMPERATURA > 23 °C
    name: "Spia Velocità 1 Diff. Temp. Int-Est > 23 [°C]"
    icon: mdi:memory

  vmc_master_spia_velocita_2_delta_temp_verifica_soglia_valore:                # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI] SENSORE TRACCIAMENTO VELOCITA' 2, IN CASO DI DIFFERENZA DI TEMPERATURA > 23 °C
    name: "Spia Velocità 2 Diff. Temp. Int-Est > 23 [°C]"
    icon: mdi:memory

  vmc_master_spia_velocita_3_delta_temp_verifica_soglia_valore:                # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI] SENSORE TRACCIAMENTO VELOCITA' 3, IN CASO DI DIFFERENZA DI TEMPERATURA > 23 °C
    name: "Spia Velocità 3 Diff. Temp. Int-Est > 23 [°C]"
    icon: mdi:memory
    
  vmc_master_spia_velocita_4_delta_temp_verifica_soglia_valore:                # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI] SENSORE TRACCIAMENTO VELOCITA' 4, IN CASO DI DIFFERENZA DI TEMPERATURA > 23 °C
    name: "Spia Velocità 4 Diff. Temp. Int-Est > 23 [°C]"
    icon: mdi:memory

  vmc_master_spia_velocita_iperventilazione_delta_temp_verifica_soglia_valore: # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI] SENSORE TRACCIAMENTO VELOCITA' IPERVENTILAZIONE, IN CASO DI DIFFERENZA DI TEMPERATURA > 23 °C
    name: "Spia Velocità Iperventilazione Diff. Temp. Int-Est > 23 [°C]"
    icon: mdi:memory

  vmc_master_spia_velocita_notturna_delta_temp_verifica_soglia_valore:         # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI] SENSORE TRACCIAMENTO VELOCITA' NOTTURNA, IN CASO DI DIFFERENZA DI TEMPERATURA > 23 °C
    name: "Spia Velocità Notturna Diff. Temp. Int-Est > 23 [°C]"
    icon: mdi:memory

  vmc_master_spia_velocita_freecooling_delta_temp_verifica_soglia_valore:      # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI] SENSORE TRACCIAMENTO VELOCITA' FREE-COOLING, IN CASO DI DIFFERENZA DI TEMPERATURA > 23 °C
    name: "Spia Velocità Free Cool./Heat. Diff. Temp. Int-Est > 23 [°C]"
    icon: mdi:memory        

################### Fine Creazione Switch Booleani impiegati nell'Automazione, per valutare DIFFERENZA DI TEMPERATURA  #############################

################### Inizio Creazione Switch Booleano impiegato nell'Automazione, per invio Notifica al Dispositivio ############################

  vmc_master_notifica_status_vmc:                                              # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI] SENSORE TRACCIAMENTO NOTIFICA
    name: "Invio Notifica"
    icon: mdi:light-switch-off

################### Fine Creazione Switch Booleano impiegato nell'Automazione, per invio Notifica al Dispositivio ##############################

################### Inizio Creazione Switch Booleano impiegato nella riproduzione Audio, al Media Player Selezionato ############################

  vmc_master_opzione_finestra_audio:                                                   # [CONFIGURAZIONE PIU' RICHIAMI] [AUTOMAZIONE PIU' RICHIAMI] SENSORE TRACCIAMENTO AUDIO
    name: "Finestra Audio"
    icon: mdi:volume-high

  vmc_master_notifica_audio:                                                   # [CONFIGURAZIONE PIU' RICHIAMI] [AUTOMAZIONE PIU'RICHIAMI] SENSORE TRACCIAMENTO AUDIO
    name: "Invio Notifica Audio"
    icon: mdi:light-switch-off

  vmc_master_notifica_allerta_congelamento:                                   # [CONFIGURAZIONE PIU' RICHIAMI] [SCRIPT, PIU’ RICHIAMI] SENSORE PER ACCENDERE O SPEGNERE LA NOTIFICA AUDIO SULL'ALLERTA
    name: "Notifica ON/OFF Allerta Congelamento"
    icon: mdi:light-switch-off

  vmc_master_notifica_allerta_differenza_temp_int_est:                         # [CONFIGURAZIONE PIU' RICHIAMI] [SCRIPT, PIU’ RICHIAMI] SENSORE PER ACCENDERE O SPEGNERE LA NOTIFICA AUDIO SULL'ALLERTA
    name: "Notifica ON/OFF Allerta Diff. Temp. Int-Est > 23 [°C]"
    icon: mdi:light-switch-off

  vmc_master_notifica_allerta_inquinanti:                                      # [CONFIGURAZIONE PIU' RICHIAMI] [SCRIPT, PIU’ RICHIAMI] SENSORE PER ACCENDERE O SPEGNERE LA NOTIFICA AUDIO SULL'ALLERTA
    name: "Notifica ON/OFF Allerta Inquinanti"
    icon: mdi:light-switch-off

  vmc_master_notifica_allerta_pdr:                                             # [CONFIGURAZIONE PIU' RICHIAMI] [SCRIPT, PIU’ RICHIAMI] SENSORE PER ACCENDERE O SPEGNERE LA NOTIFICA AUDIO SULL'ALLERTA
    name: "Notifica ON/OFF Allerta Lim. Δ P. di Rugiada"
    icon: mdi:light-switch-off

  vmc_master_notifica_allerta_freecooling_heating:                             # [CONFIGURAZIONE PIU' RICHIAMI] [SCRIPT, PIU’ RICHIAMI] SENSORE PER ACCENDERE O SPEGNERE LA NOTIFICA AUDIO SULL'ALLERTA
    name: "Notifica ON/OFF Allerta Free Cool./Heat."
    icon: mdi:light-switch-off

  vmc_master_notifica_allerta_umidita:                                         # [CONFIGURAZIONE PIU' RICHIAMI] [SCRIPT, PIU’ RICHIAMI] SENSORE PER ACCENDERE O SPEGNERE LA NOTIFICA AUDIO SULL'ALLERTA
    name: "Notifica ON/OFF Allerta Umidità"
    icon: mdi:light-switch-off

  vmc_master_notifica_allerta_black_out:                                       # [CONFIGURAZIONE PIU' RICHIAMI] [SCRIPT, PIU’ RICHIAMI] SENSORE PER ACCENDERE O SPEGNERE LA NOTIFICA AUDIO SULL'ALLERTA
    name: "Notifica ON/OFF Allerta Black-Out"
    icon: mdi:light-switch-off

  vmc_master_notifica_allerta_status_velocita:                                 # [CONFIGURAZIONE PIU' RICHIAMI] [SCRIPT, PIU’ RICHIAMI] SENSORE PER ACCENDERE O SPEGNERE LA NOTIFICA AUDIO SULL'ALLERTA
    name: "Notifica ON/OFF Status Velocità"
    icon: mdi:light-switch-off

  vmc_master_notifica_allerta_riepilogo:                                       # [CONFIGURAZIONE PIU' RICHIAMI] [SCRIPT, PIU’ RICHIAMI] SENSORE PER ACCENDERE O SPEGNERE LA NOTIFICA AUDIO SULL'ALLERTA
    name: "Notifica ON/OFF Riepilogo Allerte"
    icon: mdi:light-switch-off
################### Fine Creazione Switch Booleano impiegato nella riproduzione Audio, al Media Player Selezionato ##############################

################### Inizio Creazione Switch Booleano impiegato nell'Automazione, per l'Audio all'Avvio di Home Assistant ############################

  vmc_master_avvio_home_assistant_in_corso_per_audio:                         # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI] SENSORE TRACCIAMENTO AUDIO ALL'AVVIO DI HOME ASSISTANT PER LA LETTURA DEI VARI SENSORI
    name: "Spia Audio all'Avvio di Home Assistant"
    icon: mdi:memory

################### Fine Creazione Switch Booleano impiegato nell'Automazione, per l'Audio all'Avvio di Home Assistant ############################

################### Inizio Creazione input datetime per l'accensione e lo spegnimento della VMC per ogni giorno della settimana ###########################################################################################
input_datetime:
  vmc_master_accensione_lunedi:                                                # [CONFIGURAZIONE, PIU’ RICHIAMI] [INTERFACCIA, PIU’ RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI] 
    name: "Lun. 1°"
    has_date: false
    has_time: true
    icon: mdi:timer-play-outline

  vmc_master_spegnimento_lunedi:                                               # [CONFIGURAZIONE, PIU’ RICHIAMI] [INTERFACCIA, PIU’ RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI]
    name: "Lun. 1°"
    has_date: false
    has_time: true
    icon: mdi:timer-stop-outline

  vmc_master_accensione_lunedi_2:                                              # [CONFIGURAZIONE, PIU’ RICHIAMI] [INTERFACCIA, PIU’ RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI]
    name: "Lun. 2°"
    has_date: false
    has_time: true
    icon: mdi:timer-play-outline
    
  vmc_master_spegnimento_lunedi_2:                                             # [CONFIGURAZIONE, PIU’ RICHIAMI] [INTERFACCIA, PIU’ RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI]
    name: "Lun. 2°"
    has_date: false
    has_time: true
    icon: mdi:timer-stop-outline

  vmc_master_accensione_martedi:                                               # [CONFIGURAZIONE, PIU’ RICHIAMI] [INTERFACCIA, PIU’ RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI]
    name: "Mar. 1°"
    has_date: false
    has_time: true
    icon: mdi:timer-play-outline

  vmc_master_spegnimento_martedi:                                              # [CONFIGURAZIONE, PIU’ RICHIAMI] [INTERFACCIA, PIU’ RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI]
    name: "Mar. 1°"
    has_date: false
    has_time: true
    icon: mdi:timer-stop-outline
    
  vmc_master_accensione_martedi_2:                                             # [CONFIGURAZIONE, PIU’ RICHIAMI] [INTERFACCIA, PIU’ RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI]
    name: "Mar. 2°"
    has_date: false
    has_time: true
    icon: mdi:timer-play-outline
    
  vmc_master_spegnimento_martedi_2:                                            # [CONFIGURAZIONE, PIU’ RICHIAMI] [INTERFACCIA, PIU’ RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI]
    name: "Mar. 2°"
    has_date: false
    has_time: true
    icon: mdi:timer-stop-outline
    
  vmc_master_accensione_mercoledi:                                             # [CONFIGURAZIONE, PIU’ RICHIAMI] [INTERFACCIA, PIU’ RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI]
    name: "Mer. 1°"
    has_date: false
    has_time: true
    icon: mdi:timer-play-outline

  vmc_master_spegnimento_mercoledi:                                            # [CONFIGURAZIONE, PIU’ RICHIAMI] [INTERFACCIA, PIU’ RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI]
    name: "Mer. 1°"
    has_date: false
    has_time: true
    icon: mdi:timer-stop-outline

  vmc_master_accensione_mercoledi_2:                                           # [CONFIGURAZIONE, PIU’ RICHIAMI] [INTERFACCIA, PIU’ RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI]
    name: "Mer. 2°"
    has_date: false
    has_time: true
    icon: mdi:timer-play-outline
    
  vmc_master_spegnimento_mercoledi_2:                                          # [CONFIGURAZIONE, PIU’ RICHIAMI] [INTERFACCIA, PIU’ RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI]
    name: "Mer. 2°"
    has_date: false
    has_time: true
    icon: mdi:timer-stop-outline

  vmc_master_accensione_giovedi:                                               # [CONFIGURAZIONE, PIU’ RICHIAMI] [INTERFACCIA, PIU’ RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI]
    name: "Gio. 1°"
    has_date: false
    has_time: true
    icon: mdi:timer-play-outline

  vmc_master_spegnimento_giovedi:                                              # [CONFIGURAZIONE, PIU’ RICHIAMI] [INTERFACCIA, PIU’ RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI]
    name: "Gio. 1°"
    has_date: false
    has_time: true
    icon: mdi:timer-stop-outline

  vmc_master_accensione_giovedi_2:                                             # [CONFIGURAZIONE, PIU’ RICHIAMI] [INTERFACCIA, PIU’ RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI]
    name: "Gio. 2°"
    has_date: false
    has_time: true
    icon: mdi:timer-play-outline

  vmc_master_spegnimento_giovedi_2:                                            # [CONFIGURAZIONE, PIU’ RICHIAMI] [INTERFACCIA, PIU’ RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI]
    name: "Gio. 2°"
    has_date: false
    has_time: true
    icon: mdi:timer-stop-outline
    
  vmc_master_accensione_venerdi:                                               # [CONFIGURAZIONE, PIU’ RICHIAMI] [INTERFACCIA, PIU’ RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI]
    name: "Ven. 1°"
    has_date: false
    has_time: true
    icon: mdi:timer-play-outline

  vmc_master_spegnimento_venerdi:                                              # [CONFIGURAZIONE, PIU’ RICHIAMI] [INTERFACCIA, PIU’ RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI]
    name: "Ven. 1°"
    has_date: false
    has_time: true
    icon: mdi:timer-stop-outline

  vmc_master_accensione_venerdi_2:                                             # [CONFIGURAZIONE, PIU’ RICHIAMI] [INTERFACCIA, PIU’ RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI]
    name: "Ven. 2°"
    has_date: false
    has_time: true
    icon: mdi:timer-play-outline

  vmc_master_spegnimento_venerdi_2:                                            # [CONFIGURAZIONE, PIU’ RICHIAMI] [INTERFACCIA, PIU’ RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI]
    name: "Ven. 2°"
    has_date: false
    has_time: true
    icon: mdi:timer-stop-outline
    
  vmc_master_accensione_sabato:                                                # [CONFIGURAZIONE, PIU’ RICHIAMI] [INTERFACCIA, PIU’ RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI]
    name: "Sab. 1°"
    has_date: false
    has_time: true
    icon: mdi:timer-play-outline

  vmc_master_spegnimento_sabato:                                               # [CONFIGURAZIONE, PIU’ RICHIAMI] [INTERFACCIA, PIU’ RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI]
    name: "Sab. 1°"
    has_date: false
    has_time: true
    icon: mdi:timer-stop-outline

  vmc_master_accensione_sabato_2:                                              # [CONFIGURAZIONE, PIU’ RICHIAMI] [INTERFACCIA, PIU’ RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI]
    name: "Sab. 2°"
    has_date: false
    has_time: true
    icon: mdi:timer-play-outline
    
  vmc_master_spegnimento_sabato_2:                                             # [CONFIGURAZIONE, PIU’ RICHIAMI] [INTERFACCIA, PIU’ RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI]
    name: "Sab. 2°"
    has_date: false
    has_time: true
    icon: mdi:timer-stop-outline
    
  vmc_master_accensione_domenica:                                              # [CONFIGURAZIONE, PIU’ RICHIAMI] [INTERFACCIA, PIU’ RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI]
    name: "Dom. 1°"
    has_date: false
    has_time: true
    icon: mdi:timer-play-outline

  vmc_master_spegnimento_domenica:                                             # [CONFIGURAZIONE, PIU’ RICHIAMI] [INTERFACCIA, PIU’ RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI]
    name: "Dom. 1°"
    has_date: false
    has_time: true
    icon: mdi:timer-stop-outline

  vmc_master_accensione_domenica_2:                                            # [CONFIGURAZIONE, PIU’ RICHIAMI] [INTERFACCIA, PIU’ RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI]
    name: "Dom. 2°"
    has_date: false
    has_time: true
    icon: mdi:timer-play-outline
    
  vmc_master_spegnimento_domenica_2:                                           # [CONFIGURAZIONE, PIU’ RICHIAMI] [INTERFACCIA, PIU’ RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI]
    name: "Dom. 2°"
    has_date: false
    has_time: true
    icon: mdi:timer-stop-outline

  vmc_master_audio_start_time:                                                # [CONFIGURAZIONE, PIU’ RICHIAMI] [INTERFACCIA, PIU’ RICHIAMI] [AUTOMAZIONE, 0 RICHIAMI]
    name: Notifica Audio - Ora Inizio
    has_date: false
    has_time: true

  vmc_master_audio_end_time:                                                   # [CONFIGURAZIONE, PIU’ RICHIAMI] [INTERFACCIA, PIU’ RICHIAMI] [AUTOMAZIONE,0 RICHIAMI]
    name: Notifica Audio - Ora Fine
    has_date: false
    has_time: true
################### Fine Creazione input datetime per l'accensione e lo spegnimento della VMC per ogni giorno della settimana ###########################################################################################

################### Inizio Creazione Scripts ############################################################################################################################################################################
script:
################### Inizio Creazione Scripts SELEZIONA ENTITA' installate su Home Assistant ###################
  vmc_master_aggiorna_elenco_entita_temperatura_esterna:
    alias: VMC Master - Aggiorna Elenco Entità Temperatura Esterna
    sequence:
      # Aggiorna le opzioni dell'input_select con le entità di temperatura disponibili
      - service: input_select.set_options
        target:
          entity_id: input_select.vmc_master_selected_temp_external_entity
        data:
          options: >
            {% set temperatura_esterna_sensor_entities = states.sensor
              | selectattr('attributes.device_class', 'eq', 'temperature')
              | map(attribute='entity_id')
              | reject('search', '_temperatura_esterna_selezionata$')
              | reject('search', '_temperatura_interna_selezionata$')
              | list %}
  
            {% set temperatura_esterna_weather_entities = states.weather
              | selectattr('attributes.temperature', 'defined')
              | map(attribute='entity_id')
              | list %}
  
            {# Aggiungi manualmente il sensore specificato #}
            {% set temperatura_esterna_custom_entities = ['sensor.vmc_master_temp_esterna_status_senza_offset'] %}
  
            {% set temperatura_esterna_entities = temperatura_esterna_sensor_entities + temperatura_esterna_weather_entities + temperatura_esterna_custom_entities %}
  
            {% if "Aggiorna Elenco Entità Temperatura Esterna" not in temperatura_esterna_entities %}
              {{ ["Aggiorna Elenco Entità Temperatura Esterna"] + temperatura_esterna_entities }}
            {% else %}
              {{ temperatura_esterna_entities }}
            {% endif %}
      - delay: "00:00:02"
      # Verifica se l'entità selezionata è valida
      - choose:
          # Se l'entità temperatura selezionata non è valida
          - conditions:
              - condition: template
                value_template: >
                  {% set selected_temperatura_esterna_entity = states('input_select.vmc_master_selected_temp_external_entity') %}
                  {% set valid_options = state_attr('input_select.vmc_master_selected_temp_external_entity', 'options') %}
                  {{ selected_temperatura_esterna_entity not in valid_options or selected_temperatura_esterna_entity in ["Aggiorna Elenco Entità Temperatura Esterna", "", "sconosciuto", "unknown", none, "unavailable", "Non disponibile"] }}
            sequence:
              # Ripristina l'ultima entità temperatura selezionata se esiste ed è valida
              - choose:
                  - conditions:
                      - condition: template
                        value_template: >
                          {% set last_temperatura_esterna_entity = states('input_text.vmc_master_last_temp_external_entity') %}
                          {% set valid_options = state_attr('input_select.vmc_master_selected_temp_external_entity', 'options') %}
                          {{ last_temperatura_esterna_entity in valid_options and last_temperatura_esterna_entity not in ["sconosciuto", "unknown", "", none, "unavailable", "Non disponibile"] }}
                    sequence:
                      - service: input_select.select_option
                        target:
                          entity_id: input_select.vmc_master_selected_temp_external_entity
                        data:
                          option: "{{ states('input_text.vmc_master_last_temp_external_entity') }}"
              # Se l'ultima entità non è valida, imposta il valore su "Aggiorna Elenco Entità Temperatura Esterna" e invia una notifica
              - choose:
                  - conditions:
                      - condition: template
                        value_template: >
                          {% set last_temperatura_esterna_entity = states('input_text.vmc_master_last_temp_external_entity') %}
                          {% set valid_options = state_attr('input_select.vmc_master_selected_temp_external_entity', 'options') | reject('equalto', 'Aggiorna Elenco Entità Temperatura Esterna') | list %}
                          {{ (last_temperatura_esterna_entity not in valid_options or last_temperatura_esterna_entity in ["sconosciuto", "unknown", "", none, "unavailable", "Non disponibile"]) and states('vmc_master_status_ip_interfaccia')=='ON-Line' and states('input_boolean.vmc_master_notifica_status_vmc')=='on'}}
                    sequence:
                      - service: input_select.select_option
                        target:
                          entity_id: input_select.vmc_master_selected_temp_external_entity
                        data:
                          option: "Aggiorna Elenco Entità Temperatura Esterna"
                      - service: persistent_notification.create
                        data:
                          title: VMC "{{ states('sensor.vmc_master_nome_status') }}"
                          message: "Aggiornare Manualmente l'Entità Temperatura Esterna"
              # Aggiorna l'ultima entità temperatura selezionata
              - service: input_text.set_value
                target:
                  entity_id: input_text.vmc_master_last_temp_external_entity
                data:
                  value: "{{ states('input_select.vmc_master_selected_temp_external_entity') }}"
            alias: Seleziona o ripristina l'entità temperatura valida
          # Se l'entità temperatura selezionata è valida
          - conditions:
              - condition: template
                value_template: >
                  {% set selected_temperatura_esterna_entity = states('input_select.vmc_master_selected_temp_external_entity') %}
                  {% set valid_options = state_attr('input_select.vmc_master_selected_temp_external_entity', 'options') %}
                  {{ selected_temperatura_esterna_entity in valid_options and selected_temperatura_esterna_entity not in ["Aggiorna Elenco Entità Temperatura Esterna", "", "sconosciuto", "unknown", none, "unavailable", "Non disponibile"] }}
            sequence:
              - service: input_text.set_value
                target:
                  entity_id: input_text.vmc_master_last_temp_external_entity
                data:
                  value: "{{ states('input_select.vmc_master_selected_temp_external_entity') }}"
            alias: Aggiorna ultima entità temperatura valida
      - delay:
          hours: 0
          minutes: 0
          seconds: 3
          milliseconds: 0
      - service: homeassistant.update_entity
        target:
          entity_id:
            - input_select.vmc_master_selected_temp_external_entity
            - input_text.vmc_master_last_temp_external_entity
    mode: restart
    icon: mdi:fingerprint-off
    description: Permette di selezionare l'entità temperatura preferita tra tutte quelle installate in Home Assistant, inclusi i sensori meteo

  vmc_master_aggiorna_elenco_entita_temperatura_interna:
    alias: VMC Master - Aggiorna Elenco Entità Temperatura Interna
    sequence:
      # Aggiorna le opzioni dell'input_select con le entità di temperatura disponibili
      - service: input_select.set_options
        target:
          entity_id: input_select.vmc_master_selected_temp_internal_entity
        data:
          options: >
            {% set temperatura_interna_sensor_entities = states.sensor
              | selectattr('attributes.device_class', 'eq', 'temperature')
              | map(attribute='entity_id')
              | reject('search', '_temperatura_esterna_selezionata$')
              | reject('search', '_temperatura_interna_selezionata$')
              | list %}
  
            {# Aggiungi manualmente il sensore specificato #}
            {% set temperatura_interna_custom_entities = ['sensor.vmc_master_temp_interna_status_senza_offset'] %}
  
            {% set temperatura_interna_entities = temperatura_interna_sensor_entities + temperatura_interna_custom_entities %}
  
            {% if "Aggiorna Elenco Entità Temperatura Interna" not in temperatura_interna_entities %}
              {{ ["Aggiorna Elenco Entità Temperatura Interna"] + temperatura_interna_entities }}
            {% else %}
              {{ temperatura_interna_entities }}
            {% endif %}
      - delay: "00:00:02"
      # Verifica se l'entità selezionata è valida
      - choose:
          # Se l'entità temperatura selezionata non è valida
          - conditions:
              - condition: template
                value_template: >
                  {% set selected_temperatura_interna_entity = states('input_select.vmc_master_selected_temp_internal_entity') %}
                  {% set valid_options = state_attr('input_select.vmc_master_selected_temp_internal_entity', 'options') %}
                  {{ selected_temperatura_interna_entity not in valid_options or selected_temperatura_interna_entity in ["Aggiorna Elenco Entità Temperatura Interna", "", "sconosciuto", "unknown", none, "unavailable", "Non disponibile"] }}
            sequence:
              # Ripristina l'ultima entità temperatura selezionata se esiste ed è valida
              - choose:
                  - conditions:
                      - condition: template
                        value_template: >
                          {% set last_temperatura_interna_entity = states('input_text.vmc_master_last_temp_internal_entity') %}
                          {% set valid_options = state_attr('input_select.vmc_master_selected_temp_internal_entity', 'options') %}
                          {{ last_temperatura_interna_entity in valid_options and last_temperatura_interna_entity not in ["sconosciuto", "unknown", "", none, "unavailable", "Non disponibile"] }}
                    sequence:
                      - service: input_select.select_option
                        target:
                          entity_id: input_select.vmc_master_selected_temp_internal_entity
                        data:
                          option: "{{ states('input_text.vmc_master_last_temp_internal_entity') }}"
              # Se l'ultima entità non è valida, imposta il valore su "Aggiorna Elenco Entità Temperatura Interna" e invia una notifica
              - choose:
                  - conditions:
                      - condition: template
                        value_template: >
                          {% set last_temperatura_interna_entity = states('input_text.vmc_master_last_temp_internal_entity') %}
                          {% set valid_options = state_attr('input_select.vmc_master_selected_temp_internal_entity', 'options') | reject('equalto', 'Aggiorna Elenco Entità Temperatura Interna') | list %}
                          {{ (last_temperatura_interna_entity not in valid_options or last_temperatura_interna_entity in ["sconosciuto", "unknown", "", none, "unavailable", "Non disponibile"]) and states('vmc_master_status_ip_interfaccia')=='ON-Line' and states('input_boolean.vmc_master_notifica_status_vmc')=='on'}}
                    sequence:
                      - service: input_select.select_option
                        target:
                          entity_id: input_select.vmc_master_selected_temp_internal_entity
                        data:
                          option: "Aggiorna Elenco Entità Temperatura Interna"
                      - service: persistent_notification.create
                        data:
                          title: VMC "{{ states('sensor.vmc_master_nome_status') }}"
                          message: "Aggiornare Manualmente l'Entità Temperatura Interna"
              # Aggiorna l'ultima entità temperatura selezionata
              - service: input_text.set_value
                target:
                  entity_id: input_text.vmc_master_last_temp_internal_entity
                data:
                  value: "{{ states('input_select.vmc_master_selected_temp_internal_entity') }}"
            alias: Seleziona o ripristina l'entità temperatura valida
          # Se l'entità temperatura selezionata è valida
          - conditions:
              - condition: template
                value_template: >
                  {% set selected_temperatura_interna_entity = states('input_select.vmc_master_selected_temp_internal_entity') %}
                  {% set valid_options = state_attr('input_select.vmc_master_selected_temp_internal_entity', 'options') %}
                  {{ selected_temperatura_interna_entity in valid_options and selected_temperatura_interna_entity not in ["Aggiorna Elenco Entità Temperatura Interna", "", "sconosciuto", "unknown", none, "unavailable", "Non disponibile"] }}
            sequence:
              - service: input_text.set_value
                target:
                  entity_id: input_text.vmc_master_last_temp_internal_entity
                data:
                  value: "{{ states('input_select.vmc_master_selected_temp_internal_entity') }}"
            alias: Aggiorna ultima entità temperatura valida
      - delay:
          hours: 0
          minutes: 0
          seconds: 3
          milliseconds: 0
      - service: homeassistant.update_entity
        target:
          entity_id:
            - input_select.vmc_master_selected_temp_internal_entity
            - input_text.vmc_master_last_temp_internal_entity
    mode: restart
    icon: mdi:fingerprint-off
    description: Permette di selezionare l'entità temperatura preferita tra tutte quelle installate in Home Assistant

  vmc_master_aggiorna_elenco_entita_umidita_esterna:
    alias: VMC Master - Aggiorna Elenco Entità Umidità Esterna
    sequence:
      # Aggiorna le opzioni dell'input_select con le entità di umidità disponibili
      - service: input_select.set_options
        target:
          entity_id: input_select.vmc_master_selected_humidity_external_entity
        data:
          options: >
            {% set umidita_esterna_sensor_entities = states.sensor
              | selectattr('attributes.device_class', 'eq', 'humidity')
              | map(attribute='entity_id')
              | reject('search', '_umidita_esterna_selezionata$')
              | reject('search', '_umidita_interna_selezionata$')
              | list %}
  
            {% set umidita_esterna_weather_entities = states.weather
              | selectattr('attributes.humidity', 'defined')
              | map(attribute='entity_id')
              | list %}
  
            {% set umidita_esterna_entities = umidita_esterna_sensor_entities + umidita_esterna_weather_entities %}
  
            {% if "Aggiorna Elenco Entità Umidità Esterna" not in umidita_esterna_entities %}
              {{ ["Aggiorna Elenco Entità Umidità Esterna"] + umidita_esterna_entities }}
            {% else %}
              {{ umidita_esterna_entities }}
            {% endif %}
      - delay: "00:00:02"
      # Verifica se l'entità selezionata è valida
      - choose:
          # Se l'entità umidità selezionata non è valida
          - conditions:
              - condition: template
                value_template: >
                  {% set selected_umidita_esterna_entity = states('input_select.vmc_master_selected_humidity_external_entity') %}
                  {% set valid_options = state_attr('input_select.vmc_master_selected_humidity_external_entity', 'options') %}
                  {{ selected_umidita_esterna_entity not in valid_options or selected_umidita_esterna_entity in ["Aggiorna Elenco Entità Umidità Esterna", "", "sconosciuto", "unknown", none, "unavailable", "Non disponibile"] }}
            sequence:
              # Ripristina l'ultima entità umidità selezionata se esiste ed è valida
              - choose:
                  - conditions:
                      - condition: template
                        value_template: >
                          {% set last_umidita_esterna_entity = states('input_text.vmc_master_last_humidity_external_entity') %}
                          {% set valid_options = state_attr('input_select.vmc_master_selected_humidity_external_entity', 'options') %}
                          {{ last_umidita_esterna_entity in valid_options and last_umidita_esterna_entity not in ["sconosciuto", "unknown", "", none, "unavailable", "Non disponibile"] }}
                    sequence:
                      - service: input_select.select_option
                        target:
                          entity_id: input_select.vmc_master_selected_humidity_external_entity
                        data:
                          option: "{{ states('input_text.vmc_master_last_humidity_external_entity') }}"
              # Se l'ultima entità non è valida, imposta il valore su "Aggiorna Elenco Entità Umidità Esterna" e invia una notifica
              - choose:
                  - conditions:
                      - condition: template
                        value_template: >
                          {% set last_umidita_esterna_entity = states('input_text.vmc_master_last_humidity_external_entity') %}
                          {% set valid_options = state_attr('input_select.vmc_master_selected_humidity_external_entity', 'options') | reject('equalto', 'Aggiorna Elenco Entità Umidità Esterna') | list %}
                          {{ (last_umidita_esterna_entity not in valid_options or last_umidita_esterna_entity in ["sconosciuto", "unknown", "", none, "unavailable", "Non disponibile"]) and states('vmc_master_status_ip_interfaccia')=='ON-Line' and states('input_boolean.vmc_master_notifica_status_vmc')=='on'}}
                    sequence:
                      - service: input_select.select_option
                        target:
                          entity_id: input_select.vmc_master_selected_humidity_external_entity
                        data:
                          option: "Aggiorna Elenco Entità Umidità Esterna"
                      - service: persistent_notification.create
                        data:
                          title: VMC "{{ states('sensor.vmc_master_nome_status') }}"
                          message: "Aggiornare Manualmente l'Entità Umidità Esterna"
              # Aggiorna l'ultima entità umidità selezionata
              - service: input_text.set_value
                target:
                  entity_id: input_text.vmc_master_last_humidity_external_entity
                data:
                  value: "{{ states('input_select.vmc_master_selected_humidity_external_entity') }}"
            alias: Seleziona o ripristina l'entità umidità valida
          # Se l'entità umidità selezionata è valida
          - conditions:
              - condition: template
                value_template: >
                  {% set selected_umidita_esterna_entity = states('input_select.vmc_master_selected_humidity_external_entity') %}
                  {% set valid_options = state_attr('input_select.vmc_master_selected_humidity_external_entity', 'options') %}
                  {{ selected_umidita_esterna_entity in valid_options and selected_umidita_esterna_entity not in ["Aggiorna Elenco Entità Umidità Esterna", "", "sconosciuto", "unknown", none, "unavailable", "Non disponibile"] }}
            sequence:
              - service: input_text.set_value
                target:
                  entity_id: input_text.vmc_master_last_humidity_external_entity
                data:
                  value: "{{ states('input_select.vmc_master_selected_humidity_external_entity') }}"
            alias: Aggiorna ultima entità umidità valida
      - delay:
          hours: 0
          minutes: 0
          seconds: 3
          milliseconds: 0
      - service: homeassistant.update_entity
        target:
          entity_id:
            - input_select.vmc_master_selected_humidity_external_entity
            - input_text.vmc_master_last_humidity_external_entity
    mode: restart
    icon: mdi:fingerprint-off
    description: Permette di selezionare l'entità umidità preferita tra tutte quelle installate in Home Assistant, inclusi i sensori meteo

  vmc_master_aggiorna_elenco_entita_umidita_interna:
    alias: VMC Master - Aggiorna Elenco Entità Umidità Interna
    sequence:
      # Aggiorna le opzioni dell'input_select con le entità di umidità disponibili
      - service: input_select.set_options
        target:
          entity_id: input_select.vmc_master_selected_humidity_internal_entity
        data:
          options: >
            {% set umidita_interna_sensor_entities = states.sensor
              | selectattr('attributes.device_class', 'eq', 'humidity')
              | map(attribute='entity_id')
              | reject('search', '_umidita_esterna_selezionata$')
              | reject('search', '_umidita_interna_selezionata$')
              | list %}
  
            {# Aggiungi manualmente il sensore specificato #}
            {% set umidita_interna_custom_entities = ['sensor.vmc_master_umidita_interna_status_senza_offset'] %}
  
            {% set umidita_interna_entities = umidita_interna_sensor_entities + umidita_interna_custom_entities %}
  
            {% if "Aggiorna Elenco Entità Umidità Interna" not in umidita_interna_entities %}
              {{ ["Aggiorna Elenco Entità Umidità Interna"] + umidita_interna_entities }}
            {% else %}
              {{ umidita_interna_entities }}
            {% endif %}
      - delay: "00:00:02"
      # Verifica se l'entità selezionata è valida
      - choose:
          # Se l'entità umidità selezionata non è valida
          - conditions:
              - condition: template
                value_template: >
                  {% set selected_umidita_interna_entity = states('input_select.vmc_master_selected_humidity_internal_entity') %}
                  {% set valid_options = state_attr('input_select.vmc_master_selected_humidity_internal_entity', 'options') %}
                  {{ selected_umidita_interna_entity not in valid_options or selected_umidita_interna_entity in ["Aggiorna Elenco Entità Umidità Interna", "", "sconosciuto", "unknown", none, "unavailable", "Non disponibile"] }}
            sequence:
              # Ripristina l'ultima entità umidità selezionata se esiste ed è valida
              - choose:
                  - conditions:
                      - condition: template
                        value_template: >
                          {% set last_umidita_interna_entity = states('input_text.vmc_master_last_humidity_internal_entity') %}
                          {% set valid_options = state_attr('input_select.vmc_master_selected_humidity_internal_entity', 'options') %}
                          {{ last_umidita_interna_entity in valid_options and last_umidita_interna_entity not in ["sconosciuto", "unknown", "", none, "unavailable", "Non disponibile"] }}
                    sequence:
                      - service: input_select.select_option
                        target:
                          entity_id: input_select.vmc_master_selected_humidity_internal_entity
                        data:
                          option: "{{ states('input_text.vmc_master_last_humidity_internal_entity') }}"
              # Se l'ultima entità non è valida, imposta il valore su "Aggiorna Elenco Entità Umidità Interna" e invia una notifica
              - choose:
                  - conditions:
                      - condition: template
                        value_template: >
                          {% set last_umidita_interna_entity = states('input_text.vmc_master_last_humidity_internal_entity') %}
                          {% set valid_options = state_attr('input_select.vmc_master_selected_humidity_internal_entity', 'options') | reject('equalto', 'Aggiorna Elenco Entità Umidità Interna') | list %}
                          {{ (last_umidita_interna_entity not in valid_options or last_umidita_interna_entity in ["sconosciuto", "unknown", "", none, "unavailable", "Non disponibile"]) and states('vmc_master_status_ip_interfaccia')=='ON-Line' and states('input_boolean.vmc_master_notifica_status_vmc')=='on'}}
                    sequence:
                      - service: input_select.select_option
                        target:
                          entity_id: input_select.vmc_master_selected_humidity_internal_entity
                        data:
                          option: "Aggiorna Elenco Entità Umidità Interna"
                      - service: persistent_notification.create
                        data:
                          title: VMC "{{ states('sensor.vmc_master_nome_status') }}"
                          message: "Aggiornare Manualmente l'Entità Umidità Interna"
              # Aggiorna l'ultima entità umidità selezionata
              - service: input_text.set_value
                target:
                  entity_id: input_text.vmc_master_last_humidity_internal_entity
                data:
                  value: "{{ states('input_select.vmc_master_selected_humidity_internal_entity') }}"
            alias: Seleziona o ripristina l'entità umidità valida
          # Se l'entità umidità selezionata è valida
          - conditions:
              - condition: template
                value_template: >
                  {% set selected_umidita_interna_entity = states('input_select.vmc_master_selected_humidity_internal_entity') %}
                  {% set valid_options = state_attr('input_select.vmc_master_selected_humidity_internal_entity', 'options') %}
                  {{ selected_umidita_interna_entity in valid_options and selected_umidita_interna_entity not in ["Aggiorna Elenco Entità Umidità Interna", "", "sconosciuto", "unknown", none, "unavailable", "Non disponibile"] }}
            sequence:
              - service: input_text.set_value
                target:
                  entity_id: input_text.vmc_master_last_humidity_internal_entity
                data:
                  value: "{{ states('input_select.vmc_master_selected_humidity_internal_entity') }}"
            alias: Aggiorna ultima entità umidità valida
      - delay:
          hours: 0
          minutes: 0
          seconds: 3
          milliseconds: 0
      - service: homeassistant.update_entity
        target:
          entity_id:
            - input_select.vmc_master_selected_humidity_internal_entity
            - input_text.vmc_master_last_humidity_internal_entity
    mode: restart
    icon: mdi:fingerprint-off
    description: Permette di selezionare l'entità umidità preferita tra tutte quelle installate in Home Assistant

  vmc_master_aggiorna_elenco_entita_co2_interna:
    alias: VMC Master - Aggiorna Elenco Entità Anidride Carbonica Interna
    sequence:
      - service: input_select.set_options
        target:
          entity_id: input_select.vmc_master_selected_co2_internal_entity
        data:
          options: >
            {% set co2_interna_sensor_entities = states.sensor
              | selectattr('attributes.device_class', 'eq', 'carbon_dioxide')
              | map(attribute='entity_id')
              | reject('search', '_co2_interna_selezionata$')
              | list %}
    
            {% set co2_interna_custom_entities = ['sensor.vmc_master_co2_status_senza_offset'] %}
    
            {% set co2_interna_entities = co2_interna_sensor_entities + co2_interna_custom_entities %}
    
            {% if "Aggiorna Elenco Entità CO₂ Interna" not in co2_interna_entities %}
              {{ ["Aggiorna Elenco Entità CO₂ Interna"] + co2_interna_entities }}
            {% else %}
              {{ co2_interna_entities }}
            {% endif %}
      - delay: "00:00:02"
      - choose:
          - conditions:
              - condition: template
                value_template: >
                  {% set selected_co2_interna_entity = states('input_select.vmc_master_selected_co2_internal_entity') %}
                  {% set valid_options = state_attr('input_select.vmc_master_selected_co2_internal_entity', 'options') %}
                  {{ selected_co2_interna_entity not in valid_options or selected_co2_interna_entity in ["Aggiorna Elenco Entità CO₂ Interna", "", "sconosciuto", "unknown", none, "unavailable", "Non disponibile"] }}
            sequence:
              - choose:
                  - conditions:
                      - condition: template
                        value_template: >
                          {% set last_co2_interna_entity = states('input_text.vmc_master_last_co2_internal_entity') %}
                          {% set valid_options = state_attr('input_select.vmc_master_selected_co2_internal_entity', 'options') %}
                          {{ last_co2_interna_entity in valid_options and last_co2_interna_entity not in ["sconosciuto", "unknown", "", none, "unavailable", "Non disponibile"] }}
                    sequence:
                      - service: input_select.select_option
                        target:
                          entity_id: input_select.vmc_master_selected_co2_internal_entity
                        data:
                          option: "{{ states('input_text.vmc_master_last_co2_internal_entity') }}"
              - choose:
                  - conditions:
                      - condition: template
                        value_template: >
                          {% set last_co2_interna_entity = states('input_text.vmc_master_last_co2_internal_entity') %}
                          {% set valid_options = state_attr('input_select.vmc_master_selected_co2_internal_entity', 'options') | reject('equalto', 'Aggiorna Elenco Entità CO₂ Interna') | list %}
                          {{ (last_co2_interna_entity not in valid_options or last_co2_interna_entity in ["sconosciuto", "unknown", "", none, "unavailable", "Non disponibile"]) and states('vmc_master_status_ip_interfaccia')=='ON-Line' and states('input_boolean.vmc_master_notifica_status_vmc')=='on'}}
                    sequence:
                      - service: input_select.select_option
                        target:
                          entity_id: input_select.vmc_master_selected_co2_internal_entity
                        data:
                          option: "Aggiorna Elenco Entità CO₂ Interna"
                      - service: persistent_notification.create
                        data:
                          title: VMC "{{ states('sensor.vmc_master_nome_status') }}"
                          message: "Aggiornare Manualmente l'Entità CO2 Interna"
              - service: input_text.set_value
                target:
                  entity_id: input_text.vmc_master_last_co2_internal_entity
                data:
                  value: "{{ states('input_select.vmc_master_selected_co2_internal_entity') }}"
            alias: Seleziona o ripristina l'entità anidride carbonica valida
          - conditions:
              - condition: template
                value_template: >
                  {% set selected_co2_interna_entity = states('input_select.vmc_master_selected_co2_internal_entity') %}
                  {% set valid_options = state_attr('input_select.vmc_master_selected_co2_internal_entity', 'options') %}
                  {{ selected_co2_interna_entity in valid_options and selected_co2_interna_entity not in ["Aggiorna Elenco Entità CO₂ Interna", "", "sconosciuto", "unknown", none, "unavailable", "Non disponibile"] }}
            sequence:
              - service: input_text.set_value
                target:
                  entity_id: input_text.vmc_master_last_co2_internal_entity
                data:
                  value: "{{ states('input_select.vmc_master_selected_co2_internal_entity') }}"
            alias: Aggiorna ultima entità anidride carbonica valida
      - delay:
          hours: 0
          minutes: 0
          seconds: 3
          milliseconds: 0
      - service: homeassistant.update_entity
        target:
          entity_id:
            - input_select.vmc_master_selected_co2_internal_entity
            - input_text.vmc_master_last_co2_internal_entity
    mode: restart
    icon: mdi:fingerprint-off
    description: Permette di selezionare l'entità anidride carbonica preferita tra tutte quelle installate in Home Assistant

  vmc_master_aggiorna_elenco_entita_notifica_dispositivo:
    alias: VMC Master - Aggiorna Elenco Entità Notifica Dispositivo
    sequence:
      - service: input_select.set_options
        target:
          entity_id: input_select.vmc_master_selected_notification_device
        data:
          options: >
            {% set mobile_app_notify_entities = integration_entities('mobile_app')
              | select('match','device_tracker')
              | map('state_attr','friendly_name')
              | map('slugify')
              | map('regex_replace', '^','')
              | list %}
  
            {% if "Aggiorna Elenco Dispositivi per Invio Notifica" not in mobile_app_notify_entities %}
              {{ ["Aggiorna Elenco Dispositivi per Invio Notifica"] + mobile_app_notify_entities }}
            {% else %}
              {{ mobile_app_notify_entities }}
            {% endif %}
      - delay: "00:00:02"
      - choose:
          - conditions:
              - condition: template
                value_template: >
                  {% set selected_notification_device = states('input_select.vmc_master_selected_notification_device') %}
                  {% set valid_options = state_attr('input_select.vmc_master_selected_notification_device', 'options') %}
                  {{ selected_notification_device not in valid_options or selected_notification_device in ["Aggiorna Elenco Dispositivi per Invio Notifica", "", "sconosciuto", "unknown", none, "unavailable", "Non disponibile"] }}
            sequence:
              - choose:
                  - conditions:
                      - condition: template
                        value_template: >
                          {% set last_notification_device = states('input_text.vmc_master_last_notification_device') %}
                          {% set valid_options = state_attr('input_select.vmc_master_selected_notification_device', 'options') %}
                          {{ last_notification_device in valid_options and last_notification_device not in ["sconosciuto", "unknown", "", none, "unavailable", "Non disponibile"] }}
                    sequence:
                      - service: input_select.select_option
                        target:
                          entity_id: input_select.vmc_master_selected_notification_device
                        data:
                          option: "{{ states('input_text.vmc_master_last_notification_device') }}"
              - choose:
                  - conditions:
                      - condition: template
                        value_template: >
                          {% set last_notification_device = states('input_text.vmc_master_last_notification_device') %}
                          {% set valid_options = state_attr('input_select.vmc_master_selected_notification_device', 'options') | reject('equalto', 'Aggiorna Elenco Dispositivi per Invio Notifica') | list %}
                          {{ (last_notification_device not in valid_options or last_notification_device in ["sconosciuto", "unknown", "", none, "unavailable", "Non disponibile"]) and states('vmc_master_status_ip_interfaccia')=='ON-Line' and states('input_boolean.vmc_master_notifica_status_vmc')=='on'}}
                    sequence:
                      - service: input_select.select_option
                        target:
                          entity_id: input_select.vmc_master_selected_notification_device
                        data:
                          option: "Aggiorna Elenco Dispositivi per Invio Notifica"
                      - service: persistent_notification.create
                        data:
                          title: VMC "{{ states('sensor.vmc_master_nome_status') }}"
                          message: "Aggiornare Manualmente l'Entità Dispositivo di Notifica"
              - service: input_text.set_value
                target:
                  entity_id: input_text.vmc_master_last_notification_device
                data:
                  value: "{{ states('input_select.vmc_master_selected_notification_device') }}"
            alias: Seleziona o ripristina l'entità dispositivo di notifica valida
          - conditions:
              - condition: template
                value_template: >
                  {% set selected_notification_device = states('input_select.vmc_master_selected_notification_device') %}
                  {% set valid_options = state_attr('input_select.vmc_master_selected_notification_device', 'options') %}
                  {{ selected_notification_device in valid_options and selected_notification_device not in ["Aggiorna Elenco Dispositivi per Invio Notifica", "", "sconosciuto", "unknown", none, "unavailable", "Non disponibile"] }}
            sequence:
              - service: input_text.set_value
                target:
                  entity_id: input_text.vmc_master_last_notification_device
                data:
                  value: "{{ states('input_select.vmc_master_selected_notification_device') }}"
            alias: Aggiorna ultima entità dispositivo di notifica valida
      - delay:
          hours: 0
          minutes: 0
          seconds: 3
          milliseconds: 0
      - service: homeassistant.update_entity
        target:
          entity_id:
            - input_select.vmc_master_selected_notification_device
            - input_text.vmc_master_last_notification_device
    mode: restart
    icon: mdi:fingerprint-off
    description: Permette di selezionare l'entità dispositivo di notifica preferita tra tutte quelle disponibili tramite l'integrazione Mobile App.

  vmc_master_aggiorna_elenco_entita_media_player:
    alias: VMC Master - Aggiorna Elenco Entità Media Player
    sequence:
      # 1️⃣ Aggiorna le opzioni dell'input_select con i media player disponibili
      - service: input_select.set_options
        target:
          entity_id: input_select.vmc_master_selected_media_player_entity
        data:
          options: >
            {% set media_players = states.media_player | map(attribute='entity_id') | list | default([]) %}
            {% if "Aggiorna Elenco Media Player" not in media_players %}
              {{ ["Aggiorna Elenco Media Player"] + media_players }}
            {% else %}
              {{ media_players }}
            {% endif %}
      - delay: "00:00:02"
  
      # 2️⃣ Gestione selezione entità valida o fallback
      - choose:
          - conditions:
              - condition: template
                value_template: >
                  {% set selected_mp = states('input_select.vmc_master_selected_media_player_entity') %}
                  {% set valid_options = state_attr('input_select.vmc_master_selected_media_player_entity', 'options') %}
                  {{ selected_mp not in valid_options or selected_mp in ["Aggiorna Elenco Media Player", "", "sconosciuto", "unknown", none, "unavailable", "Non disponibile"] }}
            sequence:
              - choose:
                  - conditions:
                      - condition: template
                        value_template: >
                          {% set last_mp = states('input_text.vmc_master_last_media_player_entity') %}
                          {% set valid_options = state_attr('input_select.vmc_master_selected_media_player_entity', 'options') %}
                          {{ last_mp in valid_options and last_mp not in ["sconosciuto", "unknown", "", none, "unavailable", "Non disponibile"] }}
                    sequence:
                      - service: input_select.select_option
                        target:
                          entity_id: input_select.vmc_master_selected_media_player_entity
                        data:
                          option: "{{ states('input_text.vmc_master_last_media_player_entity') }}"
              - choose:
                  - conditions:
                      - condition: template
                        value_template: >
                          {% set last_mp = states('input_text.vmc_master_last_media_player_entity') %}
                          {% set valid_options = state_attr('input_select.vmc_master_selected_media_player_entity', 'options') 
                            | reject('equalto', 'Aggiorna Elenco Media Player') | list %}
                          {{ (last_mp not in valid_options or last_mp in ["sconosciuto", "unknown", "", none, "unavailable", "Non disponibile"]) and states('vmc_master_status_ip_interfaccia')=='ON-Line' and states('input_boolean.vmc_master_notifica_status_vmc')=='on'}}
                    sequence:
                      - service: input_select.select_option
                        target:
                          entity_id: input_select.vmc_master_selected_media_player_entity
                        data:
                          option: "Aggiorna Elenco Media Player"
                      - service: persistent_notification.create
                        data:
                          title: VMC "{{ states('sensor.vmc_master_nome_status') }}"
                          message: "Aggiornare Manualmente l'Entità Media Player"
              - service: input_text.set_value
                target:
                  entity_id: input_text.vmc_master_last_media_player_entity
                data:
                  value: "{{ states('input_select.vmc_master_selected_media_player_entity') }}"
            alias: Seleziona o ripristina l'entità media player valida
  
          - conditions:
              - condition: template
                value_template: >
                  {% set selected_mp = states('input_select.vmc_master_selected_media_player_entity') %}
                  {% set valid_options = state_attr('input_select.vmc_master_selected_media_player_entity', 'options') %}
                  {{ selected_mp in valid_options and selected_mp not in ["Aggiorna Elenco Media Player", "", "sconosciuto", "unknown", none, "unavailable", "Non disponibile"] }}
            sequence:
              - service: input_text.set_value
                target:
                  entity_id: input_text.vmc_master_last_media_player_entity
                data:
                  value: "{{ states('input_select.vmc_master_selected_media_player_entity') }}"
            alias: Aggiorna ultima entità media player valida
  
      - delay: "00:00:03"
  
      # 3️⃣ Aggiorna le entità in Home Assistant
      - service: homeassistant.update_entity
        target:
          entity_id:
            - input_select.vmc_master_selected_media_player_entity
            - input_text.vmc_master_last_media_player_entity
  
    mode: restart
    icon: mdi:fingerprint-off
    description: >
      Permette di selezionare l'entità Media Player preferita tra quelle installate.
      L'opzione "Aggiorna Elenco Media Player" serve per aggiornare manualmente la lista.
      Mostra una notifica persistente se l'entità selezionata non è più valida.
################### Fine Creazione Scripts SELEZIONA ENTITA' installate su Home Assistant #####################

################### Inzio Creazione Scripts Invio Notifiche su Mobile installate su Home Assistant ###################
  # --- Errore Temperatura Esterna ---
  vmc_master_notifica_errore_temp_esterna:
    alias: VMC Master - Invia notifica Errore Temp. Esterna
    sequence:
      - choose:
          - conditions:
              - condition: template
                value_template: >
                  {% set device = states('input_select.vmc_master_selected_notification_device') %}
                  {% set invalid_device = ["Aggiorna Elenco Dispositivi per Invio Notifica", "", "sconosciuto", "unknown", none, "unavailable", "Non disponibile"] %}
                  {{ device not in invalid_device }}
            sequence:
              - service: notify.mobile_app_{{ states('input_select.vmc_master_selected_notification_device') }}
                data:
                  title: >-
                    VMC {{ states('sensor.vmc_master_nome_status') }}
                  message: >-
                    Non Disponibile: {{ states('input_text.vmc_master_last_temp_external_entity') }}
  
                    Impiegato per il rilevamento: {{ state_attr('sensor.vmc_master_temp_esterna_status', 'friendly_name') }}
  
                    Data: {{ now().strftime('%d-%m-%Y') }}
                    Ora: {{ now().strftime('%H:%M:%S') }}
    icon: mdi:fingerprint-off
    mode: restart
  
  # --- Errore Temperatura Interna ---
  vmc_master_notifica_errore_temp_interna:
    alias: VMC Master - Invia notifica Errore Temp. Interna
    sequence:
      - choose:
          - conditions:
              - condition: template
                value_template: >
                  {% set device = states('input_select.vmc_master_selected_notification_device') %}
                  {% set invalid_device = ["Aggiorna Elenco Dispositivi per Invio Notifica", "", "sconosciuto", "unknown", none, "unavailable", "Non disponibile"] %}
                  {{ device not in invalid_device }}
            sequence:
              - service: notify.mobile_app_{{ states('input_select.vmc_master_selected_notification_device') }}
                data:
                  title: >-
                    VMC {{ states('sensor.vmc_master_nome_status') }}
                  message: >-
                    Non Disponibile: {{ states('input_text.vmc_master_last_temp_internal_entity') }}
  
                    Impiegato per il rilevamento: {{ state_attr('sensor.vmc_master_temp_interna_status', 'friendly_name') }}
  
                    Data: {{ now().strftime('%d-%m-%Y') }}
                    Ora: {{ now().strftime('%H:%M:%S') }}
    icon: mdi:fingerprint-off
    mode: restart
  
  # --- Errore Umidità Esterna ---
  vmc_master_notifica_errore_umidita_esterna:
    alias: VMC Master - Invia notifica Errore Umidità Esterna
    sequence:
      - choose:
          - conditions:
              - condition: template
                value_template: >
                  {% set device = states('input_select.vmc_master_selected_notification_device') %}
                  {% set invalid_device = ["Aggiorna Elenco Dispositivi per Invio Notifica", "", "sconosciuto", "unknown", none, "unavailable", "Non disponibile"] %}
                  {{ device not in invalid_device }}
            sequence:
              - service: notify.mobile_app_{{ states('input_select.vmc_master_selected_notification_device') }}
                data:
                  title: >-
                    VMC {{ states('sensor.vmc_master_nome_status') }}
                  message: >-
                    Non Disponibile: {{ states('input_text.vmc_master_last_humidity_external_entity') }}
  
                    Impiegato per il rilevamento: {{ state_attr('sensor.vmc_master_umidita_esterna_status', 'friendly_name') }}
  
                    Data: {{ now().strftime('%d-%m-%Y') }}
                    Ora: {{ now().strftime('%H:%M:%S') }}
    icon: mdi:fingerprint-off
    mode: restart
  
  # --- Errore Umidità Interna ---
  vmc_master_notifica_errore_umidita_interna:
    alias: VMC Master - Invia notifica Errore Umidità Interna
    sequence:
      - choose:
          - conditions:
              - condition: template
                value_template: >
                  {% set device = states('input_select.vmc_master_selected_notification_device') %}
                  {% set invalid_device = ["Aggiorna Elenco Dispositivi per Invio Notifica", "", "sconosciuto", "unknown", none, "unavailable", "Non disponibile"] %}
                  {{ device not in invalid_device }}
            sequence:
              - service: notify.mobile_app_{{ states('input_select.vmc_master_selected_notification_device') }}
                data:
                  title: >-
                    VMC {{ states('sensor.vmc_master_nome_status') }}
                  message: >-
                    Non Disponibile: {{ states('input_text.vmc_master_last_humidity_internal_entity') }}
  
                    Impiegato per il rilevamento: {{ state_attr('sensor.vmc_master_umidita_interna_status', 'friendly_name') }}
  
                    Data: {{ now().strftime('%d-%m-%Y') }}
                    Ora: {{ now().strftime('%H:%M:%S') }}
    icon: mdi:fingerprint-off
    mode: restart
  
  # --- Errore CO2 Interna ---
  vmc_master_notifica_errore_co2_interna:
    alias: VMC Master - Invia notifica Errore CO₂ Interna
    sequence:
      - choose:
          - conditions:
              - condition: template
                value_template: >
                  {% set device = states('input_select.vmc_master_selected_notification_device') %}
                  {% set invalid_device = ["Aggiorna Elenco Dispositivi per Invio Notifica", "", "sconosciuto", "unknown", none, "unavailable", "Non disponibile"] %}
                  {{ device not in invalid_device }}
            sequence:
              - service: notify.mobile_app_{{ states('input_select.vmc_master_selected_notification_device') }}
                data:
                  title: >-
                    VMC {{ states('sensor.vmc_master_nome_status') }}
                  message: >-
                    Non Disponibile: {{ states('input_text.vmc_master_last_co2_internal_entity') }}
  
                    Impiegato per il rilevamento: {{ state_attr('sensor.vmc_master_co2_status', 'friendly_name') }}
  
                    Data: {{ now().strftime('%d-%m-%Y') }}
                    Ora: {{ now().strftime('%H:%M:%S') }}
    icon: mdi:fingerprint-off
    mode: restart
  
  # --- Cambio Filtro ---
  vmc_master_notifica_cambio_filtro:
    alias: VMC Master - Invia notifica Cambio Filtro
    sequence:
      - choose:
          - conditions:
              - condition: template
                value_template: >
                  {% set device = states('input_select.vmc_master_selected_notification_device') %}
                  {% set invalid_device = ["Aggiorna Elenco Dispositivi per Invio Notifica", "", "sconosciuto", "unknown", none, "unavailable", "Non disponibile"] %}
                  {{ device not in invalid_device }}
            sequence:
              - service: notify.mobile_app_{{ states('input_select.vmc_master_selected_notification_device') }}
                data:
                  title: >-
                    VMC {{ states('sensor.vmc_master_nome_status') }}
                  message: >-
                    Avviso ogni 24 ore: Verificare Filtro
  
                    Data: {{ now().strftime('%d-%m-%Y') }}
                    Ora: {{ now().strftime('%H:%M:%S') }}
    icon: mdi:fingerprint-off
    mode: restart

  vmc_master_notifica_velocita_0:
    alias: VMC Master - Invia notifica Velocità 0
    sequence:
      - choose:
          - conditions:
              - condition: template
                value_template: >
                  {{ states('input_select.vmc_master_selected_notification_device') not in 
                     ["Aggiorna Elenco Dispositivi per Invio Notifica", "", "sconosciuto", "unknown", none, "unavailable", "Non disponibile"] }}
            sequence:
              - service: notify.mobile_app_{{ states('input_select.vmc_master_selected_notification_device') }}
                data:
                  title: >-
                    VMC {{ states('sensor.vmc_master_nome_status') }}
                  message: >-
                    {{
                    states('sensor.vmc_master_status_ventola_lettura_codice_interpretato_interfaccia')
                    }}: in data {{ now().strftime('%d-%m-%Y') }} alle {{
                    now().strftime('%H:%M:%S') }}
  
                    Livello di Concentrazione CO₂ [ppm]: {{
                    states('sensor.vmc_master_co2_status_verifica_soglia') }}
  
                    Livello di Concentrazione VOC [ppb]: {{
                    states('sensor.vmc_master_voc_status_verifica_soglia') }}
                    
                    Superamento Lim. Δ Punto di Rugiada: {{
                    states('sensor.vmc_master_alert_monitoraggio_pdr') }}
                    
                    Livello di Umidità Interna [%]: {{
                    states('sensor.vmc_master_umidita_interna_status_verifica_soglia') }}
  
                    Impiego Free H./C.: {{
                    states('sensor.vmc_master_alert_monitoraggio_free_heating_o_free_cooling_allert_interfaccia_avvisi') }}
  
                    VMC Sensori Int. Δ Temp. > 23 [°C] ?: {{
                    states('sensor.vmc_master_delta_temp_verifica_soglia') }}
                    
                    VMC Congelamento ≤ -18 [°C] Temp. Esterna ?: {{
                    states('sensor.vmc_master_congelamento_verifica_soglia') }}
  
                    Verifica Black-Out: {{
                    states('sensor.vmc_master_alert_monitoraggio_black_out') }}
    icon: mdi:fingerprint-off
    mode: restart

  vmc_master_notifica_velocita_diversa_da_0:
    alias: VMC Master - Invia notifica VMC in Funzione
    sequence:
      - choose:
          - conditions:
              - condition: template
                value_template: >
                  {{ states('input_select.vmc_master_selected_notification_device') not in
                     ["Aggiorna Elenco Dispositivi per Invio Notifica", "", "sconosciuto", "unknown", none, "unavailable", "Non disponibile"] }}
            sequence:
              - service: notify.mobile_app_{{ states('input_select.vmc_master_selected_notification_device') }}
                data:
                  title: >-
                    VMC {{ states('sensor.vmc_master_nome_status') }}
                  message: >-
                    {{
                    states('sensor.vmc_master_status_ventola_lettura_codice_interpretato_interfaccia')
                    }}: in data {{ now().strftime('%d-%m-%Y') }} alle {{
                    now().strftime('%H:%M:%S') }}
  
                    Livello di Concentrazione CO₂ [ppm]: {{
                    states('sensor.vmc_master_co2_status_verifica_soglia') }}
  
                    Livello di Concentrazione VOC [ppb]: {{
                    states('sensor.vmc_master_voc_status_verifica_soglia') }}
                    
                    Superamento Lim. Δ Punto di Rugiada: {{
                    states('sensor.vmc_master_alert_monitoraggio_pdr') }}
                    
                    Livello di Umidità Interna [%]: {{
                    states('sensor.vmc_master_umidita_interna_status_verifica_soglia') }}
  
                    Impiego Free H./C.: {{
                    states('sensor.vmc_master_alert_monitoraggio_free_heating_o_free_cooling_allert_interfaccia_avvisi') }}
  
                    VMC Sensori Int. Δ Temp. > 23 [°C] ?: {{
                    states('sensor.vmc_master_delta_temp_verifica_soglia') }}
                    
                    VMC Congelamento ≤ -18 [°C] Temp. Esterna ?: {{
                    states('sensor.vmc_master_congelamento_verifica_soglia') }}
  
                    Verifica Black-Out: {{
                    states('sensor.vmc_master_alert_monitoraggio_black_out') }}
    icon: mdi:fingerprint-off
    mode: restart

  vmc_master_notifica_errore_media_player:
    alias: VMC Master - Invia notifica Errore Media Player
    sequence:
      - choose:
          - conditions:
              - condition: template
                value_template: >
                  {% set mp = states('input_select.vmc_master_selected_media_player_entity') %}
                  {% set invalid_mp = ["Aggiorna Elenco Media Player", "", "sconosciuto", "unknown", none, "unavailable", "Non disponibile"] %}
                  {% set device = states('input_select.vmc_master_selected_notification_device') %}
                  {% set invalid_device = ["Aggiorna Elenco Dispositivi per Invio Notifica", "", "sconosciuto", "unknown", none, "unavailable", "Non disponibile"] %}
                  {{ mp in invalid_mp or device in invalid_device }}
            sequence:
              - service: notify.mobile_app_{{ states('input_select.vmc_master_selected_notification_device') }}
                data:
                  title: >-
                    VMC {{ states('sensor.vmc_master_nome_status') }}
                  message: >-
                    Errore Media Player: {{ states('input_text.vmc_master_last_media_player_entity') }} non disponibile.
  
                    Impiegato per la riproduzione Audio sul Media Player: {{ state_attr('sensor.vmc_master_status_media_player', 'friendly_name') }}
  
                    Data: {{ now().strftime('%d-%m-%Y') }}
                    Ora: {{ now().strftime('%H:%M:%S') }}
    mode: restart
    icon: mdi:fingerprint-off
    description: >
      Invia una notifica push al dispositivo mobile selezionato se il Media Player della VMC non è disponibile.
################### Fine Creazione Scripts Invio Notifiche su Mobile installate su Home Assistant #####################
  vmc_master_reset_filtro_vmc:
    alias: "VMC Master - Reset Filtro"
    icon: mdi:cursor-pointer
    mode: restart
    sequence:
      - service: shell_command.vmc_master_reset_filtro
      - delay:
          hours: 0
          minutes: 0
          seconds: 5
          milliseconds: 0
    description: Resetta il FIltro all'interno della VMC una volta sostituito lo stesso

  vmc_master_pulisci_cronologia_audio:
    alias: "VMC Master - Pulisci cronologia Audio"
    sequence:
      - service: tts.clear_cache
      - delay:
          hours: 0
          minutes: 0
          seconds: 2
          milliseconds: 0
    mode: restart
    icon: mdi:cursor-pointer
    description: Pulisce la cronologia di tutte le Entità installate dal Package

  vmc_master_pulisci_cronologia_entita:
    alias: "VMC Master - Pulisci cronologia Entità"
    sequence:
      - service: recorder.purge_entities
        data:
          keep_days: 0
          entity_id:
            - automation.vmc_master_aggiorna_aria_scambiata_e_gestisci_countdown_rev_00
            - automation.automazione_vmc_master
            - automation.vmc_master_audio_allerte_stato
            - automation.vmc_master_riepilogo_audio_allavvio
            - sensor.vmc_master_temperatura_esterna_selezionata
            - sensor.vmc_master_temperatura_interna_selezionata
            - sensor.vmc_master_umidita_esterna_selezionata
            - sensor.vmc_master_umidita_interna_selezionata
            - sensor.vmc_master_co2_interna_selezionata
            - sensor.VMC_MASTER_STATUS_IP
            - sensor.VMC_MASTER_STATUS_VENTOLA
            - sensor.VMC_MASTER_SENSORI
            - sensor.VMC_MASTER_NOME
            - sensor.VMC_MASTER_LAN
            - sensor.vmc_master_versione_repository
            - sensor.vmc_master_versione_corrente
            - sensor.vmc_master_verifica_ip_inserito
            - sensor.vmc_master_ip
            - sensor.vmc_master_status_ip_interfaccia
            - sensor.vmc_master_nome_status
            - sensor.vmc_master_status_ventola_lettura_codice
            - sensor.vmc_master_status_ventola_lettura_codice_interpretato
            - sensor.vmc_master_status_ventola_lettura_codice_interpretato_interfaccia
            - sensor.vmc_master_status_sensori_lettura_codice_interpretato
            - sensor.vmc_master_status_led_pannello_lettura_codice_interpretato
            - sensor.vmc_master_temp_esterna_positivo_negativo
            - sensor.vmc_master_temp_interna_positivo_negativo
            - sensor.vmc_master_temp_esterna_status
            - sensor.vmc_master_temp_esterna_status_senza_offset
            - sensor.vmc_master_temp_interna_status
            - sensor.vmc_master_temp_interna_status_senza_offset
            - sensor.vmc_master_umidita_esterna_status
            - sensor.vmc_master_umidita_interna_status
            - sensor.vmc_master_umidita_interna_status_senza_offset
            - sensor.vmc_master_co2_status
            - sensor.vmc_master_co2_status_senza_offset
            - sensor.vmc_master_voc_status
            - sensor.vmc_master_voc_status_senza_offset
            - sensor.vmc_master_umidita_interna_status_verifica_soglia_valore
            - sensor.vmc_master_punto_di_rugiada_verifica_confronto_valore
            - sensor.vmc_master_punto_di_rugiada_valore
            - sensor.vmc_master_umidita_interna_status_verifica_soglia
            - sensor.vmc_master_co2_status_verifica_soglia
            - sensor.vmc_master_voc_status_verifica_soglia
            - sensor.vmc_master_congelamento_verifica_soglia
            - sensor.vmc_master_delta_temp_verifica_soglia
            - sensor.vmc_master_punto_di_rugiada_interno
            - sensor.vmc_master_punto_di_rugiada_esterno
            - sensor.vmc_master_punto_di_rugiada_interno_esterno_non_calcolabile
            - sensor.vmc_master_punto_di_rugiada_verifica_confronto
            - sensor.vmc_master_umidita_assoluta_interna
            - sensor.vmc_master_umidita_assoluta_esterna
            - sensor.vmc_master_calcolo_confort_interno
            - sensor.vmc_master_status_portata_ventola_lettura_codice_interpretato
            - sensor.vmc_master_status_calcolo_portata_ventola
            - sensor.vmc_master_alert_monitoraggio_umidita
            - sensor.vmc_master_alert_monitoraggio_co2
            - sensor.vmc_master_alert_monitoraggio_voc
            - sensor.vmc_master_alert_monitoraggio_pdr
            - sensor.vmc_master_alert_monitoraggio_congelamento
            - sensor.vmc_master_alert_monitoraggio_delta
            - sensor.vmc_master_alert_monitoraggio_free_heating_o_free_cooling
            - sensor.vmc_master_alert_monitoraggio_free_heating_o_free_cooling_allert_interfaccia_avvisi
            - sensor.vmc_master_alert_monitoraggio_free_heating_o_free_cooling_disabilitato
            - sensor.vmc_master_alert_monitoraggio_offset_tutti_min
            - sensor.vmc_master_alert_monitoraggio_black_out
            - sensor.vmc_master_alert_monitoraggio_totale
            - sensor.vmc_master_spia_pannello_alert_monitoraggio_totale
            - sensor.vmc_master_status_accensione_vmc_tramite_calendario_interfaccia
            - sensor.vmc_master_status_accensione_vmc_tramite_calendario_2_interfaccia
            - sensor.vmc_master_status_spegnimento_vmc_tramite_calendario_interfaccia
            - sensor.vmc_master_status_spegnimento_vmc_tramite_calendario_2_interfaccia
            - sensor.vmc_master_status_accensione_vmc_tramite_calendario
            - sensor.vmc_master_status_accensione_vmc_tramite_calendario_2
            - sensor.vmc_master_status_spegnimento_vmc_tramite_calendario
            - sensor.vmc_master_status_spegnimento_vmc_tramite_calendario_2
            - sensor.vmc_master_status_check_freeheating_freecooling
            - sensor.vmc_master_status_freeheating
            - sensor.vmc_master_status_freecooling
            - sensor.vmc_master_status_mese_corrente_freeheating_o_freecooling
            - sensor.vmc_master_speed_1_fascia_calendario
            - sensor.vmc_master_speed_2_fascia_calendario
            - sensor.vmc_master_mese_1_fascia_freeheating
            - sensor.vmc_master_mese_2_fascia_freeheating
            - sensor.vmc_master_mese_1_fascia_freecooling
            - sensor.vmc_master_mese_2_fascia_freecooling
            - sensor.vmc_master_status_calcolo_aria_scambiata_totale
            - sensor.vmc_master_cicli_ricambio_aria
            - sensor.vmc_master_tempo_mancante_ricambio
            - sensor.vmc_master_temp_interna_numeric
            - sensor.vmc_master_hum_interna_numeric
            - sensor.vmc_master_calcolo_rischio_muffa_4w
            - sensor.vmc_master_calcolo_rischio_muffa_8w
            - sensor.vmc_master_calcolo_rischio_muffa_12w
            - sensor.vmc_master_temp_interna_4w
            - sensor.vmc_master_temp_interna_8w
            - sensor.vmc_master_temp_interna_12w
            - sensor.vmc_master_hum_interna_4w
            - sensor.vmc_master_hum_interna_8w
            - sensor.vmc_master_hum_interna_12w
            - sensor.vmc_master_trend_muffa
            - sensor.vmc_master_trend_muffa_level
            - input_text.vmc_master_nome_da_inserire
            - input_text.vmc_master_ip_insert
            - input_text.vmc_master_last_temp_external_entity
            - input_text.vmc_master_last_temp_internal_entity
            - input_text.vmc_master_last_humidity_external_entity
            - input_text.vmc_master_last_humidity_internal_entity
            - input_text.vmc_master_last_co2_internal_entity
            - input_text.vmc_master_last_notification_device
            - input_text.vmc_master_tempo_mancante_reset
            - input_text.vmc_master_velocita_precedente
            - input_text.vmc_master_last_media_player_entity
            - input_select.vmc_master_speed_1_fascia_calendario
            - input_select.vmc_master_speed_2_fascia_calendario
            - input_select.vmc_master_mese_1_fascia_freeheating
            - input_select.vmc_master_mese_2_fascia_freeheating
            - input_select.vmc_master_mese_1_fascia_freecooling
            - input_select.vmc_master_mese_2_fascia_freecooling
            - input_select.vmc_master_selected_temp_external_entity
            - input_select.vmc_master_selected_temp_internal_entity
            - input_select.vmc_master_selected_humidity_external_entity
            - input_select.vmc_master_selected_humidity_internal_entity
            - input_select.vmc_master_selected_co2_internal_entity
            - input_select.vmc_master_selected_notification_device
            - input_select.vmc_master_speed_umidita  
            - input_select.vmc_master_selected_media_player_entity
            - input_number.vmc_master_offset_temp_interna
            - input_number.vmc_master_offset_temp_esterna
            - input_number.vmc_master_offset_umidita_interna
            - input_number.vmc_master_offset_umidita_esterna
            - input_number.vmc_master_offset_co2
            - input_number.vmc_master_offset_voc
            - input_number.vmc_master_offset_verifica_impiego_vmc
            - input_number.vmc_master_volume_da_inserire
            - input_number.vmc_master_umidita_avvio     
            - input_number.vmc_master_aria_scambiata_v1
            - input_number.vmc_master_aria_scambiata_v2
            - input_number.vmc_master_aria_scambiata_v3
            - input_number.vmc_master_aria_scambiata_v4
            - input_number.vmc_master_aria_scambiata_iperventilazione
            - input_number.vmc_master_aria_scambiata_notte
            - input_number.vmc_master_aria_scambiata_freecooling
            - input_number.vmc_master_aria_scambiata_ricomincio
            - input_number.vmc_master_audio_volume
            - input_datetime.vmc_master_accensione_lunedi
            - input_datetime.vmc_master_spegnimento_lunedi
            - input_datetime.vmc_master_accensione_lunedi_2
            - input_datetime.vmc_master_spegnimento_lunedi_2
            - input_datetime.vmc_master_accensione_martedi
            - input_datetime.vmc_master_spegnimento_martedi
            - input_datetime.vmc_master_accensione_martedi_2
            - input_datetime.vmc_master_spegnimento_martedi_2
            - input_datetime.vmc_master_accensione_mercoledi
            - input_datetime.vmc_master_spegnimento_mercoledi
            - input_datetime.vmc_master_accensione_mercoledi_2
            - input_datetime.vmc_master_spegnimento_mercoledi_2
            - input_datetime.vmc_master_accensione_giovedi
            - input_datetime.vmc_master_spegnimento_giovedi
            - input_datetime.vmc_master_accensione_giovedi_2
            - input_datetime.vmc_master_spegnimento_giovedi_2
            - input_datetime.vmc_master_accensione_venerdi
            - input_datetime.vmc_master_spegnimento_venerdi
            - input_datetime.vmc_master_accensione_venerdi_2
            - input_datetime.vmc_master_spegnimento_venerdi_2
            - input_datetime.vmc_master_accensione_sabato
            - input_datetime.vmc_master_spegnimento_sabato
            - input_datetime.vmc_master_accensione_sabato_2
            - input_datetime.vmc_master_spegnimento_sabato_2
            - input_datetime.vmc_master_accensione_domenica
            - input_datetime.vmc_master_spegnimento_domenica
            - input_datetime.vmc_master_accensione_domenica_2
            - input_datetime.vmc_master_spegnimento_domenica_2
            - input_datetime.vmc_master_audio_start_time
            - input_datetime.vmc_master_audio_end_time
            - input_boolean.vmc_master_opzioni_avvisi
            - input_boolean.vmc_master_opzioni_avvisi_grafici
            - input_boolean.vmc_master_opzioni_vmc
            - input_boolean.vmc_master_opzioni_offset_sensori
            - input_boolean.vmc_master_opzioni_interruttore_offset_sensori
            - input_boolean.vmc_master_opzioni_monitoraggio_sensori
            - input_boolean.vmc_master_opzioni_interruttore_monitoraggio_sensori_extra
            - input_boolean.vmc_master_opzioni_calendario_main
            - input_boolean.vmc_master_opzioni_calendario
            - input_boolean.vmc_master_opzioni_punto_di_rugiada
            - input_boolean.vmc_master_opzioni_free_heating_o_free_cooling
            - input_boolean.vmc_master_opzioni_interruttore_calendario
            - input_boolean.vmc_master_opzioni_lettura_sensori
            - input_boolean.vmc_master_opzioni_scelta_sensori
            - input_boolean.vmc_master_opzioni_elementi_chimici
            - input_boolean.vmc_master_opzione_finestra_audio
            - input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr
            - input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_calendario
            - input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_freeheating
            - input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_freecooling
            - input_boolean.vmc_master_opzioni_accendi_spegni_avvisi
            - input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc
            - input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_umidita
            - input_boolean.vmc_master_opzioni_accendi_spegni_avvisi_spia
            - input_boolean.vmc_master_popup_versione_corrente_vs_repository
            - input_boolean.vmc_master_spia_velocita_0
            - input_boolean.vmc_master_spia_velocita_1
            - input_boolean.vmc_master_spia_velocita_2
            - input_boolean.vmc_master_spia_velocita_3
            - input_boolean.vmc_master_spia_velocita_4
            - input_boolean.vmc_master_spia_velocita_iperventilazione
            - input_boolean.vmc_master_spia_velocita_notturna
            - input_boolean.vmc_master_spia_velocita_freecooling
            - input_boolean.vmc_master_spia_calendario_lunedi_1
            - input_boolean.vmc_master_spia_calendario_lunedi_2
            - input_boolean.vmc_master_spia_calendario_martedi_1
            - input_boolean.vmc_master_spia_calendario_martedi_2
            - input_boolean.vmc_master_spia_calendario_mercoledi_1
            - input_boolean.vmc_master_spia_calendario_mercoledi_2
            - input_boolean.vmc_master_spia_calendario_giovedi_1
            - input_boolean.vmc_master_spia_calendario_giovedi_2
            - input_boolean.vmc_master_spia_calendario_venerdi_1
            - input_boolean.vmc_master_spia_calendario_venerdi_2
            - input_boolean.vmc_master_spia_calendario_sabato_1
            - input_boolean.vmc_master_spia_calendario_sabato_2
            - input_boolean.vmc_master_spia_calendario_domenica_1
            - input_boolean.vmc_master_spia_calendario_domenica_2
            - input_boolean.vmc_master_spia_velocita_0_un_solo_avvio
            - input_boolean.vmc_master_spia_velocita_1_un_solo_avvio
            - input_boolean.vmc_master_spia_velocita_2_un_solo_avvio
            - input_boolean.vmc_master_spia_velocita_3_un_solo_avvio
            - input_boolean.vmc_master_spia_velocita_4_un_solo_avvio
            - input_boolean.vmc_master_spia_velocita_iperventilazione_un_solo_avvio
            - input_boolean.vmc_master_spia_velocita_notturna_un_solo_avvio
            - input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio
            - input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio_per_programmazione_freecooling
            - input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio_per_programmazione_freeheating
            - input_boolean.vmc_master_spia_co2_o_voc
            - input_boolean.vmc_master_spia_co2_o_voc_partenza_ritorno_velocita_0
            - input_boolean.vmc_master_spia_velocita_0_co2_o_voc
            - input_boolean.vmc_master_spia_velocita_1_co2_o_voc
            - input_boolean.vmc_master_spia_velocita_2_co2_o_voc
            - input_boolean.vmc_master_spia_velocita_3_co2_o_voc
            - input_boolean.vmc_master_spia_velocita_4_co2_o_voc
            - input_boolean.vmc_master_spia_velocita_iperventilazione_co2_o_voc
            - input_boolean.vmc_master_spia_velocita_notturna_co2_o_voc
            - input_boolean.vmc_master_spia_velocita_freecooling_co2_o_voc
            - input_boolean.vmc_master_spia_velocita_1_co2_o_voc_pdr
            - input_boolean.vmc_master_congelamento_verifica_soglia_valore_spia
            - input_boolean.vmc_master_spia_velocita_0_congelamento
            - input_boolean.vmc_master_spia_velocita_1_congelamento
            - input_boolean.vmc_master_spia_velocita_2_congelamento
            - input_boolean.vmc_master_spia_velocita_3_congelamento
            - input_boolean.vmc_master_spia_velocita_4_congelamento
            - input_boolean.vmc_master_spia_velocita_iperventilazione_congelamento
            - input_boolean.vmc_master_spia_velocita_notturna_congelamento
            - input_boolean.vmc_master_spia_velocita_freecooling_congelamento
            - input_boolean.vmc_master_delta_temp_verifica_soglia_valore_spia
            - input_boolean.vmc_master_spia_velocita_0_delta_temp_verifica_soglia_valore
            - input_boolean.vmc_master_spia_velocita_1_delta_temp_verifica_soglia_valore
            - input_boolean.vmc_master_spia_velocita_2_delta_temp_verifica_soglia_valore
            - input_boolean.vmc_master_spia_velocita_3_delta_temp_verifica_soglia_valore
            - input_boolean.vmc_master_spia_velocita_4_delta_temp_verifica_soglia_valore
            - input_boolean.vmc_master_spia_velocita_iperventilazione_delta_temp_verifica_soglia_valore
            - input_boolean.vmc_master_spia_velocita_notturna_delta_temp_verifica_soglia_valore
            - input_boolean.vmc_master_spia_velocita_freecooling_delta_temp_verifica_soglia_valore
            - input_boolean.vmc_master_notifica_status_vmc
            - input_boolean.vmc_master_umidita_verifica_soglia_valore_spia
            - input_boolean.vmc_master_spia_umidita_velocita_0
            - input_boolean.vmc_master_spia_umidita_velocita_1
            - input_boolean.vmc_master_spia_umidita_velocita_2
            - input_boolean.vmc_master_spia_umidita_velocita_3
            - input_boolean.vmc_master_spia_umidita_velocita_4
            - input_boolean.vmc_master_spia_umidita_velocita_iperventilazione
            - input_boolean.vmc_master_spia_umidita_velocita_notturna
            - input_boolean.vmc_master_spia_umidita_velocita_freecooling
            - input_boolean.vmc_master_avvio_home_assistant_in_corso_per_audio
            - input_boolean.vmc_master_notifica_audio
            - input_boolean.vmc_master_notifica_allerta_congelamento
            - input_boolean.vmc_master_notifica_allerta_differenza_temp_int_est
            - input_boolean.vmc_master_notifica_allerta_inquinanti
            - input_boolean.vmc_master_notifica_allerta_pdr
            - input_boolean.vmc_master_notifica_allerta_freecooling_heating
            - input_boolean.vmc_master_notifica_allerta_umidita
            - input_boolean.vmc_master_notifica_allerta_black_out
            - input_boolean.vmc_master_notifica_allerta_status_velocita
            - input_boolean.vmc_master_notifica_allerta_riepilogo
            - script.vmc_master_aggiorna_elenco_entita_temperatura_esterna
            - script.vmc_master_aggiorna_elenco_entita_temperatura_interna
            - script.vmc_master_aggiorna_elenco_entita_umidita_esterna
            - script.vmc_master_aggiorna_elenco_entita_umidita_interna
            - script.vmc_master_aggiorna_elenco_entita_co2_interna
            - script.vmc_master_aggiorna_elenco_entita_notifica_dispositivo
            - script.vmc_master_aggiorna_elenco_entita_media_player
            - script.vmc_master_notifica_errore_temp_esterna
            - script.vmc_master_notifica_errore_temp_interna
            - script.vmc_master_notifica_errore_umidita_esterna
            - script.vmc_master_notifica_errore_umidita_interna
            - script.vmc_master_notifica_errore_co2_interna
            - script.vmc_master_notifica_cambio_filtro
            - script.vmc_master_notifica_velocita_0
            - script.vmc_master_notifica_velocita_diversa_da_0
            - script.vmc_master_notifica_errore_media_player
            - script.vmc_master_azzera_booleans
            - script.vmc_master_azzera_offset_sensors
            - script.vmc_master_upgrade_sensors
            - script.vmc_master_profilo_calendario
            - script.vmc_master_profilo_free_heating_cooling
            - script.vmc_master_profilo_pdr
            - script.vmc_master_profilo_inizializzazione
            - script.vmc_master_audio_profilo
            - script.vmc_master_bottone_panico
            - script.vmc_master_calendario_fascia_1_o_2_off
            - script.vmc_master_calendario_fascia_1_on
            - script.vmc_master_calendario_fascia_2_on    
            - script.vmc_master_azzera_aria_scambiata
            - script.vmc_master_pulisci_cronologia_audio
            - script.vmc_master_audio_status_velocita
            - script.vmc_master_audio_allerta_umidita_interna
            - script.vmc_master_audio_nessuna_allerta_umidita_interna
            - script.vmc_master_audio_allerta_co2
            - script.vmc_master_audio_nessuna_allerta_co2
            - script.vmc_master_audio_allerta_voc
            - script.vmc_master_audio_nessuna_allerta_voc
            - script.vmc_master_audio_allerta_pdr
            - script.vmc_master_audio_nessuna_allerta_pdr
            - script.vmc_master_audio_allerta_black_out
            - script.vmc_master_audio_nessuna_allerta_black_out
            - script.vmc_master_audio_free_heating_o_free_cooling
            - script.vmc_master_audio_allerta_congelamento
            - script.vmc_master_audio_nessuna_allerta_congelamento
            - script.vmc_master_audio_allerta_diff_temp
            - script.vmc_master_audio_nessuna_allerta_diff_temp
            - script.vmc_master_azzera_aria_scambiata_puntuale
    mode: restart
    icon: mdi:cursor-pointer
    description: Pulisce la cronologia di tutte le Entità installate dal Package

  vmc_master_azzera_booleans:
    alias: VMC Master - Booleans Off
    sequence:
      - service: input_boolean.turn_off
        data: {}
        target:
          entity_id:
            - input_boolean.vmc_master_opzioni_avvisi
            - input_boolean.vmc_master_opzioni_avvisi_grafici
            - input_boolean.vmc_master_opzioni_vmc
            - input_boolean.vmc_master_opzioni_offset_sensori
            - input_boolean.vmc_master_opzioni_interruttore_offset_sensori
            - input_boolean.vmc_master_opzioni_monitoraggio_sensori
            - input_boolean.vmc_master_opzioni_interruttore_monitoraggio_sensori_extra
            - input_boolean.vmc_master_opzioni_calendario_main
            - input_boolean.vmc_master_opzioni_calendario
            - input_boolean.vmc_master_opzioni_punto_di_rugiada
            - input_boolean.vmc_master_opzioni_free_heating_o_free_cooling
            - input_boolean.vmc_master_opzioni_interruttore_calendario
            - input_boolean.vmc_master_opzioni_lettura_sensori
            - input_boolean.vmc_master_opzioni_accendi_spegni_avvisi_spia
            - input_boolean.vmc_master_spia_velocita_0
            - input_boolean.vmc_master_spia_velocita_1
            - input_boolean.vmc_master_spia_velocita_2
            - input_boolean.vmc_master_spia_velocita_3
            - input_boolean.vmc_master_spia_velocita_4
            - input_boolean.vmc_master_spia_velocita_iperventilazione
            - input_boolean.vmc_master_spia_velocita_notturna
            - input_boolean.vmc_master_spia_velocita_freecooling
            - input_boolean.vmc_master_spia_calendario_lunedi_1
            - input_boolean.vmc_master_spia_calendario_lunedi_2
            - input_boolean.vmc_master_spia_calendario_martedi_1
            - input_boolean.vmc_master_spia_calendario_martedi_2
            - input_boolean.vmc_master_spia_calendario_mercoledi_1
            - input_boolean.vmc_master_spia_calendario_mercoledi_2
            - input_boolean.vmc_master_spia_calendario_giovedi_1
            - input_boolean.vmc_master_spia_calendario_giovedi_2
            - input_boolean.vmc_master_spia_calendario_venerdi_1
            - input_boolean.vmc_master_spia_calendario_venerdi_2
            - input_boolean.vmc_master_spia_calendario_sabato_1
            - input_boolean.vmc_master_spia_calendario_sabato_2
            - input_boolean.vmc_master_spia_calendario_domenica_1
            - input_boolean.vmc_master_spia_calendario_domenica_2
            - input_boolean.vmc_master_spia_velocita_0_un_solo_avvio
            - input_boolean.vmc_master_spia_velocita_1_un_solo_avvio
            - input_boolean.vmc_master_spia_velocita_2_un_solo_avvio
            - input_boolean.vmc_master_spia_velocita_3_un_solo_avvio
            - input_boolean.vmc_master_spia_velocita_4_un_solo_avvio
            - input_boolean.vmc_master_spia_velocita_iperventilazione_un_solo_avvio
            - input_boolean.vmc_master_spia_velocita_notturna_un_solo_avvio
            - input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio
            - input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio_per_programmazione_freecooling
            - input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio_per_programmazione_freeheating
            - input_boolean.vmc_master_spia_co2_o_voc_partenza_ritorno_velocita_0
            - input_boolean.vmc_master_spia_velocita_0_co2_o_voc
            - input_boolean.vmc_master_spia_velocita_1_co2_o_voc
            - input_boolean.vmc_master_spia_velocita_2_co2_o_voc
            - input_boolean.vmc_master_spia_velocita_3_co2_o_voc
            - input_boolean.vmc_master_spia_velocita_4_co2_o_voc
            - input_boolean.vmc_master_spia_velocita_iperventilazione_co2_o_voc
            - input_boolean.vmc_master_spia_velocita_notturna_co2_o_voc
            - input_boolean.vmc_master_spia_velocita_freecooling_co2_o_voc
            - input_boolean.vmc_master_spia_co2_o_voc
            - input_boolean.vmc_master_spia_velocita_1_co2_o_voc_pdr
            - input_boolean.vmc_master_congelamento_verifica_soglia_valore_spia
            - input_boolean.vmc_master_spia_velocita_0_congelamento
            - input_boolean.vmc_master_spia_velocita_1_congelamento
            - input_boolean.vmc_master_spia_velocita_2_congelamento
            - input_boolean.vmc_master_spia_velocita_3_congelamento
            - input_boolean.vmc_master_spia_velocita_4_congelamento
            - input_boolean.vmc_master_spia_velocita_iperventilazione_congelamento
            - input_boolean.vmc_master_spia_velocita_notturna_congelamento
            - input_boolean.vmc_master_spia_velocita_freecooling_congelamento
            - input_boolean.vmc_master_delta_temp_verifica_soglia_valore_spia
            - input_boolean.vmc_master_spia_velocita_0_delta_temp_verifica_soglia_valore
            - input_boolean.vmc_master_spia_velocita_1_delta_temp_verifica_soglia_valore
            - input_boolean.vmc_master_spia_velocita_2_delta_temp_verifica_soglia_valore
            - input_boolean.vmc_master_spia_velocita_3_delta_temp_verifica_soglia_valore
            - input_boolean.vmc_master_spia_velocita_4_delta_temp_verifica_soglia_valore
            - input_boolean.vmc_master_spia_velocita_iperventilazione_delta_temp_verifica_soglia_valore
            - input_boolean.vmc_master_spia_velocita_notturna_delta_temp_verifica_soglia_valore
            - input_boolean.vmc_master_spia_velocita_freecooling_delta_temp_verifica_soglia_valore
            - input_boolean.vmc_master_umidita_verifica_soglia_valore_spia
            - input_boolean.vmc_master_opzioni_scelta_sensori
            - input_boolean.vmc_master_opzioni_elementi_chimici
            - input_boolean.vmc_master_opzione_finestra_audio
            - input_boolean.vmc_master_spia_umidita_velocita_0
            - input_boolean.vmc_master_spia_umidita_velocita_1
            - input_boolean.vmc_master_spia_umidita_velocita_2
            - input_boolean.vmc_master_spia_umidita_velocita_3
            - input_boolean.vmc_master_spia_umidita_velocita_4
            - input_boolean.vmc_master_spia_umidita_velocita_iperventilazione
            - input_boolean.vmc_master_spia_umidita_velocita_notturna
            - input_boolean.vmc_master_spia_umidita_velocita_freecooling
            - input_boolean.vmc_master_avvio_home_assistant_in_corso_per_audio
    mode: restart
    icon: mdi:fingerprint-off
    description: Imposta tutte le variabili Booleane su OFF
    #TRANNE: input_boolean.vmc_master_notifica_audio, input_boolean.vmc_master_notifica_status_vmc, input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_umidita, input_boolean.vmc_master_opzioni_accendi_spegni_avvisi,input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr, input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_calendario,input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_freeheating, input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_freecooling, input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc, input_boolean.vmc_master_notifica_allerta_congelamento, input_boolean.vmc_master_notifica_allerta_differenza_temp_int_est, input_boolean.vmc_master_notifica_allerta_inquinanti, input_boolean.vmc_master_notifica_allerta_pdr, input_boolean.vmc_master_notifica_allerta_freecooling_heating, input_boolean.vmc_master_notifica_allerta_umidita, input_boolean.vmc_master_notifica_allerta_black_out, input_boolean.vmc_master_notifica_allerta_status_velocita, input_boolean.vmc_master_notifica_allerta_riepilogo

  vmc_master_azzera_offset_sensors:
    alias: VMC Master - Azzera gli Offset dei Sensori
    sequence:
      - service: input_number.set_value
        data:
          entity_id:
            - input_number.vmc_master_offset_temp_esterna
            - input_number.vmc_master_offset_temp_interna
            - input_number.vmc_master_offset_umidita_esterna
            - input_number.vmc_master_offset_umidita_interna
            - input_number.vmc_master_offset_co2
            - input_number.vmc_master_offset_voc
          value: 0
    mode: restart
    icon: mdi:cursor-pointer

  vmc_master_audio_profilo:
    alias: VMC Master - Profilo Audio
    sequence:
      - service: input_datetime.set_datetime
        data:
          time: "08:00"
        target:
          entity_id:
            - input_datetime.vmc_master_audio_start_time
      - service: input_datetime.set_datetime
        data:
          time: "21:00"
        target:
          entity_id:
            - input_datetime.vmc_master_audio_end_time
      - service: input_number.set_value
        data:
          entity_id:
            - input_number.vmc_master_audio_volume
          value: 0.3
      - service: input_boolean.turn_on
        data: {}
        target:
          entity_id:
            - input_boolean.vmc_master_notifica_audio
            - input_boolean.vmc_master_notifica_allerta_congelamento
            - input_boolean.vmc_master_notifica_allerta_differenza_temp_int_est
            - input_boolean.vmc_master_notifica_allerta_inquinanti
            - input_boolean.vmc_master_notifica_allerta_pdr
            - input_boolean.vmc_master_notifica_allerta_freecooling_heating
            - input_boolean.vmc_master_notifica_allerta_umidita
            - input_boolean.vmc_master_notifica_allerta_black_out
            - input_boolean.vmc_master_notifica_allerta_status_velocita
            - input_boolean.vmc_master_notifica_allerta_riepilogo
    mode: restart
    icon: mdi:cursor-pointer

  vmc_master_azzera_aria_scambiata_puntuale:
    alias: VMC Master - Azzera Totale Aria Scambiata Puntuale
    sequence:
      - service: input_text.set_value
        data:
          entity_id: input_text.vmc_master_tempo_mancante_reset
          value: ""
    mode: restart
    icon: mdi:fingerprint-off

  vmc_master_azzera_aria_scambiata:
    alias: VMC Master - Azzera Totale Aria Scambiata
    sequence:
      - service: recorder.purge_entities
        data:
          keep_days: 0
          entity_id:
            - sensor.vmc_master_status_calcolo_aria_scambiata_totale
            - sensor.vmc_master_cicli_ricambio_aria
            - sensor.vmc_master_tempo_mancante_ricambio
            - input_number.vmc_master_aria_scambiata_v1
            - input_number.vmc_master_aria_scambiata_v2
            - input_number.vmc_master_aria_scambiata_v3
            - input_number.vmc_master_aria_scambiata_v4
            - input_number.vmc_master_aria_scambiata_iperventilazione
            - input_number.vmc_master_aria_scambiata_notte
            - input_number.vmc_master_aria_scambiata_freecooling      
            - input_number.vmc_master_aria_scambiata_ricomincio
      - service: input_number.set_value
        data:
          entity_id:
            - input_number.vmc_master_aria_scambiata_v1
            - input_number.vmc_master_aria_scambiata_v2
            - input_number.vmc_master_aria_scambiata_v3
            - input_number.vmc_master_aria_scambiata_v4
            - input_number.vmc_master_aria_scambiata_iperventilazione
            - input_number.vmc_master_aria_scambiata_notte
            - input_number.vmc_master_aria_scambiata_freecooling      
            - input_number.vmc_master_aria_scambiata_ricomincio
          value: 0
      - service: input_text.set_value
        data:
          entity_id: input_text.vmc_master_tempo_mancante_reset
          value: "reset"
    mode: restart
    icon: mdi:cursor-pointer

  vmc_master_upgrade_sensors:
    alias: VMC Master - Agg. Sensori (Attendere)
    sequence:
      - service: homeassistant.update_entity
        target:
          entity_id:
            - sensor.vmc_master_status_ip
      - delay:
          seconds: 2
      - service: homeassistant.update_entity
        target:
          entity_id:
            - sensor.vmc_master_status_ventola
            - sensor.vmc_master_status_sensori_lettura_codice_interpretato
            - sensor.vmc_master_status_led_pannello_lettura_codice_interpretato
            - sensor.vmc_master_status_calcolo_portata_ventola
            - sensor.vmc_master_status_portata_ventola_lettura_codice_interpretato
            - sensor.vmc_master_status_ventola_lettura_codice_interpretato_interfaccia
      - delay:
          seconds: 2
      - service: homeassistant.update_entity
        target:
          entity_id:
            - sensor.vmc_master_sensori
      - delay:
          seconds: 2
      - service: homeassistant.update_entity
        target:
          entity_id:
            - sensor.vmc_master_nome
            - sensor.vmc_master_nome_status
      - delay:
          seconds: 2
      - service: homeassistant.update_entity
        target:
          entity_id:
            - sensor.vmc_master_lan
      - delay:
          seconds: 2
      - service: homeassistant.update_entity
        target:
          entity_id:
            - sensor.vmc_master_versione_repository
      - delay:
          seconds: 2
      - service: homeassistant.update_entity
        target:
          entity_id:
            - sensor.vmc_master_co2_status
      - delay:
          seconds: 2
      - service: homeassistant.update_entity
        target:
          entity_id:
            - sensor.vmc_master_voc_status
      - delay:
          seconds: 2
      - service: script.vmc_master_aggiorna_elenco_entita_temperatura_esterna
        data: {}
      - delay:
          seconds: 2
      - service: script.vmc_master_aggiorna_elenco_entita_temperatura_interna
        data: {}
      - delay:
          seconds: 2
      - service: script.vmc_master_aggiorna_elenco_entita_umidita_esterna
        data: {}
      - delay:
          seconds: 2
      - service: script.vmc_master_aggiorna_elenco_entita_umidita_interna
        data: {}
      - delay:
          seconds: 2
      - service: script.vmc_master_aggiorna_elenco_entita_co2_interna
        data: {}
      - delay:
          seconds: 2
      - service: script.vmc_master_aggiorna_elenco_entita_notifica_dispositivo
        data: {}
      - delay:
          seconds: 2
      - service: script.vmc_master_aggiorna_elenco_entita_media_player
        data: {}
      - delay:
          seconds: 2
      - service: script.turn_on
        target:
          entity_id: script.vmc_master_aggiorna_elenco_entita_temperatura_esterna
      - delay:
          seconds: 2
      - service: script.turn_on
        target:
          entity_id: script.vmc_master_aggiorna_elenco_entita_temperatura_interna
      - delay:
          seconds: 2
      - service: script.turn_on
        target:
          entity_id: script.vmc_master_aggiorna_elenco_entita_umidita_esterna
      - delay:
          seconds: 2
      - service: script.turn_on
        target:
          entity_id: script.vmc_master_aggiorna_elenco_entita_umidita_interna
      - delay:
          seconds: 2
      - service: script.turn_on
        target:
          entity_id: script.vmc_master_aggiorna_elenco_entita_co2_interna
      - delay:
          seconds: 2
      - service: script.turn_on
        target:
          entity_id: script.vmc_master_aggiorna_elenco_entita_notifica_dispositivo
      - delay:
          seconds: 2
      - service: script.turn_on
        target:
          entity_id: script.vmc_master_aggiorna_elenco_entita_media_player
      - delay:
          seconds: 2
      - service: homeassistant.update_entity
        target:
          entity_id:
            - sensor.vmc_master_spia_pannello_alert_monitoraggio_totale
            - sensor.vmc_master_temperatura_esterna_selezionata
            - sensor.vmc_master_temperatura_interna_selezionata
            - sensor.vmc_master_umidita_esterna_selezionata
            - sensor.vmc_master_umidita_interna_selezionata
            - sensor.vmc_master_co2_interna_selezionata
            - input_select.vmc_master_selected_temp_external_entity
            - input_select.vmc_master_selected_temp_internal_entity
            - input_select.vmc_master_selected_humidity_external_entity
            - input_select.vmc_master_selected_humidity_internal_entity
            - input_select.vmc_master_selected_co2_internal_entity
            - input_select.vmc_master_selected_notification_device
            - input_select.vmc_master_selected_media_player_entity
            - input_text.vmc_master_last_temp_external_entity
            - input_text.vmc_master_last_temp_internal_entity
            - input_text.vmc_master_last_humidity_external_entity
            - input_text.vmc_master_last_humidity_internal_entity
            - input_text.vmc_master_last_co2_internal_entity
            - input_text.vmc_master_last_notification_device
            - input_text.vmc_master_last_media_player_entity
    mode: restart
    icon: mdi:cursor-pointer
    description: Aggiorna in sequenza tutte le entità e i sensori della VMC.

  vmc_master_profilo_calendario:
    alias: VMC Master - Profilo Calendario
    sequence:
      - service: input_datetime.set_datetime
        data:
          time: "00:30"
        target:
          entity_id:
            - input_datetime.vmc_master_accensione_lunedi
            - input_datetime.vmc_master_accensione_martedi
            - input_datetime.vmc_master_accensione_mercoledi
            - input_datetime.vmc_master_accensione_giovedi
            - input_datetime.vmc_master_accensione_venerdi
            - input_datetime.vmc_master_accensione_sabato
            - input_datetime.vmc_master_accensione_domenica
      - service: input_datetime.set_datetime
        data:
          time: "06:00"
        target:
          entity_id:
            - input_datetime.vmc_master_spegnimento_lunedi
            - input_datetime.vmc_master_spegnimento_martedi
            - input_datetime.vmc_master_spegnimento_mercoledi
            - input_datetime.vmc_master_spegnimento_giovedi
            - input_datetime.vmc_master_spegnimento_venerdi
            - input_datetime.vmc_master_spegnimento_sabato
            - input_datetime.vmc_master_spegnimento_domenica  
      - service: input_datetime.set_datetime
        data:
          time: "20:00"
        target:
          entity_id:
            - input_datetime.vmc_master_accensione_lunedi_2
            - input_datetime.vmc_master_accensione_martedi_2
            - input_datetime.vmc_master_accensione_mercoledi_2
            - input_datetime.vmc_master_accensione_giovedi_2
            - input_datetime.vmc_master_accensione_venerdi_2
            - input_datetime.vmc_master_accensione_sabato_2
            - input_datetime.vmc_master_accensione_domenica_2
      - service: input_datetime.set_datetime
        data:
          time: "23:30"
        target:
          entity_id:
            - input_datetime.vmc_master_spegnimento_lunedi_2
            - input_datetime.vmc_master_spegnimento_martedi_2
            - input_datetime.vmc_master_spegnimento_mercoledi_2
            - input_datetime.vmc_master_spegnimento_giovedi_2
            - input_datetime.vmc_master_spegnimento_venerdi_2
            - input_datetime.vmc_master_spegnimento_sabato_2
            - input_datetime.vmc_master_spegnimento_domenica_2  
      - service: input_select.select_option
        data:
          option: Velocità 1
        target:
          entity_id:
            - input_select.vmc_master_speed_1_fascia_calendario
      - service: input_select.select_option
        data:
          option: Velocità 1
        target:
          entity_id:
            - input_select.vmc_master_speed_2_fascia_calendario    
      - service: input_boolean.turn_on
        data: {}
        target:
          entity_id: input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_calendario
    mode: restart
    icon: mdi:cursor-pointer
    
  vmc_master_profilo_free_heating_cooling:
    alias: VMC Master - Profilo Free Heating/Cooling
    sequence:
      - service: input_boolean.turn_on
        data: {}
        target:
          entity_id: 
            - input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_freeheating
            - input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_freecooling
      - service: input_select.select_option
        data:
          entity_id: input_select.vmc_master_mese_1_fascia_freeheating
          option: Ottobre
      - service: input_select.select_option
        data:
          entity_id: input_select.vmc_master_mese_2_fascia_freeheating
          option: Giugno
      - service: input_select.select_option
        data:
          entity_id: input_select.vmc_master_mese_1_fascia_freecooling
          option: Luglio
      - service: input_select.select_option
        data:
          entity_id: input_select.vmc_master_mese_2_fascia_freecooling 
          option: Settembre
      - service: homeassistant.update_entity
        target:
          entity_id:
            - input_select.vmc_master_mese_1_fascia_freeheating
            - input_select.vmc_master_mese_2_fascia_freeheating
            - input_select.vmc_master_mese_1_fascia_freecooling
            - input_select.vmc_master_mese_2_fascia_freecooling 
    mode: restart
    icon: mdi:cursor-pointer

  vmc_master_profilo_pdr:
    alias: VMC Master - Profilo Lim. Δ P. di Rugiada
    sequence:
      - service: input_number.set_value
        data:
          entity_id:
            - input_number.vmc_master_offset_verifica_impiego_vmc
          value: 0
      - service: input_boolean.turn_on
        data: {}
        target:
          entity_id: 
            - input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr
    mode: restart
    icon: mdi:cursor-pointer

  vmc_master_profilo_umidita:
    alias: VMC Master - Profilo Umidità Interna di Avvio
    sequence:
      - service: input_number.set_value
        data:
          entity_id:
            - input_number.vmc_master_umidita_avvio
          value: 75
      - service: input_select.select_option
        data:
          option: Iperventilazione
        target:
          entity_id:
            - input_select.vmc_master_speed_umidita
      - service: input_boolean.turn_on
        data: {}
        target:
          entity_id: 
            - input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_umidita
    mode: restart
    icon: mdi:cursor-pointer

  vmc_master_profilo_inizializzazione:
    alias: VMC Master - Profilo Inizializzazione (Attendere - Riavvio H.A.)
    sequence:
      - service: script.vmc_master_azzera_booleans
        data: {}
      - service: script.vmc_master_azzera_offset_sensors
        data: {}
      - service: script.vmc_master_profilo_calendario
        data: {}
      - service: script.vmc_master_profilo_free_heating_cooling
        data: {}        
      - service: script.vmc_master_profilo_pdr
        data: {}
      - service: script.vmc_master_profilo_umidita
        data: {}
      - service: script.vmc_master_audio_profilo
        data: {}      
      - service: shell_command.vmc_master_velocita_0
      - delay:
          hours: 0
          minutes: 0
          seconds: 5
          milliseconds: 0
      - service: shell_command.vmc_master_sensori_off
      - delay:
          hours: 0
          minutes: 0
          seconds: 5
          milliseconds: 0
      - service: shell_command.vmc_master_pannello_led_on
      - service: input_boolean.turn_on
        data: {}
        target:
          entity_id: 
            - input_boolean.vmc_master_opzioni_accendi_spegni_avvisi
            - input_boolean.vmc_master_notifica_status_vmc
            - input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr
            - input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_umidita         
            - input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_calendario
            - input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_freeheating
            - input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_freecooling
            - input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc
      - service: homeassistant.restart
        data: {}
    mode: restart
    icon: mdi:cursor-pointer

  vmc_master_bottone_panico:
    alias: VMC Master - Panic Botton (Riavvio Package)
    sequence:
      - service: script.vmc_master_azzera_booleans
        data: {}
      - service: input_boolean.turn_off
        data: {}
        target:
          entity_id: 
            - input_boolean.vmc_master_opzioni_accendi_spegni_avvisi
            - input_boolean.vmc_master_notifica_status_vmc
            - input_boolean.vmc_master_notifica_audio
            - input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr
            - input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_umidita
            - input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_calendario
            - input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_freeheating
            - input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_freecooling
            - input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc
            - input_boolean.vmc_master_avvio_home_assistant_in_corso_per_audio
      - service: shell_command.vmc_master_velocita_0
    mode: restart
    icon: mdi:cursor-pointer
#-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
#------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  vmc_master_calendario_fascia_1_o_2_off:
    alias: VMC Master - Calendario Fascia 1 o 2 Off
    sequence:
      - service: script.vmc_master_azzera_booleans
        data: {}
    mode: restart
    icon: mdi:fingerprint-off
#------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
#------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  vmc_master_calendario_fascia_1_on:
    alias: VMC Master - Calendario Fascia 1 On
    sequence:
      - delay:
          hours: 0
          minutes: 0
          seconds: 5
          milliseconds: 0
      - choose:
          - conditions:
              - alias: Velocità 0 in Assenza di Congelamento e Delta Temperatura
                condition: and
                conditions:
                  - condition: state
                    entity_id: sensor.vmc_master_speed_1_fascia_calendario
                    state: Velocità 0
                  - condition: template
                    value_template: >-
                      {{(states('input_boolean.vmc_master_congelamento_verifica_soglia_valore_spia')==
                      'off' and
                      states('input_boolean.vmc_master_delta_temp_verifica_soglia_valore_spia')==
                      'off')}}
                    alias: Congelamento Assente e Delta Temperatura Assente
            sequence:
              - service: input_boolean.turn_off
                data: {}
                target:
                  entity_id:
                    - >-
                      input_boolean.vmc_master_spia_co2_o_voc_partenza_ritorno_velocita_0
                    - input_boolean.vmc_master_spia_velocita_1_co2_o_voc_pdr
                    - input_boolean.vmc_master_spia_velocita_0_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_1_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_2_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_3_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_4_co2_o_voc
                    - >-
                      input_boolean.vmc_master_spia_velocita_iperventilazione_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_notturna_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_freecooling_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_0_un_solo_avvio
                    - input_boolean.vmc_master_spia_velocita_1_un_solo_avvio
                    - input_boolean.vmc_master_spia_velocita_2_un_solo_avvio
                    - input_boolean.vmc_master_spia_velocita_3_un_solo_avvio
                    - input_boolean.vmc_master_spia_velocita_4_un_solo_avvio
                    - input_boolean.vmc_master_spia_velocita_notturna_un_solo_avvio
                    - >-
                      input_boolean.vmc_master_spia_velocita_iperventilazione_un_solo_avvio
                    - >-
                      input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio
                    - >-
                      input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio_per_programmazione_freecooling
                    - >-
                      input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio_per_programmazione_freeheating
              - choose:
                  - conditions:
                      - condition: and
                        conditions:
                          - condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr')=='on'}}
                            alias: Interruttore PdR ON
                          - condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc')=='on'}}
                            alias: Interruttore Inquinanti ON
                    sequence:
                      - choose:
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                                alias: Verifica CASO PDR ON E INQUINANTI ON
                            sequence:
                              - service: input_boolean.turn_on
                                data: {}
                                target:
                                  entity_id:
                                    - >-
                                      input_boolean.vmc_master_spia_velocita_1_co2_o_voc_pdr
                                    - >-
                                      input_boolean.vmc_master_spia_co2_o_voc_partenza_ritorno_velocita_0
                                    - input_boolean.vmc_master_spia_co2_o_voc
                                    - >-
                                      input_boolean.vmc_master_spia_velocita_1_co2_o_voc
                              - service: shell_command.vmc_master_velocita_1
                                metadata: {}
                                data: {}
                            alias: CASO PDR ON E INQUINANTI ON
                          - conditions:
                              - alias: Verifica CASO PDR ON E INQUINANTI OFF
                                condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - service: shell_command.vmc_master_velocita_0
                                data: {}
                            alias: CASO PDR ON E INQUINANTI OFF
                          - conditions:
                              - alias: Verifica CASO PDR OFF E INQUINANTI ON
                                condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - service: input_boolean.turn_on
                                data: {}
                                target:
                                  entity_id:
                                    - >-
                                      input_boolean.vmc_master_spia_velocita_1_co2_o_voc_pdr
                                    - >-
                                      input_boolean.vmc_master_spia_co2_o_voc_partenza_ritorno_velocita_0
                                    - input_boolean.vmc_master_spia_co2_o_voc
                                    - >-
                                      input_boolean.vmc_master_spia_velocita_1_co2_o_voc
                              - service: shell_command.vmc_master_velocita_1
                                metadata: {}
                                data: {}
                            alias: CASO PDR OFF E INQUINANTI ON
                          - conditions:
                              - alias: Verifica CASO PDR OFF E INQUINANTI OFF
                                condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - service: shell_command.vmc_master_velocita_0
                                data: {}
                            alias: CASO PDR OFF E INQUINANTI OFF
                    alias: Interruttore PdR ON e Interruttore Inquinanti ON
                  - conditions:
                      - condition: and
                        conditions:
                          - condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr')=='on'}}
                            alias: Interruttore PdR ON
                          - alias: Interruttore Inquinanti OFF
                            condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc')=='off'}}
                    sequence:
                      - choose:
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                                alias: Verifica CASO PDR ON E INQUINANTI ON
                            sequence:
                              - service: shell_command.vmc_master_velocita_0
                                data: {}
                            alias: CASO PDR ON E INQUINANTI ON
                          - conditions:
                              - alias: Verifica CASO PDR ON E INQUINANTI OFF
                                condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - service: shell_command.vmc_master_velocita_0
                                data: {}
                            alias: CASO PDR ON E INQUINANTI OFF
                          - conditions:
                              - alias: Verifica CASO PDR OFF E INQUINANTI ON
                                condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - service: shell_command.vmc_master_velocita_0
                                data: {}
                            alias: CASO PDR OFF E INQUINANTI ON
                          - conditions:
                              - alias: Verifica CASO PDR OFF E INQUINANTI OFF
                                condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - service: shell_command.vmc_master_velocita_0
                                data: {}
                            alias: CASO PDR OFF E INQUINANTI OFF
                    alias: Interruttore PdR ON e Interruttore Inquinanti OFF
                  - conditions:
                      - condition: and
                        conditions:
                          - alias: Interruttore PdR OFF
                            condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr')=='off'}}
                          - condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc')=='on'}}
                            alias: Interruttore Inquinanti ON
                    sequence:
                      - choose:
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                                alias: Verifica CASO PDR ON E INQUINANTI ON
                            sequence:
                              - service: input_boolean.turn_on
                                data: {}
                                target:
                                  entity_id:
                                    - >-
                                      input_boolean.vmc_master_spia_velocita_1_co2_o_voc_pdr
                                    - >-
                                      input_boolean.vmc_master_spia_co2_o_voc_partenza_ritorno_velocita_0
                                    - input_boolean.vmc_master_spia_co2_o_voc
                                    - >-
                                      input_boolean.vmc_master_spia_velocita_1_co2_o_voc
                              - service: shell_command.vmc_master_velocita_1
                                metadata: {}
                                data: {}
                            alias: CASO PDR ON E INQUINANTI ON
                          - conditions:
                              - alias: Verifica CASO PDR ON E INQUINANTI OFF
                                condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - service: shell_command.vmc_master_velocita_0
                                data: {}
                            alias: CASO PDR ON E INQUINANTI OFF
                          - conditions:
                              - alias: Verifica CASO PDR OFF E INQUINANTI ON
                                condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - service: input_boolean.turn_on
                                data: {}
                                target:
                                  entity_id:
                                    - >-
                                      input_boolean.vmc_master_spia_velocita_1_co2_o_voc_pdr
                                    - >-
                                      input_boolean.vmc_master_spia_co2_o_voc_partenza_ritorno_velocita_0
                                    - input_boolean.vmc_master_spia_co2_o_voc
                                    - >-
                                      input_boolean.vmc_master_spia_velocita_1_co2_o_voc
                              - service: shell_command.vmc_master_velocita_1
                                metadata: {}
                                data: {}
                            alias: CASO PDR OFF E INQUINANTI ON
                          - conditions:
                              - alias: Verifica CASO PDR OFF E INQUINANTI OFF
                                condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - service: shell_command.vmc_master_velocita_0
                                data: {}
                            alias: CASO PDR OFF E INQUINANTI OFF
                    alias: Interruttore PdR OFF e Interruttore Inquinanti ON
                  - conditions:
                      - condition: and
                        conditions:
                          - alias: Interruttore PdR OFF
                            condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr')=='off'}}
                          - alias: Interruttore Inquinanti OFF
                            condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc')=='off'}}
                    sequence:
                      - choose:
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                                alias: Verifica CASO PDR ON E INQUINANTI ON
                            sequence:
                              - service: shell_command.vmc_master_velocita_0
                                data: {}
                            alias: CASO PDR ON E INQUINANTI ON
                          - conditions:
                              - alias: Verifica CASO PDR ON E INQUINANTI OFF
                                condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - service: shell_command.vmc_master_velocita_0
                                data: {}
                            alias: CASO PDR ON E INQUINANTI OFF
                          - conditions:
                              - alias: Verifica CASO PDR OFF E INQUINANTI ON
                                condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - service: shell_command.vmc_master_velocita_0
                                data: {}
                            alias: CASO PDR OFF E INQUINANTI ON
                          - conditions:
                              - alias: Verifica CASO PDR OFF E INQUINANTI OFF
                                condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - service: shell_command.vmc_master_velocita_0
                                data: {}
                            alias: CASO PDR OFF E INQUINANTI OFF
                    alias: Interruttore PdR OFF e Interruttore Inquinanti OFF
          - conditions:
              - alias: Velocità 1 in Assenza di Congelamento e Delta Temperatura
                condition: and
                conditions:
                  - condition: state
                    entity_id: sensor.vmc_master_speed_1_fascia_calendario
                    state: Velocità 1
                  - condition: template
                    value_template: >-
                      {{(states('input_boolean.vmc_master_congelamento_verifica_soglia_valore_spia')==
                      'off' and
                      states('input_boolean.vmc_master_delta_temp_verifica_soglia_valore_spia')==
                      'off')}}
                    alias: Congelamento Assente e Delta Temperatura Assente
            sequence:
              - service: input_boolean.turn_off
                data: {}
                target:
                  entity_id:
                    - >-
                      input_boolean.vmc_master_spia_co2_o_voc_partenza_ritorno_velocita_0
                    - input_boolean.vmc_master_spia_velocita_1_co2_o_voc_pdr
                    - input_boolean.vmc_master_spia_velocita_0_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_1_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_2_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_3_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_4_co2_o_voc
                    - >-
                      input_boolean.vmc_master_spia_velocita_iperventilazione_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_notturna_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_freecooling_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_0_un_solo_avvio
                    - input_boolean.vmc_master_spia_velocita_1_un_solo_avvio
                    - input_boolean.vmc_master_spia_velocita_2_un_solo_avvio
                    - input_boolean.vmc_master_spia_velocita_3_un_solo_avvio
                    - input_boolean.vmc_master_spia_velocita_4_un_solo_avvio
                    - input_boolean.vmc_master_spia_velocita_notturna_un_solo_avvio
                    - >-
                      input_boolean.vmc_master_spia_velocita_iperventilazione_un_solo_avvio
                    - >-
                      input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio
                    - >-
                      input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio_per_programmazione_freecooling
                    - >-
                      input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio_per_programmazione_freeheating
              - choose:
                  - conditions:
                      - condition: and
                        conditions:
                          - condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr')=='on'}}
                            alias: Interruttore PdR ON
                          - condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc')=='on'}}
                            alias: Interruttore Inquinanti ON
                    sequence:
                      - choose:
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - service: input_boolean.turn_on
                                metadata: {}
                                data: {}
                                target:
                                  entity_id:
                                    - >-
                                      input_boolean.vmc_master_spia_velocita_1_un_solo_avvio
                                    - >-
                                      input_boolean.vmc_master_spia_velocita_1_co2_o_voc
                              - service: shell_command.vmc_master_velocita_1
                                metadata: {}
                                data: {}
                            alias: CASO PDR ON E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - service: input_boolean.turn_on
                                metadata: {}
                                data: {}
                                target:
                                  entity_id: >-
                                    input_boolean.vmc_master_spia_velocita_1_un_solo_avvio
                              - service: shell_command.vmc_master_velocita_0
                                data: {}
                            alias: CASO PDR ON E INQUINANTI OFF
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - service: input_boolean.turn_on
                                metadata: {}
                                data: {}
                                target:
                                  entity_id:
                                    - >-
                                      input_boolean.vmc_master_spia_velocita_1_co2_o_voc
                              - service: shell_command.vmc_master_velocita_1
                                metadata: {}
                                data: {}
                            alias: CASO PDR OFF E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - service: shell_command.vmc_master_velocita_1
                                metadata: {}
                                data: {}
                            alias: CASO PDR OFF E INQUINANTI OFF
                    alias: Interruttore PdR ON e Interruttore Inquinanti ON
                  - conditions:
                      - condition: and
                        conditions:
                          - condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr')=='on'}}
                            alias: Interruttore PdR ON
                          - alias: Interruttore Inquinanti OFF
                            condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc')=='off'}}
                    sequence:
                      - choose:
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - service: input_boolean.turn_on
                                metadata: {}
                                data: {}
                                target:
                                  entity_id:
                                    - >-
                                      input_boolean.vmc_master_spia_velocita_1_un_solo_avvio
                              - service: shell_command.vmc_master_velocita_0
                                data: {}
                            alias: CASO PDR ON E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - service: input_boolean.turn_on
                                metadata: {}
                                data: {}
                                target:
                                  entity_id: >-
                                    input_boolean.vmc_master_spia_velocita_1_un_solo_avvio
                              - service: shell_command.vmc_master_velocita_0
                                data: {}
                            alias: CASO PDR ON E INQUINANTI OFF
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - service: shell_command.vmc_master_velocita_1
                                metadata: {}
                                data: {}
                            alias: CASO PDR OFF E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - service: shell_command.vmc_master_velocita_1
                                metadata: {}
                                data: {}
                            alias: CASO PDR OFF E INQUINANTI OFF
                    alias: Interruttore PdR ON e Interruttore Inquinanti OFF
                  - conditions:
                      - condition: and
                        conditions:
                          - alias: Interruttore PdR OFF
                            condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr')=='off'}}
                          - condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc')=='on'}}
                            alias: Interruttore Inquinanti ON
                    sequence:
                      - choose:
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - service: input_boolean.turn_on
                                metadata: {}
                                data: {}
                                target:
                                  entity_id:
                                    - >-
                                      input_boolean.vmc_master_spia_velocita_1_co2_o_voc
                              - service: shell_command.vmc_master_velocita_1
                                metadata: {}
                                data: {}
                            alias: CASO PDR ON E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - service: shell_command.vmc_master_velocita_1
                                data: {}
                            alias: CASO PDR ON E INQUINANTI OFF
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - service: input_boolean.turn_on
                                metadata: {}
                                data: {}
                                target:
                                  entity_id:
                                    - >-
                                      input_boolean.vmc_master_spia_velocita_1_co2_o_voc
                              - service: shell_command.vmc_master_velocita_1
                                metadata: {}
                                data: {}
                            alias: CASO PDR OFF E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - service: shell_command.vmc_master_velocita_1
                                metadata: {}
                                data: {}
                            alias: CASO PDR OFF E INQUINANTI OFF
                    alias: Interruttore PdR OFF e Interruttore Inquinanti ON
                  - conditions:
                      - condition: and
                        conditions:
                          - alias: Interruttore PdR OFF
                            condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr')=='off'}}
                          - alias: Interruttore Inquinanti OFF
                            condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc')=='off'}}
                    sequence:
                      - choose:
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - service: shell_command.vmc_master_velocita_1
                                data: {}
                            alias: CASO PDR ON E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - service: shell_command.vmc_master_velocita_1
                                data: {}
                            alias: CASO PDR ON E INQUINANTI OFF
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - service: shell_command.vmc_master_velocita_1
                                metadata: {}
                                data: {}
                            alias: CASO PDR OFF E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - service: shell_command.vmc_master_velocita_1
                                metadata: {}
                                data: {}
                            alias: CASO PDR OFF E INQUINANTI OFF
                    alias: Interruttore PdR OFF e Interruttore Inquinanti OFF
          - conditions:
              - alias: Velocità 2 in Assenza di Congelamento e Delta Temperatura
                condition: and
                conditions:
                  - condition: state
                    entity_id: sensor.vmc_master_speed_1_fascia_calendario
                    state: Velocità 2
                  - condition: template
                    value_template: >-
                      {{(states('input_boolean.vmc_master_congelamento_verifica_soglia_valore_spia')==
                      'off' and
                      states('input_boolean.vmc_master_delta_temp_verifica_soglia_valore_spia')==
                      'off')}}
                    alias: Congelamento Assente e Delta Temperatura Assente
            sequence:
              - service: input_boolean.turn_off
                data: {}
                target:
                  entity_id:
                    - >-
                      input_boolean.vmc_master_spia_co2_o_voc_partenza_ritorno_velocita_0
                    - input_boolean.vmc_master_spia_velocita_1_co2_o_voc_pdr
                    - input_boolean.vmc_master_spia_velocita_0_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_1_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_2_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_3_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_4_co2_o_voc
                    - >-
                      input_boolean.vmc_master_spia_velocita_iperventilazione_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_notturna_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_freecooling_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_0_un_solo_avvio
                    - input_boolean.vmc_master_spia_velocita_1_un_solo_avvio
                    - input_boolean.vmc_master_spia_velocita_2_un_solo_avvio
                    - input_boolean.vmc_master_spia_velocita_3_un_solo_avvio
                    - input_boolean.vmc_master_spia_velocita_4_un_solo_avvio
                    - input_boolean.vmc_master_spia_velocita_notturna_un_solo_avvio
                    - >-
                      input_boolean.vmc_master_spia_velocita_iperventilazione_un_solo_avvio
                    - >-
                      input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio
                    - >-
                      input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio_per_programmazione_freecooling
                    - >-
                      input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio_per_programmazione_freeheating
              - choose:
                  - conditions:
                      - condition: and
                        conditions:
                          - condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr')=='on'}}
                            alias: Interruttore PdR ON
                          - condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc')=='on'}}
                            alias: Interruttore Inquinanti ON
                    sequence:
                      - choose:
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - service: input_boolean.turn_on
                                metadata: {}
                                data: {}
                                target:
                                  entity_id:
                                    - >-
                                      input_boolean.vmc_master_spia_velocita_2_un_solo_avvio
                                    - >-
                                      input_boolean.vmc_master_spia_velocita_2_co2_o_voc
                              - service: shell_command.vmc_master_velocita_2
                                data: {}
                            alias: CASO PDR ON E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - service: input_boolean.turn_on
                                metadata: {}
                                data: {}
                                target:
                                  entity_id: >-
                                    input_boolean.vmc_master_spia_velocita_2_un_solo_avvio
                              - service: shell_command.vmc_master_velocita_0
                                data: {}
                            alias: CASO PDR ON E INQUINANTI OFF
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - service: input_boolean.turn_on
                                metadata: {}
                                data: {}
                                target:
                                  entity_id:
                                    - >-
                                      input_boolean.vmc_master_spia_velocita_2_co2_o_voc
                              - service: shell_command.vmc_master_velocita_2
                                data: {}
                            alias: CASO PDR OFF E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - service: shell_command.vmc_master_velocita_2
                                data: {}
                            alias: CASO PDR OFF E INQUINANTI OFF
                    alias: Interruttore PdR ON e Interruttore Inquinanti ON
                  - conditions:
                      - condition: and
                        conditions:
                          - condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr')=='on'}}
                            alias: Interruttore PdR ON
                          - alias: Interruttore Inquinanti OFF
                            condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc')=='off'}}
                    sequence:
                      - choose:
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - service: input_boolean.turn_on
                                metadata: {}
                                data: {}
                                target:
                                  entity_id:
                                    - >-
                                      input_boolean.vmc_master_spia_velocita_2_un_solo_avvio
                              - service: shell_command.vmc_master_velocita_0
                                data: {}
                            alias: CASO PDR ON E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - service: input_boolean.turn_on
                                metadata: {}
                                data: {}
                                target:
                                  entity_id: >-
                                    input_boolean.vmc_master_spia_velocita_2_un_solo_avvio
                              - service: shell_command.vmc_master_velocita_0
                                data: {}
                            alias: CASO PDR ON E INQUINANTI OFF
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - service: shell_command.vmc_master_velocita_2
                                data: {}
                            alias: CASO PDR OFF E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - service: shell_command.vmc_master_velocita_2
                                data: {}
                            alias: CASO PDR OFF E INQUINANTI OFF
                    alias: Interruttore PdR ON e Interruttore Inquinanti OFF
                  - conditions:
                      - condition: and
                        conditions:
                          - alias: Interruttore PdR OFF
                            condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr')=='off'}}
                          - condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc')=='on'}}
                            alias: Interruttore Inquinanti ON
                    sequence:
                      - choose:
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - service: input_boolean.turn_on
                                metadata: {}
                                data: {}
                                target:
                                  entity_id:
                                    - >-
                                      input_boolean.vmc_master_spia_velocita_2_co2_o_voc
                              - service: shell_command.vmc_master_velocita_2
                                data: {}
                            alias: CASO PDR ON E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - service: shell_command.vmc_master_velocita_2
                                data: {}
                            alias: CASO PDR ON E INQUINANTI OFF
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - service: input_boolean.turn_on
                                metadata: {}
                                data: {}
                                target:
                                  entity_id:
                                    - >-
                                      input_boolean.vmc_master_spia_velocita_2_co2_o_voc
                              - service: shell_command.vmc_master_velocita_2
                                data: {}
                            alias: CASO PDR OFF E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - service: shell_command.vmc_master_velocita_2
                                data: {}
                            alias: CASO PDR OFF E INQUINANTI OFF
                    alias: Interruttore PdR OFF e Interruttore Inquinanti ON
                  - conditions:
                      - condition: and
                        conditions:
                          - alias: Interruttore PdR OFF
                            condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr')=='off'}}
                          - alias: Interruttore Inquinanti OFF
                            condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc')=='off'}}
                    sequence:
                      - choose:
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - service: shell_command.vmc_master_velocita_2
                                data: {}
                            alias: CASO PDR ON E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - service: shell_command.vmc_master_velocita_2
                                data: {}
                            alias: CASO PDR ON E INQUINANTI OFF
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - service: shell_command.vmc_master_velocita_2
                                data: {}
                            alias: CASO PDR OFF E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - service: shell_command.vmc_master_velocita_2
                                data: {}
                            alias: CASO PDR OFF E INQUINANTI OFF
                    alias: Interruttore PdR OFF e Interruttore Inquinanti OFF
          - conditions:
              - alias: Velocità 3 in Assenza di Congelamento e Delta Temperatura
                condition: and
                conditions:
                  - condition: state
                    entity_id: sensor.vmc_master_speed_1_fascia_calendario
                    state: Velocità 3
                  - condition: template
                    value_template: >-
                      {{(states('input_boolean.vmc_master_congelamento_verifica_soglia_valore_spia')==
                      'off' and
                      states('input_boolean.vmc_master_delta_temp_verifica_soglia_valore_spia')==
                      'off')}}
                    alias: Congelamento Assente e Delta Temperatura Assente
            sequence:
              - service: input_boolean.turn_off
                data: {}
                target:
                  entity_id:
                    - >-
                      input_boolean.vmc_master_spia_co2_o_voc_partenza_ritorno_velocita_0
                    - input_boolean.vmc_master_spia_velocita_1_co2_o_voc_pdr
                    - input_boolean.vmc_master_spia_velocita_0_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_1_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_2_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_3_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_4_co2_o_voc
                    - >-
                      input_boolean.vmc_master_spia_velocita_iperventilazione_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_notturna_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_freecooling_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_0_un_solo_avvio
                    - input_boolean.vmc_master_spia_velocita_1_un_solo_avvio
                    - input_boolean.vmc_master_spia_velocita_2_un_solo_avvio
                    - input_boolean.vmc_master_spia_velocita_3_un_solo_avvio
                    - input_boolean.vmc_master_spia_velocita_4_un_solo_avvio
                    - input_boolean.vmc_master_spia_velocita_notturna_un_solo_avvio
                    - >-
                      input_boolean.vmc_master_spia_velocita_iperventilazione_un_solo_avvio
                    - >-
                      input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio
                    - >-
                      input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio_per_programmazione_freecooling
                    - >-
                      input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio_per_programmazione_freeheating
              - choose:
                  - conditions:
                      - condition: and
                        conditions:
                          - condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr')=='on'}}
                            alias: Interruttore PdR ON
                          - condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc')=='on'}}
                            alias: Interruttore Inquinanti ON
                    sequence:
                      - choose:
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - service: input_boolean.turn_on
                                metadata: {}
                                data: {}
                                target:
                                  entity_id:
                                    - >-
                                      input_boolean.vmc_master_spia_velocita_3_un_solo_avvio
                                    - >-
                                      input_boolean.vmc_master_spia_velocita_3_co2_o_voc
                              - service: shell_command.vmc_master_velocita_3
                                metadata: {}
                                data: {}
                            alias: CASO PDR ON E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - service: input_boolean.turn_on
                                metadata: {}
                                data: {}
                                target:
                                  entity_id: >-
                                    input_boolean.vmc_master_spia_velocita_3_un_solo_avvio
                              - service: shell_command.vmc_master_velocita_0
                                data: {}
                            alias: CASO PDR ON E INQUINANTI OFF
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - service: input_boolean.turn_on
                                metadata: {}
                                data: {}
                                target:
                                  entity_id:
                                    - >-
                                      input_boolean.vmc_master_spia_velocita_3_co2_o_voc
                              - service: shell_command.vmc_master_velocita_3
                                metadata: {}
                                data: {}
                            alias: CASO PDR OFF E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - service: shell_command.vmc_master_velocita_3
                                metadata: {}
                                data: {}
                            alias: CASO PDR OFF E INQUINANTI OFF
                    alias: Interruttore PdR ON e Interruttore Inquinanti ON
                  - conditions:
                      - condition: and
                        conditions:
                          - condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr')=='on'}}
                            alias: Interruttore PdR ON
                          - alias: Interruttore Inquinanti OFF
                            condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc')=='off'}}
                    sequence:
                      - choose:
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - service: input_boolean.turn_on
                                metadata: {}
                                data: {}
                                target:
                                  entity_id:
                                    - >-
                                      input_boolean.vmc_master_spia_velocita_3_un_solo_avvio
                              - service: shell_command.vmc_master_velocita_0
                                data: {}
                            alias: CASO PDR ON E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - service: input_boolean.turn_on
                                metadata: {}
                                data: {}
                                target:
                                  entity_id: >-
                                    input_boolean.vmc_master_spia_velocita_3_un_solo_avvio
                              - service: shell_command.vmc_master_velocita_0
                                data: {}
                            alias: CASO PDR ON E INQUINANTI OFF
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - service: shell_command.vmc_master_velocita_3
                                metadata: {}
                                data: {}
                            alias: CASO PDR OFF E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - service: shell_command.vmc_master_velocita_3
                                metadata: {}
                                data: {}
                            alias: CASO PDR OFF E INQUINANTI OFF
                    alias: Interruttore PdR ON e Interruttore Inquinanti OFF
                  - conditions:
                      - condition: and
                        conditions:
                          - alias: Interruttore PdR OFF
                            condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr')=='off'}}
                          - condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc')=='on'}}
                            alias: Interruttore Inquinanti ON
                    sequence:
                      - choose:
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - service: input_boolean.turn_on
                                metadata: {}
                                data: {}
                                target:
                                  entity_id:
                                    - >-
                                      input_boolean.vmc_master_spia_velocita_3_co2_o_voc
                              - service: shell_command.vmc_master_velocita_3
                                metadata: {}
                                data: {}
                            alias: CASO PDR ON E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - service: shell_command.vmc_master_velocita_3
                                data: {}
                            alias: CASO PDR ON E INQUINANTI OFF
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - service: input_boolean.turn_on
                                metadata: {}
                                data: {}
                                target:
                                  entity_id:
                                    - >-
                                      input_boolean.vmc_master_spia_velocita_3_co2_o_voc
                              - service: shell_command.vmc_master_velocita_3
                                metadata: {}
                                data: {}
                            alias: CASO PDR OFF E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - service: shell_command.vmc_master_velocita_3
                                metadata: {}
                                data: {}
                            alias: CASO PDR OFF E INQUINANTI OFF
                    alias: Interruttore PdR OFF e Interruttore Inquinanti ON
                  - conditions:
                      - condition: and
                        conditions:
                          - alias: Interruttore PdR OFF
                            condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr')=='off'}}
                          - alias: Interruttore Inquinanti OFF
                            condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc')=='off'}}
                    sequence:
                      - choose:
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - service: shell_command.vmc_master_velocita_3
                                data: {}
                            alias: CASO PDR ON E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - service: shell_command.vmc_master_velocita_3
                                data: {}
                            alias: CASO PDR ON E INQUINANTI OFF
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - service: shell_command.vmc_master_velocita_3
                                metadata: {}
                                data: {}
                            alias: CASO PDR OFF E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - service: shell_command.vmc_master_velocita_3
                                metadata: {}
                                data: {}
                            alias: CASO PDR OFF E INQUINANTI OFF
                    alias: Interruttore PdR OFF e Interruttore Inquinanti OFF
          - conditions:
              - alias: Velocità 4 in Assenza di Congelamento e Delta Temperatura
                condition: and
                conditions:
                  - condition: state
                    entity_id: sensor.vmc_master_speed_1_fascia_calendario
                    state: Velocità 4
                  - condition: template
                    value_template: >-
                      {{(states('input_boolean.vmc_master_congelamento_verifica_soglia_valore_spia')==
                      'off' and
                      states('input_boolean.vmc_master_delta_temp_verifica_soglia_valore_spia')==
                      'off')}}
                    alias: Congelamento Assente e Delta Temperatura Assente
            sequence:
              - service: input_boolean.turn_off
                data: {}
                target:
                  entity_id:
                    - >-
                      input_boolean.vmc_master_spia_co2_o_voc_partenza_ritorno_velocita_0
                    - input_boolean.vmc_master_spia_velocita_1_co2_o_voc_pdr
                    - input_boolean.vmc_master_spia_velocita_0_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_1_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_2_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_3_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_4_co2_o_voc
                    - >-
                      input_boolean.vmc_master_spia_velocita_iperventilazione_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_notturna_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_freecooling_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_0_un_solo_avvio
                    - input_boolean.vmc_master_spia_velocita_1_un_solo_avvio
                    - input_boolean.vmc_master_spia_velocita_2_un_solo_avvio
                    - input_boolean.vmc_master_spia_velocita_3_un_solo_avvio
                    - input_boolean.vmc_master_spia_velocita_4_un_solo_avvio
                    - input_boolean.vmc_master_spia_velocita_notturna_un_solo_avvio
                    - >-
                      input_boolean.vmc_master_spia_velocita_iperventilazione_un_solo_avvio
                    - >-
                      input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio
                    - >-
                      input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio_per_programmazione_freecooling
                    - >-
                      input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio_per_programmazione_freeheating
              - choose:
                  - conditions:
                      - condition: and
                        conditions:
                          - condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr')=='on'}}
                            alias: Interruttore PdR ON
                          - condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc')=='on'}}
                            alias: Interruttore Inquinanti ON
                    sequence:
                      - choose:
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - service: input_boolean.turn_on
                                metadata: {}
                                data: {}
                                target:
                                  entity_id:
                                    - >-
                                      input_boolean.vmc_master_spia_velocita_4_un_solo_avvio
                                    - >-
                                      input_boolean.vmc_master_spia_velocita_4_co2_o_voc
                              - service: shell_command.vmc_master_velocita_4
                                metadata: {}
                                data: {}
                            alias: CASO PDR ON E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - service: input_boolean.turn_on
                                metadata: {}
                                data: {}
                                target:
                                  entity_id: >-
                                    input_boolean.vmc_master_spia_velocita_4_un_solo_avvio
                              - service: shell_command.vmc_master_velocita_0
                                data: {}
                            alias: CASO PDR ON E INQUINANTI OFF
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - service: input_boolean.turn_on
                                metadata: {}
                                data: {}
                                target:
                                  entity_id:
                                    - >-
                                      input_boolean.vmc_master_spia_velocita_4_co2_o_voc
                              - service: shell_command.vmc_master_velocita_4
                                metadata: {}
                                data: {}
                            alias: CASO PDR OFF E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - service: shell_command.vmc_master_velocita_4
                                metadata: {}
                                data: {}
                            alias: CASO PDR OFF E INQUINANTI OFF
                    alias: Interruttore PdR ON e Interruttore Inquinanti ON
                  - conditions:
                      - condition: and
                        conditions:
                          - condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr')=='on'}}
                            alias: Interruttore PdR ON
                          - alias: Interruttore Inquinanti OFF
                            condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc')=='off'}}
                    sequence:
                      - choose:
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - service: input_boolean.turn_on
                                metadata: {}
                                data: {}
                                target:
                                  entity_id:
                                    - >-
                                      input_boolean.vmc_master_spia_velocita_4_un_solo_avvio
                              - service: shell_command.vmc_master_velocita_0
                                data: {}
                            alias: CASO PDR ON E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - service: input_boolean.turn_on
                                metadata: {}
                                data: {}
                                target:
                                  entity_id: >-
                                    input_boolean.vmc_master_spia_velocita_4_un_solo_avvio
                              - service: shell_command.vmc_master_velocita_0
                                data: {}
                            alias: CASO PDR ON E INQUINANTI OFF
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - service: shell_command.vmc_master_velocita_4
                                metadata: {}
                                data: {}
                            alias: CASO PDR OFF E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - service: shell_command.vmc_master_velocita_4
                                metadata: {}
                                data: {}
                            alias: CASO PDR OFF E INQUINANTI OFF
                    alias: Interruttore PdR ON e Interruttore Inquinanti OFF
                  - conditions:
                      - condition: and
                        conditions:
                          - alias: Interruttore PdR OFF
                            condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr')=='off'}}
                          - condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc')=='on'}}
                            alias: Interruttore Inquinanti ON
                    sequence:
                      - choose:
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - service: input_boolean.turn_on
                                metadata: {}
                                data: {}
                                target:
                                  entity_id:
                                    - >-
                                      input_boolean.vmc_master_spia_velocita_4_co2_o_voc
                              - service: shell_command.vmc_master_velocita_4
                                metadata: {}
                                data: {}
                            alias: CASO PDR ON E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - service: shell_command.vmc_master_velocita_4
                                data: {}
                            alias: CASO PDR ON E INQUINANTI OFF
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - service: input_boolean.turn_on
                                metadata: {}
                                data: {}
                                target:
                                  entity_id:
                                    - >-
                                      input_boolean.vmc_master_spia_velocita_4_co2_o_voc
                              - service: shell_command.vmc_master_velocita_4
                                metadata: {}
                                data: {}
                            alias: CASO PDR OFF E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - service: shell_command.vmc_master_velocita_4
                                metadata: {}
                                data: {}
                            alias: CASO PDR OFF E INQUINANTI OFF
                    alias: Interruttore PdR OFF e Interruttore Inquinanti ON
                  - conditions:
                      - condition: and
                        conditions:
                          - alias: Interruttore PdR OFF
                            condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr')=='off'}}
                          - alias: Interruttore Inquinanti OFF
                            condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc')=='off'}}
                    sequence:
                      - choose:
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - service: shell_command.vmc_master_velocita_4
                                data: {}
                            alias: CASO PDR ON E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - service: shell_command.vmc_master_velocita_4
                                data: {}
                            alias: CASO PDR ON E INQUINANTI OFF
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - service: shell_command.vmc_master_velocita_4
                                metadata: {}
                                data: {}
                            alias: CASO PDR OFF E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - service: shell_command.vmc_master_velocita_4
                                metadata: {}
                                data: {}
                            alias: CASO PDR OFF E INQUINANTI OFF
                    alias: Interruttore PdR OFF e Interruttore Inquinanti OFF
          - conditions:
              - alias: Velocità Notturna in Assenza di Congelamento e Delta Temperatura
                condition: and
                conditions:
                  - condition: state
                    entity_id: sensor.vmc_master_speed_1_fascia_calendario
                    state: Notturna
                  - condition: template
                    value_template: >-
                      {{(states('input_boolean.vmc_master_congelamento_verifica_soglia_valore_spia')==
                      'off' and
                      states('input_boolean.vmc_master_delta_temp_verifica_soglia_valore_spia')==
                      'off')}}
                    alias: Congelamento Assente e Delta Temperatura Assente
            sequence:
              - service: input_boolean.turn_off
                data: {}
                target:
                  entity_id:
                    - >-
                      input_boolean.vmc_master_spia_co2_o_voc_partenza_ritorno_velocita_0
                    - input_boolean.vmc_master_spia_velocita_1_co2_o_voc_pdr
                    - input_boolean.vmc_master_spia_velocita_0_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_1_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_2_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_3_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_4_co2_o_voc
                    - >-
                      input_boolean.vmc_master_spia_velocita_iperventilazione_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_notturna_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_freecooling_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_0_un_solo_avvio
                    - input_boolean.vmc_master_spia_velocita_1_un_solo_avvio
                    - input_boolean.vmc_master_spia_velocita_2_un_solo_avvio
                    - input_boolean.vmc_master_spia_velocita_3_un_solo_avvio
                    - input_boolean.vmc_master_spia_velocita_4_un_solo_avvio
                    - input_boolean.vmc_master_spia_velocita_notturna_un_solo_avvio
                    - >-
                      input_boolean.vmc_master_spia_velocita_iperventilazione_un_solo_avvio
                    - >-
                      input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio
                    - >-
                      input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio_per_programmazione_freecooling
                    - >-
                      input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio_per_programmazione_freeheating
              - choose:
                  - conditions:
                      - condition: and
                        conditions:
                          - condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr')=='on'}}
                            alias: Interruttore PdR ON
                          - condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc')=='on'}}
                            alias: Interruttore Inquinanti ON
                    sequence:
                      - choose:
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - service: input_boolean.turn_on
                                metadata: {}
                                data: {}
                                target:
                                  entity_id:
                                    - >-
                                      input_boolean.vmc_master_spia_velocita_notturna_un_solo_avvio
                                    - >-
                                      input_boolean.vmc_master_spia_velocita_notturna_co2_o_voc
                              - service: shell_command.vmc_master_notturna
                                data: {}
                            alias: CASO PDR ON E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - service: input_boolean.turn_on
                                metadata: {}
                                data: {}
                                target:
                                  entity_id: >-
                                    input_boolean.vmc_master_spia_velocita_notturna_un_solo_avvio
                              - service: shell_command.vmc_master_velocita_0
                                data: {}
                            alias: CASO PDR ON E INQUINANTI OFF
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - service: input_boolean.turn_on
                                metadata: {}
                                data: {}
                                target:
                                  entity_id:
                                    - >-
                                      input_boolean.vmc_master_spia_velocita_notturna_co2_o_voc
                              - service: shell_command.vmc_master_notturna
                                data: {}
                            alias: CASO PDR OFF E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - service: shell_command.vmc_master_notturna
                                data: {}
                            alias: CASO PDR OFF E INQUINANTI OFF
                    alias: Interruttore PdR ON e Interruttore Inquinanti ON
                  - conditions:
                      - condition: and
                        conditions:
                          - condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr')=='on'}}
                            alias: Interruttore PdR ON
                          - alias: Interruttore Inquinanti OFF
                            condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc')=='off'}}
                    sequence:
                      - choose:
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - service: input_boolean.turn_on
                                metadata: {}
                                data: {}
                                target:
                                  entity_id:
                                    - >-
                                      input_boolean.vmc_master_spia_velocita_notturna_un_solo_avvio
                              - service: shell_command.vmc_master_velocita_0
                                data: {}
                            alias: CASO PDR ON E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - service: input_boolean.turn_on
                                metadata: {}
                                data: {}
                                target:
                                  entity_id: >-
                                    input_boolean.vmc_master_spia_velocita_notturna_un_solo_avvio
                              - service: shell_command.vmc_master_velocita_0
                                data: {}
                            alias: CASO PDR ON E INQUINANTI OFF
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - service: shell_command.vmc_master_notturna
                                data: {}
                            alias: CASO PDR OFF E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - service: shell_command.vmc_master_notturna
                                data: {}
                            alias: CASO PDR OFF E INQUINANTI OFF
                    alias: Interruttore PdR ON e Interruttore Inquinanti OFF
                  - conditions:
                      - condition: and
                        conditions:
                          - alias: Interruttore PdR OFF
                            condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr')=='off'}}
                          - condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc')=='on'}}
                            alias: Interruttore Inquinanti ON
                    sequence:
                      - choose:
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - service: input_boolean.turn_on
                                metadata: {}
                                data: {}
                                target:
                                  entity_id:
                                    - >-
                                      input_boolean.vmc_master_spia_velocita_notturna_co2_o_voc
                              - service: shell_command.vmc_master_notturna
                                data: {}
                            alias: CASO PDR ON E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - service: shell_command.vmc_master_notturna
                                data: {}
                            alias: CASO PDR ON E INQUINANTI OFF
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - service: input_boolean.turn_on
                                metadata: {}
                                data: {}
                                target:
                                  entity_id:
                                    - >-
                                      input_boolean.vmc_master_spia_velocita_notturna_co2_o_voc
                              - service: shell_command.vmc_master_notturna
                                data: {}
                            alias: CASO PDR OFF E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - service: shell_command.vmc_master_notturna
                                data: {}
                            alias: CASO PDR OFF E INQUINANTI OFF
                    alias: Interruttore PdR OFF e Interruttore Inquinanti ON
                  - conditions:
                      - condition: and
                        conditions:
                          - alias: Interruttore PdR OFF
                            condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr')=='off'}}
                          - alias: Interruttore Inquinanti OFF
                            condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc')=='off'}}
                    sequence:
                      - choose:
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - service: shell_command.vmc_master_notturna
                                data: {}
                            alias: CASO PDR ON E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - service: shell_command.vmc_master_notturna
                                data: {}
                            alias: CASO PDR ON E INQUINANTI OFF
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - service: shell_command.vmc_master_notturna
                                data: {}
                            alias: CASO PDR OFF E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - service: shell_command.vmc_master_notturna
                                data: {}
                            alias: CASO PDR OFF E INQUINANTI OFF
                    alias: Interruttore PdR OFF e Interruttore Inquinanti OFF
          - conditions:
              - alias: >-
                  Velocità Iperventilazione in Assenza di Congelamento e Delta
                  Temperatura
                condition: and
                conditions:
                  - condition: state
                    entity_id: sensor.vmc_master_speed_1_fascia_calendario
                    state: Iperventilazione
                  - condition: template
                    value_template: >-
                      {{(states('input_boolean.vmc_master_congelamento_verifica_soglia_valore_spia')==
                      'off' and
                      states('input_boolean.vmc_master_delta_temp_verifica_soglia_valore_spia')==
                      'off')}}
                    alias: Congelamento Assente e Delta Temperatura Assente
            sequence:
              - service: input_boolean.turn_off
                data: {}
                target:
                  entity_id:
                    - >-
                      input_boolean.vmc_master_spia_co2_o_voc_partenza_ritorno_velocita_0
                    - input_boolean.vmc_master_spia_velocita_1_co2_o_voc_pdr
                    - input_boolean.vmc_master_spia_velocita_0_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_1_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_2_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_3_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_4_co2_o_voc
                    - >-
                      input_boolean.vmc_master_spia_velocita_iperventilazione_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_notturna_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_freecooling_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_0_un_solo_avvio
                    - input_boolean.vmc_master_spia_velocita_1_un_solo_avvio
                    - input_boolean.vmc_master_spia_velocita_2_un_solo_avvio
                    - input_boolean.vmc_master_spia_velocita_3_un_solo_avvio
                    - input_boolean.vmc_master_spia_velocita_4_un_solo_avvio
                    - input_boolean.vmc_master_spia_velocita_notturna_un_solo_avvio
                    - >-
                      input_boolean.vmc_master_spia_velocita_iperventilazione_un_solo_avvio
                    - >-
                      input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio
                    - >-
                      input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio_per_programmazione_freecooling
                    - >-
                      input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio_per_programmazione_freeheating
              - choose:
                  - conditions:
                      - condition: and
                        conditions:
                          - condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr')=='on'}}
                            alias: Interruttore PdR ON
                          - condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc')=='on'}}
                            alias: Interruttore Inquinanti ON
                    sequence:
                      - choose:
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - service: input_boolean.turn_on
                                metadata: {}
                                data: {}
                                target:
                                  entity_id:
                                    - >-
                                      input_boolean.vmc_master_spia_velocita_iperventilazione_un_solo_avvio
                                    - >-
                                      input_boolean.vmc_master_spia_velocita_iperventilazione_co2_o_voc
                              - service: shell_command.vmc_master_iperventilazione
                                data: {}
                            alias: CASO PDR ON E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - service: input_boolean.turn_on
                                metadata: {}
                                data: {}
                                target:
                                  entity_id: >-
                                    input_boolean.vmc_master_spia_velocita_iperventilazione_un_solo_avvio
                              - service: shell_command.vmc_master_velocita_0
                                data: {}
                            alias: CASO PDR ON E INQUINANTI OFF
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - service: input_boolean.turn_on
                                metadata: {}
                                data: {}
                                target:
                                  entity_id:
                                    - >-
                                      input_boolean.vmc_master_spia_velocita_iperventilazione_co2_o_voc
                              - service: shell_command.vmc_master_iperventilazione
                                data: {}
                            alias: CASO PDR OFF E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - service: shell_command.vmc_master_iperventilazione
                                data: {}
                            alias: CASO PDR OFF E INQUINANTI OFF
                    alias: Interruttore PdR ON e Interruttore Inquinanti ON
                  - conditions:
                      - condition: and
                        conditions:
                          - condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr')=='on'}}
                            alias: Interruttore PdR ON
                          - alias: Interruttore Inquinanti OFF
                            condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc')=='off'}}
                    sequence:
                      - choose:
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - service: input_boolean.turn_on
                                metadata: {}
                                data: {}
                                target:
                                  entity_id:
                                    - >-
                                      input_boolean.vmc_master_spia_velocita_iperventilazione_un_solo_avvio
                              - service: shell_command.vmc_master_velocita_0
                                data: {}
                            alias: CASO PDR ON E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - service: input_boolean.turn_on
                                metadata: {}
                                data: {}
                                target:
                                  entity_id: >-
                                    input_boolean.vmc_master_spia_velocita_iperventilazione_un_solo_avvio
                              - service: shell_command.vmc_master_velocita_0
                                data: {}
                            alias: CASO PDR ON E INQUINANTI OFF
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - service: shell_command.vmc_master_iperventilazione
                                data: {}
                            alias: CASO PDR OFF E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - service: shell_command.vmc_master_iperventilazione
                                data: {}
                            alias: CASO PDR OFF E INQUINANTI OFF
                    alias: Interruttore PdR ON e Interruttore Inquinanti OFF
                  - conditions:
                      - condition: and
                        conditions:
                          - alias: Interruttore PdR OFF
                            condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr')=='off'}}
                          - condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc')=='on'}}
                            alias: Interruttore Inquinanti ON
                    sequence:
                      - choose:
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - service: input_boolean.turn_on
                                metadata: {}
                                data: {}
                                target:
                                  entity_id:
                                    - >-
                                      input_boolean.vmc_master_spia_velocita_iperventilazione_co2_o_voc
                              - service: shell_command.vmc_master_iperventilazione
                                data: {}
                            alias: CASO PDR ON E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - service: shell_command.vmc_master_iperventilazione
                                data: {}
                            alias: CASO PDR ON E INQUINANTI OFF
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - service: input_boolean.turn_on
                                metadata: {}
                                data: {}
                                target:
                                  entity_id:
                                    - >-
                                      input_boolean.vmc_master_spia_velocita_iperventilazione_co2_o_voc
                              - service: shell_command.vmc_master_iperventilazione
                                data: {}
                            alias: CASO PDR OFF E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - service: shell_command.vmc_master_iperventilazione
                                data: {}
                            alias: CASO PDR OFF E INQUINANTI OFF
                    alias: Interruttore PdR OFF e Interruttore Inquinanti ON
                  - conditions:
                      - condition: and
                        conditions:
                          - alias: Interruttore PdR OFF
                            condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr')=='off'}}
                          - alias: Interruttore Inquinanti OFF
                            condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc')=='off'}}
                    sequence:
                      - choose:
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - service: shell_command.vmc_master_iperventilazione
                                data: {}
                            alias: CASO PDR ON E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - service: shell_command.vmc_master_iperventilazione
                                data: {}
                            alias: CASO PDR ON E INQUINANTI OFF
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - service: shell_command.vmc_master_iperventilazione
                                data: {}
                            alias: CASO PDR OFF E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - service: shell_command.vmc_master_iperventilazione
                                data: {}
                            alias: CASO PDR OFF E INQUINANTI OFF
                    alias: Interruttore PdR OFF e Interruttore Inquinanti OFF
          - conditions:
              - alias: >-
                  Velocità Free Cool./Heat. in Assenza di Congelamento e Delta
                  Temperatura
                condition: and
                conditions:
                  - condition: state
                    entity_id: sensor.vmc_master_speed_1_fascia_calendario
                    state: Free Cool./Heat.
                  - condition: template
                    value_template: >-
                      {{(states('input_boolean.vmc_master_congelamento_verifica_soglia_valore_spia')==
                      'off' and
                      states('input_boolean.vmc_master_delta_temp_verifica_soglia_valore_spia')==
                      'off')}}
                    alias: Congelamento Assente e Delta Temperatura Assente
            sequence:
              - service: input_boolean.turn_off
                data: {}
                target:
                  entity_id:
                    - >-
                      input_boolean.vmc_master_spia_co2_o_voc_partenza_ritorno_velocita_0
                    - input_boolean.vmc_master_spia_velocita_1_co2_o_voc_pdr
                    - input_boolean.vmc_master_spia_velocita_0_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_1_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_2_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_3_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_4_co2_o_voc
                    - >-
                      input_boolean.vmc_master_spia_velocita_iperventilazione_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_notturna_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_freecooling_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_0_un_solo_avvio
                    - input_boolean.vmc_master_spia_velocita_1_un_solo_avvio
                    - input_boolean.vmc_master_spia_velocita_2_un_solo_avvio
                    - input_boolean.vmc_master_spia_velocita_3_un_solo_avvio
                    - input_boolean.vmc_master_spia_velocita_4_un_solo_avvio
                    - input_boolean.vmc_master_spia_velocita_notturna_un_solo_avvio
                    - >-
                      input_boolean.vmc_master_spia_velocita_iperventilazione_un_solo_avvio
                    - >-
                      input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio
                    - >-
                      input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio_per_programmazione_freecooling
                    - >-
                      input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio_per_programmazione_freeheating
              - choose:
                  - conditions:
                      - alias: Verifica Programmato Mese Free Heating
                        condition: template
                        value_template: >-
                          {{
                          states('sensor.vmc_master_status_mese_corrente_freeheating_o_freecooling')
                          == "Free Heating" }}
                    sequence:
                      - alias: Spia Free Heating ON o Spia Free Heating OFF ?
                        choose:
                          - conditions:
                              - alias: Allerte Free Heating ON
                                condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_alert_monitoraggio_free_heating_o_free_cooling_allert_interfaccia_avvisi')
                                  != "Nessuna Allerta Free Heating Programmato" or
                                  states('sensor.vmc_master_alert_monitoraggio_free_heating_o_free_cooling_allert_interfaccia_avvisi')
                                  != "Nessuna Allerta Free Heating Programmato,
                                  Presenza di Inquinanti" }}
                            sequence:
                              - choose:
                                  - conditions:
                                      - condition: and
                                        conditions:
                                          - condition: template
                                            value_template: >-
                                              {{
                                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr')=='on'}}
                                            alias: Interruttore PdR ON
                                          - condition: template
                                            value_template: >-
                                              {{
                                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc')=='on'}}
                                            alias: Interruttore Inquinanti ON
                                    sequence:
                                      - choose:
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Allerta' or
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Allerta')}}
                                            sequence:
                                              - service: input_boolean.turn_on
                                                metadata: {}
                                                data: {}
                                                target:
                                                  entity_id:
                                                    - >-
                                                      input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio
                                                    - >-
                                                      input_boolean.vmc_master_spia_velocita_1_co2_o_voc
                                                    - >-
                                                      input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio_per_programmazione_freeheating
                                              - service: shell_command.vmc_master_velocita_1
                                                metadata: {}
                                                data: {}
                                            alias: CASO PDR ON E INQUINANTI ON
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Nessuna Allerta' and
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Nessuna Allerta')}}
                                            sequence:
                                              - service: input_boolean.turn_on
                                                metadata: {}
                                                data: {}
                                                target:
                                                  entity_id:
                                                    - >-
                                                      input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio_per_programmazione_freeheating
                                                    - >-
                                                      input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio
                                              - service: shell_command.vmc_master_velocita_0
                                                data: {}
                                            alias: CASO PDR ON E INQUINANTI OFF
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Allerta' or
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Allerta')}}
                                            sequence:
                                              - service: input_boolean.turn_on
                                                metadata: {}
                                                data: {}
                                                target:
                                                  entity_id:
                                                    - >-
                                                      input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio_per_programmazione_freeheating
                                                    - >-
                                                      input_boolean.vmc_master_spia_velocita_1_co2_o_voc
                                              - service: shell_command.vmc_master_velocita_1
                                                metadata: {}
                                                data: {}
                                            alias: CASO PDR OFF E INQUINANTI ON
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Nessuna Allerta' and
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Nessuna Allerta')}}
                                            sequence:
                                              - service: input_boolean.turn_on
                                                metadata: {}
                                                data: {}
                                                target:
                                                  entity_id: >-
                                                    input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio_per_programmazione_freeheating
                                              - service: shell_command.vmc_master_velocita_0
                                                data: {}
                                            alias: CASO PDR OFF E INQUINANTI OFF
                                    alias: >-
                                      Interruttore PdR ON e Interruttore Inquinanti
                                      ON
                                  - conditions:
                                      - condition: and
                                        conditions:
                                          - condition: template
                                            value_template: >-
                                              {{
                                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr')=='on'}}
                                            alias: Interruttore PdR ON
                                          - alias: Interruttore Inquinanti OFF
                                            condition: template
                                            value_template: >-
                                              {{
                                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc')=='off'}}
                                    sequence:
                                      - choose:
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Allerta' or
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Allerta')}}
                                            sequence:
                                              - service: input_boolean.turn_on
                                                metadata: {}
                                                data: {}
                                                target:
                                                  entity_id:
                                                    - >-
                                                      input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio
                                                    - >-
                                                      input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio_per_programmazione_freeheating
                                              - service: shell_command.vmc_master_velocita_0
                                                data: {}
                                            alias: CASO PDR ON E INQUINANTI ON
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Nessuna Allerta' and
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Nessuna Allerta')}}
                                            sequence:
                                              - service: input_boolean.turn_on
                                                metadata: {}
                                                data: {}
                                                target:
                                                  entity_id:
                                                    - >-
                                                      input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio
                                                    - >-
                                                      input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio_per_programmazione_freeheating
                                              - service: shell_command.vmc_master_velocita_0
                                                data: {}
                                            alias: CASO PDR ON E INQUINANTI OFF
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Allerta' or
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Allerta')}}
                                            sequence:
                                              - service: input_boolean.turn_on
                                                metadata: {}
                                                data: {}
                                                target:
                                                  entity_id:
                                                    - >-
                                                      input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio_per_programmazione_freeheating
                                              - service: shell_command.vmc_master_velocita_0
                                                data: {}
                                            alias: CASO PDR OFF E INQUINANTI ON
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Nessuna Allerta' and
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Nessuna Allerta')}}
                                            sequence:
                                              - service: input_boolean.turn_on
                                                metadata: {}
                                                data: {}
                                                target:
                                                  entity_id:
                                                    - >-
                                                      input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio_per_programmazione_freeheating
                                              - service: shell_command.vmc_master_velocita_0
                                                data: {}
                                            alias: CASO PDR OFF E INQUINANTI OFF
                                    alias: >-
                                      Interruttore PdR ON e Interruttore Inquinanti
                                      OFF
                                  - conditions:
                                      - condition: and
                                        conditions:
                                          - alias: Interruttore PdR OFF
                                            condition: template
                                            value_template: >-
                                              {{
                                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr')=='off'}}
                                          - condition: template
                                            value_template: >-
                                              {{
                                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc')=='on'}}
                                            alias: Interruttore Inquinanti ON
                                    sequence:
                                      - choose:
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Allerta' or
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Allerta')}}
                                            sequence:
                                              - service: input_boolean.turn_on
                                                metadata: {}
                                                data: {}
                                                target:
                                                  entity_id:
                                                    - >-
                                                      input_boolean.vmc_master_spia_velocita_1_co2_o_voc
                                                    - >-
                                                      input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio_per_programmazione_freeheating
                                              - service: shell_command.vmc_master_velocita_1
                                                metadata: {}
                                                data: {}
                                            alias: CASO PDR ON E INQUINANTI ON
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Nessuna Allerta' and
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Nessuna Allerta')}}
                                            sequence:
                                              - service: input_boolean.turn_on
                                                metadata: {}
                                                data: {}
                                                target:
                                                  entity_id:
                                                    - >-
                                                      input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio_per_programmazione_freeheating
                                              - service: shell_command.vmc_master_velocita_0
                                                data: {}
                                            alias: CASO PDR ON E INQUINANTI OFF
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Allerta' or
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Allerta')}}
                                            sequence:
                                              - service: input_boolean.turn_on
                                                metadata: {}
                                                data: {}
                                                target:
                                                  entity_id:
                                                    - >-
                                                      input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio_per_programmazione_freeheating
                                                    - >-
                                                      input_boolean.vmc_master_spia_velocita_1_co2_o_voc
                                              - service: shell_command.vmc_master_velocita_1
                                                metadata: {}
                                                data: {}
                                            alias: CASO PDR OFF E INQUINANTI ON
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Nessuna Allerta' and
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Nessuna Allerta')}}
                                            sequence:
                                              - service: input_boolean.turn_on
                                                metadata: {}
                                                data: {}
                                                target:
                                                  entity_id: >-
                                                    input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio_per_programmazione_freeheating
                                              - service: shell_command.vmc_master_velocita_0
                                                data: {}
                                            alias: CASO PDR OFF E INQUINANTI OFF
                                    alias: >-
                                      Interruttore PdR OFF e Interruttore Inquinanti
                                      ON
                                  - conditions:
                                      - condition: and
                                        conditions:
                                          - alias: Interruttore PdR OFF
                                            condition: template
                                            value_template: >-
                                              {{
                                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr')=='off'}}
                                          - alias: Interruttore Inquinanti OFF
                                            condition: template
                                            value_template: >-
                                              {{
                                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc')=='off'}}
                                    sequence:
                                      - choose:
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Allerta' or
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Allerta')}}
                                            sequence:
                                              - service: input_boolean.turn_on
                                                metadata: {}
                                                data: {}
                                                target:
                                                  entity_id:
                                                    - >-
                                                      input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio_per_programmazione_freeheating
                                              - service: shell_command.vmc_master_velocita_0
                                                data: {}
                                            alias: CASO PDR ON E INQUINANTI ON
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Nessuna Allerta' and
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Nessuna Allerta')}}
                                            sequence:
                                              - service: input_boolean.turn_on
                                                metadata: {}
                                                data: {}
                                                target:
                                                  entity_id:
                                                    - >-
                                                      input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio_per_programmazione_freeheating
                                              - service: shell_command.vmc_master_velocita_0
                                                data: {}
                                            alias: CASO PDR ON E INQUINANTI OFF
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Allerta' or
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Allerta')}}
                                            sequence:
                                              - service: input_boolean.turn_on
                                                metadata: {}
                                                data: {}
                                                target:
                                                  entity_id:
                                                    - >-
                                                      input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio_per_programmazione_freeheating
                                              - service: shell_command.vmc_master_velocita_0
                                                data: {}
                                            alias: CASO PDR OFF E INQUINANTI ON
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Nessuna Allerta' and
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Nessuna Allerta')}}
                                            sequence:
                                              - service: input_boolean.turn_on
                                                metadata: {}
                                                data: {}
                                                target:
                                                  entity_id:
                                                    - >-
                                                      input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio_per_programmazione_freeheating
                                              - service: shell_command.vmc_master_velocita_0
                                                data: {}
                                            alias: CASO PDR OFF E INQUINANTI OFF
                                    alias: >-
                                      Interruttore PdR OFF e Interruttore Inquinanti
                                      OFF
                            alias: Spia Free Heating ON
                          - conditions:
                              - alias: Allerte Free Heating OFF
                                condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_alert_monitoraggio_free_heating_o_free_cooling_allert_interfaccia_avvisi')
                                  == "Nessuna Allerta Free Heating Programmato" or
                                  states('sensor.vmc_master_alert_monitoraggio_free_heating_o_free_cooling_allert_interfaccia_avvisi')
                                  == "Nessuna Allerta Free Heating Programmato,
                                  Presenza di Inquinanti" }}
                            sequence:
                              - choose:
                                  - conditions:
                                      - condition: and
                                        conditions:
                                          - condition: template
                                            value_template: >-
                                              {{
                                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr')=='on'}}
                                            alias: Interruttore PdR ON
                                          - condition: template
                                            value_template: >-
                                              {{
                                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc')=='on'}}
                                            alias: Interruttore Inquinanti ON
                                    sequence:
                                      - choose:
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Allerta' or
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Allerta')}}
                                            sequence:
                                              - service: input_boolean.turn_on
                                                metadata: {}
                                                data: {}
                                                target:
                                                  entity_id:
                                                    - >-
                                                      input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio
                                                    - >-
                                                      input_boolean.vmc_master_spia_velocita_freecooling_co2_o_voc
                                              - service: shell_command.vmc_master_freecooling
                                                data: {}
                                            alias: CASO PDR ON E INQUINANTI ON
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Nessuna Allerta' and
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Nessuna Allerta')}}
                                            sequence:
                                              - service: input_boolean.turn_on
                                                metadata: {}
                                                data: {}
                                                target:
                                                  entity_id: >-
                                                    input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio
                                              - service: shell_command.vmc_master_velocita_0
                                                data: {}
                                            alias: CASO PDR ON E INQUINANTI OFF
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Allerta' or
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Allerta')}}
                                            sequence:
                                              - service: input_boolean.turn_on
                                                metadata: {}
                                                data: {}
                                                target:
                                                  entity_id:
                                                    - >-
                                                      input_boolean.vmc_master_spia_velocita_freecooling_co2_o_voc
                                              - service: shell_command.vmc_master_freecooling
                                                data: {}
                                            alias: CASO PDR OFF E INQUINANTI ON
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Nessuna Allerta' and
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Nessuna Allerta')}}
                                            sequence:
                                              - service: shell_command.vmc_master_freecooling
                                                data: {}
                                            alias: CASO PDR OFF E INQUINANTI OFF
                                    alias: >-
                                      Interruttore PdR ON e Interruttore Inquinanti
                                      ON
                                  - conditions:
                                      - condition: and
                                        conditions:
                                          - condition: template
                                            value_template: >-
                                              {{
                                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr')=='on'}}
                                            alias: Interruttore PdR ON
                                          - alias: Interruttore Inquinanti OFF
                                            condition: template
                                            value_template: >-
                                              {{
                                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc')=='off'}}
                                    sequence:
                                      - choose:
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Allerta' or
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Allerta')}}
                                            sequence:
                                              - service: input_boolean.turn_on
                                                metadata: {}
                                                data: {}
                                                target:
                                                  entity_id:
                                                    - >-
                                                      input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio
                                              - service: shell_command.vmc_master_velocita_0
                                                data: {}
                                            alias: CASO PDR ON E INQUINANTI ON
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Nessuna Allerta' and
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Nessuna Allerta')}}
                                            sequence:
                                              - service: input_boolean.turn_on
                                                metadata: {}
                                                data: {}
                                                target:
                                                  entity_id: >-
                                                    input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio
                                              - service: shell_command.vmc_master_velocita_0
                                                data: {}
                                            alias: CASO PDR ON E INQUINANTI OFF
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Allerta' or
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Allerta')}}
                                            sequence:
                                              - service: shell_command.vmc_master_freecooling
                                                data: {}
                                            alias: CASO PDR OFF E INQUINANTI ON
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Nessuna Allerta' and
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Nessuna Allerta')}}
                                            sequence:
                                              - service: shell_command.vmc_master_freecooling
                                                data: {}
                                            alias: CASO PDR OFF E INQUINANTI OFF
                                    alias: >-
                                      Interruttore PdR ON e Interruttore Inquinanti
                                      OFF
                                  - conditions:
                                      - condition: and
                                        conditions:
                                          - alias: Interruttore PdR OFF
                                            condition: template
                                            value_template: >-
                                              {{
                                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr')=='off'}}
                                          - condition: template
                                            value_template: >-
                                              {{
                                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc')=='on'}}
                                            alias: Interruttore Inquinanti ON
                                    sequence:
                                      - choose:
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Allerta' or
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Allerta')}}
                                            sequence:
                                              - service: input_boolean.turn_on
                                                metadata: {}
                                                data: {}
                                                target:
                                                  entity_id:
                                                    - >-
                                                      input_boolean.vmc_master_spia_velocita_freecooling_co2_o_voc
                                              - service: shell_command.vmc_master_freecooling
                                                data: {}
                                            alias: CASO PDR ON E INQUINANTI ON
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Nessuna Allerta' and
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Nessuna Allerta')}}
                                            sequence:
                                              - service: shell_command.vmc_master_freecooling
                                                data: {}
                                            alias: CASO PDR ON E INQUINANTI OFF
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Allerta' or
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Allerta')}}
                                            sequence:
                                              - service: input_boolean.turn_on
                                                metadata: {}
                                                data: {}
                                                target:
                                                  entity_id:
                                                    - >-
                                                      input_boolean.vmc_master_spia_velocita_freecooling_co2_o_voc
                                              - service: shell_command.vmc_master_freecooling
                                                data: {}
                                            alias: CASO PDR OFF E INQUINANTI ON
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Nessuna Allerta' and
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Nessuna Allerta')}}
                                            sequence:
                                              - service: shell_command.vmc_master_freecooling
                                                data: {}
                                            alias: CASO PDR OFF E INQUINANTI OFF
                                    alias: >-
                                      Interruttore PdR OFF e Interruttore Inquinanti
                                      ON
                                  - conditions:
                                      - condition: and
                                        conditions:
                                          - alias: Interruttore PdR OFF
                                            condition: template
                                            value_template: >-
                                              {{
                                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr')=='off'}}
                                          - alias: Interruttore Inquinanti OFF
                                            condition: template
                                            value_template: >-
                                              {{
                                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc')=='off'}}
                                    sequence:
                                      - choose:
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Allerta' or
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Allerta')}}
                                            sequence:
                                              - service: shell_command.vmc_master_freecooling
                                                data: {}
                                            alias: CASO PDR ON E INQUINANTI ON
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Nessuna Allerta' and
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Nessuna Allerta')}}
                                            sequence:
                                              - service: shell_command.vmc_master_freecooling
                                                data: {}
                                            alias: CASO PDR ON E INQUINANTI OFF
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Allerta' or
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Allerta')}}
                                            sequence:
                                              - service: shell_command.vmc_master_freecooling
                                                data: {}
                                            alias: CASO PDR OFF E INQUINANTI ON
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Nessuna Allerta' and
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Nessuna Allerta')}}
                                            sequence:
                                              - service: shell_command.vmc_master_freecooling
                                                data: {}
                                            alias: CASO PDR OFF E INQUINANTI OFF
                                    alias: >-
                                      Interruttore PdR OFF e Interruttore Inquinanti
                                      OFF
                            alias: Spia Free Heating OFF
                    alias: Programmato Mese Free Heating
                  - conditions:
                      - alias: Verifica Programmato Mese Free Cooling
                        condition: template
                        value_template: >-
                          {{
                          states('sensor.vmc_master_status_mese_corrente_freeheating_o_freecooling')
                          == "Free Cooling" }}
                    sequence:
                      - alias: Spia Free Cooling ON o Spia Free Cooling OFF ?
                        choose:
                          - conditions:
                              - alias: Allerte Free Cooling ON
                                condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_alert_monitoraggio_free_heating_o_free_cooling_allert_interfaccia_avvisi')
                                  != "Nessuna Allerta Free Cooling Programmato" or
                                  states('sensor.vmc_master_alert_monitoraggio_free_heating_o_free_cooling_allert_interfaccia_avvisi')
                                  != "Nessuna Allerta Free Cooling Programmato,
                                  Presenza di Inquinanti" }}
                            sequence:
                              - choose:
                                  - conditions:
                                      - condition: template
                                        value_template: >-
                                          {{
                                          states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                          ne sconsiglia l\'impiego" and
                                          (states('sensor.vmc_master_alert_monitoraggio_co2')
                                          == 'Allerta' or
                                          states('sensor.vmc_master_alert_monitoraggio_voc')
                                          == 'Allerta')}}
                                    sequence:
                                      - service: input_boolean.turn_on
                                        metadata: {}
                                        data: {}
                                        target:
                                          entity_id:
                                            - >-
                                              input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio
                                            - >-
                                              input_boolean.vmc_master_spia_velocita_1_co2_o_voc
                                            - >-
                                              input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio_per_programmazione_freecooling
                                      - service: shell_command.vmc_master_velocita_1
                                        metadata: {}
                                        data: {}
                                    alias: CASO PDR ON E INQUINANTI ON
                                  - conditions:
                                      - condition: template
                                        value_template: >-
                                          {{
                                          states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                          ne sconsiglia l\'impiego" and
                                          (states('sensor.vmc_master_alert_monitoraggio_co2')
                                          == 'Nessuna Allerta' and
                                          states('sensor.vmc_master_alert_monitoraggio_voc')
                                          == 'Nessuna Allerta')}}
                                    sequence:
                                      - service: input_boolean.turn_on
                                        metadata: {}
                                        data: {}
                                        target:
                                          entity_id:
                                            - >-
                                              input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio_per_programmazione_freecooling
                                            - >-
                                              input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio
                                      - service: shell_command.vmc_master_velocita_0
                                        data: {}
                                    alias: CASO PDR ON E INQUINANTI OFF
                                  - conditions:
                                      - condition: template
                                        value_template: >-
                                          {{
                                          states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                          ne sconsiglia l\'impiego" and
                                          (states('sensor.vmc_master_alert_monitoraggio_co2')
                                          == 'Allerta' or
                                          states('sensor.vmc_master_alert_monitoraggio_voc')
                                          == 'Allerta')}}
                                    sequence:
                                      - service: input_boolean.turn_on
                                        metadata: {}
                                        data: {}
                                        target:
                                          entity_id:
                                            - >-
                                              input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio_per_programmazione_freecooling
                                            - >-
                                              input_boolean.vmc_master_spia_velocita_1_co2_o_voc
                                      - service: shell_command.vmc_master_velocita_1
                                        metadata: {}
                                        data: {}
                                    alias: CASO PDR OFF E INQUINANTI ON
                                  - conditions:
                                      - condition: template
                                        value_template: >-
                                          {{
                                          states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                          ne sconsiglia l\'impiego" and
                                          (states('sensor.vmc_master_alert_monitoraggio_co2')
                                          == 'Nessuna Allerta' and
                                          states('sensor.vmc_master_alert_monitoraggio_voc')
                                          == 'Nessuna Allerta')}}
                                    sequence:
                                      - service: input_boolean.turn_on
                                        metadata: {}
                                        data: {}
                                        target:
                                          entity_id: >-
                                            input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio_per_programmazione_freecooling
                                      - service: shell_command.vmc_master_velocita_0
                                        data: {}
                                    alias: CASO PDR OFF E INQUINANTI OFF
                            alias: Spia Free Cooling ON
                          - conditions:
                              - alias: Allerte Free Cooling OFF
                                condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_alert_monitoraggio_free_heating_o_free_cooling_allert_interfaccia_avvisi')
                                  == "Nessuna Allerta Free Cooling Programmato" or
                                  states('sensor.vmc_master_alert_monitoraggio_free_heating_o_free_cooling_allert_interfaccia_avvisi')
                                  == "Nessuna Allerta Free Cooling Programmato,
                                  Presenza di Inquinanti" }}
                            sequence:
                              - choose:
                                  - conditions:
                                      - condition: and
                                        conditions:
                                          - condition: template
                                            value_template: >-
                                              {{
                                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr')=='on'}}
                                            alias: Interruttore PdR ON
                                          - condition: template
                                            value_template: >-
                                              {{
                                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc')=='on'}}
                                            alias: Interruttore Inquinanti ON
                                    sequence:
                                      - choose:
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Allerta' or
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Allerta')}}
                                            sequence:
                                              - service: input_boolean.turn_on
                                                metadata: {}
                                                data: {}
                                                target:
                                                  entity_id:
                                                    - >-
                                                      input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio
                                                    - >-
                                                      input_boolean.vmc_master_spia_velocita_freecooling_co2_o_voc
                                              - service: shell_command.vmc_master_freecooling
                                                data: {}
                                            alias: CASO PDR ON E INQUINANTI ON
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Nessuna Allerta' and
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Nessuna Allerta')}}
                                            sequence:
                                              - service: input_boolean.turn_on
                                                metadata: {}
                                                data: {}
                                                target:
                                                  entity_id: >-
                                                    input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio
                                              - service: shell_command.vmc_master_velocita_0
                                                data: {}
                                            alias: CASO PDR ON E INQUINANTI OFF
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Allerta' or
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Allerta')}}
                                            sequence:
                                              - service: input_boolean.turn_on
                                                metadata: {}
                                                data: {}
                                                target:
                                                  entity_id:
                                                    - >-
                                                      input_boolean.vmc_master_spia_velocita_freecooling_co2_o_voc
                                              - service: shell_command.vmc_master_freecooling
                                                data: {}
                                            alias: CASO PDR OFF E INQUINANTI ON
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Nessuna Allerta' and
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Nessuna Allerta')}}
                                            sequence:
                                              - service: shell_command.vmc_master_freecooling
                                                data: {}
                                            alias: CASO PDR OFF E INQUINANTI OFF
                                    alias: >-
                                      Interruttore PdR ON e Interruttore Inquinanti
                                      ON
                                  - conditions:
                                      - condition: and
                                        conditions:
                                          - condition: template
                                            value_template: >-
                                              {{
                                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr')=='on'}}
                                            alias: Interruttore PdR ON
                                          - alias: Interruttore Inquinanti OFF
                                            condition: template
                                            value_template: >-
                                              {{
                                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc')=='off'}}
                                    sequence:
                                      - choose:
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Allerta' or
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Allerta')}}
                                            sequence:
                                              - service: input_boolean.turn_on
                                                metadata: {}
                                                data: {}
                                                target:
                                                  entity_id:
                                                    - >-
                                                      input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio
                                              - service: shell_command.vmc_master_velocita_0
                                                data: {}
                                            alias: CASO PDR ON E INQUINANTI ON
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Nessuna Allerta' and
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Nessuna Allerta')}}
                                            sequence:
                                              - service: input_boolean.turn_on
                                                metadata: {}
                                                data: {}
                                                target:
                                                  entity_id: >-
                                                    input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio
                                              - service: shell_command.vmc_master_velocita_0
                                                data: {}
                                            alias: CASO PDR ON E INQUINANTI OFF
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Allerta' or
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Allerta')}}
                                            sequence:
                                              - service: shell_command.vmc_master_freecooling
                                                data: {}
                                            alias: CASO PDR OFF E INQUINANTI ON
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Nessuna Allerta' and
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Nessuna Allerta')}}
                                            sequence:
                                              - service: shell_command.vmc_master_freecooling
                                                data: {}
                                            alias: CASO PDR OFF E INQUINANTI OFF
                                    alias: >-
                                      Interruttore PdR ON e Interruttore Inquinanti
                                      OFF
                                  - conditions:
                                      - condition: and
                                        conditions:
                                          - alias: Interruttore PdR OFF
                                            condition: template
                                            value_template: >-
                                              {{
                                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr')=='off'}}
                                          - condition: template
                                            value_template: >-
                                              {{
                                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc')=='on'}}
                                            alias: Interruttore Inquinanti ON
                                    sequence:
                                      - choose:
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Allerta' or
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Allerta')}}
                                            sequence:
                                              - service: input_boolean.turn_on
                                                metadata: {}
                                                data: {}
                                                target:
                                                  entity_id:
                                                    - >-
                                                      input_boolean.vmc_master_spia_velocita_freecooling_co2_o_voc
                                              - service: shell_command.vmc_master_freecooling
                                                data: {}
                                            alias: CASO PDR ON E INQUINANTI ON
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Nessuna Allerta' and
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Nessuna Allerta')}}
                                            sequence:
                                              - service: shell_command.vmc_master_freecooling
                                                data: {}
                                            alias: CASO PDR ON E INQUINANTI OFF
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Allerta' or
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Allerta')}}
                                            sequence:
                                              - service: input_boolean.turn_on
                                                metadata: {}
                                                data: {}
                                                target:
                                                  entity_id:
                                                    - >-
                                                      input_boolean.vmc_master_spia_velocita_freecooling_co2_o_voc
                                              - service: shell_command.vmc_master_freecooling
                                                data: {}
                                            alias: CASO PDR OFF E INQUINANTI ON
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Nessuna Allerta' and
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Nessuna Allerta')}}
                                            sequence:
                                              - service: shell_command.vmc_master_freecooling
                                                data: {}
                                            alias: CASO PDR OFF E INQUINANTI OFF
                                    alias: >-
                                      Interruttore PdR OFF e Interruttore Inquinanti
                                      ON
                                  - conditions:
                                      - condition: and
                                        conditions:
                                          - alias: Interruttore PdR OFF
                                            condition: template
                                            value_template: >-
                                              {{
                                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr')=='off'}}
                                          - alias: Interruttore Inquinanti OFF
                                            condition: template
                                            value_template: >-
                                              {{
                                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc')=='off'}}
                                    sequence:
                                      - choose:
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Allerta' or
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Allerta')}}
                                            sequence:
                                              - service: shell_command.vmc_master_freecooling
                                                data: {}
                                            alias: CASO PDR ON E INQUINANTI ON
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Nessuna Allerta' and
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Nessuna Allerta')}}
                                            sequence:
                                              - service: shell_command.vmc_master_freecooling
                                                data: {}
                                            alias: CASO PDR ON E INQUINANTI OFF
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Allerta' or
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Allerta')}}
                                            sequence:
                                              - service: shell_command.vmc_master_freecooling
                                                data: {}
                                            alias: CASO PDR OFF E INQUINANTI ON
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Nessuna Allerta' and
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Nessuna Allerta')}}
                                            sequence:
                                              - service: shell_command.vmc_master_freecooling
                                                data: {}
                                            alias: CASO PDR OFF E INQUINANTI OFF
                                    alias: >-
                                      Interruttore PdR OFF e Interruttore Inquinanti
                                      OFF
                            alias: Spia Free Cooling OFF
                    alias: Programmato Mese Free Cooling
                  - conditions:
                      - alias: Verifica Programmato Mese Disabilitato
                        condition: template
                        value_template: >-
                          {{
                          states('sensor.vmc_master_status_mese_corrente_freeheating_o_freecooling')
                          == "Disabilitata" }}
                    sequence:
                      - choose:
                          - conditions:
                              - condition: and
                                conditions:
                                  - condition: template
                                    value_template: >-
                                      {{
                                      states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr')=='on'}}
                                    alias: Interruttore PdR ON
                                  - condition: template
                                    value_template: >-
                                      {{
                                      states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc')=='on'}}
                                    alias: Interruttore Inquinanti ON
                            sequence:
                              - choose:
                                  - conditions:
                                      - condition: template
                                        value_template: >-
                                          {{
                                          states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                          ne sconsiglia l\'impiego" and
                                          (states('sensor.vmc_master_alert_monitoraggio_co2')
                                          == 'Allerta' or
                                          states('sensor.vmc_master_alert_monitoraggio_voc')
                                          == 'Allerta')}}
                                    sequence:
                                      - service: input_boolean.turn_on
                                        metadata: {}
                                        data: {}
                                        target:
                                          entity_id:
                                            - >-
                                              input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio
                                            - >-
                                              input_boolean.vmc_master_spia_velocita_freecooling_co2_o_voc
                                      - service: shell_command.vmc_master_freecooling
                                        data: {}
                                    alias: CASO PDR ON E INQUINANTI ON
                                  - conditions:
                                      - condition: template
                                        value_template: >-
                                          {{
                                          states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                          ne sconsiglia l\'impiego" and
                                          (states('sensor.vmc_master_alert_monitoraggio_co2')
                                          == 'Nessuna Allerta' and
                                          states('sensor.vmc_master_alert_monitoraggio_voc')
                                          == 'Nessuna Allerta')}}
                                    sequence:
                                      - service: input_boolean.turn_on
                                        metadata: {}
                                        data: {}
                                        target:
                                          entity_id: >-
                                            input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio
                                      - service: shell_command.vmc_master_velocita_0
                                        data: {}
                                    alias: CASO PDR ON E INQUINANTI OFF
                                  - conditions:
                                      - condition: template
                                        value_template: >-
                                          {{
                                          states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                          ne sconsiglia l\'impiego" and
                                          (states('sensor.vmc_master_alert_monitoraggio_co2')
                                          == 'Allerta' or
                                          states('sensor.vmc_master_alert_monitoraggio_voc')
                                          == 'Allerta')}}
                                    sequence:
                                      - service: input_boolean.turn_on
                                        metadata: {}
                                        data: {}
                                        target:
                                          entity_id:
                                            - >-
                                              input_boolean.vmc_master_spia_velocita_freecooling_co2_o_voc
                                      - service: shell_command.vmc_master_freecooling
                                        data: {}
                                    alias: CASO PDR OFF E INQUINANTI ON
                                  - conditions:
                                      - condition: template
                                        value_template: >-
                                          {{
                                          states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                          ne sconsiglia l\'impiego" and
                                          (states('sensor.vmc_master_alert_monitoraggio_co2')
                                          == 'Nessuna Allerta' and
                                          states('sensor.vmc_master_alert_monitoraggio_voc')
                                          == 'Nessuna Allerta')}}
                                    sequence:
                                      - service: shell_command.vmc_master_freecooling
                                        data: {}
                                    alias: CASO PDR OFF E INQUINANTI OFF
                            alias: Interruttore PdR ON e Interruttore Inquinanti ON
                          - conditions:
                              - condition: and
                                conditions:
                                  - condition: template
                                    value_template: >-
                                      {{
                                      states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr')=='on'}}
                                    alias: Interruttore PdR ON
                                  - alias: Interruttore Inquinanti OFF
                                    condition: template
                                    value_template: >-
                                      {{
                                      states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc')=='off'}}
                            sequence:
                              - choose:
                                  - conditions:
                                      - condition: template
                                        value_template: >-
                                          {{
                                          states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                          ne sconsiglia l\'impiego" and
                                          (states('sensor.vmc_master_alert_monitoraggio_co2')
                                          == 'Allerta' or
                                          states('sensor.vmc_master_alert_monitoraggio_voc')
                                          == 'Allerta')}}
                                    sequence:
                                      - service: input_boolean.turn_on
                                        metadata: {}
                                        data: {}
                                        target:
                                          entity_id:
                                            - >-
                                              input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio
                                      - service: shell_command.vmc_master_velocita_0
                                        data: {}
                                    alias: CASO PDR ON E INQUINANTI ON
                                  - conditions:
                                      - condition: template
                                        value_template: >-
                                          {{
                                          states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                          ne sconsiglia l\'impiego" and
                                          (states('sensor.vmc_master_alert_monitoraggio_co2')
                                          == 'Nessuna Allerta' and
                                          states('sensor.vmc_master_alert_monitoraggio_voc')
                                          == 'Nessuna Allerta')}}
                                    sequence:
                                      - service: input_boolean.turn_on
                                        metadata: {}
                                        data: {}
                                        target:
                                          entity_id: >-
                                            input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio
                                      - service: shell_command.vmc_master_velocita_0
                                        data: {}
                                    alias: CASO PDR ON E INQUINANTI OFF
                                  - conditions:
                                      - condition: template
                                        value_template: >-
                                          {{
                                          states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                          ne sconsiglia l\'impiego" and
                                          (states('sensor.vmc_master_alert_monitoraggio_co2')
                                          == 'Allerta' or
                                          states('sensor.vmc_master_alert_monitoraggio_voc')
                                          == 'Allerta')}}
                                    sequence:
                                      - service: shell_command.vmc_master_freecooling
                                        data: {}
                                    alias: CASO PDR OFF E INQUINANTI ON
                                  - conditions:
                                      - condition: template
                                        value_template: >-
                                          {{
                                          states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                          ne sconsiglia l\'impiego" and
                                          (states('sensor.vmc_master_alert_monitoraggio_co2')
                                          == 'Nessuna Allerta' and
                                          states('sensor.vmc_master_alert_monitoraggio_voc')
                                          == 'Nessuna Allerta')}}
                                    sequence:
                                      - service: shell_command.vmc_master_freecooling
                                        data: {}
                                    alias: CASO PDR OFF E INQUINANTI OFF
                            alias: Interruttore PdR ON e Interruttore Inquinanti OFF
                          - conditions:
                              - condition: and
                                conditions:
                                  - alias: Interruttore PdR OFF
                                    condition: template
                                    value_template: >-
                                      {{
                                      states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr')=='off'}}
                                  - condition: template
                                    value_template: >-
                                      {{
                                      states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc')=='on'}}
                                    alias: Interruttore Inquinanti ON
                            sequence:
                              - choose:
                                  - conditions:
                                      - condition: template
                                        value_template: >-
                                          {{
                                          states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                          ne sconsiglia l\'impiego" and
                                          (states('sensor.vmc_master_alert_monitoraggio_co2')
                                          == 'Allerta' or
                                          states('sensor.vmc_master_alert_monitoraggio_voc')
                                          == 'Allerta')}}
                                    sequence:
                                      - service: input_boolean.turn_on
                                        metadata: {}
                                        data: {}
                                        target:
                                          entity_id:
                                            - >-
                                              input_boolean.vmc_master_spia_velocita_freecooling_co2_o_voc
                                      - service: shell_command.vmc_master_freecooling
                                        data: {}
                                    alias: CASO PDR ON E INQUINANTI ON
                                  - conditions:
                                      - condition: template
                                        value_template: >-
                                          {{
                                          states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                          ne sconsiglia l\'impiego" and
                                          (states('sensor.vmc_master_alert_monitoraggio_co2')
                                          == 'Nessuna Allerta' and
                                          states('sensor.vmc_master_alert_monitoraggio_voc')
                                          == 'Nessuna Allerta')}}
                                    sequence:
                                      - service: shell_command.vmc_master_freecooling
                                        data: {}
                                    alias: CASO PDR ON E INQUINANTI OFF
                                  - conditions:
                                      - condition: template
                                        value_template: >-
                                          {{
                                          states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                          ne sconsiglia l\'impiego" and
                                          (states('sensor.vmc_master_alert_monitoraggio_co2')
                                          == 'Allerta' or
                                          states('sensor.vmc_master_alert_monitoraggio_voc')
                                          == 'Allerta')}}
                                    sequence:
                                      - service: input_boolean.turn_on
                                        metadata: {}
                                        data: {}
                                        target:
                                          entity_id:
                                            - >-
                                              input_boolean.vmc_master_spia_velocita_freecooling_co2_o_voc
                                      - service: shell_command.vmc_master_freecooling
                                        data: {}
                                    alias: CASO PDR OFF E INQUINANTI ON
                                  - conditions:
                                      - condition: template
                                        value_template: >-
                                          {{
                                          states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                          ne sconsiglia l\'impiego" and
                                          (states('sensor.vmc_master_alert_monitoraggio_co2')
                                          == 'Nessuna Allerta' and
                                          states('sensor.vmc_master_alert_monitoraggio_voc')
                                          == 'Nessuna Allerta')}}
                                    sequence:
                                      - service: shell_command.vmc_master_freecooling
                                        data: {}
                                    alias: CASO PDR OFF E INQUINANTI OFF
                            alias: Interruttore PdR OFF e Interruttore Inquinanti ON
                          - conditions:
                              - condition: and
                                conditions:
                                  - alias: Interruttore PdR OFF
                                    condition: template
                                    value_template: >-
                                      {{
                                      states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr')=='off'}}
                                  - alias: Interruttore Inquinanti OFF
                                    condition: template
                                    value_template: >-
                                      {{
                                      states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc')=='off'}}
                            sequence:
                              - choose:
                                  - conditions:
                                      - condition: template
                                        value_template: >-
                                          {{
                                          states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                          ne sconsiglia l\'impiego" and
                                          (states('sensor.vmc_master_alert_monitoraggio_co2')
                                          == 'Allerta' or
                                          states('sensor.vmc_master_alert_monitoraggio_voc')
                                          == 'Allerta')}}
                                    sequence:
                                      - service: shell_command.vmc_master_freecooling
                                        data: {}
                                    alias: CASO PDR ON E INQUINANTI ON
                                  - conditions:
                                      - condition: template
                                        value_template: >-
                                          {{
                                          states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                          ne sconsiglia l\'impiego" and
                                          (states('sensor.vmc_master_alert_monitoraggio_co2')
                                          == 'Nessuna Allerta' and
                                          states('sensor.vmc_master_alert_monitoraggio_voc')
                                          == 'Nessuna Allerta')}}
                                    sequence:
                                      - service: shell_command.vmc_master_freecooling
                                        data: {}
                                    alias: CASO PDR ON E INQUINANTI OFF
                                  - conditions:
                                      - condition: template
                                        value_template: >-
                                          {{
                                          states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                          ne sconsiglia l\'impiego" and
                                          (states('sensor.vmc_master_alert_monitoraggio_co2')
                                          == 'Allerta' or
                                          states('sensor.vmc_master_alert_monitoraggio_voc')
                                          == 'Allerta')}}
                                    sequence:
                                      - service: shell_command.vmc_master_freecooling
                                        data: {}
                                    alias: CASO PDR OFF E INQUINANTI ON
                                  - conditions:
                                      - condition: template
                                        value_template: >-
                                          {{
                                          states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                          ne sconsiglia l\'impiego" and
                                          (states('sensor.vmc_master_alert_monitoraggio_co2')
                                          == 'Nessuna Allerta' and
                                          states('sensor.vmc_master_alert_monitoraggio_voc')
                                          == 'Nessuna Allerta')}}
                                    sequence:
                                      - service: shell_command.vmc_master_freecooling
                                        data: {}
                                    alias: CASO PDR OFF E INQUINANTI OFF
                            alias: Interruttore PdR OFF e Interruttore Inquinanti OFF
                    alias: Mese Disabilitato
    mode: restart
    icon: mdi:fingerprint-off
    description: ""
#------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
#------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  vmc_master_calendario_fascia_2_on:
    alias: VMC Master - Calendario Fascia 2 On
    sequence:
      - delay:
          hours: 0
          minutes: 0
          seconds: 5
          milliseconds: 0
      - choose:
          - conditions:
              - alias: Velocità 0 in Assenza di Congelamento e Delta Temperatura
                condition: and
                conditions:
                  - condition: state
                    entity_id: sensor.vmc_master_speed_2_fascia_calendario
                    state: Velocità 0
                  - condition: template
                    value_template: >-
                      {{(states('input_boolean.vmc_master_congelamento_verifica_soglia_valore_spia')==
                      'off' and
                      states('input_boolean.vmc_master_delta_temp_verifica_soglia_valore_spia')==
                      'off')}}
                    alias: Congelamento Assente e Delta Temperatura Assente
            sequence:
              - service: input_boolean.turn_off
                data: {}
                target:
                  entity_id:
                    - >-
                      input_boolean.vmc_master_spia_co2_o_voc_partenza_ritorno_velocita_0
                    - input_boolean.vmc_master_spia_velocita_1_co2_o_voc_pdr
                    - input_boolean.vmc_master_spia_velocita_0_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_1_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_2_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_3_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_4_co2_o_voc
                    - >-
                      input_boolean.vmc_master_spia_velocita_iperventilazione_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_notturna_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_freecooling_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_0_un_solo_avvio
                    - input_boolean.vmc_master_spia_velocita_1_un_solo_avvio
                    - input_boolean.vmc_master_spia_velocita_2_un_solo_avvio
                    - input_boolean.vmc_master_spia_velocita_3_un_solo_avvio
                    - input_boolean.vmc_master_spia_velocita_4_un_solo_avvio
                    - input_boolean.vmc_master_spia_velocita_notturna_un_solo_avvio
                    - >-
                      input_boolean.vmc_master_spia_velocita_iperventilazione_un_solo_avvio
                    - >-
                      input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio
                    - >-
                      input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio_per_programmazione_freecooling
                    - >-
                      input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio_per_programmazione_freeheating
              - choose:
                  - conditions:
                      - condition: and
                        conditions:
                          - condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr')=='on'}}
                            alias: Interruttore PdR ON
                          - condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc')=='on'}}
                            alias: Interruttore Inquinanti ON
                    sequence:
                      - choose:
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                                alias: Verifica CASO PDR ON E INQUINANTI ON
                            sequence:
                              - service: input_boolean.turn_on
                                data: {}
                                target:
                                  entity_id:
                                    - >-
                                      input_boolean.vmc_master_spia_velocita_1_co2_o_voc_pdr
                                    - >-
                                      input_boolean.vmc_master_spia_co2_o_voc_partenza_ritorno_velocita_0
                                    - input_boolean.vmc_master_spia_co2_o_voc
                                    - >-
                                      input_boolean.vmc_master_spia_velocita_1_co2_o_voc
                              - service: shell_command.vmc_master_velocita_1
                                metadata: {}
                                data: {}
                            alias: CASO PDR ON E INQUINANTI ON
                          - conditions:
                              - alias: Verifica CASO PDR ON E INQUINANTI OFF
                                condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - service: shell_command.vmc_master_velocita_0
                                data: {}
                            alias: CASO PDR ON E INQUINANTI OFF
                          - conditions:
                              - alias: Verifica CASO PDR OFF E INQUINANTI ON
                                condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - service: input_boolean.turn_on
                                data: {}
                                target:
                                  entity_id:
                                    - >-
                                      input_boolean.vmc_master_spia_velocita_1_co2_o_voc_pdr
                                    - >-
                                      input_boolean.vmc_master_spia_co2_o_voc_partenza_ritorno_velocita_0
                                    - input_boolean.vmc_master_spia_co2_o_voc
                                    - >-
                                      input_boolean.vmc_master_spia_velocita_1_co2_o_voc
                              - service: shell_command.vmc_master_velocita_1
                                metadata: {}
                                data: {}
                            alias: CASO PDR OFF E INQUINANTI ON
                          - conditions:
                              - alias: Verifica CASO PDR OFF E INQUINANTI OFF
                                condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - service: shell_command.vmc_master_velocita_0
                                data: {}
                            alias: CASO PDR OFF E INQUINANTI OFF
                    alias: Interruttore PdR ON e Interruttore Inquinanti ON
                  - conditions:
                      - condition: and
                        conditions:
                          - condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr')=='on'}}
                            alias: Interruttore PdR ON
                          - alias: Interruttore Inquinanti OFF
                            condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc')=='off'}}
                    sequence:
                      - choose:
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                                alias: Verifica CASO PDR ON E INQUINANTI ON
                            sequence:
                              - service: shell_command.vmc_master_velocita_0
                                data: {}
                            alias: CASO PDR ON E INQUINANTI ON
                          - conditions:
                              - alias: Verifica CASO PDR ON E INQUINANTI OFF
                                condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - service: shell_command.vmc_master_velocita_0
                                data: {}
                            alias: CASO PDR ON E INQUINANTI OFF
                          - conditions:
                              - alias: Verifica CASO PDR OFF E INQUINANTI ON
                                condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - service: shell_command.vmc_master_velocita_0
                                data: {}
                            alias: CASO PDR OFF E INQUINANTI ON
                          - conditions:
                              - alias: Verifica CASO PDR OFF E INQUINANTI OFF
                                condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - service: shell_command.vmc_master_velocita_0
                                data: {}
                            alias: CASO PDR OFF E INQUINANTI OFF
                    alias: Interruttore PdR ON e Interruttore Inquinanti OFF
                  - conditions:
                      - condition: and
                        conditions:
                          - alias: Interruttore PdR OFF
                            condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr')=='off'}}
                          - condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc')=='on'}}
                            alias: Interruttore Inquinanti ON
                    sequence:
                      - choose:
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                                alias: Verifica CASO PDR ON E INQUINANTI ON
                            sequence:
                              - service: input_boolean.turn_on
                                data: {}
                                target:
                                  entity_id:
                                    - >-
                                      input_boolean.vmc_master_spia_velocita_1_co2_o_voc_pdr
                                    - >-
                                      input_boolean.vmc_master_spia_co2_o_voc_partenza_ritorno_velocita_0
                                    - input_boolean.vmc_master_spia_co2_o_voc
                                    - >-
                                      input_boolean.vmc_master_spia_velocita_1_co2_o_voc
                              - service: shell_command.vmc_master_velocita_1
                                metadata: {}
                                data: {}
                            alias: CASO PDR ON E INQUINANTI ON
                          - conditions:
                              - alias: Verifica CASO PDR ON E INQUINANTI OFF
                                condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - service: shell_command.vmc_master_velocita_0
                                data: {}
                            alias: CASO PDR ON E INQUINANTI OFF
                          - conditions:
                              - alias: Verifica CASO PDR OFF E INQUINANTI ON
                                condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - service: input_boolean.turn_on
                                data: {}
                                target:
                                  entity_id:
                                    - >-
                                      input_boolean.vmc_master_spia_velocita_1_co2_o_voc_pdr
                                    - >-
                                      input_boolean.vmc_master_spia_co2_o_voc_partenza_ritorno_velocita_0
                                    - input_boolean.vmc_master_spia_co2_o_voc
                                    - >-
                                      input_boolean.vmc_master_spia_velocita_1_co2_o_voc
                              - service: shell_command.vmc_master_velocita_1
                                metadata: {}
                                data: {}
                            alias: CASO PDR OFF E INQUINANTI ON
                          - conditions:
                              - alias: Verifica CASO PDR OFF E INQUINANTI OFF
                                condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - service: shell_command.vmc_master_velocita_0
                                data: {}
                            alias: CASO PDR OFF E INQUINANTI OFF
                    alias: Interruttore PdR OFF e Interruttore Inquinanti ON
                  - conditions:
                      - condition: and
                        conditions:
                          - alias: Interruttore PdR OFF
                            condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr')=='off'}}
                          - alias: Interruttore Inquinanti OFF
                            condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc')=='off'}}
                    sequence:
                      - choose:
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                                alias: Verifica CASO PDR ON E INQUINANTI ON
                            sequence:
                              - service: shell_command.vmc_master_velocita_0
                                data: {}
                            alias: CASO PDR ON E INQUINANTI ON
                          - conditions:
                              - alias: Verifica CASO PDR ON E INQUINANTI OFF
                                condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - service: shell_command.vmc_master_velocita_0
                                data: {}
                            alias: CASO PDR ON E INQUINANTI OFF
                          - conditions:
                              - alias: Verifica CASO PDR OFF E INQUINANTI ON
                                condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - service: shell_command.vmc_master_velocita_0
                                data: {}
                            alias: CASO PDR OFF E INQUINANTI ON
                          - conditions:
                              - alias: Verifica CASO PDR OFF E INQUINANTI OFF
                                condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - service: shell_command.vmc_master_velocita_0
                                data: {}
                            alias: CASO PDR OFF E INQUINANTI OFF
                    alias: Interruttore PdR OFF e Interruttore Inquinanti OFF
          - conditions:
              - alias: Velocità 1 in Assenza di Congelamento e Delta Temperatura
                condition: and
                conditions:
                  - condition: state
                    entity_id: sensor.vmc_master_speed_2_fascia_calendario
                    state: Velocità 1
                  - condition: template
                    value_template: >-
                      {{(states('input_boolean.vmc_master_congelamento_verifica_soglia_valore_spia')==
                      'off' and
                      states('input_boolean.vmc_master_delta_temp_verifica_soglia_valore_spia')==
                      'off')}}
                    alias: Congelamento Assente e Delta Temperatura Assente
            sequence:
              - service: input_boolean.turn_off
                data: {}
                target:
                  entity_id:
                    - >-
                      input_boolean.vmc_master_spia_co2_o_voc_partenza_ritorno_velocita_0
                    - input_boolean.vmc_master_spia_velocita_1_co2_o_voc_pdr
                    - input_boolean.vmc_master_spia_velocita_0_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_1_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_2_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_3_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_4_co2_o_voc
                    - >-
                      input_boolean.vmc_master_spia_velocita_iperventilazione_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_notturna_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_freecooling_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_0_un_solo_avvio
                    - input_boolean.vmc_master_spia_velocita_1_un_solo_avvio
                    - input_boolean.vmc_master_spia_velocita_2_un_solo_avvio
                    - input_boolean.vmc_master_spia_velocita_3_un_solo_avvio
                    - input_boolean.vmc_master_spia_velocita_4_un_solo_avvio
                    - input_boolean.vmc_master_spia_velocita_notturna_un_solo_avvio
                    - >-
                      input_boolean.vmc_master_spia_velocita_iperventilazione_un_solo_avvio
                    - >-
                      input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio
                    - >-
                      input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio_per_programmazione_freecooling
                    - >-
                      input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio_per_programmazione_freeheating
              - choose:
                  - conditions:
                      - condition: and
                        conditions:
                          - condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr')=='on'}}
                            alias: Interruttore PdR ON
                          - condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc')=='on'}}
                            alias: Interruttore Inquinanti ON
                    sequence:
                      - choose:
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - service: input_boolean.turn_on
                                metadata: {}
                                data: {}
                                target:
                                  entity_id:
                                    - >-
                                      input_boolean.vmc_master_spia_velocita_1_un_solo_avvio
                                    - >-
                                      input_boolean.vmc_master_spia_velocita_1_co2_o_voc
                              - service: shell_command.vmc_master_velocita_1
                                metadata: {}
                                data: {}
                            alias: CASO PDR ON E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - service: input_boolean.turn_on
                                metadata: {}
                                data: {}
                                target:
                                  entity_id: >-
                                    input_boolean.vmc_master_spia_velocita_1_un_solo_avvio
                              - service: shell_command.vmc_master_velocita_0
                                data: {}
                            alias: CASO PDR ON E INQUINANTI OFF
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - service: input_boolean.turn_on
                                metadata: {}
                                data: {}
                                target:
                                  entity_id:
                                    - >-
                                      input_boolean.vmc_master_spia_velocita_1_co2_o_voc
                              - service: shell_command.vmc_master_velocita_1
                                metadata: {}
                                data: {}
                            alias: CASO PDR OFF E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - service: shell_command.vmc_master_velocita_1
                                metadata: {}
                                data: {}
                            alias: CASO PDR OFF E INQUINANTI OFF
                    alias: Interruttore PdR ON e Interruttore Inquinanti ON
                  - conditions:
                      - condition: and
                        conditions:
                          - condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr')=='on'}}
                            alias: Interruttore PdR ON
                          - alias: Interruttore Inquinanti OFF
                            condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc')=='off'}}
                    sequence:
                      - choose:
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - service: input_boolean.turn_on
                                metadata: {}
                                data: {}
                                target:
                                  entity_id:
                                    - >-
                                      input_boolean.vmc_master_spia_velocita_1_un_solo_avvio
                              - service: shell_command.vmc_master_velocita_0
                                data: {}
                            alias: CASO PDR ON E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - service: input_boolean.turn_on
                                metadata: {}
                                data: {}
                                target:
                                  entity_id: >-
                                    input_boolean.vmc_master_spia_velocita_1_un_solo_avvio
                              - service: shell_command.vmc_master_velocita_0
                                data: {}
                            alias: CASO PDR ON E INQUINANTI OFF
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - service: shell_command.vmc_master_velocita_1
                                metadata: {}
                                data: {}
                            alias: CASO PDR OFF E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - service: shell_command.vmc_master_velocita_1
                                metadata: {}
                                data: {}
                            alias: CASO PDR OFF E INQUINANTI OFF
                    alias: Interruttore PdR ON e Interruttore Inquinanti OFF
                  - conditions:
                      - condition: and
                        conditions:
                          - alias: Interruttore PdR OFF
                            condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr')=='off'}}
                          - condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc')=='on'}}
                            alias: Interruttore Inquinanti ON
                    sequence:
                      - choose:
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - service: input_boolean.turn_on
                                metadata: {}
                                data: {}
                                target:
                                  entity_id:
                                    - >-
                                      input_boolean.vmc_master_spia_velocita_1_co2_o_voc
                              - service: shell_command.vmc_master_velocita_1
                                metadata: {}
                                data: {}
                            alias: CASO PDR ON E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - service: shell_command.vmc_master_velocita_1
                                data: {}
                            alias: CASO PDR ON E INQUINANTI OFF
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - service: input_boolean.turn_on
                                metadata: {}
                                data: {}
                                target:
                                  entity_id:
                                    - >-
                                      input_boolean.vmc_master_spia_velocita_1_co2_o_voc
                              - service: shell_command.vmc_master_velocita_1
                                metadata: {}
                                data: {}
                            alias: CASO PDR OFF E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - service: shell_command.vmc_master_velocita_1
                                metadata: {}
                                data: {}
                            alias: CASO PDR OFF E INQUINANTI OFF
                    alias: Interruttore PdR OFF e Interruttore Inquinanti ON
                  - conditions:
                      - condition: and
                        conditions:
                          - alias: Interruttore PdR OFF
                            condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr')=='off'}}
                          - alias: Interruttore Inquinanti OFF
                            condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc')=='off'}}
                    sequence:
                      - choose:
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - service: shell_command.vmc_master_velocita_1
                                data: {}
                            alias: CASO PDR ON E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - service: shell_command.vmc_master_velocita_1
                                data: {}
                            alias: CASO PDR ON E INQUINANTI OFF
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - service: shell_command.vmc_master_velocita_1
                                metadata: {}
                                data: {}
                            alias: CASO PDR OFF E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - service: shell_command.vmc_master_velocita_1
                                metadata: {}
                                data: {}
                            alias: CASO PDR OFF E INQUINANTI OFF
                    alias: Interruttore PdR OFF e Interruttore Inquinanti OFF
          - conditions:
              - alias: Velocità 2 in Assenza di Congelamento e Delta Temperatura
                condition: and
                conditions:
                  - condition: state
                    entity_id: sensor.vmc_master_speed_2_fascia_calendario
                    state: Velocità 2
                  - condition: template
                    value_template: >-
                      {{(states('input_boolean.vmc_master_congelamento_verifica_soglia_valore_spia')==
                      'off' and
                      states('input_boolean.vmc_master_delta_temp_verifica_soglia_valore_spia')==
                      'off')}}
                    alias: Congelamento Assente e Delta Temperatura Assente
            sequence:
              - service: input_boolean.turn_off
                data: {}
                target:
                  entity_id:
                    - >-
                      input_boolean.vmc_master_spia_co2_o_voc_partenza_ritorno_velocita_0
                    - input_boolean.vmc_master_spia_velocita_1_co2_o_voc_pdr
                    - input_boolean.vmc_master_spia_velocita_0_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_1_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_2_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_3_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_4_co2_o_voc
                    - >-
                      input_boolean.vmc_master_spia_velocita_iperventilazione_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_notturna_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_freecooling_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_0_un_solo_avvio
                    - input_boolean.vmc_master_spia_velocita_1_un_solo_avvio
                    - input_boolean.vmc_master_spia_velocita_2_un_solo_avvio
                    - input_boolean.vmc_master_spia_velocita_3_un_solo_avvio
                    - input_boolean.vmc_master_spia_velocita_4_un_solo_avvio
                    - input_boolean.vmc_master_spia_velocita_notturna_un_solo_avvio
                    - >-
                      input_boolean.vmc_master_spia_velocita_iperventilazione_un_solo_avvio
                    - >-
                      input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio
                    - >-
                      input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio_per_programmazione_freecooling
                    - >-
                      input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio_per_programmazione_freeheating
              - choose:
                  - conditions:
                      - condition: and
                        conditions:
                          - condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr')=='on'}}
                            alias: Interruttore PdR ON
                          - condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc')=='on'}}
                            alias: Interruttore Inquinanti ON
                    sequence:
                      - choose:
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - service: input_boolean.turn_on
                                metadata: {}
                                data: {}
                                target:
                                  entity_id:
                                    - >-
                                      input_boolean.vmc_master_spia_velocita_2_un_solo_avvio
                                    - >-
                                      input_boolean.vmc_master_spia_velocita_2_co2_o_voc
                              - service: shell_command.vmc_master_velocita_2
                                data: {}
                            alias: CASO PDR ON E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - service: input_boolean.turn_on
                                metadata: {}
                                data: {}
                                target:
                                  entity_id: >-
                                    input_boolean.vmc_master_spia_velocita_2_un_solo_avvio
                              - service: shell_command.vmc_master_velocita_0
                                data: {}
                            alias: CASO PDR ON E INQUINANTI OFF
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - service: input_boolean.turn_on
                                metadata: {}
                                data: {}
                                target:
                                  entity_id:
                                    - >-
                                      input_boolean.vmc_master_spia_velocita_2_co2_o_voc
                              - service: shell_command.vmc_master_velocita_2
                                data: {}
                            alias: CASO PDR OFF E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - service: shell_command.vmc_master_velocita_2
                                data: {}
                            alias: CASO PDR OFF E INQUINANTI OFF
                    alias: Interruttore PdR ON e Interruttore Inquinanti ON
                  - conditions:
                      - condition: and
                        conditions:
                          - condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr')=='on'}}
                            alias: Interruttore PdR ON
                          - alias: Interruttore Inquinanti OFF
                            condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc')=='off'}}
                    sequence:
                      - choose:
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - service: input_boolean.turn_on
                                metadata: {}
                                data: {}
                                target:
                                  entity_id:
                                    - >-
                                      input_boolean.vmc_master_spia_velocita_2_un_solo_avvio
                              - service: shell_command.vmc_master_velocita_0
                                data: {}
                            alias: CASO PDR ON E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - service: input_boolean.turn_on
                                metadata: {}
                                data: {}
                                target:
                                  entity_id: >-
                                    input_boolean.vmc_master_spia_velocita_2_un_solo_avvio
                              - service: shell_command.vmc_master_velocita_0
                                data: {}
                            alias: CASO PDR ON E INQUINANTI OFF
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - service: shell_command.vmc_master_velocita_2
                                data: {}
                            alias: CASO PDR OFF E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - service: shell_command.vmc_master_velocita_2
                                data: {}
                            alias: CASO PDR OFF E INQUINANTI OFF
                    alias: Interruttore PdR ON e Interruttore Inquinanti OFF
                  - conditions:
                      - condition: and
                        conditions:
                          - alias: Interruttore PdR OFF
                            condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr')=='off'}}
                          - condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc')=='on'}}
                            alias: Interruttore Inquinanti ON
                    sequence:
                      - choose:
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - service: input_boolean.turn_on
                                metadata: {}
                                data: {}
                                target:
                                  entity_id:
                                    - >-
                                      input_boolean.vmc_master_spia_velocita_2_co2_o_voc
                              - service: shell_command.vmc_master_velocita_2
                                data: {}
                            alias: CASO PDR ON E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - service: shell_command.vmc_master_velocita_2
                                data: {}
                            alias: CASO PDR ON E INQUINANTI OFF
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - service: input_boolean.turn_on
                                metadata: {}
                                data: {}
                                target:
                                  entity_id:
                                    - >-
                                      input_boolean.vmc_master_spia_velocita_2_co2_o_voc
                              - service: shell_command.vmc_master_velocita_2
                                data: {}
                            alias: CASO PDR OFF E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - service: shell_command.vmc_master_velocita_2
                                data: {}
                            alias: CASO PDR OFF E INQUINANTI OFF
                    alias: Interruttore PdR OFF e Interruttore Inquinanti ON
                  - conditions:
                      - condition: and
                        conditions:
                          - alias: Interruttore PdR OFF
                            condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr')=='off'}}
                          - alias: Interruttore Inquinanti OFF
                            condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc')=='off'}}
                    sequence:
                      - choose:
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - service: shell_command.vmc_master_velocita_2
                                data: {}
                            alias: CASO PDR ON E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - service: shell_command.vmc_master_velocita_2
                                data: {}
                            alias: CASO PDR ON E INQUINANTI OFF
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - service: shell_command.vmc_master_velocita_2
                                data: {}
                            alias: CASO PDR OFF E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - service: shell_command.vmc_master_velocita_2
                                data: {}
                            alias: CASO PDR OFF E INQUINANTI OFF
                    alias: Interruttore PdR OFF e Interruttore Inquinanti OFF
          - conditions:
              - alias: Velocità 3 in Assenza di Congelamento e Delta Temperatura
                condition: and
                conditions:
                  - condition: state
                    entity_id: sensor.vmc_master_speed_2_fascia_calendario
                    state: Velocità 3
                  - condition: template
                    value_template: >-
                      {{(states('input_boolean.vmc_master_congelamento_verifica_soglia_valore_spia')==
                      'off' and
                      states('input_boolean.vmc_master_delta_temp_verifica_soglia_valore_spia')==
                      'off')}}
                    alias: Congelamento Assente e Delta Temperatura Assente
            sequence:
              - service: input_boolean.turn_off
                data: {}
                target:
                  entity_id:
                    - >-
                      input_boolean.vmc_master_spia_co2_o_voc_partenza_ritorno_velocita_0
                    - input_boolean.vmc_master_spia_velocita_1_co2_o_voc_pdr
                    - input_boolean.vmc_master_spia_velocita_0_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_1_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_2_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_3_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_4_co2_o_voc
                    - >-
                      input_boolean.vmc_master_spia_velocita_iperventilazione_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_notturna_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_freecooling_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_0_un_solo_avvio
                    - input_boolean.vmc_master_spia_velocita_1_un_solo_avvio
                    - input_boolean.vmc_master_spia_velocita_2_un_solo_avvio
                    - input_boolean.vmc_master_spia_velocita_3_un_solo_avvio
                    - input_boolean.vmc_master_spia_velocita_4_un_solo_avvio
                    - input_boolean.vmc_master_spia_velocita_notturna_un_solo_avvio
                    - >-
                      input_boolean.vmc_master_spia_velocita_iperventilazione_un_solo_avvio
                    - >-
                      input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio
                    - >-
                      input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio_per_programmazione_freecooling
                    - >-
                      input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio_per_programmazione_freeheating
              - choose:
                  - conditions:
                      - condition: and
                        conditions:
                          - condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr')=='on'}}
                            alias: Interruttore PdR ON
                          - condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc')=='on'}}
                            alias: Interruttore Inquinanti ON
                    sequence:
                      - choose:
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - service: input_boolean.turn_on
                                metadata: {}
                                data: {}
                                target:
                                  entity_id:
                                    - >-
                                      input_boolean.vmc_master_spia_velocita_3_un_solo_avvio
                                    - >-
                                      input_boolean.vmc_master_spia_velocita_3_co2_o_voc
                              - service: shell_command.vmc_master_velocita_3
                                metadata: {}
                                data: {}
                            alias: CASO PDR ON E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - service: input_boolean.turn_on
                                metadata: {}
                                data: {}
                                target:
                                  entity_id: >-
                                    input_boolean.vmc_master_spia_velocita_3_un_solo_avvio
                              - service: shell_command.vmc_master_velocita_0
                                data: {}
                            alias: CASO PDR ON E INQUINANTI OFF
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - service: input_boolean.turn_on
                                metadata: {}
                                data: {}
                                target:
                                  entity_id:
                                    - >-
                                      input_boolean.vmc_master_spia_velocita_3_co2_o_voc
                              - service: shell_command.vmc_master_velocita_3
                                metadata: {}
                                data: {}
                            alias: CASO PDR OFF E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - service: shell_command.vmc_master_velocita_3
                                metadata: {}
                                data: {}
                            alias: CASO PDR OFF E INQUINANTI OFF
                    alias: Interruttore PdR ON e Interruttore Inquinanti ON
                  - conditions:
                      - condition: and
                        conditions:
                          - condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr')=='on'}}
                            alias: Interruttore PdR ON
                          - alias: Interruttore Inquinanti OFF
                            condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc')=='off'}}
                    sequence:
                      - choose:
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - service: input_boolean.turn_on
                                metadata: {}
                                data: {}
                                target:
                                  entity_id:
                                    - >-
                                      input_boolean.vmc_master_spia_velocita_3_un_solo_avvio
                              - service: shell_command.vmc_master_velocita_0
                                data: {}
                            alias: CASO PDR ON E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - service: input_boolean.turn_on
                                metadata: {}
                                data: {}
                                target:
                                  entity_id: >-
                                    input_boolean.vmc_master_spia_velocita_3_un_solo_avvio
                              - service: shell_command.vmc_master_velocita_0
                                data: {}
                            alias: CASO PDR ON E INQUINANTI OFF
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - service: shell_command.vmc_master_velocita_3
                                metadata: {}
                                data: {}
                            alias: CASO PDR OFF E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - service: shell_command.vmc_master_velocita_3
                                metadata: {}
                                data: {}
                            alias: CASO PDR OFF E INQUINANTI OFF
                    alias: Interruttore PdR ON e Interruttore Inquinanti OFF
                  - conditions:
                      - condition: and
                        conditions:
                          - alias: Interruttore PdR OFF
                            condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr')=='off'}}
                          - condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc')=='on'}}
                            alias: Interruttore Inquinanti ON
                    sequence:
                      - choose:
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - service: input_boolean.turn_on
                                metadata: {}
                                data: {}
                                target:
                                  entity_id:
                                    - >-
                                      input_boolean.vmc_master_spia_velocita_3_co2_o_voc
                              - service: shell_command.vmc_master_velocita_3
                                metadata: {}
                                data: {}
                            alias: CASO PDR ON E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - service: shell_command.vmc_master_velocita_3
                                data: {}
                            alias: CASO PDR ON E INQUINANTI OFF
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - service: input_boolean.turn_on
                                metadata: {}
                                data: {}
                                target:
                                  entity_id:
                                    - >-
                                      input_boolean.vmc_master_spia_velocita_3_co2_o_voc
                              - service: shell_command.vmc_master_velocita_3
                                metadata: {}
                                data: {}
                            alias: CASO PDR OFF E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - service: shell_command.vmc_master_velocita_3
                                metadata: {}
                                data: {}
                            alias: CASO PDR OFF E INQUINANTI OFF
                    alias: Interruttore PdR OFF e Interruttore Inquinanti ON
                  - conditions:
                      - condition: and
                        conditions:
                          - alias: Interruttore PdR OFF
                            condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr')=='off'}}
                          - alias: Interruttore Inquinanti OFF
                            condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc')=='off'}}
                    sequence:
                      - choose:
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - service: shell_command.vmc_master_velocita_3
                                data: {}
                            alias: CASO PDR ON E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - service: shell_command.vmc_master_velocita_3
                                data: {}
                            alias: CASO PDR ON E INQUINANTI OFF
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - service: shell_command.vmc_master_velocita_3
                                metadata: {}
                                data: {}
                            alias: CASO PDR OFF E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - service: shell_command.vmc_master_velocita_3
                                metadata: {}
                                data: {}
                            alias: CASO PDR OFF E INQUINANTI OFF
                    alias: Interruttore PdR OFF e Interruttore Inquinanti OFF
          - conditions:
              - alias: Velocità 4 in Assenza di Congelamento e Delta Temperatura
                condition: and
                conditions:
                  - condition: state
                    entity_id: sensor.vmc_master_speed_2_fascia_calendario
                    state: Velocità 4
                  - condition: template
                    value_template: >-
                      {{(states('input_boolean.vmc_master_congelamento_verifica_soglia_valore_spia')==
                      'off' and
                      states('input_boolean.vmc_master_delta_temp_verifica_soglia_valore_spia')==
                      'off')}}
                    alias: Congelamento Assente e Delta Temperatura Assente
            sequence:
              - service: input_boolean.turn_off
                data: {}
                target:
                  entity_id:
                    - >-
                      input_boolean.vmc_master_spia_co2_o_voc_partenza_ritorno_velocita_0
                    - input_boolean.vmc_master_spia_velocita_1_co2_o_voc_pdr
                    - input_boolean.vmc_master_spia_velocita_0_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_1_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_2_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_3_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_4_co2_o_voc
                    - >-
                      input_boolean.vmc_master_spia_velocita_iperventilazione_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_notturna_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_freecooling_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_0_un_solo_avvio
                    - input_boolean.vmc_master_spia_velocita_1_un_solo_avvio
                    - input_boolean.vmc_master_spia_velocita_2_un_solo_avvio
                    - input_boolean.vmc_master_spia_velocita_3_un_solo_avvio
                    - input_boolean.vmc_master_spia_velocita_4_un_solo_avvio
                    - input_boolean.vmc_master_spia_velocita_notturna_un_solo_avvio
                    - >-
                      input_boolean.vmc_master_spia_velocita_iperventilazione_un_solo_avvio
                    - >-
                      input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio
                    - >-
                      input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio_per_programmazione_freecooling
                    - >-
                      input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio_per_programmazione_freeheating
              - choose:
                  - conditions:
                      - condition: and
                        conditions:
                          - condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr')=='on'}}
                            alias: Interruttore PdR ON
                          - condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc')=='on'}}
                            alias: Interruttore Inquinanti ON
                    sequence:
                      - choose:
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - service: input_boolean.turn_on
                                metadata: {}
                                data: {}
                                target:
                                  entity_id:
                                    - >-
                                      input_boolean.vmc_master_spia_velocita_4_un_solo_avvio
                                    - >-
                                      input_boolean.vmc_master_spia_velocita_4_co2_o_voc
                              - service: shell_command.vmc_master_velocita_4
                                metadata: {}
                                data: {}
                            alias: CASO PDR ON E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - service: input_boolean.turn_on
                                metadata: {}
                                data: {}
                                target:
                                  entity_id: >-
                                    input_boolean.vmc_master_spia_velocita_4_un_solo_avvio
                              - service: shell_command.vmc_master_velocita_0
                                data: {}
                            alias: CASO PDR ON E INQUINANTI OFF
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - service: input_boolean.turn_on
                                metadata: {}
                                data: {}
                                target:
                                  entity_id:
                                    - >-
                                      input_boolean.vmc_master_spia_velocita_4_co2_o_voc
                              - service: shell_command.vmc_master_velocita_4
                                metadata: {}
                                data: {}
                            alias: CASO PDR OFF E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - service: shell_command.vmc_master_velocita_4
                                metadata: {}
                                data: {}
                            alias: CASO PDR OFF E INQUINANTI OFF
                    alias: Interruttore PdR ON e Interruttore Inquinanti ON
                  - conditions:
                      - condition: and
                        conditions:
                          - condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr')=='on'}}
                            alias: Interruttore PdR ON
                          - alias: Interruttore Inquinanti OFF
                            condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc')=='off'}}
                    sequence:
                      - choose:
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - service: input_boolean.turn_on
                                metadata: {}
                                data: {}
                                target:
                                  entity_id:
                                    - >-
                                      input_boolean.vmc_master_spia_velocita_4_un_solo_avvio
                              - service: shell_command.vmc_master_velocita_0
                                data: {}
                            alias: CASO PDR ON E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - service: input_boolean.turn_on
                                metadata: {}
                                data: {}
                                target:
                                  entity_id: >-
                                    input_boolean.vmc_master_spia_velocita_4_un_solo_avvio
                              - service: shell_command.vmc_master_velocita_0
                                data: {}
                            alias: CASO PDR ON E INQUINANTI OFF
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - service: shell_command.vmc_master_velocita_4
                                metadata: {}
                                data: {}
                            alias: CASO PDR OFF E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - service: shell_command.vmc_master_velocita_4
                                metadata: {}
                                data: {}
                            alias: CASO PDR OFF E INQUINANTI OFF
                    alias: Interruttore PdR ON e Interruttore Inquinanti OFF
                  - conditions:
                      - condition: and
                        conditions:
                          - alias: Interruttore PdR OFF
                            condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr')=='off'}}
                          - condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc')=='on'}}
                            alias: Interruttore Inquinanti ON
                    sequence:
                      - choose:
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - service: input_boolean.turn_on
                                metadata: {}
                                data: {}
                                target:
                                  entity_id:
                                    - >-
                                      input_boolean.vmc_master_spia_velocita_4_co2_o_voc
                              - service: shell_command.vmc_master_velocita_4
                                metadata: {}
                                data: {}
                            alias: CASO PDR ON E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - service: shell_command.vmc_master_velocita_4
                                data: {}
                            alias: CASO PDR ON E INQUINANTI OFF
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - service: input_boolean.turn_on
                                metadata: {}
                                data: {}
                                target:
                                  entity_id:
                                    - >-
                                      input_boolean.vmc_master_spia_velocita_4_co2_o_voc
                              - service: shell_command.vmc_master_velocita_4
                                metadata: {}
                                data: {}
                            alias: CASO PDR OFF E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - service: shell_command.vmc_master_velocita_4
                                metadata: {}
                                data: {}
                            alias: CASO PDR OFF E INQUINANTI OFF
                    alias: Interruttore PdR OFF e Interruttore Inquinanti ON
                  - conditions:
                      - condition: and
                        conditions:
                          - alias: Interruttore PdR OFF
                            condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr')=='off'}}
                          - alias: Interruttore Inquinanti OFF
                            condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc')=='off'}}
                    sequence:
                      - choose:
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - service: shell_command.vmc_master_velocita_4
                                data: {}
                            alias: CASO PDR ON E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - service: shell_command.vmc_master_velocita_4
                                data: {}
                            alias: CASO PDR ON E INQUINANTI OFF
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - service: shell_command.vmc_master_velocita_4
                                metadata: {}
                                data: {}
                            alias: CASO PDR OFF E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - service: shell_command.vmc_master_velocita_4
                                metadata: {}
                                data: {}
                            alias: CASO PDR OFF E INQUINANTI OFF
                    alias: Interruttore PdR OFF e Interruttore Inquinanti OFF
          - conditions:
              - alias: Velocità Notturna in Assenza di Congelamento e Delta Temperatura
                condition: and
                conditions:
                  - condition: state
                    entity_id: sensor.vmc_master_speed_2_fascia_calendario
                    state: Notturna
                  - condition: template
                    value_template: >-
                      {{(states('input_boolean.vmc_master_congelamento_verifica_soglia_valore_spia')==
                      'off' and
                      states('input_boolean.vmc_master_delta_temp_verifica_soglia_valore_spia')==
                      'off')}}
                    alias: Congelamento Assente e Delta Temperatura Assente
            sequence:
              - service: input_boolean.turn_off
                data: {}
                target:
                  entity_id:
                    - >-
                      input_boolean.vmc_master_spia_co2_o_voc_partenza_ritorno_velocita_0
                    - input_boolean.vmc_master_spia_velocita_1_co2_o_voc_pdr
                    - input_boolean.vmc_master_spia_velocita_0_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_1_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_2_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_3_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_4_co2_o_voc
                    - >-
                      input_boolean.vmc_master_spia_velocita_iperventilazione_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_notturna_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_freecooling_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_0_un_solo_avvio
                    - input_boolean.vmc_master_spia_velocita_1_un_solo_avvio
                    - input_boolean.vmc_master_spia_velocita_2_un_solo_avvio
                    - input_boolean.vmc_master_spia_velocita_3_un_solo_avvio
                    - input_boolean.vmc_master_spia_velocita_4_un_solo_avvio
                    - input_boolean.vmc_master_spia_velocita_notturna_un_solo_avvio
                    - >-
                      input_boolean.vmc_master_spia_velocita_iperventilazione_un_solo_avvio
                    - >-
                      input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio
                    - >-
                      input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio_per_programmazione_freecooling
                    - >-
                      input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio_per_programmazione_freeheating
              - choose:
                  - conditions:
                      - condition: and
                        conditions:
                          - condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr')=='on'}}
                            alias: Interruttore PdR ON
                          - condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc')=='on'}}
                            alias: Interruttore Inquinanti ON
                    sequence:
                      - choose:
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - service: input_boolean.turn_on
                                metadata: {}
                                data: {}
                                target:
                                  entity_id:
                                    - >-
                                      input_boolean.vmc_master_spia_velocita_notturna_un_solo_avvio
                                    - >-
                                      input_boolean.vmc_master_spia_velocita_notturna_co2_o_voc
                              - service: shell_command.vmc_master_notturna
                                data: {}
                            alias: CASO PDR ON E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - service: input_boolean.turn_on
                                metadata: {}
                                data: {}
                                target:
                                  entity_id: >-
                                    input_boolean.vmc_master_spia_velocita_notturna_un_solo_avvio
                              - service: shell_command.vmc_master_velocita_0
                                data: {}
                            alias: CASO PDR ON E INQUINANTI OFF
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - service: input_boolean.turn_on
                                metadata: {}
                                data: {}
                                target:
                                  entity_id:
                                    - >-
                                      input_boolean.vmc_master_spia_velocita_notturna_co2_o_voc
                              - service: shell_command.vmc_master_notturna
                                data: {}
                            alias: CASO PDR OFF E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - service: shell_command.vmc_master_notturna
                                data: {}
                            alias: CASO PDR OFF E INQUINANTI OFF
                    alias: Interruttore PdR ON e Interruttore Inquinanti ON
                  - conditions:
                      - condition: and
                        conditions:
                          - condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr')=='on'}}
                            alias: Interruttore PdR ON
                          - alias: Interruttore Inquinanti OFF
                            condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc')=='off'}}
                    sequence:
                      - choose:
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - service: input_boolean.turn_on
                                metadata: {}
                                data: {}
                                target:
                                  entity_id:
                                    - >-
                                      input_boolean.vmc_master_spia_velocita_notturna_un_solo_avvio
                              - service: shell_command.vmc_master_velocita_0
                                data: {}
                            alias: CASO PDR ON E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - service: input_boolean.turn_on
                                metadata: {}
                                data: {}
                                target:
                                  entity_id: >-
                                    input_boolean.vmc_master_spia_velocita_notturna_un_solo_avvio
                              - service: shell_command.vmc_master_velocita_0
                                data: {}
                            alias: CASO PDR ON E INQUINANTI OFF
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - service: shell_command.vmc_master_notturna
                                data: {}
                            alias: CASO PDR OFF E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - service: shell_command.vmc_master_notturna
                                data: {}
                            alias: CASO PDR OFF E INQUINANTI OFF
                    alias: Interruttore PdR ON e Interruttore Inquinanti OFF
                  - conditions:
                      - condition: and
                        conditions:
                          - alias: Interruttore PdR OFF
                            condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr')=='off'}}
                          - condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc')=='on'}}
                            alias: Interruttore Inquinanti ON
                    sequence:
                      - choose:
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - service: input_boolean.turn_on
                                metadata: {}
                                data: {}
                                target:
                                  entity_id:
                                    - >-
                                      input_boolean.vmc_master_spia_velocita_notturna_co2_o_voc
                              - service: shell_command.vmc_master_notturna
                                data: {}
                            alias: CASO PDR ON E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - service: shell_command.vmc_master_notturna
                                data: {}
                            alias: CASO PDR ON E INQUINANTI OFF
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - service: input_boolean.turn_on
                                metadata: {}
                                data: {}
                                target:
                                  entity_id:
                                    - >-
                                      input_boolean.vmc_master_spia_velocita_notturna_co2_o_voc
                              - service: shell_command.vmc_master_notturna
                                data: {}
                            alias: CASO PDR OFF E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - service: shell_command.vmc_master_notturna
                                data: {}
                            alias: CASO PDR OFF E INQUINANTI OFF
                    alias: Interruttore PdR OFF e Interruttore Inquinanti ON
                  - conditions:
                      - condition: and
                        conditions:
                          - alias: Interruttore PdR OFF
                            condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr')=='off'}}
                          - alias: Interruttore Inquinanti OFF
                            condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc')=='off'}}
                    sequence:
                      - choose:
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - service: shell_command.vmc_master_notturna
                                data: {}
                            alias: CASO PDR ON E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - service: shell_command.vmc_master_notturna
                                data: {}
                            alias: CASO PDR ON E INQUINANTI OFF
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - service: shell_command.vmc_master_notturna
                                data: {}
                            alias: CASO PDR OFF E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - service: shell_command.vmc_master_notturna
                                data: {}
                            alias: CASO PDR OFF E INQUINANTI OFF
                    alias: Interruttore PdR OFF e Interruttore Inquinanti OFF
          - conditions:
              - alias: >-
                  Velocità Iperventilazione in Assenza di Congelamento e Delta
                  Temperatura
                condition: and
                conditions:
                  - condition: state
                    entity_id: sensor.vmc_master_speed_2_fascia_calendario
                    state: Iperventilazione
                  - condition: template
                    value_template: >-
                      {{(states('input_boolean.vmc_master_congelamento_verifica_soglia_valore_spia')==
                      'off' and
                      states('input_boolean.vmc_master_delta_temp_verifica_soglia_valore_spia')==
                      'off')}}
                    alias: Congelamento Assente e Delta Temperatura Assente
            sequence:
              - service: input_boolean.turn_off
                data: {}
                target:
                  entity_id:
                    - >-
                      input_boolean.vmc_master_spia_co2_o_voc_partenza_ritorno_velocita_0
                    - input_boolean.vmc_master_spia_velocita_1_co2_o_voc_pdr
                    - input_boolean.vmc_master_spia_velocita_0_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_1_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_2_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_3_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_4_co2_o_voc
                    - >-
                      input_boolean.vmc_master_spia_velocita_iperventilazione_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_notturna_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_freecooling_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_0_un_solo_avvio
                    - input_boolean.vmc_master_spia_velocita_1_un_solo_avvio
                    - input_boolean.vmc_master_spia_velocita_2_un_solo_avvio
                    - input_boolean.vmc_master_spia_velocita_3_un_solo_avvio
                    - input_boolean.vmc_master_spia_velocita_4_un_solo_avvio
                    - input_boolean.vmc_master_spia_velocita_notturna_un_solo_avvio
                    - >-
                      input_boolean.vmc_master_spia_velocita_iperventilazione_un_solo_avvio
                    - >-
                      input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio
                    - >-
                      input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio_per_programmazione_freecooling
                    - >-
                      input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio_per_programmazione_freeheating
              - choose:
                  - conditions:
                      - condition: and
                        conditions:
                          - condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr')=='on'}}
                            alias: Interruttore PdR ON
                          - condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc')=='on'}}
                            alias: Interruttore Inquinanti ON
                    sequence:
                      - choose:
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - service: input_boolean.turn_on
                                metadata: {}
                                data: {}
                                target:
                                  entity_id:
                                    - >-
                                      input_boolean.vmc_master_spia_velocita_iperventilazione_un_solo_avvio
                                    - >-
                                      input_boolean.vmc_master_spia_velocita_iperventilazione_co2_o_voc
                              - service: shell_command.vmc_master_iperventilazione
                                data: {}
                            alias: CASO PDR ON E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - service: input_boolean.turn_on
                                metadata: {}
                                data: {}
                                target:
                                  entity_id: >-
                                    input_boolean.vmc_master_spia_velocita_iperventilazione_un_solo_avvio
                              - service: shell_command.vmc_master_velocita_0
                                data: {}
                            alias: CASO PDR ON E INQUINANTI OFF
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - service: input_boolean.turn_on
                                metadata: {}
                                data: {}
                                target:
                                  entity_id:
                                    - >-
                                      input_boolean.vmc_master_spia_velocita_iperventilazione_co2_o_voc
                              - service: shell_command.vmc_master_iperventilazione
                                data: {}
                            alias: CASO PDR OFF E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - service: shell_command.vmc_master_iperventilazione
                                data: {}
                            alias: CASO PDR OFF E INQUINANTI OFF
                    alias: Interruttore PdR ON e Interruttore Inquinanti ON
                  - conditions:
                      - condition: and
                        conditions:
                          - condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr')=='on'}}
                            alias: Interruttore PdR ON
                          - alias: Interruttore Inquinanti OFF
                            condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc')=='off'}}
                    sequence:
                      - choose:
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - service: input_boolean.turn_on
                                metadata: {}
                                data: {}
                                target:
                                  entity_id:
                                    - >-
                                      input_boolean.vmc_master_spia_velocita_iperventilazione_un_solo_avvio
                              - service: shell_command.vmc_master_velocita_0
                                data: {}
                            alias: CASO PDR ON E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - service: input_boolean.turn_on
                                metadata: {}
                                data: {}
                                target:
                                  entity_id: >-
                                    input_boolean.vmc_master_spia_velocita_iperventilazione_un_solo_avvio
                              - service: shell_command.vmc_master_velocita_0
                                data: {}
                            alias: CASO PDR ON E INQUINANTI OFF
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - service: shell_command.vmc_master_iperventilazione
                                data: {}
                            alias: CASO PDR OFF E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - service: shell_command.vmc_master_iperventilazione
                                data: {}
                            alias: CASO PDR OFF E INQUINANTI OFF
                    alias: Interruttore PdR ON e Interruttore Inquinanti OFF
                  - conditions:
                      - condition: and
                        conditions:
                          - alias: Interruttore PdR OFF
                            condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr')=='off'}}
                          - condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc')=='on'}}
                            alias: Interruttore Inquinanti ON
                    sequence:
                      - choose:
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - service: input_boolean.turn_on
                                metadata: {}
                                data: {}
                                target:
                                  entity_id:
                                    - >-
                                      input_boolean.vmc_master_spia_velocita_iperventilazione_co2_o_voc
                              - service: shell_command.vmc_master_iperventilazione
                                data: {}
                            alias: CASO PDR ON E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - service: shell_command.vmc_master_iperventilazione
                                data: {}
                            alias: CASO PDR ON E INQUINANTI OFF
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - service: input_boolean.turn_on
                                metadata: {}
                                data: {}
                                target:
                                  entity_id:
                                    - >-
                                      input_boolean.vmc_master_spia_velocita_iperventilazione_co2_o_voc
                              - service: shell_command.vmc_master_iperventilazione
                                data: {}
                            alias: CASO PDR OFF E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - service: shell_command.vmc_master_iperventilazione
                                data: {}
                            alias: CASO PDR OFF E INQUINANTI OFF
                    alias: Interruttore PdR OFF e Interruttore Inquinanti ON
                  - conditions:
                      - condition: and
                        conditions:
                          - alias: Interruttore PdR OFF
                            condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr')=='off'}}
                          - alias: Interruttore Inquinanti OFF
                            condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc')=='off'}}
                    sequence:
                      - choose:
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - service: shell_command.vmc_master_iperventilazione
                                data: {}
                            alias: CASO PDR ON E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - service: shell_command.vmc_master_iperventilazione
                                data: {}
                            alias: CASO PDR ON E INQUINANTI OFF
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - service: shell_command.vmc_master_iperventilazione
                                data: {}
                            alias: CASO PDR OFF E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - service: shell_command.vmc_master_iperventilazione
                                data: {}
                            alias: CASO PDR OFF E INQUINANTI OFF
                    alias: Interruttore PdR OFF e Interruttore Inquinanti OFF
          - conditions:
              - alias: >-
                  Velocità Free Cool./Heat. in Assenza di Congelamento e Delta
                  Temperatura
                condition: and
                conditions:
                  - condition: state
                    entity_id: sensor.vmc_master_speed_2_fascia_calendario
                    state: Free Cool./Heat.
                  - condition: template
                    value_template: >-
                      {{(states('input_boolean.vmc_master_congelamento_verifica_soglia_valore_spia')==
                      'off' and
                      states('input_boolean.vmc_master_delta_temp_verifica_soglia_valore_spia')==
                      'off')}}
                    alias: Congelamento Assente e Delta Temperatura Assente
            sequence:
              - service: input_boolean.turn_off
                data: {}
                target:
                  entity_id:
                    - >-
                      input_boolean.vmc_master_spia_co2_o_voc_partenza_ritorno_velocita_0
                    - input_boolean.vmc_master_spia_velocita_1_co2_o_voc_pdr
                    - input_boolean.vmc_master_spia_velocita_0_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_1_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_2_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_3_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_4_co2_o_voc
                    - >-
                      input_boolean.vmc_master_spia_velocita_iperventilazione_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_notturna_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_freecooling_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_0_un_solo_avvio
                    - input_boolean.vmc_master_spia_velocita_1_un_solo_avvio
                    - input_boolean.vmc_master_spia_velocita_2_un_solo_avvio
                    - input_boolean.vmc_master_spia_velocita_3_un_solo_avvio
                    - input_boolean.vmc_master_spia_velocita_4_un_solo_avvio
                    - input_boolean.vmc_master_spia_velocita_notturna_un_solo_avvio
                    - >-
                      input_boolean.vmc_master_spia_velocita_iperventilazione_un_solo_avvio
                    - >-
                      input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio
                    - >-
                      input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio_per_programmazione_freecooling
                    - >-
                      input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio_per_programmazione_freeheating
              - choose:
                  - conditions:
                      - alias: Verifica Programmato Mese Free Heating
                        condition: template
                        value_template: >-
                          {{
                          states('sensor.vmc_master_status_mese_corrente_freeheating_o_freecooling')
                          == "Free Heating" }}
                    sequence:
                      - alias: Spia Free Heating ON o Spia Free Heating OFF ?
                        choose:
                          - conditions:
                              - alias: Allerte Free Heating ON
                                condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_alert_monitoraggio_free_heating_o_free_cooling_allert_interfaccia_avvisi')
                                  != "Nessuna Allerta Free Heating Programmato" or
                                  states('sensor.vmc_master_alert_monitoraggio_free_heating_o_free_cooling_allert_interfaccia_avvisi')
                                  != "Nessuna Allerta Free Heating Programmato,
                                  Presenza di Inquinanti" }}
                            sequence:
                              - choose:
                                  - conditions:
                                      - condition: and
                                        conditions:
                                          - condition: template
                                            value_template: >-
                                              {{
                                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr')=='on'}}
                                            alias: Interruttore PdR ON
                                          - condition: template
                                            value_template: >-
                                              {{
                                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc')=='on'}}
                                            alias: Interruttore Inquinanti ON
                                    sequence:
                                      - choose:
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Allerta' or
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Allerta')}}
                                            sequence:
                                              - service: input_boolean.turn_on
                                                metadata: {}
                                                data: {}
                                                target:
                                                  entity_id:
                                                    - >-
                                                      input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio
                                                    - >-
                                                      input_boolean.vmc_master_spia_velocita_1_co2_o_voc
                                                    - >-
                                                      input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio_per_programmazione_freeheating
                                              - service: shell_command.vmc_master_velocita_1
                                                metadata: {}
                                                data: {}
                                            alias: CASO PDR ON E INQUINANTI ON
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Nessuna Allerta' and
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Nessuna Allerta')}}
                                            sequence:
                                              - service: input_boolean.turn_on
                                                metadata: {}
                                                data: {}
                                                target:
                                                  entity_id:
                                                    - >-
                                                      input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio_per_programmazione_freeheating
                                                    - >-
                                                      input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio
                                              - service: shell_command.vmc_master_velocita_0
                                                data: {}
                                            alias: CASO PDR ON E INQUINANTI OFF
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Allerta' or
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Allerta')}}
                                            sequence:
                                              - service: input_boolean.turn_on
                                                metadata: {}
                                                data: {}
                                                target:
                                                  entity_id:
                                                    - >-
                                                      input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio_per_programmazione_freeheating
                                                    - >-
                                                      input_boolean.vmc_master_spia_velocita_1_co2_o_voc
                                              - service: shell_command.vmc_master_velocita_1
                                                metadata: {}
                                                data: {}
                                            alias: CASO PDR OFF E INQUINANTI ON
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Nessuna Allerta' and
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Nessuna Allerta')}}
                                            sequence:
                                              - service: input_boolean.turn_on
                                                metadata: {}
                                                data: {}
                                                target:
                                                  entity_id: >-
                                                    input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio_per_programmazione_freeheating
                                              - service: shell_command.vmc_master_velocita_0
                                                data: {}
                                            alias: CASO PDR OFF E INQUINANTI OFF
                                    alias: >-
                                      Interruttore PdR ON e Interruttore Inquinanti
                                      ON
                                  - conditions:
                                      - condition: and
                                        conditions:
                                          - condition: template
                                            value_template: >-
                                              {{
                                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr')=='on'}}
                                            alias: Interruttore PdR ON
                                          - alias: Interruttore Inquinanti OFF
                                            condition: template
                                            value_template: >-
                                              {{
                                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc')=='off'}}
                                    sequence:
                                      - choose:
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Allerta' or
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Allerta')}}
                                            sequence:
                                              - service: input_boolean.turn_on
                                                metadata: {}
                                                data: {}
                                                target:
                                                  entity_id:
                                                    - >-
                                                      input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio
                                                    - >-
                                                      input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio_per_programmazione_freeheating
                                              - service: shell_command.vmc_master_velocita_0
                                                data: {}
                                            alias: CASO PDR ON E INQUINANTI ON
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Nessuna Allerta' and
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Nessuna Allerta')}}
                                            sequence:
                                              - service: input_boolean.turn_on
                                                metadata: {}
                                                data: {}
                                                target:
                                                  entity_id:
                                                    - >-
                                                      input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio
                                                    - >-
                                                      input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio_per_programmazione_freeheating
                                              - service: shell_command.vmc_master_velocita_0
                                                data: {}
                                            alias: CASO PDR ON E INQUINANTI OFF
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Allerta' or
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Allerta')}}
                                            sequence:
                                              - service: input_boolean.turn_on
                                                metadata: {}
                                                data: {}
                                                target:
                                                  entity_id:
                                                    - >-
                                                      input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio_per_programmazione_freeheating
                                              - service: shell_command.vmc_master_velocita_0
                                                data: {}
                                            alias: CASO PDR OFF E INQUINANTI ON
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Nessuna Allerta' and
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Nessuna Allerta')}}
                                            sequence:
                                              - service: input_boolean.turn_on
                                                metadata: {}
                                                data: {}
                                                target:
                                                  entity_id:
                                                    - >-
                                                      input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio_per_programmazione_freeheating
                                              - service: shell_command.vmc_master_velocita_0
                                                data: {}
                                            alias: CASO PDR OFF E INQUINANTI OFF
                                    alias: >-
                                      Interruttore PdR ON e Interruttore Inquinanti
                                      OFF
                                  - conditions:
                                      - condition: and
                                        conditions:
                                          - alias: Interruttore PdR OFF
                                            condition: template
                                            value_template: >-
                                              {{
                                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr')=='off'}}
                                          - condition: template
                                            value_template: >-
                                              {{
                                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc')=='on'}}
                                            alias: Interruttore Inquinanti ON
                                    sequence:
                                      - choose:
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Allerta' or
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Allerta')}}
                                            sequence:
                                              - service: input_boolean.turn_on
                                                metadata: {}
                                                data: {}
                                                target:
                                                  entity_id:
                                                    - >-
                                                      input_boolean.vmc_master_spia_velocita_1_co2_o_voc
                                                    - >-
                                                      input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio_per_programmazione_freeheating
                                              - service: shell_command.vmc_master_velocita_1
                                                metadata: {}
                                                data: {}
                                            alias: CASO PDR ON E INQUINANTI ON
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Nessuna Allerta' and
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Nessuna Allerta')}}
                                            sequence:
                                              - service: input_boolean.turn_on
                                                metadata: {}
                                                data: {}
                                                target:
                                                  entity_id:
                                                    - >-
                                                      input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio_per_programmazione_freeheating
                                              - service: shell_command.vmc_master_velocita_0
                                                data: {}
                                            alias: CASO PDR ON E INQUINANTI OFF
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Allerta' or
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Allerta')}}
                                            sequence:
                                              - service: input_boolean.turn_on
                                                metadata: {}
                                                data: {}
                                                target:
                                                  entity_id:
                                                    - >-
                                                      input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio_per_programmazione_freeheating
                                                    - >-
                                                      input_boolean.vmc_master_spia_velocita_1_co2_o_voc
                                              - service: shell_command.vmc_master_velocita_1
                                                metadata: {}
                                                data: {}
                                            alias: CASO PDR OFF E INQUINANTI ON
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Nessuna Allerta' and
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Nessuna Allerta')}}
                                            sequence:
                                              - service: input_boolean.turn_on
                                                metadata: {}
                                                data: {}
                                                target:
                                                  entity_id: >-
                                                    input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio_per_programmazione_freeheating
                                              - service: shell_command.vmc_master_velocita_0
                                                data: {}
                                            alias: CASO PDR OFF E INQUINANTI OFF
                                    alias: >-
                                      Interruttore PdR OFF e Interruttore Inquinanti
                                      ON
                                  - conditions:
                                      - condition: and
                                        conditions:
                                          - alias: Interruttore PdR OFF
                                            condition: template
                                            value_template: >-
                                              {{
                                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr')=='off'}}
                                          - alias: Interruttore Inquinanti OFF
                                            condition: template
                                            value_template: >-
                                              {{
                                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc')=='off'}}
                                    sequence:
                                      - choose:
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Allerta' or
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Allerta')}}
                                            sequence:
                                              - service: input_boolean.turn_on
                                                metadata: {}
                                                data: {}
                                                target:
                                                  entity_id:
                                                    - >-
                                                      input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio_per_programmazione_freeheating
                                              - service: shell_command.vmc_master_velocita_0
                                                data: {}
                                            alias: CASO PDR ON E INQUINANTI ON
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Nessuna Allerta' and
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Nessuna Allerta')}}
                                            sequence:
                                              - service: input_boolean.turn_on
                                                metadata: {}
                                                data: {}
                                                target:
                                                  entity_id:
                                                    - >-
                                                      input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio_per_programmazione_freeheating
                                              - service: shell_command.vmc_master_velocita_0
                                                data: {}
                                            alias: CASO PDR ON E INQUINANTI OFF
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Allerta' or
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Allerta')}}
                                            sequence:
                                              - service: input_boolean.turn_on
                                                metadata: {}
                                                data: {}
                                                target:
                                                  entity_id:
                                                    - >-
                                                      input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio_per_programmazione_freeheating
                                              - service: shell_command.vmc_master_velocita_0
                                                data: {}
                                            alias: CASO PDR OFF E INQUINANTI ON
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Nessuna Allerta' and
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Nessuna Allerta')}}
                                            sequence:
                                              - service: input_boolean.turn_on
                                                metadata: {}
                                                data: {}
                                                target:
                                                  entity_id:
                                                    - >-
                                                      input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio_per_programmazione_freeheating
                                              - service: shell_command.vmc_master_velocita_0
                                                data: {}
                                            alias: CASO PDR OFF E INQUINANTI OFF
                                    alias: >-
                                      Interruttore PdR OFF e Interruttore Inquinanti
                                      OFF
                            alias: Spia Free Heating ON
                          - conditions:
                              - alias: Allerte Free Heating OFF
                                condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_alert_monitoraggio_free_heating_o_free_cooling_allert_interfaccia_avvisi')
                                  == "Nessuna Allerta Free Heating Programmato" or
                                  states('sensor.vmc_master_alert_monitoraggio_free_heating_o_free_cooling_allert_interfaccia_avvisi')
                                  == "Nessuna Allerta Free Heating Programmato,
                                  Presenza di Inquinanti" }}
                            sequence:
                              - choose:
                                  - conditions:
                                      - condition: and
                                        conditions:
                                          - condition: template
                                            value_template: >-
                                              {{
                                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr')=='on'}}
                                            alias: Interruttore PdR ON
                                          - condition: template
                                            value_template: >-
                                              {{
                                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc')=='on'}}
                                            alias: Interruttore Inquinanti ON
                                    sequence:
                                      - choose:
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Allerta' or
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Allerta')}}
                                            sequence:
                                              - service: input_boolean.turn_on
                                                metadata: {}
                                                data: {}
                                                target:
                                                  entity_id:
                                                    - >-
                                                      input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio
                                                    - >-
                                                      input_boolean.vmc_master_spia_velocita_freecooling_co2_o_voc
                                              - service: shell_command.vmc_master_freecooling
                                                data: {}
                                            alias: CASO PDR ON E INQUINANTI ON
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Nessuna Allerta' and
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Nessuna Allerta')}}
                                            sequence:
                                              - service: input_boolean.turn_on
                                                metadata: {}
                                                data: {}
                                                target:
                                                  entity_id: >-
                                                    input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio
                                              - service: shell_command.vmc_master_velocita_0
                                                data: {}
                                            alias: CASO PDR ON E INQUINANTI OFF
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Allerta' or
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Allerta')}}
                                            sequence:
                                              - service: input_boolean.turn_on
                                                metadata: {}
                                                data: {}
                                                target:
                                                  entity_id:
                                                    - >-
                                                      input_boolean.vmc_master_spia_velocita_freecooling_co2_o_voc
                                              - service: shell_command.vmc_master_freecooling
                                                data: {}
                                            alias: CASO PDR OFF E INQUINANTI ON
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Nessuna Allerta' and
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Nessuna Allerta')}}
                                            sequence:
                                              - service: shell_command.vmc_master_freecooling
                                                data: {}
                                            alias: CASO PDR OFF E INQUINANTI OFF
                                    alias: >-
                                      Interruttore PdR ON e Interruttore Inquinanti
                                      ON
                                  - conditions:
                                      - condition: and
                                        conditions:
                                          - condition: template
                                            value_template: >-
                                              {{
                                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr')=='on'}}
                                            alias: Interruttore PdR ON
                                          - alias: Interruttore Inquinanti OFF
                                            condition: template
                                            value_template: >-
                                              {{
                                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc')=='off'}}
                                    sequence:
                                      - choose:
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Allerta' or
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Allerta')}}
                                            sequence:
                                              - service: input_boolean.turn_on
                                                metadata: {}
                                                data: {}
                                                target:
                                                  entity_id:
                                                    - >-
                                                      input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio
                                              - service: shell_command.vmc_master_velocita_0
                                                data: {}
                                            alias: CASO PDR ON E INQUINANTI ON
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Nessuna Allerta' and
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Nessuna Allerta')}}
                                            sequence:
                                              - service: input_boolean.turn_on
                                                metadata: {}
                                                data: {}
                                                target:
                                                  entity_id: >-
                                                    input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio
                                              - service: shell_command.vmc_master_velocita_0
                                                data: {}
                                            alias: CASO PDR ON E INQUINANTI OFF
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Allerta' or
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Allerta')}}
                                            sequence:
                                              - service: shell_command.vmc_master_freecooling
                                                data: {}
                                            alias: CASO PDR OFF E INQUINANTI ON
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Nessuna Allerta' and
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Nessuna Allerta')}}
                                            sequence:
                                              - service: shell_command.vmc_master_freecooling
                                                data: {}
                                            alias: CASO PDR OFF E INQUINANTI OFF
                                    alias: >-
                                      Interruttore PdR ON e Interruttore Inquinanti
                                      OFF
                                  - conditions:
                                      - condition: and
                                        conditions:
                                          - alias: Interruttore PdR OFF
                                            condition: template
                                            value_template: >-
                                              {{
                                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr')=='off'}}
                                          - condition: template
                                            value_template: >-
                                              {{
                                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc')=='on'}}
                                            alias: Interruttore Inquinanti ON
                                    sequence:
                                      - choose:
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Allerta' or
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Allerta')}}
                                            sequence:
                                              - service: input_boolean.turn_on
                                                metadata: {}
                                                data: {}
                                                target:
                                                  entity_id:
                                                    - >-
                                                      input_boolean.vmc_master_spia_velocita_freecooling_co2_o_voc
                                              - service: shell_command.vmc_master_freecooling
                                                data: {}
                                            alias: CASO PDR ON E INQUINANTI ON
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Nessuna Allerta' and
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Nessuna Allerta')}}
                                            sequence:
                                              - service: shell_command.vmc_master_freecooling
                                                data: {}
                                            alias: CASO PDR ON E INQUINANTI OFF
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Allerta' or
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Allerta')}}
                                            sequence:
                                              - service: input_boolean.turn_on
                                                metadata: {}
                                                data: {}
                                                target:
                                                  entity_id:
                                                    - >-
                                                      input_boolean.vmc_master_spia_velocita_freecooling_co2_o_voc
                                              - service: shell_command.vmc_master_freecooling
                                                data: {}
                                            alias: CASO PDR OFF E INQUINANTI ON
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Nessuna Allerta' and
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Nessuna Allerta')}}
                                            sequence:
                                              - service: shell_command.vmc_master_freecooling
                                                data: {}
                                            alias: CASO PDR OFF E INQUINANTI OFF
                                    alias: >-
                                      Interruttore PdR OFF e Interruttore Inquinanti
                                      ON
                                  - conditions:
                                      - condition: and
                                        conditions:
                                          - alias: Interruttore PdR OFF
                                            condition: template
                                            value_template: >-
                                              {{
                                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr')=='off'}}
                                          - alias: Interruttore Inquinanti OFF
                                            condition: template
                                            value_template: >-
                                              {{
                                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc')=='off'}}
                                    sequence:
                                      - choose:
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Allerta' or
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Allerta')}}
                                            sequence:
                                              - service: shell_command.vmc_master_freecooling
                                                data: {}
                                            alias: CASO PDR ON E INQUINANTI ON
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Nessuna Allerta' and
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Nessuna Allerta')}}
                                            sequence:
                                              - service: shell_command.vmc_master_freecooling
                                                data: {}
                                            alias: CASO PDR ON E INQUINANTI OFF
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Allerta' or
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Allerta')}}
                                            sequence:
                                              - service: shell_command.vmc_master_freecooling
                                                data: {}
                                            alias: CASO PDR OFF E INQUINANTI ON
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Nessuna Allerta' and
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Nessuna Allerta')}}
                                            sequence:
                                              - service: shell_command.vmc_master_freecooling
                                                data: {}
                                            alias: CASO PDR OFF E INQUINANTI OFF
                                    alias: >-
                                      Interruttore PdR OFF e Interruttore Inquinanti
                                      OFF
                            alias: Spia Free Heating OFF
                    alias: Programmato Mese Free Heating
                  - conditions:
                      - alias: Verifica Programmato Mese Free Cooling
                        condition: template
                        value_template: >-
                          {{
                          states('sensor.vmc_master_status_mese_corrente_freeheating_o_freecooling')
                          == "Free Cooling" }}
                    sequence:
                      - alias: Spia Free Cooling ON o Spia Free Cooling OFF ?
                        choose:
                          - conditions:
                              - alias: Allerte Free Cooling ON
                                condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_alert_monitoraggio_free_heating_o_free_cooling_allert_interfaccia_avvisi')
                                  != "Nessuna Allerta Free Cooling Programmato" or
                                  states('sensor.vmc_master_alert_monitoraggio_free_heating_o_free_cooling_allert_interfaccia_avvisi')
                                  != "Nessuna Allerta Free Cooling Programmato,
                                  Presenza di Inquinanti" }}
                            sequence:
                              - choose:
                                  - conditions:
                                      - condition: template
                                        value_template: >-
                                          {{
                                          states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                          ne sconsiglia l\'impiego" and
                                          (states('sensor.vmc_master_alert_monitoraggio_co2')
                                          == 'Allerta' or
                                          states('sensor.vmc_master_alert_monitoraggio_voc')
                                          == 'Allerta')}}
                                    sequence:
                                      - service: input_boolean.turn_on
                                        metadata: {}
                                        data: {}
                                        target:
                                          entity_id:
                                            - >-
                                              input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio
                                            - >-
                                              input_boolean.vmc_master_spia_velocita_1_co2_o_voc
                                            - >-
                                              input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio_per_programmazione_freecooling
                                      - service: shell_command.vmc_master_velocita_1
                                        metadata: {}
                                        data: {}
                                    alias: CASO PDR ON E INQUINANTI ON
                                  - conditions:
                                      - condition: template
                                        value_template: >-
                                          {{
                                          states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                          ne sconsiglia l\'impiego" and
                                          (states('sensor.vmc_master_alert_monitoraggio_co2')
                                          == 'Nessuna Allerta' and
                                          states('sensor.vmc_master_alert_monitoraggio_voc')
                                          == 'Nessuna Allerta')}}
                                    sequence:
                                      - service: input_boolean.turn_on
                                        metadata: {}
                                        data: {}
                                        target:
                                          entity_id:
                                            - >-
                                              input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio_per_programmazione_freecooling
                                            - >-
                                              input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio
                                      - service: shell_command.vmc_master_velocita_0
                                        data: {}
                                    alias: CASO PDR ON E INQUINANTI OFF
                                  - conditions:
                                      - condition: template
                                        value_template: >-
                                          {{
                                          states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                          ne sconsiglia l\'impiego" and
                                          (states('sensor.vmc_master_alert_monitoraggio_co2')
                                          == 'Allerta' or
                                          states('sensor.vmc_master_alert_monitoraggio_voc')
                                          == 'Allerta')}}
                                    sequence:
                                      - service: input_boolean.turn_on
                                        metadata: {}
                                        data: {}
                                        target:
                                          entity_id:
                                            - >-
                                              input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio_per_programmazione_freecooling
                                            - >-
                                              input_boolean.vmc_master_spia_velocita_1_co2_o_voc
                                      - service: shell_command.vmc_master_velocita_1
                                        metadata: {}
                                        data: {}
                                    alias: CASO PDR OFF E INQUINANTI ON
                                  - conditions:
                                      - condition: template
                                        value_template: >-
                                          {{
                                          states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                          ne sconsiglia l\'impiego" and
                                          (states('sensor.vmc_master_alert_monitoraggio_co2')
                                          == 'Nessuna Allerta' and
                                          states('sensor.vmc_master_alert_monitoraggio_voc')
                                          == 'Nessuna Allerta')}}
                                    sequence:
                                      - service: input_boolean.turn_on
                                        metadata: {}
                                        data: {}
                                        target:
                                          entity_id: >-
                                            input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio_per_programmazione_freecooling
                                      - service: shell_command.vmc_master_velocita_0
                                        data: {}
                                    alias: CASO PDR OFF E INQUINANTI OFF
                            alias: Spia Free Cooling ON
                          - conditions:
                              - alias: Allerte Free Cooling OFF
                                condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_alert_monitoraggio_free_heating_o_free_cooling_allert_interfaccia_avvisi')
                                  == "Nessuna Allerta Free Cooling Programmato" or
                                  states('sensor.vmc_master_alert_monitoraggio_free_heating_o_free_cooling_allert_interfaccia_avvisi')
                                  == "Nessuna Allerta Free Cooling Programmato,
                                  Presenza di Inquinanti" }}
                            sequence:
                              - choose:
                                  - conditions:
                                      - condition: and
                                        conditions:
                                          - condition: template
                                            value_template: >-
                                              {{
                                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr')=='on'}}
                                            alias: Interruttore PdR ON
                                          - condition: template
                                            value_template: >-
                                              {{
                                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc')=='on'}}
                                            alias: Interruttore Inquinanti ON
                                    sequence:
                                      - choose:
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Allerta' or
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Allerta')}}
                                            sequence:
                                              - service: input_boolean.turn_on
                                                metadata: {}
                                                data: {}
                                                target:
                                                  entity_id:
                                                    - >-
                                                      input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio
                                                    - >-
                                                      input_boolean.vmc_master_spia_velocita_freecooling_co2_o_voc
                                              - service: shell_command.vmc_master_freecooling
                                                data: {}
                                            alias: CASO PDR ON E INQUINANTI ON
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Nessuna Allerta' and
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Nessuna Allerta')}}
                                            sequence:
                                              - service: input_boolean.turn_on
                                                metadata: {}
                                                data: {}
                                                target:
                                                  entity_id: >-
                                                    input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio
                                              - service: shell_command.vmc_master_velocita_0
                                                data: {}
                                            alias: CASO PDR ON E INQUINANTI OFF
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Allerta' or
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Allerta')}}
                                            sequence:
                                              - service: input_boolean.turn_on
                                                metadata: {}
                                                data: {}
                                                target:
                                                  entity_id:
                                                    - >-
                                                      input_boolean.vmc_master_spia_velocita_freecooling_co2_o_voc
                                              - service: shell_command.vmc_master_freecooling
                                                data: {}
                                            alias: CASO PDR OFF E INQUINANTI ON
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Nessuna Allerta' and
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Nessuna Allerta')}}
                                            sequence:
                                              - service: shell_command.vmc_master_freecooling
                                                data: {}
                                            alias: CASO PDR OFF E INQUINANTI OFF
                                    alias: >-
                                      Interruttore PdR ON e Interruttore Inquinanti
                                      ON
                                  - conditions:
                                      - condition: and
                                        conditions:
                                          - condition: template
                                            value_template: >-
                                              {{
                                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr')=='on'}}
                                            alias: Interruttore PdR ON
                                          - alias: Interruttore Inquinanti OFF
                                            condition: template
                                            value_template: >-
                                              {{
                                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc')=='off'}}
                                    sequence:
                                      - choose:
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Allerta' or
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Allerta')}}
                                            sequence:
                                              - service: input_boolean.turn_on
                                                metadata: {}
                                                data: {}
                                                target:
                                                  entity_id:
                                                    - >-
                                                      input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio
                                              - service: shell_command.vmc_master_velocita_0
                                                data: {}
                                            alias: CASO PDR ON E INQUINANTI ON
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Nessuna Allerta' and
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Nessuna Allerta')}}
                                            sequence:
                                              - service: input_boolean.turn_on
                                                metadata: {}
                                                data: {}
                                                target:
                                                  entity_id: >-
                                                    input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio
                                              - service: shell_command.vmc_master_velocita_0
                                                data: {}
                                            alias: CASO PDR ON E INQUINANTI OFF
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Allerta' or
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Allerta')}}
                                            sequence:
                                              - service: shell_command.vmc_master_freecooling
                                                data: {}
                                            alias: CASO PDR OFF E INQUINANTI ON
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Nessuna Allerta' and
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Nessuna Allerta')}}
                                            sequence:
                                              - service: shell_command.vmc_master_freecooling
                                                data: {}
                                            alias: CASO PDR OFF E INQUINANTI OFF
                                    alias: >-
                                      Interruttore PdR ON e Interruttore Inquinanti
                                      OFF
                                  - conditions:
                                      - condition: and
                                        conditions:
                                          - alias: Interruttore PdR OFF
                                            condition: template
                                            value_template: >-
                                              {{
                                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr')=='off'}}
                                          - condition: template
                                            value_template: >-
                                              {{
                                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc')=='on'}}
                                            alias: Interruttore Inquinanti ON
                                    sequence:
                                      - choose:
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Allerta' or
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Allerta')}}
                                            sequence:
                                              - service: input_boolean.turn_on
                                                metadata: {}
                                                data: {}
                                                target:
                                                  entity_id:
                                                    - >-
                                                      input_boolean.vmc_master_spia_velocita_freecooling_co2_o_voc
                                              - service: shell_command.vmc_master_freecooling
                                                data: {}
                                            alias: CASO PDR ON E INQUINANTI ON
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Nessuna Allerta' and
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Nessuna Allerta')}}
                                            sequence:
                                              - service: shell_command.vmc_master_freecooling
                                                data: {}
                                            alias: CASO PDR ON E INQUINANTI OFF
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Allerta' or
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Allerta')}}
                                            sequence:
                                              - service: input_boolean.turn_on
                                                metadata: {}
                                                data: {}
                                                target:
                                                  entity_id:
                                                    - >-
                                                      input_boolean.vmc_master_spia_velocita_freecooling_co2_o_voc
                                              - service: shell_command.vmc_master_freecooling
                                                data: {}
                                            alias: CASO PDR OFF E INQUINANTI ON
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Nessuna Allerta' and
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Nessuna Allerta')}}
                                            sequence:
                                              - service: shell_command.vmc_master_freecooling
                                                data: {}
                                            alias: CASO PDR OFF E INQUINANTI OFF
                                    alias: >-
                                      Interruttore PdR OFF e Interruttore Inquinanti
                                      ON
                                  - conditions:
                                      - condition: and
                                        conditions:
                                          - alias: Interruttore PdR OFF
                                            condition: template
                                            value_template: >-
                                              {{
                                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr')=='off'}}
                                          - alias: Interruttore Inquinanti OFF
                                            condition: template
                                            value_template: >-
                                              {{
                                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc')=='off'}}
                                    sequence:
                                      - choose:
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Allerta' or
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Allerta')}}
                                            sequence:
                                              - service: shell_command.vmc_master_freecooling
                                                data: {}
                                            alias: CASO PDR ON E INQUINANTI ON
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Nessuna Allerta' and
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Nessuna Allerta')}}
                                            sequence:
                                              - service: shell_command.vmc_master_freecooling
                                                data: {}
                                            alias: CASO PDR ON E INQUINANTI OFF
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Allerta' or
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Allerta')}}
                                            sequence:
                                              - service: shell_command.vmc_master_freecooling
                                                data: {}
                                            alias: CASO PDR OFF E INQUINANTI ON
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Nessuna Allerta' and
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Nessuna Allerta')}}
                                            sequence:
                                              - service: shell_command.vmc_master_freecooling
                                                data: {}
                                            alias: CASO PDR OFF E INQUINANTI OFF
                                    alias: >-
                                      Interruttore PdR OFF e Interruttore Inquinanti
                                      OFF
                            alias: Spia Free Cooling OFF
                    alias: Programmato Mese Free Cooling
                  - conditions:
                      - alias: Verifica Programmato Mese Disabilitato
                        condition: template
                        value_template: >-
                          {{
                          states('sensor.vmc_master_status_mese_corrente_freeheating_o_freecooling')
                          == "Disabilitata" }}
                    sequence:
                      - choose:
                          - conditions:
                              - condition: and
                                conditions:
                                  - condition: template
                                    value_template: >-
                                      {{
                                      states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr')=='on'}}
                                    alias: Interruttore PdR ON
                                  - condition: template
                                    value_template: >-
                                      {{
                                      states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc')=='on'}}
                                    alias: Interruttore Inquinanti ON
                            sequence:
                              - choose:
                                  - conditions:
                                      - condition: template
                                        value_template: >-
                                          {{
                                          states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                          ne sconsiglia l\'impiego" and
                                          (states('sensor.vmc_master_alert_monitoraggio_co2')
                                          == 'Allerta' or
                                          states('sensor.vmc_master_alert_monitoraggio_voc')
                                          == 'Allerta')}}
                                    sequence:
                                      - service: input_boolean.turn_on
                                        metadata: {}
                                        data: {}
                                        target:
                                          entity_id:
                                            - >-
                                              input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio
                                            - >-
                                              input_boolean.vmc_master_spia_velocita_freecooling_co2_o_voc
                                      - service: shell_command.vmc_master_freecooling
                                        data: {}
                                    alias: CASO PDR ON E INQUINANTI ON
                                  - conditions:
                                      - condition: template
                                        value_template: >-
                                          {{
                                          states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                          ne sconsiglia l\'impiego" and
                                          (states('sensor.vmc_master_alert_monitoraggio_co2')
                                          == 'Nessuna Allerta' and
                                          states('sensor.vmc_master_alert_monitoraggio_voc')
                                          == 'Nessuna Allerta')}}
                                    sequence:
                                      - service: input_boolean.turn_on
                                        metadata: {}
                                        data: {}
                                        target:
                                          entity_id: >-
                                            input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio
                                      - service: shell_command.vmc_master_velocita_0
                                        data: {}
                                    alias: CASO PDR ON E INQUINANTI OFF
                                  - conditions:
                                      - condition: template
                                        value_template: >-
                                          {{
                                          states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                          ne sconsiglia l\'impiego" and
                                          (states('sensor.vmc_master_alert_monitoraggio_co2')
                                          == 'Allerta' or
                                          states('sensor.vmc_master_alert_monitoraggio_voc')
                                          == 'Allerta')}}
                                    sequence:
                                      - service: input_boolean.turn_on
                                        metadata: {}
                                        data: {}
                                        target:
                                          entity_id:
                                            - >-
                                              input_boolean.vmc_master_spia_velocita_freecooling_co2_o_voc
                                      - service: shell_command.vmc_master_freecooling
                                        data: {}
                                    alias: CASO PDR OFF E INQUINANTI ON
                                  - conditions:
                                      - condition: template
                                        value_template: >-
                                          {{
                                          states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                          ne sconsiglia l\'impiego" and
                                          (states('sensor.vmc_master_alert_monitoraggio_co2')
                                          == 'Nessuna Allerta' and
                                          states('sensor.vmc_master_alert_monitoraggio_voc')
                                          == 'Nessuna Allerta')}}
                                    sequence:
                                      - service: shell_command.vmc_master_freecooling
                                        data: {}
                                    alias: CASO PDR OFF E INQUINANTI OFF
                            alias: Interruttore PdR ON e Interruttore Inquinanti ON
                          - conditions:
                              - condition: and
                                conditions:
                                  - condition: template
                                    value_template: >-
                                      {{
                                      states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr')=='on'}}
                                    alias: Interruttore PdR ON
                                  - alias: Interruttore Inquinanti OFF
                                    condition: template
                                    value_template: >-
                                      {{
                                      states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc')=='off'}}
                            sequence:
                              - choose:
                                  - conditions:
                                      - condition: template
                                        value_template: >-
                                          {{
                                          states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                          ne sconsiglia l\'impiego" and
                                          (states('sensor.vmc_master_alert_monitoraggio_co2')
                                          == 'Allerta' or
                                          states('sensor.vmc_master_alert_monitoraggio_voc')
                                          == 'Allerta')}}
                                    sequence:
                                      - service: input_boolean.turn_on
                                        metadata: {}
                                        data: {}
                                        target:
                                          entity_id:
                                            - >-
                                              input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio
                                      - service: shell_command.vmc_master_velocita_0
                                        data: {}
                                    alias: CASO PDR ON E INQUINANTI ON
                                  - conditions:
                                      - condition: template
                                        value_template: >-
                                          {{
                                          states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                          ne sconsiglia l\'impiego" and
                                          (states('sensor.vmc_master_alert_monitoraggio_co2')
                                          == 'Nessuna Allerta' and
                                          states('sensor.vmc_master_alert_monitoraggio_voc')
                                          == 'Nessuna Allerta')}}
                                    sequence:
                                      - service: input_boolean.turn_on
                                        metadata: {}
                                        data: {}
                                        target:
                                          entity_id: >-
                                            input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio
                                      - service: shell_command.vmc_master_velocita_0
                                        data: {}
                                    alias: CASO PDR ON E INQUINANTI OFF
                                  - conditions:
                                      - condition: template
                                        value_template: >-
                                          {{
                                          states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                          ne sconsiglia l\'impiego" and
                                          (states('sensor.vmc_master_alert_monitoraggio_co2')
                                          == 'Allerta' or
                                          states('sensor.vmc_master_alert_monitoraggio_voc')
                                          == 'Allerta')}}
                                    sequence:
                                      - service: shell_command.vmc_master_freecooling
                                        data: {}
                                    alias: CASO PDR OFF E INQUINANTI ON
                                  - conditions:
                                      - condition: template
                                        value_template: >-
                                          {{
                                          states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                          ne sconsiglia l\'impiego" and
                                          (states('sensor.vmc_master_alert_monitoraggio_co2')
                                          == 'Nessuna Allerta' and
                                          states('sensor.vmc_master_alert_monitoraggio_voc')
                                          == 'Nessuna Allerta')}}
                                    sequence:
                                      - service: shell_command.vmc_master_freecooling
                                        data: {}
                                    alias: CASO PDR OFF E INQUINANTI OFF
                            alias: Interruttore PdR ON e Interruttore Inquinanti OFF
                          - conditions:
                              - condition: and
                                conditions:
                                  - alias: Interruttore PdR OFF
                                    condition: template
                                    value_template: >-
                                      {{
                                      states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr')=='off'}}
                                  - condition: template
                                    value_template: >-
                                      {{
                                      states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc')=='on'}}
                                    alias: Interruttore Inquinanti ON
                            sequence:
                              - choose:
                                  - conditions:
                                      - condition: template
                                        value_template: >-
                                          {{
                                          states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                          ne sconsiglia l\'impiego" and
                                          (states('sensor.vmc_master_alert_monitoraggio_co2')
                                          == 'Allerta' or
                                          states('sensor.vmc_master_alert_monitoraggio_voc')
                                          == 'Allerta')}}
                                    sequence:
                                      - service: input_boolean.turn_on
                                        metadata: {}
                                        data: {}
                                        target:
                                          entity_id:
                                            - >-
                                              input_boolean.vmc_master_spia_velocita_freecooling_co2_o_voc
                                      - service: shell_command.vmc_master_freecooling
                                        data: {}
                                    alias: CASO PDR ON E INQUINANTI ON
                                  - conditions:
                                      - condition: template
                                        value_template: >-
                                          {{
                                          states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                          ne sconsiglia l\'impiego" and
                                          (states('sensor.vmc_master_alert_monitoraggio_co2')
                                          == 'Nessuna Allerta' and
                                          states('sensor.vmc_master_alert_monitoraggio_voc')
                                          == 'Nessuna Allerta')}}
                                    sequence:
                                      - service: shell_command.vmc_master_freecooling
                                        data: {}
                                    alias: CASO PDR ON E INQUINANTI OFF
                                  - conditions:
                                      - condition: template
                                        value_template: >-
                                          {{
                                          states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                          ne sconsiglia l\'impiego" and
                                          (states('sensor.vmc_master_alert_monitoraggio_co2')
                                          == 'Allerta' or
                                          states('sensor.vmc_master_alert_monitoraggio_voc')
                                          == 'Allerta')}}
                                    sequence:
                                      - service: input_boolean.turn_on
                                        metadata: {}
                                        data: {}
                                        target:
                                          entity_id:
                                            - >-
                                              input_boolean.vmc_master_spia_velocita_freecooling_co2_o_voc
                                      - service: shell_command.vmc_master_freecooling
                                        data: {}
                                    alias: CASO PDR OFF E INQUINANTI ON
                                  - conditions:
                                      - condition: template
                                        value_template: >-
                                          {{
                                          states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                          ne sconsiglia l\'impiego" and
                                          (states('sensor.vmc_master_alert_monitoraggio_co2')
                                          == 'Nessuna Allerta' and
                                          states('sensor.vmc_master_alert_monitoraggio_voc')
                                          == 'Nessuna Allerta')}}
                                    sequence:
                                      - service: shell_command.vmc_master_freecooling
                                        data: {}
                                    alias: CASO PDR OFF E INQUINANTI OFF
                            alias: Interruttore PdR OFF e Interruttore Inquinanti ON
                          - conditions:
                              - condition: and
                                conditions:
                                  - alias: Interruttore PdR OFF
                                    condition: template
                                    value_template: >-
                                      {{
                                      states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr')=='off'}}
                                  - alias: Interruttore Inquinanti OFF
                                    condition: template
                                    value_template: >-
                                      {{
                                      states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc')=='off'}}
                            sequence:
                              - choose:
                                  - conditions:
                                      - condition: template
                                        value_template: >-
                                          {{
                                          states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                          ne sconsiglia l\'impiego" and
                                          (states('sensor.vmc_master_alert_monitoraggio_co2')
                                          == 'Allerta' or
                                          states('sensor.vmc_master_alert_monitoraggio_voc')
                                          == 'Allerta')}}
                                    sequence:
                                      - service: shell_command.vmc_master_freecooling
                                        data: {}
                                    alias: CASO PDR ON E INQUINANTI ON
                                  - conditions:
                                      - condition: template
                                        value_template: >-
                                          {{
                                          states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                          ne sconsiglia l\'impiego" and
                                          (states('sensor.vmc_master_alert_monitoraggio_co2')
                                          == 'Nessuna Allerta' and
                                          states('sensor.vmc_master_alert_monitoraggio_voc')
                                          == 'Nessuna Allerta')}}
                                    sequence:
                                      - service: shell_command.vmc_master_freecooling
                                        data: {}
                                    alias: CASO PDR ON E INQUINANTI OFF
                                  - conditions:
                                      - condition: template
                                        value_template: >-
                                          {{
                                          states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                          ne sconsiglia l\'impiego" and
                                          (states('sensor.vmc_master_alert_monitoraggio_co2')
                                          == 'Allerta' or
                                          states('sensor.vmc_master_alert_monitoraggio_voc')
                                          == 'Allerta')}}
                                    sequence:
                                      - service: shell_command.vmc_master_freecooling
                                        data: {}
                                    alias: CASO PDR OFF E INQUINANTI ON
                                  - conditions:
                                      - condition: template
                                        value_template: >-
                                          {{
                                          states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                          ne sconsiglia l\'impiego" and
                                          (states('sensor.vmc_master_alert_monitoraggio_co2')
                                          == 'Nessuna Allerta' and
                                          states('sensor.vmc_master_alert_monitoraggio_voc')
                                          == 'Nessuna Allerta')}}
                                    sequence:
                                      - service: shell_command.vmc_master_freecooling
                                        data: {}
                                    alias: CASO PDR OFF E INQUINANTI OFF
                            alias: Interruttore PdR OFF e Interruttore Inquinanti OFF
                    alias: Mese Disabilitato
    mode: restart
    icon: mdi:fingerprint-off
    description: ""
#------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
#------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
################### Inizio Creazione Scripts Audio per Allertet ###################
  vmc_master_audio_status_velocita:
    alias: VMC Master - Audio Status Velocità
    sequence:
      - choose:
          - conditions:
              - condition: template
                value_template: >
                  {% set mp = states('input_select.vmc_master_selected_media_player_entity') %}
                  {% set invalid = ["Aggiorna Elenco Media Player", "", "sconosciuto", "unknown", none, "unavailable", "Non disponibile"] %}
                  {% set audio_interruttore = states('input_boolean.vmc_master_notifica_audio') %}
                  {% set now_time = now().time() %}
                  
                  {# Legge start/end, fallback a None se sconosciuto #}
                  {% set start_raw = states('input_datetime.vmc_master_audio_start_time')[:5] %}
                  {% set end_raw = states('input_datetime.vmc_master_audio_end_time')[:5] %}
                  
                  {% set start_time = (strptime(start_raw, '%H:%M').time() if start_raw != "unknown" else None) %}
                  {% set end_time = (strptime(end_raw, '%H:%M').time() if end_raw != "unknown" else None) %}
                  
                  {% if start_time and end_time %}
                    {% if start_time <= end_time %}
                      {{ states('sensor.vmc_master_status_ip_interfaccia') == 'ON-Line' and mp not in invalid and audio_interruttore == 'on' and start_time <= now_time <= end_time and states('input_boolean.vmc_master_notifica_allerta_status_velocita')=='on' }}
                    {% else %}
                      {{ states('sensor.vmc_master_status_ip_interfaccia') == 'ON-Line' and mp not in invalid and audio_interruttore == 'on' and (now_time >= start_time or now_time <= end_time) and states('input_boolean.vmc_master_notifica_allerta_status_velocita')=='on' }}
                    {% endif %}
                  {% else %}
                    false
                  {% endif %}
            sequence:
              - service: media_player.volume_set
                target:
                  entity_id: "{{ states('input_select.vmc_master_selected_media_player_entity') }}"
                data:
                  volume_level: "{{ states('input_number.vmc_master_audio_volume') | float }}"
              - service: tts.google_translate_say
                target:
                  entity_id: "{{ states('input_select.vmc_master_selected_media_player_entity') }}"
                data:
                  message: >
                    Sulla VMC {{ states('sensor.vmc_master_nome_status') }} 
                    la Velocità Attuale è: {{states('sensor.vmc_master_status_ventola_lettura_codice_interpretato_interfaccia')}}
                  language: "it"
              - delay: "00:00:10"
    mode: queued
    max: 10
    icon: mdi:fingerprint-off
    description: >
      Invia un messaggio audio al media player selezionato con il nome della VMC e l'avviso correlato in italiano.
      Imposta il volume dal sensore, attende n° secondi, verifica il range orario anche oltre la mezzanotte.

  vmc_master_audio_allerta_congelamento:
    alias: VMC Master - Audio Congelamento
    sequence:
      - choose:
          - conditions:
              - condition: template
                value_template: >
                  {% set mp = states('input_select.vmc_master_selected_media_player_entity') %}
                  {% set invalid = ["Aggiorna Elenco Media Player", "", "sconosciuto", "unknown", none, "unavailable", "Non disponibile"] %}
                  {% set audio_interruttore = states('input_boolean.vmc_master_notifica_audio') %}
                  {% set now_time = now().time() %}
                  
                  {# Orari #}
                  {% set start_raw = states('input_datetime.vmc_master_audio_start_time')[:5] %}
                  {% set end_raw = states('input_datetime.vmc_master_audio_end_time')[:5] %}
                  {% set start_time = (strptime(start_raw, '%H:%M').time() if start_raw != "unknown" else None) %}
                  {% set end_time = (strptime(end_raw, '%H:%M').time() if end_raw != "unknown" else None) %}
                  
                  {% if start_time and end_time %}
                    {% if start_time <= end_time %}
                      {{ states('sensor.vmc_master_status_ip_interfaccia') == 'ON-Line' and mp not in invalid and audio_interruttore == 'on' and start_time <= now_time <= end_time and states('input_boolean.vmc_master_notifica_allerta_congelamento')=='on' }}
                    {% else %}
                      {{ states('sensor.vmc_master_status_ip_interfaccia') == 'ON-Line' and mp not in invalid and audio_interruttore == 'on' and (now_time >= start_time or now_time <= end_time) and states('input_boolean.vmc_master_notifica_allerta_congelamento')=='on' }}
                    {% endif %}
                  {% else %}
                    false
                  {% endif %}
            sequence:
              - service: media_player.volume_set
                target:
                  entity_id: "{{ states('input_select.vmc_master_selected_media_player_entity') }}"
                data:
                  volume_level: "{{ states('input_number.vmc_master_audio_volume') | float }}"
              - service: tts.google_translate_say
                target:
                  entity_id: "{{ states('input_select.vmc_master_selected_media_player_entity') }}"
                data:
                  message: >
                    Sulla VMC {{ states('sensor.vmc_master_nome_status') }} 
                    {% if states('sensor.vmc_master_temp_esterna_status') | float(default=none) <= -18 or states('sensor.vmc_master_temp_esterna_status_senza_offset') | float(default=none) <= -18 %}
                      Allerta Congelamento, Arresto della VMC
                    {% else %}
                      Allerta Congelamento Prossimo, si consiglia di Arrestare la VMC o di Non Avviare la VMC
                    {% endif %}
                  language: "it"
              - delay: "00:00:10"
    mode: queued
    max: 10
    icon: mdi:fingerprint-off
    description: >
      Invia un messaggio audio al media player selezionato con il nome della VMC e l'avviso correlato in italiano.
      Imposta il volume dal sensore, attende n° secondi, verifica il range orario anche oltre la mezzanotte.

  vmc_master_audio_nessuna_allerta_congelamento:
    alias: VMC Master - Audio Assenza Congelamento
    sequence:
      - choose:
          - conditions:
              - condition: template
                value_template: >
                  {% set mp = states('input_select.vmc_master_selected_media_player_entity') %}
                  {% set invalid = ["Aggiorna Elenco Media Player", "", "sconosciuto", "unknown", none, "unavailable", "Non disponibile"] %}
                  {% set audio_interruttore = states('input_boolean.vmc_master_notifica_audio') %}
                  {% set now_time = now().time() %}
                  
                  {# Legge start/end, fallback a None se sconosciuto #}
                  {% set start_raw = states('input_datetime.vmc_master_audio_start_time')[:5] %}
                  {% set end_raw = states('input_datetime.vmc_master_audio_end_time')[:5] %}
                  
                  {% set start_time = (strptime(start_raw, '%H:%M').time() if start_raw != "unknown" else None) %}
                  {% set end_time = (strptime(end_raw, '%H:%M').time() if end_raw != "unknown" else None) %}
                  
                  {% if start_time and end_time %}
                    {% if start_time <= end_time %}
                      {{ states('sensor.vmc_master_status_ip_interfaccia') == 'ON-Line' and mp not in invalid and audio_interruttore == 'on' and start_time <= now_time <= end_time and states('input_boolean.vmc_master_notifica_allerta_congelamento')=='on' }}
                    {% else %}
                      {{ states('sensor.vmc_master_status_ip_interfaccia') == 'ON-Line' and mp not in invalid and audio_interruttore == 'on' and (now_time >= start_time or now_time <= end_time) and states('input_boolean.vmc_master_notifica_allerta_congelamento')=='on' }}
                    {% endif %}
                  {% else %}
                    false
                  {% endif %}
            sequence:
              - service: media_player.volume_set
                target:
                  entity_id: "{{ states('input_select.vmc_master_selected_media_player_entity') }}"
                data:
                  volume_level: "{{ states('input_number.vmc_master_audio_volume') | float }}"
              - service: tts.google_translate_say
                target:
                  entity_id: "{{ states('input_select.vmc_master_selected_media_player_entity') }}"
                data:
                  message: >
                    Sulla VMC {{ states('sensor.vmc_master_nome_status') }} 
                    Nessuna Allerta Congelamento
                  language: "it"
              - delay: "00:00:10"
    mode: queued
    max: 10
    icon: mdi:fingerprint-off
    description: >
      Invia un messaggio audio al media player selezionato con il nome della VMC e l'avviso correlato in italiano.
      Imposta il volume dal sensore, attende n° secondi, verifica il range orario anche oltre la mezzanotte.

  vmc_master_audio_allerta_diff_temp:
    alias: VMC Master - Audio Diff. Temp. Int-Est > 23 [°C]
    sequence:
      - choose:
          - conditions:
              - condition: template
                value_template: >
                  {% set mp = states('input_select.vmc_master_selected_media_player_entity') %}
                  {% set invalid = ["Aggiorna Elenco Media Player", "", "sconosciuto", "unknown", none, "unavailable", "Non disponibile"] %}
                  {% set audio_interruttore = states('input_boolean.vmc_master_notifica_audio') %}
                  {% set now_time = now().time() %}
                  
                  {# Orari #}
                  {% set start_raw = states('input_datetime.vmc_master_audio_start_time')[:5] %}
                  {% set end_raw = states('input_datetime.vmc_master_audio_end_time')[:5] %}
                  {% set start_time = (strptime(start_raw, '%H:%M').time() if start_raw != "unknown" else None) %}
                  {% set end_time = (strptime(end_raw, '%H:%M').time() if end_raw != "unknown" else None) %}
                  
                  {% if start_time and end_time %}
                    {% if start_time <= end_time %}
                      {{ states('sensor.vmc_master_status_ip_interfaccia') == 'ON-Line' and mp not in invalid and audio_interruttore == 'on' and start_time <= now_time <= end_time and states('input_boolean.vmc_master_notifica_allerta_differenza_temp_int_est')=='on' }}
                    {% else %}
                      {{ states('sensor.vmc_master_status_ip_interfaccia') == 'ON-Line' and mp not in invalid and audio_interruttore == 'on' and (now_time >= start_time or now_time <= end_time) and states('input_boolean.vmc_master_notifica_allerta_differenza_temp_int_est')=='on' }}
                    {% endif %}
                  {% else %}
                    false
                  {% endif %}
            sequence:
              - service: media_player.volume_set
                target:
                  entity_id: "{{ states('input_select.vmc_master_selected_media_player_entity') }}"
                data:
                  volume_level: "{{ states('input_number.vmc_master_audio_volume') | float }}"
              - service: tts.google_translate_say
                target:
                  entity_id: "{{ states('input_select.vmc_master_selected_media_player_entity') }}"
                data:
                  message: >
                    Sulla VMC {{ states('sensor.vmc_master_nome_status') }} 
                    {% if states('sensor.vmc_master_delta_temp_verifica_soglia') == 'Si' %}
                      Allerta Differenza tra temperatura interna ed esterna ha superato i 23 °C
                    {% else %}
                      Allerta Differenza tra temperatura interna ed esterna si sta avvicinando a valori superiori a 23 °C.
                    {% endif %}
                  language: "it"
              - delay: "00:00:10"
    mode: queued
    max: 10
    icon: mdi:fingerprint-off
    description: >
      Invia un messaggio audio al media player selezionato con il nome della VMC e l'avviso correlato in italiano.
      Imposta il volume dal sensore, attende n° secondi, verifica il range orario anche oltre la mezzanotte.

  vmc_master_audio_nessuna_allerta_diff_temp:
    alias: VMC Master - Audio Assenza Diff. Temp. Int-Est > 23 [°C]
    sequence:
      - choose:
          - conditions:
              - condition: template
                value_template: >
                  {% set mp = states('input_select.vmc_master_selected_media_player_entity') %}
                  {% set invalid = ["Aggiorna Elenco Media Player", "", "sconosciuto", "unknown", none, "unavailable", "Non disponibile"] %}
                  {% set audio_interruttore = states('input_boolean.vmc_master_notifica_audio') %}
                  {% set now_time = now().time() %}
                  
                  {# Legge start/end, fallback a None se sconosciuto #}
                  {% set start_raw = states('input_datetime.vmc_master_audio_start_time')[:5] %}
                  {% set end_raw = states('input_datetime.vmc_master_audio_end_time')[:5] %}
                  
                  {% set start_time = (strptime(start_raw, '%H:%M').time() if start_raw != "unknown" else None) %}
                  {% set end_time = (strptime(end_raw, '%H:%M').time() if end_raw != "unknown" else None) %}
                  
                  {% if start_time and end_time %}
                    {% if start_time <= end_time %}
                      {{ states('sensor.vmc_master_status_ip_interfaccia') == 'ON-Line' and mp not in invalid and audio_interruttore == 'on' and start_time <= now_time <= end_time and states('input_boolean.vmc_master_notifica_allerta_differenza_temp_int_est')=='on' }}
                    {% else %}
                      {{ states('sensor.vmc_master_status_ip_interfaccia') == 'ON-Line' and mp not in invalid and audio_interruttore == 'on' and (now_time >= start_time or now_time <= end_time) and states('input_boolean.vmc_master_notifica_allerta_differenza_temp_int_est')=='on' }}
                    {% endif %}
                  {% else %}
                    false
                  {% endif %}
            sequence:
              - service: media_player.volume_set
                target:
                  entity_id: "{{ states('input_select.vmc_master_selected_media_player_entity') }}"
                data:
                  volume_level: "{{ states('input_number.vmc_master_audio_volume') | float }}"
              - service: tts.google_translate_say
                target:
                  entity_id: "{{ states('input_select.vmc_master_selected_media_player_entity') }}"
                data:
                  message: >
                    Sulla VMC {{ states('sensor.vmc_master_nome_status') }} 
                    Nessuna Allerta Differenza tra temperatura interna ed esterna è inferiore ai 23 °C
                  language: "it"
              - delay: "00:00:10"
    mode: queued
    max: 10
    icon: mdi:fingerprint-off
    description: >
      Invia un messaggio audio al media player selezionato con il nome della VMC e l'avviso correlato in italiano.
      Imposta il volume dal sensore, attende n° secondi, verifica il range orario anche oltre la mezzanotte.

  vmc_master_audio_allerta_co2:
    alias: VMC Master - Audio CO₂
    sequence:
      - choose:
          - conditions:
              - condition: template
                value_template: >
                  {% set mp = states('input_select.vmc_master_selected_media_player_entity') %}
                  {% set invalid = ["Aggiorna Elenco Media Player", "", "sconosciuto", "unknown", none, "unavailable", "Non disponibile"] %}
                  {% set audio_interruttore = states('input_boolean.vmc_master_notifica_audio') %}
                  {% set now_time = now().time() %}
                  
                  {# Legge start/end, fallback a None se sconosciuto #}
                  {% set start_raw = states('input_datetime.vmc_master_audio_start_time')[:5] %}
                  {% set end_raw = states('input_datetime.vmc_master_audio_end_time')[:5] %}
                  
                  {% set start_time = (strptime(start_raw, '%H:%M').time() if start_raw != "unknown" else None) %}
                  {% set end_time = (strptime(end_raw, '%H:%M').time() if end_raw != "unknown" else None) %}
                  
                  {% if start_time and end_time %}
                    {% if start_time <= end_time %}
                      {{ states('sensor.vmc_master_status_ip_interfaccia') == 'ON-Line' and mp not in invalid and audio_interruttore == 'on' and start_time <= now_time <= end_time and states('sensor.vmc_master_co2_status_verifica_soglia')!='-' and states('input_boolean.vmc_master_notifica_allerta_inquinanti')=='on' }}
                    {% else %}
                      {{ states('sensor.vmc_master_status_ip_interfaccia') == 'ON-Line' and mp not in invalid and audio_interruttore == 'on' and (now_time >= start_time or now_time <= end_time) and states('sensor.vmc_master_co2_status_verifica_soglia')!='-' and states('input_boolean.vmc_master_notifica_allerta_inquinanti')=='on' }}
                    {% endif %}
                  {% else %}
                    false
                  {% endif %}
            sequence:
              - service: media_player.volume_set
                target:
                  entity_id: "{{ states('input_select.vmc_master_selected_media_player_entity') }}"
                data:
                  volume_level: "{{ states('input_number.vmc_master_audio_volume') | float }}"
              - service: tts.google_translate_say
                target:
                  entity_id: "{{ states('input_select.vmc_master_selected_media_player_entity') }}"
                data:
                  message: >
                    Sulla VMC {{ states('sensor.vmc_master_nome_status') }} 
                    Allerta Anidride Carbonica,  {{states('sensor.vmc_master_co2_status_verifica_soglia')}}, {{states('sensor.vmc_master_co2_status')}} ppm
                  language: "it"
              - delay: "00:00:10"
    mode: queued
    max: 10
    icon: mdi:fingerprint-off
    description: >
      Invia un messaggio audio al media player selezionato con il nome della VMC e l'avviso correlato in italiano.
      Imposta il volume dal sensore, attende n° secondi, verifica il range orario anche oltre la mezzanotte.

  vmc_master_audio_nessuna_allerta_co2:
    alias: VMC Master - Audio Assenza CO₂
    sequence:
      - choose:
          - conditions:
              - condition: template
                value_template: >
                  {% set mp = states('input_select.vmc_master_selected_media_player_entity') %}
                  {% set invalid = ["Aggiorna Elenco Media Player", "", "sconosciuto", "unknown", none, "unavailable", "Non disponibile"] %}
                  {% set audio_interruttore = states('input_boolean.vmc_master_notifica_audio') %}
                  {% set now_time = now().time() %}
                  
                  {# Legge start/end, fallback a None se sconosciuto #}
                  {% set start_raw = states('input_datetime.vmc_master_audio_start_time')[:5] %}
                  {% set end_raw = states('input_datetime.vmc_master_audio_end_time')[:5] %}
                  
                  {% set start_time = (strptime(start_raw, '%H:%M').time() if start_raw != "unknown" else None) %}
                  {% set end_time = (strptime(end_raw, '%H:%M').time() if end_raw != "unknown" else None) %}
                  
                  {% if start_time and end_time %}
                    {% if start_time <= end_time %}
                      {{ states('sensor.vmc_master_status_ip_interfaccia') == 'ON-Line' and mp not in invalid and audio_interruttore == 'on' and start_time <= now_time <= end_time and states('sensor.vmc_master_co2_status_verifica_soglia')!='-' and states('input_boolean.vmc_master_notifica_allerta_inquinanti')=='on' }}
                    {% else %}
                      {{ states('sensor.vmc_master_status_ip_interfaccia') == 'ON-Line' and mp not in invalid and audio_interruttore == 'on' and (now_time >= start_time or now_time <= end_time) and states('sensor.vmc_master_co2_status_verifica_soglia')!='-' and states('input_boolean.vmc_master_notifica_allerta_inquinanti')=='on' }}
                    {% endif %}
                  {% else %}
                    false
                  {% endif %}
            sequence:
              - service: media_player.volume_set
                target:
                  entity_id: "{{ states('input_select.vmc_master_selected_media_player_entity') }}"
                data:
                  volume_level: "{{ states('input_number.vmc_master_audio_volume') | float }}"
              - service: tts.google_translate_say
                target:
                  entity_id: "{{ states('input_select.vmc_master_selected_media_player_entity') }}"
                data:
                  message: >
                    Sulla VMC {{ states('sensor.vmc_master_nome_status') }} 
                    Nessuna Allerta Anidride Carbonica
                  language: "it"
              - delay: "00:00:10"
    mode: queued
    max: 10
    icon: mdi:fingerprint-off
    description: >
      Invia un messaggio audio al media player selezionato con il nome della VMC e l'avviso correlato in italiano.
      Imposta il volume dal sensore, attende n° secondi, verifica il range orario anche oltre la mezzanotte.

  vmc_master_audio_allerta_voc:
    alias: VMC Master - Audio VOC
    sequence:
      - choose:
          - conditions:
              - condition: template
                value_template: >
                  {% set mp = states('input_select.vmc_master_selected_media_player_entity') %}
                  {% set invalid = ["Aggiorna Elenco Media Player", "", "sconosciuto", "unknown", none, "unavailable", "Non disponibile"] %}
                  {% set audio_interruttore = states('input_boolean.vmc_master_notifica_audio') %}
                  {% set now_time = now().time() %}
                  
                  {# Legge start/end, fallback a None se sconosciuto #}
                  {% set start_raw = states('input_datetime.vmc_master_audio_start_time')[:5] %}
                  {% set end_raw = states('input_datetime.vmc_master_audio_end_time')[:5] %}
                  
                  {% set start_time = (strptime(start_raw, '%H:%M').time() if start_raw != "unknown" else None) %}
                  {% set end_time = (strptime(end_raw, '%H:%M').time() if end_raw != "unknown" else None) %}
                  
                  {% if start_time and end_time %}
                    {% if start_time <= end_time %}
                      {{ states('sensor.vmc_master_status_ip_interfaccia') == 'ON-Line' and mp not in invalid and audio_interruttore == 'on' and start_time <= now_time <= end_time and states('sensor.vmc_master_voc_status_verifica_soglia')!='-' and states('input_boolean.vmc_master_notifica_allerta_inquinanti')=='on' }}
                    {% else %}
                      {{ states('sensor.vmc_master_status_ip_interfaccia') == 'ON-Line' and mp not in invalid and audio_interruttore == 'on' and (now_time >= start_time or now_time <= end_time) and states('sensor.vmc_master_voc_status_verifica_soglia')!='-' and states('input_boolean.vmc_master_notifica_allerta_inquinanti')=='on' }}
                    {% endif %}
                  {% else %}
                    false
                  {% endif %}
            sequence:
              - service: media_player.volume_set
                target:
                  entity_id: "{{ states('input_select.vmc_master_selected_media_player_entity') }}"
                data:
                  volume_level: "{{ states('input_number.vmc_master_audio_volume') | float }}"
              - service: tts.google_translate_say
                target:
                  entity_id: "{{ states('input_select.vmc_master_selected_media_player_entity') }}"
                data:
                  message: >
                    Sulla VMC {{ states('sensor.vmc_master_nome_status') }} 
                    Allerta Composti Organici Volatili,  {{states('sensor.vmc_master_voc_status_verifica_soglia')}}, {{states('sensor.vmc_master_co2_status')}} ppb
                  language: "it"
              - delay: "00:00:10"
    mode: queued
    max: 10
    icon: mdi:fingerprint-off
    description: >
      Invia un messaggio audio al media player selezionato con il nome della VMC e l'avviso correlato in italiano.
      Imposta il volume dal sensore, attende n° secondi, verifica il range orario anche oltre la mezzanotte.

  vmc_master_audio_nessuna_allerta_voc:
    alias: VMC Master - Audio Assenza VOC
    sequence:
      - choose:
          - conditions:
              - condition: template
                value_template: >
                  {% set mp = states('input_select.vmc_master_selected_media_player_entity') %}
                  {% set invalid = ["Aggiorna Elenco Media Player", "", "sconosciuto", "unknown", none, "unavailable", "Non disponibile"] %}
                  {% set audio_interruttore = states('input_boolean.vmc_master_notifica_audio') %}
                  {% set now_time = now().time() %}
                  
                  {# Legge start/end, fallback a None se sconosciuto #}
                  {% set start_raw = states('input_datetime.vmc_master_audio_start_time')[:5] %}
                  {% set end_raw = states('input_datetime.vmc_master_audio_end_time')[:5] %}
                  
                  {% set start_time = (strptime(start_raw, '%H:%M').time() if start_raw != "unknown" else None) %}
                  {% set end_time = (strptime(end_raw, '%H:%M').time() if end_raw != "unknown" else None) %}
                  
                  {% if start_time and end_time %}
                    {% if start_time <= end_time %}
                      {{ states('sensor.vmc_master_status_ip_interfaccia') == 'ON-Line' and mp not in invalid and audio_interruttore == 'on' and start_time <= now_time <= end_time and states('sensor.vmc_master_voc_status_verifica_soglia')!='-' and states('input_boolean.vmc_master_notifica_allerta_inquinanti')=='on' }}
                    {% else %}
                      {{ states('sensor.vmc_master_status_ip_interfaccia') == 'ON-Line' and mp not in invalid and audio_interruttore == 'on' and (now_time >= start_time or now_time <= end_time) and states('sensor.vmc_master_voc_status_verifica_soglia')!='-' and states('input_boolean.vmc_master_notifica_allerta_inquinanti')=='on' }}
                    {% endif %}
                  {% else %}
                    false
                  {% endif %}
            sequence:
              - service: media_player.volume_set
                target:
                  entity_id: "{{ states('input_select.vmc_master_selected_media_player_entity') }}"
                data:
                  volume_level: "{{ states('input_number.vmc_master_audio_volume') | float }}"
              - service: tts.google_translate_say
                target:
                  entity_id: "{{ states('input_select.vmc_master_selected_media_player_entity') }}"
                data:
                  message: >
                    Sulla VMC {{ states('sensor.vmc_master_nome_status') }} 
                    Nessuna Allerta Composti Organici Volatili
                  language: "it"
              - delay: "00:00:10"
    mode: queued
    max: 10
    icon: mdi:fingerprint-off
    description: >
      Invia un messaggio audio al media player selezionato con il nome della VMC e l'avviso correlato in italiano.
      Imposta il volume dal sensore, attende n° secondi, verifica il range orario anche oltre la mezzanotte.

  vmc_master_audio_allerta_pdr:
    alias: VMC Master - Audio Punto di Rugiada
    sequence:
      - choose:
          - conditions:
              - condition: template
                value_template: >
                  {% set mp = states('input_select.vmc_master_selected_media_player_entity') %}
                  {% set invalid = ["Aggiorna Elenco Media Player", "", "sconosciuto", "unknown", none, "unavailable", "Non disponibile"] %}
                  {% set audio_interruttore = states('input_boolean.vmc_master_notifica_audio') %}
                  {% set now_time = now().time() %}
                  
                  {# Legge start/end, fallback a None se sconosciuto #}
                  {% set start_raw = states('input_datetime.vmc_master_audio_start_time')[:5] %}
                  {% set end_raw = states('input_datetime.vmc_master_audio_end_time')[:5] %}
                  
                  {% set start_time = (strptime(start_raw, '%H:%M').time() if start_raw != "unknown" else None) %}
                  {% set end_time = (strptime(end_raw, '%H:%M').time() if end_raw != "unknown" else None) %}
                  
                  {% if start_time and end_time %}
                    {% if start_time <= end_time %}
                      {{ states('sensor.vmc_master_status_ip_interfaccia') == 'ON-Line' and mp not in invalid and audio_interruttore == 'on' and start_time <= now_time <= end_time and states('input_boolean.vmc_master_notifica_allerta_pdr')=='on' }}
                    {% else %}
                      {{ states('sensor.vmc_master_status_ip_interfaccia') == 'ON-Line' and mp not in invalid and audio_interruttore == 'on' and (now_time >= start_time or now_time <= end_time) and states('input_boolean.vmc_master_notifica_allerta_pdr')=='on' }}
                    {% endif %}
                  {% else %}
                    false
                  {% endif %}
            sequence:
              - service: media_player.volume_set
                target:
                  entity_id: "{{ states('input_select.vmc_master_selected_media_player_entity') }}"
                data:
                  volume_level: "{{ states('input_number.vmc_master_audio_volume') | float }}"
              - service: tts.google_translate_say
                target:
                  entity_id: "{{ states('input_select.vmc_master_selected_media_player_entity') }}"
                data:
                  message: >
                    Sulla VMC {{ states('sensor.vmc_master_nome_status') }} 
                    {% if is_state('sensor.vmc_master_status_ventola_lettura_codice_interpretato_interfaccia', 'Velocità 0') %}
                      Allerta Superamento del Punto di Rugiada, si consiglia di Non Avviare la VMC
                    {% else %}
                      Allerta Superamento del Punto di Rugiada, Arresto della VMC
                    {% endif %}
                  language: "it"
              - delay: "00:00:10"
    mode: queued
    max: 10
    icon: mdi:fingerprint-off
    description: >
      Invia un messaggio audio al media player selezionato con il nome della VMC e l'avviso correlato in italiano.
      Imposta il volume dal sensore, attende n° secondi, verifica il range orario anche oltre la mezzanotte.

  vmc_master_audio_nessuna_allerta_pdr:
    alias: VMC Master - Audio Assenza Punto di Rugiada
    sequence:
      - choose:
          - conditions:
              - condition: template
                value_template: >
                  {% set mp = states('input_select.vmc_master_selected_media_player_entity') %}
                  {% set invalid = ["Aggiorna Elenco Media Player", "", "sconosciuto", "unknown", none, "unavailable", "Non disponibile"] %}
                  {% set audio_interruttore = states('input_boolean.vmc_master_notifica_audio') %}
                  {% set now_time = now().time() %}
                  
                  {# Legge start/end, fallback a None se sconosciuto #}
                  {% set start_raw = states('input_datetime.vmc_master_audio_start_time')[:5] %}
                  {% set end_raw = states('input_datetime.vmc_master_audio_end_time')[:5] %}
                  
                  {% set start_time = (strptime(start_raw, '%H:%M').time() if start_raw != "unknown" else None) %}
                  {% set end_time = (strptime(end_raw, '%H:%M').time() if end_raw != "unknown" else None) %}
                  
                  {% if start_time and end_time %}
                    {% if start_time <= end_time %}
                      {{ states('sensor.vmc_master_status_ip_interfaccia') == 'ON-Line' and mp not in invalid and audio_interruttore == 'on' and start_time <= now_time <= end_time and states('input_boolean.vmc_master_notifica_allerta_pdr')=='on' }}
                    {% else %}
                      {{ states('sensor.vmc_master_status_ip_interfaccia') == 'ON-Line' and mp not in invalid and audio_interruttore == 'on' and (now_time >= start_time or now_time <= end_time) and states('input_boolean.vmc_master_notifica_allerta_pdr')=='on' }}
                    {% endif %}
                  {% else %}
                    false
                  {% endif %}
            sequence:
              - service: media_player.volume_set
                target:
                  entity_id: "{{ states('input_select.vmc_master_selected_media_player_entity') }}"
                data:
                  volume_level: "{{ states('input_number.vmc_master_audio_volume') | float }}"
              - service: tts.google_translate_say
                target:
                  entity_id: "{{ states('input_select.vmc_master_selected_media_player_entity') }}"
                data:
                  message: >
                    Sulla VMC {{ states('sensor.vmc_master_nome_status') }} 
                    Nessuna Allerta Superamento del Punto di Rugiada
                  language: "it"
              - delay: "00:00:10"
    mode: queued
    max: 10
    icon: mdi:fingerprint-off
    description: >
      Invia un messaggio audio al media player selezionato con il nome della VMC e l'avviso correlato in italiano.
      Imposta il volume dal sensore, attende n° secondi, verifica il range orario anche oltre la mezzanotte.

  vmc_master_audio_free_heating_o_free_cooling:
    alias: VMC Master - Audio Free Heating/Cooling
    sequence:
      - choose:
          - conditions:
              - condition: template
                value_template: >
                  {% set mp = states('input_select.vmc_master_selected_media_player_entity') %}
                  {% set invalid = ["Aggiorna Elenco Media Player", "", "sconosciuto", "unknown", none, "unavailable", "Non disponibile"] %}
                  {% set audio_interruttore = states('input_boolean.vmc_master_notifica_audio') %}
                  {% set now_time = now().time() %}
                  
                  {# Orari #}
                  {% set start_raw = states('input_datetime.vmc_master_audio_start_time')[:5] %}
                  {% set end_raw = states('input_datetime.vmc_master_audio_end_time')[:5] %}
                  {% set start_time = (strptime(start_raw, '%H:%M').time() if start_raw != "unknown" else None) %}
                  {% set end_time = (strptime(end_raw, '%H:%M').time() if end_raw != "unknown" else None) %}
                  
                  {% if start_time and end_time %}
                    {% if start_time <= end_time %}
                      {{ states('sensor.vmc_master_status_ip_interfaccia') == 'ON-Line' and mp not in invalid and audio_interruttore == 'on' and start_time <= now_time <= end_time and states('input_boolean.vmc_master_notifica_allerta_freecooling_heating')=='on' }}
                    {% else %}
                      {{ states('sensor.vmc_master_status_ip_interfaccia') == 'ON-Line' and mp not in invalid and audio_interruttore == 'on' and (now_time >= start_time or now_time <= end_time) and states('input_boolean.vmc_master_notifica_allerta_freecooling_heating')=='on' }}
                    {% endif %}
                  {% else %}
                    false
                  {% endif %}
            sequence:
              - service: media_player.volume_set
                target:
                  entity_id: "{{ states('input_select.vmc_master_selected_media_player_entity') }}"
                data:
                  volume_level: "{{ states('input_number.vmc_master_audio_volume') | float }}"
              - service: tts.google_translate_say
                target:
                  entity_id: "{{ states('input_select.vmc_master_selected_media_player_entity') }}"
                data:
                  message: >
                    Sulla VMC {{ states('sensor.vmc_master_nome_status') }}
                    {{ states('sensor.vmc_master_alert_monitoraggio_free_heating_o_free_cooling_allert_interfaccia_avvisi') }}
                  language: "it"
              - delay: "00:00:10"
    mode: queued
    max: 10
    icon: mdi:fingerprint-off
    description: >
      Invia un messaggio audio al media player selezionato con il nome della VMC e l'avviso correlato in italiano.
      Imposta il volume dal sensore, attende n° secondi, verifica il range orario anche oltre la mezzanotte.

  vmc_master_audio_allerta_umidita_interna:
    alias: VMC Master - Audio Umidità Interna
    sequence:
      - choose:
          - conditions:
              - condition: template
                value_template: >
                  {% set mp = states('input_select.vmc_master_selected_media_player_entity') %}
                  {% set invalid = ["Aggiorna Elenco Media Player", "", "sconosciuto", "unknown", none, "unavailable", "Non disponibile"] %}
                  {% set audio_interruttore = states('input_boolean.vmc_master_notifica_audio') %}
                  {% set now_time = now().time() %}
                  
                  {# Legge start/end, fallback a None se sconosciuto #}
                  {% set start_raw = states('input_datetime.vmc_master_audio_start_time')[:5] %}
                  {% set end_raw = states('input_datetime.vmc_master_audio_end_time')[:5] %}
                  
                  {% set start_time = (strptime(start_raw, '%H:%M').time() if start_raw != "unknown" else None) %}
                  {% set end_time = (strptime(end_raw, '%H:%M').time() if end_raw != "unknown" else None) %}
                  
                  {% if start_time and end_time %}
                    {% if start_time <= end_time %}
                      {{ states('sensor.vmc_master_status_ip_interfaccia') == 'ON-Line' and mp not in invalid and audio_interruttore == 'on' and start_time <= now_time <= end_time and states('input_boolean.vmc_master_notifica_allerta_umidita')=='on' }}
                    {% else %}
                      {{ states('sensor.vmc_master_status_ip_interfaccia') == 'ON-Line' and mp not in invalid and audio_interruttore == 'on' and (now_time >= start_time or now_time <= end_time) and states('input_boolean.vmc_master_notifica_allerta_umidita')=='on' }}
                    {% endif %}
                  {% else %}
                    false
                  {% endif %}
            sequence:
              - service: media_player.volume_set
                target:
                  entity_id: "{{ states('input_select.vmc_master_selected_media_player_entity') }}"
                data:
                  volume_level: "{{ states('input_number.vmc_master_audio_volume') | float }}"
              - service: tts.google_translate_say
                target:
                  entity_id: "{{ states('input_select.vmc_master_selected_media_player_entity') }}"
                data:
                  message: >
                    Sulla VMC {{ states('sensor.vmc_master_nome_status') }} 
                    Allerta {{ states('sensor.vmc_master_umidita_interna_status_verifica_soglia_valore') }}
                  language: "it"
              - delay: "00:00:20"
    mode: queued
    max: 10
    icon: mdi:fingerprint-off
    description: >
      Invia un messaggio audio al media player selezionato con il nome della VMC e l'avviso correlato in italiano.
      Imposta il volume dal sensore, attende n° secondi, verifica il range orario anche oltre la mezzanotte.

  vmc_master_audio_nessuna_allerta_umidita_interna:
    alias: VMC Master - Audio Assenza Umidità Interna
    sequence:
      - choose:
          - conditions:
              - condition: template
                value_template: >
                  {% set mp = states('input_select.vmc_master_selected_media_player_entity') %}
                  {% set invalid = ["Aggiorna Elenco Media Player", "", "sconosciuto", "unknown", none, "unavailable", "Non disponibile"] %}
                  {% set audio_interruttore = states('input_boolean.vmc_master_notifica_audio') %}
                  {% set now_time = now().time() %}
                  
                  {# Legge start/end, fallback a None se sconosciuto #}
                  {% set start_raw = states('input_datetime.vmc_master_audio_start_time')[:5] %}
                  {% set end_raw = states('input_datetime.vmc_master_audio_end_time')[:5] %}
                  
                  {% set start_time = (strptime(start_raw, '%H:%M').time() if start_raw != "unknown" else None) %}
                  {% set end_time = (strptime(end_raw, '%H:%M').time() if end_raw != "unknown" else None) %}
                  
                  {% if start_time and end_time %}
                    {% if start_time <= end_time %}
                      {{ states('sensor.vmc_master_status_ip_interfaccia') == 'ON-Line' and mp not in invalid and audio_interruttore == 'on' and start_time <= now_time <= end_time and states('input_boolean.vmc_master_notifica_allerta_umidita')=='on' }}
                    {% else %}
                      {{ states('sensor.vmc_master_status_ip_interfaccia') == 'ON-Line' and mp not in invalid and audio_interruttore == 'on' and (now_time >= start_time or now_time <= end_time) and states('input_boolean.vmc_master_notifica_allerta_umidita')=='on' }}
                    {% endif %}
                  {% else %}
                    false
                  {% endif %}
            sequence:
              - service: media_player.volume_set
                target:
                  entity_id: "{{ states('input_select.vmc_master_selected_media_player_entity') }}"
                data:
                  volume_level: "{{ states('input_number.vmc_master_audio_volume') | float }}"
              - service: tts.google_translate_say
                target:
                  entity_id: "{{ states('input_select.vmc_master_selected_media_player_entity') }}"
                data:
                  message: >
                    Sulla VMC {{ states('sensor.vmc_master_nome_status') }} 
                    Nessuna Allerta Umidità Interna
                  language: "it"
              - delay: "00:00:10"
    mode: queued
    max: 10
    icon: mdi:fingerprint-off
    description: >
      Invia un messaggio audio al media player selezionato con il nome della VMC e l'avviso correlato in italiano.
      Imposta il volume dal sensore, attende n° secondi, verifica il range orario anche oltre la mezzanotte.

  vmc_master_audio_allerta_black_out:
    alias: VMC Master - Audio Black-Out
    sequence:
      - choose:
          - conditions:
              - condition: template
                value_template: >
                  {% set mp = states('input_select.vmc_master_selected_media_player_entity') %}
                  {% set invalid = ["Aggiorna Elenco Media Player", "", "sconosciuto", "unknown", none, "unavailable", "Non disponibile"] %}
                  {% set audio_interruttore = states('input_boolean.vmc_master_notifica_audio') %}
                  {% set now_time = now().time() %}
                  
                  {# Legge start/end, fallback a None se sconosciuto #}
                  {% set start_raw = states('input_datetime.vmc_master_audio_start_time')[:5] %}
                  {% set end_raw = states('input_datetime.vmc_master_audio_end_time')[:5] %}
                  
                  {% set start_time = (strptime(start_raw, '%H:%M').time() if start_raw != "unknown" else None) %}
                  {% set end_time = (strptime(end_raw, '%H:%M').time() if end_raw != "unknown" else None) %}
                  
                  {% if start_time and end_time %}
                    {% if start_time <= end_time %}
                      {{ states('sensor.vmc_master_status_ip_interfaccia') == 'OFF-Line' and mp not in invalid and audio_interruttore == 'on' and start_time <= now_time <= end_time and states('input_boolean.vmc_master_notifica_allerta_black_out')=='on' }}
                    {% else %}
                      {{ states('sensor.vmc_master_status_ip_interfaccia') == 'OFF-Line' and mp not in invalid and audio_interruttore == 'on' and (now_time >= start_time or now_time <= end_time) and states('input_boolean.vmc_master_notifica_allerta_black_out')=='on' }}
                    {% endif %}
                  {% else %}
                    false
                  {% endif %}
            sequence:
              - service: media_player.volume_set
                target:
                  entity_id: "{{ states('input_select.vmc_master_selected_media_player_entity') }}"
                data:
                  volume_level: "{{ states('input_number.vmc_master_audio_volume') | float }}"
              - service: tts.google_translate_say
                target:
                  entity_id: "{{ states('input_select.vmc_master_selected_media_player_entity') }}"
                data:
                  message: >
                    Sulla VMC {{ states('sensor.vmc_master_nome_status') }} 
                    Allerta Black-Out
                  language: "it"
              - delay: "00:00:10"
    mode: queued
    max: 10
    icon: mdi:fingerprint-off
    description: >
      Invia un messaggio audio al media player selezionato con il nome della VMC e l'avviso correlato in italiano.
      Imposta il volume dal sensore, attende n° secondi, verifica il range orario anche oltre la mezzanotte.

  vmc_master_audio_nessuna_allerta_black_out:
    alias: VMC Master - Audio Assenza Black-Out
    sequence:
      - choose:
          - conditions:
              - condition: template
                value_template: >
                  {% set mp = states('input_select.vmc_master_selected_media_player_entity') %}
                  {% set invalid = ["Aggiorna Elenco Media Player", "", "sconosciuto", "unknown", none, "unavailable", "Non disponibile"] %}
                  {% set audio_interruttore = states('input_boolean.vmc_master_notifica_audio') %}
                  {% set now_time = now().time() %}
                  
                  {# Legge start/end, fallback a None se sconosciuto #}
                  {% set start_raw = states('input_datetime.vmc_master_audio_start_time')[:5] %}
                  {% set end_raw = states('input_datetime.vmc_master_audio_end_time')[:5] %}
                  
                  {% set start_time = (strptime(start_raw, '%H:%M').time() if start_raw != "unknown" else None) %}
                  {% set end_time = (strptime(end_raw, '%H:%M').time() if end_raw != "unknown" else None) %}
                  
                  {% if start_time and end_time %}
                    {% if start_time <= end_time %}
                      {{ states('sensor.vmc_master_status_ip_interfaccia') == 'ON-Line' and mp not in invalid and audio_interruttore == 'on' and start_time <= now_time <= end_time and states('input_boolean.vmc_master_notifica_allerta_black_out')=='on' }}
                    {% else %}
                      {{ states('sensor.vmc_master_status_ip_interfaccia') == 'ON-Line' and mp not in invalid and audio_interruttore == 'on' and (now_time >= start_time or now_time <= end_time) and states('input_boolean.vmc_master_notifica_allerta_black_out')=='on' }}
                    {% endif %}
                  {% else %}
                    false
                  {% endif %}
            sequence:
              - service: media_player.volume_set
                target:
                  entity_id: "{{ states('input_select.vmc_master_selected_media_player_entity') }}"
                data:
                  volume_level: "{{ states('input_number.vmc_master_audio_volume') | float }}"
              - service: tts.google_translate_say
                target:
                  entity_id: "{{ states('input_select.vmc_master_selected_media_player_entity') }}"
                data:
                  message: >
                    VMC {{ states('sensor.vmc_master_nome_status') }} 
                    in Linea
                  language: "it"
              - delay: "00:00:10"
    mode: queued
    max: 10
    icon: mdi:fingerprint-off
    description: >
      Invia un messaggio audio al media player selezionato con il nome della VMC e l'avviso correlato in italiano.
      Imposta il volume dal sensore, attende n° secondi, verifica il range orario anche oltre la mezzanotte.
################### Fine Creazione Scripts ##############################################################################################################################################################################

################### Inizio Creazione Automazione ######################################
################### Inizio Creazione Automazione per Scambio Aria #####################
automation:
  - alias: "VMC Master - Aggiorna Aria Scambiata e Gestisci Countdown Rev.00"
    description: >
      Aggiorna l’aria scambiata in base alla portata della VMC. Ogni secondo calcola
      l'incremento volumetrico in funzione della velocità. Se cambia velocità,
      azzera il conteggio dei ricambi aria al giorno e forza il reset del countdown
      per il prossimo ricambio completo.
    triggers:
      - seconds: /1
        trigger: time_pattern
      - at: "00:00:00"
        trigger: time
      - entity_id: input_text.vmc_master_tempo_mancante_reset
        to: reset
        trigger: state
    conditions:
      - condition: template
        value_template: >
          {{ states('sensor.vmc_master_status_ventola_lettura_codice_interpretato_interfaccia') != 'Velocità 0' }}
    actions:
      - variables:
          velocita_corrente: >-
            {{
            states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')
            }}
          velocita_precedente: "{{ states('input_text.vmc_master_velocita_precedente') }}"
      - choose:
          - conditions:
              - condition: template
                value_template: "{{ velocita_corrente != velocita_precedente }}"
            sequence:
              - data:
                  entity_id: input_number.vmc_master_aria_scambiata_ricomincio
                  value: 0
                action: input_number.set_value
              - data:
                  entity_id: input_text.vmc_master_velocita_precedente
                  value: "{{ velocita_corrente }}"
                action: input_text.set_value
              - data:
                  entity_id: input_text.vmc_master_tempo_mancante_reset
                  value: reset
                action: input_text.set_value
      - choose:
          - conditions:
              - condition: template
                value_template: "{{ now().strftime('%H:%M:%S') == '00:00:00' }}"
            sequence:
              - data: {}
                action: script.vmc_master_azzera_aria_scambiata
          - conditions:
              - condition: state
                entity_id: input_text.vmc_master_tempo_mancante_reset
                state: reset
            sequence:
              - data: {}
                action: script.vmc_master_azzera_aria_scambiata_puntuale
          - conditions:
              - condition: template
                value_template: "{{ now().strftime('%H:%M:%S') != '00:00:00' }}"
              - condition: template
                value_template: >
                  {{ velocita_corrente in ['Velocità 1', 'Velocità 2', 'Velocità 3',
                  'Velocità 4', 'Iperventilazione', 'Notturna', 'Free Cooling'] }}
            sequence:
              - variables:
                  portate:
                    Velocità 1: 10
                    Velocità 2: 17
                    Velocità 3: 26
                    Velocità 4: 37
                    Iperventilazione: 42
                    Notturna: 10
                    Free Cooling: 26
                  incremento: >
                    {% set p = portate.get(velocita_corrente, 0) %} {{ (p / 3600) |
                    float | round(4) }}
                  totale_entity: |
                    {% set map = {
                      'Velocità 1': 'input_number.vmc_master_aria_scambiata_v1',
                      'Velocità 2': 'input_number.vmc_master_aria_scambiata_v2',
                      'Velocità 3': 'input_number.vmc_master_aria_scambiata_v3',
                      'Velocità 4': 'input_number.vmc_master_aria_scambiata_v4',
                      'Iperventilazione': 'input_number.vmc_master_aria_scambiata_iperventilazione',
                      'Notturna': 'input_number.vmc_master_aria_scambiata_notte',
                      'Free Cooling': 'input_number.vmc_master_aria_scambiata_freecooling'
                    } %} {{ map[velocita_corrente] }}
                  ricomincio_entity: input_number.vmc_master_aria_scambiata_ricomincio
                  tempo_mancante: "{{ states('sensor.vmc_master_tempo_mancante_ricambio') }}"
                  volume: >-
                    {{ states('input_number.vmc_master_volume_da_inserire') |
                    float(0) }}
                  ricomincio_val: >-
                    {{ states('input_number.vmc_master_aria_scambiata_ricomincio') |
                    float(0) }}
                  nuovo_valore: "{{ (states(ricomincio_entity) | float(0)) + incremento }}"
              - choose:
                  - conditions:
                      - condition: template
                        value_template: >
                          {{ tempo_mancante in ['0 secondi', '1 secondo'] and
                          ricomincio_val > 0 }}
                    sequence:
                      - data:
                          entity_id: "{{ ricomincio_entity }}"
                          value: 0
                        action: input_number.set_value
                  - conditions:
                      - condition: template
                        value_template: "{{ nuovo_valore >= volume }}"
                    sequence:
                      - data:
                          entity_id: "{{ totale_entity }}"
                          value: >
                            {{ (states(totale_entity) | float(0) + incremento) |
                            round(4) }}
                        action: input_number.set_value
                      - data:
                          entity_id: "{{ ricomincio_entity }}"
                          value: 0
                        action: input_number.set_value
                  - conditions: []
                    sequence:
                      - data:
                          entity_id: "{{ totale_entity }}"
                          value: >
                            {{ (states(totale_entity) | float(0) + incremento) |
                            round(4) }}
                        action: input_number.set_value
                      - data:
                          entity_id: "{{ ricomincio_entity }}"
                          value: "{{ nuovo_valore | round(4) }}"
                        action: input_number.set_value
    mode: restart
################### Fine Creazione Automazione per Scambio Aria #####################

################### Inizio Creazione Automazione per Allerte Audio ##################

################### Inizio Creazione Riepilogo per Allerte Audio all'Avvio di Home Assistant ##################
  - alias: "VMC Master - Riepilogo Audio all’avvio"
    description: >
      Gestisce tutti gli avvisi audio VMC, con Home Asisstant in fase di Avvio:
      - Allerta/Nessuna Allerta Black-Out
      - Stato velocità
      - Allerta/Nessuna Allerta Congelamento
      - Allerta/Nessuna Allerta Diff. Temp. Int-Est > 23 °C
      - Allerta/Nessuna Allerta CO₂
      - Allerta/Nessuna Allerta VOC
      - Allerta/Nessuna Allerta PdR
      - Allerta Free Heating/Cooling
      - Allerta/Nessuna Allerta Umidità
    trigger:
      - platform: homeassistant
        event: start

    condition:
      - condition: state
        entity_id: input_boolean.vmc_master_notifica_audio
        state: "on"
      - condition: state
        entity_id: input_boolean.vmc_master_notifica_allerta_riepilogo
        state: "on"
  
    action:
      - service: input_boolean.turn_on
        target:
          entity_id: input_boolean.vmc_master_avvio_home_assistant_in_corso_per_audio
  
      - delay: "00:00:10"   # aspetta che i sensori siano stabili

      # Black-Out
      - choose:
          - conditions: "{{ is_state('sensor.vmc_master_status_ip_interfaccia', 'OFF-Line') }}"
            sequence:
              - service: script.vmc_master_audio_allerta_black_out
          - conditions: "{{ is_state('sensor.vmc_master_status_ip_interfaccia', 'ON-Line') }}"
            sequence:
              - service: script.vmc_master_audio_nessuna_allerta_black_out

      # Stato velocità
      - service: script.vmc_master_audio_status_velocita

      # Congelamento
      - choose:
          - conditions: "{{ is_state('sensor.vmc_master_congelamento_verifica_soglia', 'Si') }}"
            sequence:
              - service: script.vmc_master_audio_allerta_congelamento
          - conditions: "{{ is_state('sensor.vmc_master_congelamento_verifica_soglia', '[No ma Prossimo]') }}"
            sequence:
              - service: script.vmc_master_audio_allerta_congelamento
          - conditions: "{{ is_state('sensor.vmc_master_alert_monitoraggio_congelamento', 'Nessuna Allerta') }}"
            sequence:
              - service: script.vmc_master_audio_nessuna_allerta_congelamento

      # Diff. Temp. Int-Est > 23 °C
      - choose:
          - conditions: "{{ is_state('sensor.vmc_master_delta_temp_verifica_soglia', 'Si') }}"
            sequence:
              - service: script.vmc_master_audio_allerta_diff_temp
          - conditions: "{{ is_state('sensor.vmc_master_delta_temp_verifica_soglia', '[No ma Prossimo]') }}"
            sequence:
              - service: script.vmc_master_audio_allerta_diff_temp
          - conditions: "{{ is_state('sensor.vmc_master_alert_monitoraggio_delta', 'Nessuna Allerta') }}"
            sequence:
              - service: script.vmc_master_audio_nessuna_allerta_diff_temp

      # CO₂
      - choose:
          - conditions: "{{ is_state('sensor.vmc_master_alert_monitoraggio_co2', 'Allerta') }}"
            sequence:
              - service: script.vmc_master_audio_allerta_co2
          - conditions: "{{ is_state('sensor.vmc_master_alert_monitoraggio_co2', 'Nessuna Allerta') }}"
            sequence:
              - service: script.vmc_master_audio_nessuna_allerta_co2
  
      # VOC
      - choose:
          - conditions: "{{ is_state('sensor.vmc_master_alert_monitoraggio_voc', 'Allerta') }}"
            sequence:
              - service: script.vmc_master_audio_allerta_voc
          - conditions: "{{ is_state('sensor.vmc_master_alert_monitoraggio_voc', 'Nessuna Allerta') }}"
            sequence:
              - service: script.vmc_master_audio_nessuna_allerta_voc

      # PdR
      - choose:
          - conditions: "{{ is_state('sensor.vmc_master_alert_monitoraggio_pdr', 'Allerta') }}"
            sequence:
              - service: script.vmc_master_audio_allerta_pdr
          - conditions: "{{ is_state('sensor.vmc_master_alert_monitoraggio_pdr', 'Nessuna Allerta') }}"
            sequence:
              - service: script.vmc_master_audio_nessuna_allerta_pdr

      # Free Heating / Cooling
      - choose:
          - conditions: "{{ states('sensor.vmc_master_alert_monitoraggio_free_heating_o_free_cooling_allert_interfaccia_avvisi') not in ['unknown','unavailable',''] }}"
            sequence:
              - service: script.vmc_master_audio_free_heating_o_free_cooling
      
      # Umidità
      - choose:
          - conditions: "{{ is_state('sensor.vmc_master_alert_monitoraggio_umidita', 'Allerta') }}"
            sequence:
              - service: script.vmc_master_audio_allerta_umidita_interna
          - conditions: "{{ is_state('sensor.vmc_master_alert_monitoraggio_umidita', 'Nessuna Allerta') }}"
            sequence:
              - service: script.vmc_master_audio_nessuna_allerta_umidita_interna

      # Fine riepilogo → spegne flag
      - service: input_boolean.turn_off
        target:
          entity_id: input_boolean.vmc_master_avvio_home_assistant_in_corso_per_audio
          
    mode: queued
    max: 30   # massimo 30 eventi in coda
################### Fine Creazione Riepilogo per Allerte Audio all'Avvio di Home Assistant ##################

################### Inizio Creazione Audio Allerte & Stato con Home Assistant già Avviato ###################
  - alias: "VMC Master - Audio Allerte & Stato"
    description: >
      Gestisce tutti gli avvisi audio VMC, con Home Asisstant già Avviato:
      - Allerta/Nessuna Allerta Black-Out
      - Stato velocità
      - Allerta/Nessuna Allerta Congelamento
      - Allerta/Nessuna Allerta Diff. Temp. Int-Est > 23 °C
      - Allerta/Nessuna Allerta CO₂
      - Allerta/Nessuna Allerta VOC
      - Allerta/Nessuna Allerta PdR
      - Allerta Free Heating/Cooling
      - Allerta/Nessuna Allerta Umidità
    trigger:
      # Stato velocità
      - platform: state
        entity_id: sensor.vmc_master_status_ventola_lettura_codice_interpretato_interfaccia

      # Umidità
      - platform: state
        entity_id: sensor.vmc_master_alert_monitoraggio_umidita
        to: "Allerta"
      - platform: state
        entity_id: sensor.vmc_master_alert_monitoraggio_umidita
        to: "Nessuna Allerta"

      # CO₂
      - platform: state
        entity_id: sensor.vmc_master_alert_monitoraggio_co2
        to: "Allerta"
      - platform: state
        entity_id: sensor.vmc_master_alert_monitoraggio_co2
        to: "Nessuna Allerta"

      # VOC
      - platform: state
        entity_id: sensor.vmc_master_alert_monitoraggio_voc
        to: "Allerta"
      - platform: state
        entity_id: sensor.vmc_master_alert_monitoraggio_voc
        to: "Nessuna Allerta"

      # PdR
      - platform: state
        entity_id: sensor.vmc_master_alert_monitoraggio_pdr
        to: "Allerta"
      - platform: state
        entity_id: sensor.vmc_master_alert_monitoraggio_pdr
        to: "Nessuna Allerta"

      # Black-Out
      - platform: state
        entity_id: sensor.vmc_master_status_ip_interfaccia
        to: "OFF-Line"
      - platform: state
        entity_id: sensor.vmc_master_status_ip_interfaccia
        to: "ON-Line"

      # Free Heating / Cooling
      - platform: state
        entity_id: sensor.vmc_master_alert_monitoraggio_free_heating_o_free_cooling_allert_interfaccia_avvisi

      # Congelamento
      - platform: state
        entity_id: sensor.vmc_master_congelamento_verifica_soglia
        to: "Si"
      - platform: state
        entity_id: sensor.vmc_master_congelamento_verifica_soglia
        to: "[No ma Prossimo]"
      - platform: state
        entity_id: sensor.vmc_master_alert_monitoraggio_congelamento
        to: "Nessuna Allerta"

      # Diff. Temp. Int-Est > 23 [°C]
      - platform: state
        entity_id: sensor.vmc_master_delta_temp_verifica_soglia
        to: "Si"
      - platform: state
        entity_id: sensor.vmc_master_delta_temp_verifica_soglia
        to: "[No ma Prossimo]"
      - platform: state
        entity_id: sensor.vmc_master_alert_monitoraggio_delta
        to: "Nessuna Allerta"

    condition:
      - condition: state
        entity_id: input_boolean.vmc_master_avvio_home_assistant_in_corso_per_audio
        state: "off"
      - condition: state
        entity_id: input_boolean.vmc_master_notifica_audio
        state: "on"

    action:
      - choose:
          # --- Stato velocità ---
          - conditions: "{{ trigger.entity_id == 'sensor.vmc_master_status_ventola_lettura_codice_interpretato_interfaccia' }}"
            sequence:
              - service: script.vmc_master_audio_status_velocita

          # --- Umidità ---
          - conditions: "{{ trigger.entity_id == 'sensor.vmc_master_alert_monitoraggio_umidita' and trigger.to_state.state == 'Allerta' }}"
            sequence:
              - service: script.vmc_master_audio_allerta_umidita_interna

          - conditions: "{{ trigger.entity_id == 'sensor.vmc_master_alert_monitoraggio_umidita' and trigger.to_state.state == 'Nessuna Allerta' }}"
            sequence:
              - service: script.vmc_master_audio_nessuna_allerta_umidita_interna

          # --- CO₂ ---
          - conditions: "{{ trigger.entity_id == 'sensor.vmc_master_alert_monitoraggio_co2' and trigger.to_state.state == 'Allerta' }}"
            sequence:
              - service: script.vmc_master_audio_allerta_co2

          - conditions: "{{ trigger.entity_id == 'sensor.vmc_master_alert_monitoraggio_co2' and trigger.to_state.state == 'Nessuna Allerta' }}"
            sequence:
              - service: script.vmc_master_audio_nessuna_allerta_co2

          # --- VOC ---
          - conditions: "{{ trigger.entity_id == 'sensor.vmc_master_alert_monitoraggio_voc' and trigger.to_state.state == 'Allerta' }}"
            sequence:
              - service: script.vmc_master_audio_allerta_voc

          - conditions: "{{ trigger.entity_id == 'sensor.vmc_master_alert_monitoraggio_voc' and trigger.to_state.state == 'Nessuna Allerta' }}"
            sequence:
              - service: script.vmc_master_audio_nessuna_allerta_voc

          # --- PdR ---
          - conditions: "{{ trigger.entity_id == 'sensor.vmc_master_alert_monitoraggio_pdr' and trigger.to_state.state == 'Allerta' }}"
            sequence:
              - service: script.vmc_master_audio_allerta_pdr

          - conditions: "{{ trigger.entity_id == 'sensor.vmc_master_alert_monitoraggio_pdr' and trigger.to_state.state == 'Nessuna Allerta' }}"
            sequence:
              - service: script.vmc_master_audio_nessuna_allerta_pdr

          # --- Black-Out ---
          - conditions: "{{ trigger.entity_id == 'sensor.vmc_master_status_ip_interfaccia' and trigger.to_state.state == 'OFF-Line' }}"
            sequence:
              - service: script.vmc_master_audio_allerta_black_out

          - conditions: "{{ trigger.entity_id == 'sensor.vmc_master_status_ip_interfaccia' and trigger.to_state.state == 'ON-Line' }}"
            sequence:
              - service: script.vmc_master_audio_nessuna_allerta_black_out

          # --- Free Heating / Cooling ---
          - conditions: "{{ trigger.entity_id == 'sensor.vmc_master_alert_monitoraggio_free_heating_o_free_cooling_allert_interfaccia_avvisi' }}"
            sequence:
              - service: script.vmc_master_audio_free_heating_o_free_cooling
              
          # --- Congelamento
          - conditions: "{{ trigger.entity_id == 'sensor.vmc_master_congelamento_verifica_soglia' and trigger.to_state.state == 'Si' }}"
            sequence:
              - service: script.vmc_master_audio_allerta_congelamento

          - conditions: "{{ trigger.entity_id == 'sensor.vmc_master_congelamento_verifica_soglia' and trigger.to_state.state == '[No ma Prossimo]' }}"
            sequence:
              - service: script.vmc_master_audio_allerta_congelamento

          - conditions: "{{ trigger.entity_id == 'sensor.vmc_master_alert_monitoraggio_congelamento' and trigger.to_state.state == 'Nessuna Allerta' }}"
            sequence:
              - service: script.vmc_master_audio_nessuna_allerta_congelamento

          # --- Diff. Temp. Int-Est > 23 [°C]
          - conditions: "{{ trigger.entity_id == 'sensor.vmc_master_delta_temp_verifica_soglia' and trigger.to_state.state == 'Si' }}"
            sequence:
              - service: script.vmc_master_audio_allerta_diff_temp

          - conditions: "{{ trigger.entity_id == 'sensor.vmc_master_delta_temp_verifica_soglia' and trigger.to_state.state == '[No ma Prossimo]' }}"
            sequence:
              - service: script.vmc_master_audio_allerta_diff_temp

          - conditions: "{{ trigger.entity_id == 'sensor.vmc_master_alert_monitoraggio_delta' and trigger.to_state.state == 'Nessuna Allerta' }}"
            sequence:
              - service: script.vmc_master_audio_nessuna_allerta_diff_temp

    mode: queued
    max: 30   # massimo 30 eventi in coda
################### Fine Creazione Audio Allerte & Stato con Home Assistant già Avviato ###################
################### Fine Creazione Automazione per Allerte Audio #####################

################### Fine Creazione Automazione #######################################

################### Inizio Creazione dei Servizi ovvero i Comandi da impartire alla VMC ################################################################################################################################# [CONFIGURAZIONE 0 RICHIAMI] [INTERFACCIA, PIU’ RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI]
shell_command: 
  vmc_master_rimuovi_caratteri_di_ritorno: find /config/packages/vmc_helty_flow/master -type f -name "*.sh" -exec sed -i 's/\r$//' {} \;                                          # [AUTOMAZIONE] TROVA E RIMUOVE CARATTERI DI RITORNO IN TUTTI I FILES *.sh CONTENUTI NELLA CARTELLA
  vmc_master_aggiorna_indirizzo_ip:        bash /config/packages/vmc_helty_flow/master/vmc_master_script_cambio_ip.sh   {{ states('input_text.vmc_master_ip_insert') }}           # [AUTOMAZIONE] TROVA E SOSTITUISCE NEL FILE CORRENTE L'INDIRIZZO IP INSERITO NELL'INTERFACCIA, SE VIENE LANCIATO SENZA SPECIFICARE UN INDIRIZZO IP DI DEFAULT VERRA' INSERITO NEL FILE CORRENTE 192.168.1.160
  vmc_master_cambia_nome:                  bash /config/packages/vmc_helty_flow/master/vmc_master_script_cambio_nome.sh {{ states('input_text.vmc_master_nome_da_inserire') }}    # [AUTOMAZIONE] INVIO COMANDO PER CAMBIARE NOME ALLA VMC 
  vmc_master_freecooling:                  timeout 15s echo -e "VMWH0000007" | nc 192.168.1.160 5001                                                                              # [CONFIGURAZIONE] [INTERFACCIA] [AUTOMAZIONE] INVIO COMANDO Free Cool./Heat. ALLA VMC
  vmc_master_notturna:                     timeout 15s echo -e "VMWH0000006" | nc 192.168.1.160 5001                                                                              # [CONFIGURAZIONE] [INTERFACCIA] [AUTOMAZIONE] INVIO COMANDO NOTTURNA         ALLA VMC
  vmc_master_iperventilazione:             timeout 15s echo -e "VMWH0000005" | nc 192.168.1.160 5001                                                                              # [CONFIGURAZIONE] [INTERFACCIA] [AUTOMAZIONE] INVIO COMANDO IPERVENTILAZIONE ALLA VMC
  vmc_master_velocita_4:                   timeout 15s echo -e "VMWH0000004" | nc 192.168.1.160 5001                                                                              # [CONFIGURAZIONE] [INTERFACCIA] [AUTOMAZIONE] INVIO COMANDO VELOCITA' 4      ALLA VMC
  vmc_master_velocita_3:                   timeout 15s echo -e "VMWH0000003" | nc 192.168.1.160 5001                                                                              # [CONFIGURAZIONE] [INTERFACCIA] [AUTOMAZIONE] INVIO COMANDO VELOCITA' 3      ALLA VMC
  vmc_master_velocita_2:                   timeout 15s echo -e "VMWH0000002" | nc 192.168.1.160 5001                                                                              # [CONFIGURAZIONE] [INTERFACCIA] [AUTOMAZIONE] INVIO COMANDO VELOCITA' 2      ALLA VMC
  vmc_master_velocita_1:                   timeout 15s echo -e "VMWH0000001" | nc 192.168.1.160 5001                                                                              # [CONFIGURAZIONE] [INTERFACCIA] [AUTOMAZIONE] INVIO COMANDO VELOCITA' 1      ALLA VMC
  vmc_master_velocita_0:                   timeout 15s echo -e "VMWH0000000" | nc 192.168.1.160 5001                                                                              # [CONFIGURAZIONE] [INTERFACCIA] [AUTOMAZIONE] INVIO COMANDO VELOCITA' 0      ALLA VMC
  vmc_master_sensori_on:                   timeout 15s echo -e "VMWH0300000" | nc 192.168.1.160 5001                                                                              # [CONFIGURAZIONE] [INTERFACCIA] [AUTOMAZIONE]  INVIO COMANDO SENSORI  ON     ALLA VMC PER ACCENDERE   I SENSORI DELLA VMC; I valori rilevati dai sensori nella schermata INFO dell'App Mobile saranno disponibili e i relativi allarmi verrano segnalati
  vmc_master_sensori_off:                  timeout 15s echo -e "VMWH0300002" | nc 192.168.1.160 5001                                                                              # [CONFIGURAZIONE] [INTERFACCIA] [AUTOMAZIONE] INVIO COMANDO SENSORI  OFF     ALLA VMC PER DISATTIVARE I SENSORI DELLA VMC; I valori rilevati dai sensori nella schermata INFO dell'App Mobile NON saranno disponibili e i relativi allarmi NON verrano segnalati
  vmc_master_pannello_led_on:              timeout 15s echo -e "VMWH0100010" | nc 192.168.1.160 5001                                                                              # [CONFIGURAZIONE] [INTERFACCIA] [AUTOMAZIONE] INVIO COMANDO PANNELLO LED ON  ALLA VMC PER ATTIVARE    IL LED PANNELLO DEI COMANDI 
  vmc_master_pannello_led_off:             timeout 15s echo -e "VMWH0100000" | nc 192.168.1.160 5001                                                                              # [CONFIGURAZIONE] [INTERFACCIA] [AUTOMAZIONE] INVIO COMANDO PANNELLO LED OFF ALLA VMC PER DISATTIVARE IL LED PANNELLO DEI COMANDI
  vmc_master_reset_filtro:                 timeout 15s echo -e "VMWH0417744" | nc 192.168.1.160 5001                                                                              # [CONFIGURAZIONE] [INTERFACCIA] INVIO COMANDO RESET FILTRO ALLA VMC, A SOSTITUZIONE DEI FILTRI
################### Fine Creazione dei Servizi ovvero i Comandi da impartire alla VMC   ###################################################################################################################################

#################################################################################################################################
# Esclusione entità da Recorder, History e Logbook per ridurre il carico sul database escludendo entità aggiornate di frequente #
#################################################################################################################################
recorder:
  include:
    entities:
      - sensor.vmc_master_spia_pannello_alert_monitoraggio_totale
      - sensor.vmc_master_status_ventola_lettura_codice_interpretato_interfaccia
      - sensor.vmc_master_temp_esterna_status
      - sensor.vmc_master_temp_interna_status
      - sensor.vmc_master_umidita_esterna_status
      - sensor.vmc_master_umidita_interna_status
      - sensor.vmc_master_co2_status
      - sensor.vmc_master_voc_status
      - sensor.vmc_master_punto_di_rugiada_esterno
      - sensor.vmc_master_punto_di_rugiada_interno
      - sensor.vmc_master_punto_di_rugiada_valore
      - sensor.vmc_master_umidita_assoluta_esterna
      - sensor.vmc_master_umidita_assoluta_interna
      - sensor.vmc_master_calcolo_confort_interno
      - sensor.vmc_master_trend_muffa
      - sensor.vmc_master_temp_esterna_status_senza_offset
      - sensor.vmc_master_temp_interna_status_senza_offset
      - sensor.vmc_master_umidita_interna_status_senza_offset
      - sensor.vmc_master_co2_status_senza_offset
      - sensor.vmc_master_voc_status_senza_offset
      - sensor.vmc_master_congelamento_verifica_soglia
      - sensor.vmc_master_delta_temp_verifica_soglia
      - sensor.vmc_master_co2_status_verifica_soglia
      - sensor.vmc_master_voc_status_verifica_soglia
      - sensor.vmc_master_alert_monitoraggio_pdr
      - sensor.vmc_master_alert_monitoraggio_free_heating_o_free_cooling_allert_interfaccia_avvisi
      - sensor.vmc_master_umidita_interna_status_verifica_soglia
      - sensor.vmc_master_alert_monitoraggio_black_out
      - sensor.vmc_master_trend_muffa_level
  exclude:
    entities:
      - automation.vmc_master_aggiorna_aria_scambiata_e_gestisci_countdown_rev_00
      - automation.automazione_vmc_master
      - automation.vmc_master_audio_allerte_stato
      - automation.vmc_master_riepilogo_audio_allavvio
      - sensor.vmc_master_temperatura_esterna_selezionata
      - sensor.vmc_master_temperatura_interna_selezionata
      - sensor.vmc_master_umidita_esterna_selezionata
      - sensor.vmc_master_umidita_interna_selezionata
      - sensor.vmc_master_co2_interna_selezionata
      - sensor.VMC_MASTER_STATUS_IP
      - sensor.VMC_MASTER_STATUS_VENTOLA
      - sensor.VMC_MASTER_SENSORI
      - sensor.VMC_MASTER_NOME
      - sensor.VMC_MASTER_LAN
      - sensor.vmc_master_versione_repository
      - sensor.vmc_master_versione_corrente
      - sensor.vmc_master_verifica_ip_inserito
      - sensor.vmc_master_ip
      - sensor.vmc_master_status_ip_interfaccia
      - sensor.vmc_master_nome_status
      - sensor.vmc_master_status_ventola_lettura_codice
      - sensor.vmc_master_status_ventola_lettura_codice_interpretato
#      - sensor.vmc_master_status_ventola_lettura_codice_interpretato_interfaccia
      - sensor.vmc_master_status_sensori_lettura_codice_interpretato
      - sensor.vmc_master_status_led_pannello_lettura_codice_interpretato
      - sensor.vmc_master_temp_esterna_positivo_negativo
      - sensor.vmc_master_temp_interna_positivo_negativo
#      - sensor.vmc_master_temp_esterna_status
#      - sensor.vmc_master_temp_esterna_status_senza_offset
#      - sensor.vmc_master_temp_interna_status
#      - sensor.vmc_master_temp_interna_status_senza_offset
#      - sensor.vmc_master_umidita_esterna_status
#      - sensor.vmc_master_umidita_interna_status
#      - sensor.vmc_master_umidita_interna_status_senza_offset
#      - sensor.vmc_master_co2_status
#      - sensor.vmc_master_co2_status_senza_offset
#      - sensor.vmc_master_voc_status
#      - sensor.vmc_master_voc_status_senza_offset
      - sensor.vmc_master_umidita_interna_status_verifica_soglia_valore
      - sensor.vmc_master_punto_di_rugiada_verifica_confronto_valore
#      - sensor.vmc_master_punto_di_rugiada_valore
#      - sensor.vmc_master_umidita_interna_status_verifica_soglia
#      - sensor.vmc_master_co2_status_verifica_soglia
#      - sensor.vmc_master_voc_status_verifica_soglia
#      - sensor.vmc_master_congelamento_verifica_soglia
#      - sensor.vmc_master_delta_temp_verifica_soglia
#      - sensor.vmc_master_punto_di_rugiada_interno
#      - sensor.vmc_master_punto_di_rugiada_esterno
      - sensor.vmc_master_punto_di_rugiada_interno_esterno_non_calcolabile
      - sensor.vmc_master_punto_di_rugiada_verifica_confronto
#      - sensor.vmc_master_umidita_assoluta_interna
#      - sensor.vmc_master_umidita_assoluta_esterna
#      - sensor.vmc_master_calcolo_confort_interno
      - sensor.vmc_master_status_portata_ventola_lettura_codice_interpretato
      - sensor.vmc_master_status_calcolo_portata_ventola
      - sensor.vmc_master_alert_monitoraggio_umidita
      - sensor.vmc_master_alert_monitoraggio_co2
      - sensor.vmc_master_alert_monitoraggio_voc
#      - sensor.vmc_master_alert_monitoraggio_pdr
      - sensor.vmc_master_alert_monitoraggio_congelamento
      - sensor.vmc_master_alert_monitoraggio_delta
      - sensor.vmc_master_alert_monitoraggio_free_heating_o_free_cooling
#      - sensor.vmc_master_alert_monitoraggio_free_heating_o_free_cooling_allert_interfaccia_avvisi
      - sensor.vmc_master_alert_monitoraggio_free_heating_o_free_cooling_disabilitato
      - sensor.vmc_master_alert_monitoraggio_offset_tutti_min
#      - sensor.vmc_master_alert_monitoraggio_black_out
      - sensor.vmc_master_alert_monitoraggio_totale
#      - sensor.vmc_master_spia_pannello_alert_monitoraggio_totale
      - sensor.vmc_master_status_accensione_vmc_tramite_calendario_interfaccia
      - sensor.vmc_master_status_accensione_vmc_tramite_calendario_2_interfaccia
      - sensor.vmc_master_status_spegnimento_vmc_tramite_calendario_interfaccia
      - sensor.vmc_master_status_spegnimento_vmc_tramite_calendario_2_interfaccia
      - sensor.vmc_master_status_accensione_vmc_tramite_calendario
      - sensor.vmc_master_status_accensione_vmc_tramite_calendario_2
      - sensor.vmc_master_status_spegnimento_vmc_tramite_calendario
      - sensor.vmc_master_status_spegnimento_vmc_tramite_calendario_2
      - sensor.vmc_master_status_check_freeheating_freecooling
      - sensor.vmc_master_status_freeheating
      - sensor.vmc_master_status_freecooling
      - sensor.vmc_master_status_mese_corrente_freeheating_o_freecooling
      - sensor.vmc_master_speed_1_fascia_calendario
      - sensor.vmc_master_speed_2_fascia_calendario
      - sensor.vmc_master_mese_1_fascia_freeheating
      - sensor.vmc_master_mese_2_fascia_freeheating
      - sensor.vmc_master_mese_1_fascia_freecooling
      - sensor.vmc_master_mese_2_fascia_freecooling
      - sensor.vmc_master_status_calcolo_aria_scambiata_totale
      - sensor.vmc_master_cicli_ricambio_aria
      - sensor.vmc_master_tempo_mancante_ricambio
      - sensor.vmc_master_temp_interna_numeric
      - sensor.vmc_master_hum_interna_numeric
      - sensor.vmc_master_calcolo_rischio_muffa_4w
      - sensor.vmc_master_calcolo_rischio_muffa_8w
      - sensor.vmc_master_calcolo_rischio_muffa_12w
      - sensor.vmc_master_temp_interna_4w
      - sensor.vmc_master_temp_interna_8w
      - sensor.vmc_master_temp_interna_12w
      - sensor.vmc_master_hum_interna_4w
      - sensor.vmc_master_hum_interna_8w
      - sensor.vmc_master_hum_interna_12w
#      - sensor.vmc_master_trend_muffa
#      - sensor.vmc_master_trend_muffa_level
      - input_text.vmc_master_nome_da_inserire
      - input_text.vmc_master_ip_insert
      - input_text.vmc_master_last_temp_external_entity
      - input_text.vmc_master_last_temp_internal_entity
      - input_text.vmc_master_last_humidity_external_entity
      - input_text.vmc_master_last_humidity_internal_entity
      - input_text.vmc_master_last_co2_internal_entity
      - input_text.vmc_master_last_notification_device
      - input_text.vmc_master_tempo_mancante_reset
      - input_text.vmc_master_velocita_precedente
      - input_text.vmc_master_last_media_player_entity
      - input_select.vmc_master_speed_1_fascia_calendario
      - input_select.vmc_master_speed_2_fascia_calendario
      - input_select.vmc_master_mese_1_fascia_freeheating
      - input_select.vmc_master_mese_2_fascia_freeheating
      - input_select.vmc_master_mese_1_fascia_freecooling
      - input_select.vmc_master_mese_2_fascia_freecooling
      - input_select.vmc_master_selected_temp_external_entity
      - input_select.vmc_master_selected_temp_internal_entity
      - input_select.vmc_master_selected_humidity_external_entity
      - input_select.vmc_master_selected_humidity_internal_entity
      - input_select.vmc_master_selected_co2_internal_entity
      - input_select.vmc_master_selected_notification_device
      - input_select.vmc_master_speed_umidita  
      - input_select.vmc_master_selected_media_player_entity
      - input_number.vmc_master_offset_temp_interna
      - input_number.vmc_master_offset_temp_esterna
      - input_number.vmc_master_offset_umidita_interna
      - input_number.vmc_master_offset_umidita_esterna
      - input_number.vmc_master_offset_co2
      - input_number.vmc_master_offset_voc
      - input_number.vmc_master_offset_verifica_impiego_vmc
      - input_number.vmc_master_volume_da_inserire
      - input_number.vmc_master_umidita_avvio     
      - input_number.vmc_master_aria_scambiata_v1
      - input_number.vmc_master_aria_scambiata_v2
      - input_number.vmc_master_aria_scambiata_v3
      - input_number.vmc_master_aria_scambiata_v4
      - input_number.vmc_master_aria_scambiata_iperventilazione
      - input_number.vmc_master_aria_scambiata_notte
      - input_number.vmc_master_aria_scambiata_freecooling
      - input_number.vmc_master_aria_scambiata_ricomincio
      - input_number.vmc_master_audio_volume
      - input_datetime.vmc_master_accensione_lunedi
      - input_datetime.vmc_master_spegnimento_lunedi
      - input_datetime.vmc_master_accensione_lunedi_2
      - input_datetime.vmc_master_spegnimento_lunedi_2
      - input_datetime.vmc_master_accensione_martedi
      - input_datetime.vmc_master_spegnimento_martedi
      - input_datetime.vmc_master_accensione_martedi_2
      - input_datetime.vmc_master_spegnimento_martedi_2
      - input_datetime.vmc_master_accensione_mercoledi
      - input_datetime.vmc_master_spegnimento_mercoledi
      - input_datetime.vmc_master_accensione_mercoledi_2
      - input_datetime.vmc_master_spegnimento_mercoledi_2
      - input_datetime.vmc_master_accensione_giovedi
      - input_datetime.vmc_master_spegnimento_giovedi
      - input_datetime.vmc_master_accensione_giovedi_2
      - input_datetime.vmc_master_spegnimento_giovedi_2
      - input_datetime.vmc_master_accensione_venerdi
      - input_datetime.vmc_master_spegnimento_venerdi
      - input_datetime.vmc_master_accensione_venerdi_2
      - input_datetime.vmc_master_spegnimento_venerdi_2
      - input_datetime.vmc_master_accensione_sabato
      - input_datetime.vmc_master_spegnimento_sabato
      - input_datetime.vmc_master_accensione_sabato_2
      - input_datetime.vmc_master_spegnimento_sabato_2
      - input_datetime.vmc_master_accensione_domenica
      - input_datetime.vmc_master_spegnimento_domenica
      - input_datetime.vmc_master_accensione_domenica_2
      - input_datetime.vmc_master_spegnimento_domenica_2
      - input_datetime.vmc_master_audio_start_time
      - input_datetime.vmc_master_audio_end_time
      - input_boolean.vmc_master_opzioni_avvisi
      - input_boolean.vmc_master_opzioni_avvisi_grafici
      - input_boolean.vmc_master_opzioni_vmc
      - input_boolean.vmc_master_opzioni_offset_sensori
      - input_boolean.vmc_master_opzioni_interruttore_offset_sensori
      - input_boolean.vmc_master_opzioni_monitoraggio_sensori
      - input_boolean.vmc_master_opzioni_interruttore_monitoraggio_sensori_extra
      - input_boolean.vmc_master_opzioni_calendario_main
      - input_boolean.vmc_master_opzioni_calendario
      - input_boolean.vmc_master_opzioni_punto_di_rugiada
      - input_boolean.vmc_master_opzioni_free_heating_o_free_cooling
      - input_boolean.vmc_master_opzioni_interruttore_calendario
      - input_boolean.vmc_master_opzioni_lettura_sensori
      - input_boolean.vmc_master_opzioni_scelta_sensori
      - input_boolean.vmc_master_opzioni_elementi_chimici
      - input_boolean.vmc_master_opzione_finestra_audio
      - input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr
      - input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_calendario
      - input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_freeheating
      - input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_freecooling
      - input_boolean.vmc_master_opzioni_accendi_spegni_avvisi
      - input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc
      - input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_umidita
      - input_boolean.vmc_master_opzioni_accendi_spegni_avvisi_spia
      - input_boolean.vmc_master_popup_versione_corrente_vs_repository
      - input_boolean.vmc_master_spia_velocita_0
      - input_boolean.vmc_master_spia_velocita_1
      - input_boolean.vmc_master_spia_velocita_2
      - input_boolean.vmc_master_spia_velocita_3
      - input_boolean.vmc_master_spia_velocita_4
      - input_boolean.vmc_master_spia_velocita_iperventilazione
      - input_boolean.vmc_master_spia_velocita_notturna
      - input_boolean.vmc_master_spia_velocita_freecooling
      - input_boolean.vmc_master_spia_calendario_lunedi_1
      - input_boolean.vmc_master_spia_calendario_lunedi_2
      - input_boolean.vmc_master_spia_calendario_martedi_1
      - input_boolean.vmc_master_spia_calendario_martedi_2
      - input_boolean.vmc_master_spia_calendario_mercoledi_1
      - input_boolean.vmc_master_spia_calendario_mercoledi_2
      - input_boolean.vmc_master_spia_calendario_giovedi_1
      - input_boolean.vmc_master_spia_calendario_giovedi_2
      - input_boolean.vmc_master_spia_calendario_venerdi_1
      - input_boolean.vmc_master_spia_calendario_venerdi_2
      - input_boolean.vmc_master_spia_calendario_sabato_1
      - input_boolean.vmc_master_spia_calendario_sabato_2
      - input_boolean.vmc_master_spia_calendario_domenica_1
      - input_boolean.vmc_master_spia_calendario_domenica_2
      - input_boolean.vmc_master_spia_velocita_0_un_solo_avvio
      - input_boolean.vmc_master_spia_velocita_1_un_solo_avvio
      - input_boolean.vmc_master_spia_velocita_2_un_solo_avvio
      - input_boolean.vmc_master_spia_velocita_3_un_solo_avvio
      - input_boolean.vmc_master_spia_velocita_4_un_solo_avvio
      - input_boolean.vmc_master_spia_velocita_iperventilazione_un_solo_avvio
      - input_boolean.vmc_master_spia_velocita_notturna_un_solo_avvio
      - input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio
      - input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio_per_programmazione_freecooling
      - input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio_per_programmazione_freeheating
      - input_boolean.vmc_master_spia_co2_o_voc
      - input_boolean.vmc_master_spia_co2_o_voc_partenza_ritorno_velocita_0
      - input_boolean.vmc_master_spia_velocita_0_co2_o_voc
      - input_boolean.vmc_master_spia_velocita_1_co2_o_voc
      - input_boolean.vmc_master_spia_velocita_2_co2_o_voc
      - input_boolean.vmc_master_spia_velocita_3_co2_o_voc
      - input_boolean.vmc_master_spia_velocita_4_co2_o_voc
      - input_boolean.vmc_master_spia_velocita_iperventilazione_co2_o_voc
      - input_boolean.vmc_master_spia_velocita_notturna_co2_o_voc
      - input_boolean.vmc_master_spia_velocita_freecooling_co2_o_voc
      - input_boolean.vmc_master_spia_velocita_1_co2_o_voc_pdr
      - input_boolean.vmc_master_congelamento_verifica_soglia_valore_spia
      - input_boolean.vmc_master_spia_velocita_0_congelamento
      - input_boolean.vmc_master_spia_velocita_1_congelamento
      - input_boolean.vmc_master_spia_velocita_2_congelamento
      - input_boolean.vmc_master_spia_velocita_3_congelamento
      - input_boolean.vmc_master_spia_velocita_4_congelamento
      - input_boolean.vmc_master_spia_velocita_iperventilazione_congelamento
      - input_boolean.vmc_master_spia_velocita_notturna_congelamento
      - input_boolean.vmc_master_spia_velocita_freecooling_congelamento
      - input_boolean.vmc_master_delta_temp_verifica_soglia_valore_spia
      - input_boolean.vmc_master_spia_velocita_0_delta_temp_verifica_soglia_valore
      - input_boolean.vmc_master_spia_velocita_1_delta_temp_verifica_soglia_valore
      - input_boolean.vmc_master_spia_velocita_2_delta_temp_verifica_soglia_valore
      - input_boolean.vmc_master_spia_velocita_3_delta_temp_verifica_soglia_valore
      - input_boolean.vmc_master_spia_velocita_4_delta_temp_verifica_soglia_valore
      - input_boolean.vmc_master_spia_velocita_iperventilazione_delta_temp_verifica_soglia_valore
      - input_boolean.vmc_master_spia_velocita_notturna_delta_temp_verifica_soglia_valore
      - input_boolean.vmc_master_spia_velocita_freecooling_delta_temp_verifica_soglia_valore
      - input_boolean.vmc_master_notifica_status_vmc
      - input_boolean.vmc_master_umidita_verifica_soglia_valore_spia
      - input_boolean.vmc_master_spia_umidita_velocita_0
      - input_boolean.vmc_master_spia_umidita_velocita_1
      - input_boolean.vmc_master_spia_umidita_velocita_2
      - input_boolean.vmc_master_spia_umidita_velocita_3
      - input_boolean.vmc_master_spia_umidita_velocita_4
      - input_boolean.vmc_master_spia_umidita_velocita_iperventilazione
      - input_boolean.vmc_master_spia_umidita_velocita_notturna
      - input_boolean.vmc_master_spia_umidita_velocita_freecooling
      - input_boolean.vmc_master_avvio_home_assistant_in_corso_per_audio
      - input_boolean.vmc_master_notifica_audio
      - input_boolean.vmc_master_notifica_allerta_congelamento
      - input_boolean.vmc_master_notifica_allerta_differenza_temp_int_est
      - input_boolean.vmc_master_notifica_allerta_inquinanti
      - input_boolean.vmc_master_notifica_allerta_pdr
      - input_boolean.vmc_master_notifica_allerta_freecooling_heating
      - input_boolean.vmc_master_notifica_allerta_umidita
      - input_boolean.vmc_master_notifica_allerta_black_out
      - input_boolean.vmc_master_notifica_allerta_status_velocita
      - input_boolean.vmc_master_notifica_allerta_riepilogo
      - script.vmc_master_aggiorna_elenco_entita_temperatura_esterna
      - script.vmc_master_aggiorna_elenco_entita_temperatura_interna
      - script.vmc_master_aggiorna_elenco_entita_umidita_esterna
      - script.vmc_master_aggiorna_elenco_entita_umidita_interna
      - script.vmc_master_aggiorna_elenco_entita_co2_interna
      - script.vmc_master_aggiorna_elenco_entita_notifica_dispositivo
      - script.vmc_master_aggiorna_elenco_entita_media_player
      - script.vmc_master_notifica_errore_temp_esterna
      - script.vmc_master_notifica_errore_temp_interna
      - script.vmc_master_notifica_errore_umidita_esterna
      - script.vmc_master_notifica_errore_umidita_interna
      - script.vmc_master_notifica_errore_co2_interna
      - script.vmc_master_notifica_cambio_filtro
      - script.vmc_master_notifica_velocita_0
      - script.vmc_master_notifica_velocita_diversa_da_0
      - script.vmc_master_notifica_errore_media_player
      - script.vmc_master_azzera_booleans
      - script.vmc_master_azzera_offset_sensors
      - script.vmc_master_upgrade_sensors
      - script.vmc_master_profilo_calendario
      - script.vmc_master_profilo_free_heating_cooling
      - script.vmc_master_profilo_pdr
      - script.vmc_master_profilo_inizializzazione
      - script.vmc_master_audio_profilo
      - script.vmc_master_bottone_panico
      - script.vmc_master_calendario_fascia_1_o_2_off
      - script.vmc_master_calendario_fascia_1_on
      - script.vmc_master_calendario_fascia_2_on    
      - script.vmc_master_azzera_aria_scambiata
      - script.vmc_master_pulisci_cronologia_audio
      - script.vmc_master_audio_status_velocita
      - script.vmc_master_audio_allerta_umidita_interna
      - script.vmc_master_audio_nessuna_allerta_umidita_interna
      - script.vmc_master_audio_allerta_co2
      - script.vmc_master_audio_nessuna_allerta_co2
      - script.vmc_master_audio_allerta_voc
      - script.vmc_master_audio_nessuna_allerta_voc
      - script.vmc_master_audio_allerta_pdr
      - script.vmc_master_audio_nessuna_allerta_pdr
      - script.vmc_master_audio_allerta_black_out
      - script.vmc_master_audio_nessuna_allerta_black_out
      - script.vmc_master_audio_free_heating_o_free_cooling
      - script.vmc_master_audio_allerta_congelamento
      - script.vmc_master_audio_nessuna_allerta_congelamento
      - script.vmc_master_audio_allerta_diff_temp
      - script.vmc_master_audio_nessuna_allerta_diff_temp
      - script.vmc_master_azzera_aria_scambiata_puntuale