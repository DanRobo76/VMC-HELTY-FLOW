###########################################################################################################################################################################################################################
#                                                                                                                                                                                                                         #
#                                                          VMC HELTY FLOW PLUS/ELITE RELEASE [VEDERE VALORE INSERITO NEL SENSORE vmc_master_versione_corrente]                                                            #
# SVILUPPATO DA DANILO ROBOTTI, ALLE PRIME ARMI CON HOME ASSISTANT                                                                                                                                                        #
# SI INVITA A DIVULGARE IL CODICE PER RENDERLO SEMPRE PIU' EFFICACIE ED EFFICIENTE, ANCHE AL SOTTOSCRITTO! :)                                                                                                             #
# EMAIL: danilo.robotti@gmail.com                                                                                                                                                                                         #
#                                                                                                                                                                                                                         #
###########################################################################################################################################################################################################################

################### Sensori della VMC  ####################################################################################################################################################################################
#                                                                                                                                                                                                                         #
# I SENSORI PRINCIPALI UTILIZZATI PER L'ESTRAZIONE DEI DATI CONTENUTI NELLA VMC SONO:                                                                                                                                     #
#                                                                                                                                                                                                                         #
# - VMC_MASTER_STATUS_IP                                                                                                                                                                                                  #
# - VMC_MASTER_STATUS_VENTOLA                                                                                                                                                                                             #
# - VMC_MASTER_SENSORI                                                                                                                                                                                                    #
# - VMC_MASTER_NOME                                                                                                                                                                                                       #
# - VMC_MASTER_LAN                                                                                                                                                                                                        #
#                                                                                                                                                                                                                         #
# I SENSORI SECONDARI PRINCIPALI UTILIZZATI PER LA RESTITUZIONE DELLA LETTURA DEI DATI ESTRATTI NELLA VMC:                                                                                                                #
#                                                                                                                                                                                                                         #
# - vmc_master_status_ip_interfaccia                                                                                                                                                                                      #
# - vmc_master_nome_status                                                                                                                                                                                                #
# - vmc_master_status_ventola_lettura_codice_interpretato                                                                                                                                                                 #
# - vmc_master_status_sensori_lettura_codice_interpretato                                                                                                                                                                 #
# - vmc_master_status_led_pannello_lettura_codice_interpretato                                                                                                                                                            #
# - vmc_master_temp_interna_positivo_negativo              [FORMULA DA VERIFICARE (INDICE ARRAY) E/O METODO , NON AVENDO MAI VISUALIZZATO UNA TEMPERATURA NEGATIVA]                                                       #
# - vmc_master_temp_esterna_positivo_negativo              [FORMULA DA VERIFICARE (INDICE ARRAY) E/O METODO , NON AVENDO MAI VISUALIZZATO UNA TEMPERATURA NEGATIVA]                                                       #
#                                                                                                                                                                                                                         #
# - vmc_master_temp_interna_status_senza_offset            [SENSORE DELLA VMC PER MONITORARE LA TEMPERATURA INTERNA]                                                                                                      #
# - vmc_master_temp_esterna_status_vmc_senza_offset        [SENSORE DELLA VMC PER MONITORARE LA TEMPERATURA ESTERNA]                                                                                                      #
# - vmc_master_co2_status_senza_offset                     [SENSORE DELLA VMC PER MONITORARE L'ANIDRIDE CARBONICA, PRESENTE SOLO NEL MODELLO VMC HELTY FLOW ELITE]                                                        #
# - vmc_master_voc_status_senza_offset                     [SENSORE DELLA VMC PER MONITORARE I COMPOSTI ORGANICI VOLATILI, PRESENTE SOLO NEL MODELLO VMC HELTY FLOW ELITE]                                                #
# - vmc_master_umidita_interna_status_senza_offset         [SENSORE DELLA VMC PER MONITORARE L'UMIDITA' INTERNA]                                                                                                          #
# - vmc_master_temp_esterna_status_senza_offset            [SENSORE DI LETTURA TEMPERATURA ESTERNA MEMORIZZATA NEL SENSORE vmc_master_forecast_temp_esterna_status                                                        #
# - vmc_master_umidita_esterna_status_senza_offset         [SENSORE DI LETTURA UMIDITA'    ESTERNA MEMORIZZATA NEL SENSORE vmc_master_forecast_umidita_esterna_status                                                     #
#                                                                                                                                                                                                                         #
#                                                                                                                                                                                                                         #
#                                                                                                                                                                                                                         #
# I COMANDI PER PILOTARE LA VMC [IMPIEGABILI TRAMITE SERVIZI IN QUALSIASI AUTOMAZIONE]                                                                                                                                    #
#                                                                                                                                                                                                                         #
# shell_command:                                                                                                                                                                                                          #
#  vmc_master_freecooling                                                                 # INVIO COMANDO Free Cool./Heat. ALLA VMC                                                                                       #
#  vmc_master_notturna                                                                    # INVIO COMANDO NOTTURNA         ALLA VMC                                                                                       #
#  vmc_master_iperventilazione                                                            # INVIO COMANDO IPERVENTILAZIONE ALLA VMC                                                                                       #
#  vmc_master_velocita_4                                                                  # INVIO COMANDO VELOCITA' 4      ALLA VMC                                                                                       #
#  vmc_master_velocita_3                                                                  # INVIO COMANDO VELOCITA' 3      ALLA VMC                                                                                       #
#  vmc_master_velocita_2                                                                  # INVIO COMANDO VELOCITA' 2      ALLA VMC                                                                                       #
#  vmc_master_velocita_1                                                                  # INVIO COMANDO VELOCITA' 1      ALLA VMC                                                                                       #
#  vmc_master_velocita_0                                                                  # INVIO COMANDO VELOCITA' 0      ALLA VMC                                                                                       #
#  vmc_master_pannello_led_on                                                             # INVIO COMANDO PANNELLO LED ON  ALLA VMC PER ATTIVARE    IL LED PANNELLO DEI COMANDI                                           #
#  vmc_master_pannello_led_off                                                            # INVIO COMANDO PANNELLO LED OFF ALLA VMC PER DISATTIVARE IL LED PANNELLO DEI COMANDI                                           #
#  vmc_master_sensori_on                                                                  # INVIO COMANDO SENSORI  ON  ALLA VMC PER ACCENDERE I SENSORI;   i valori rilevati dai sensori nella schermata INFO dell'App    #
#                                                                                           Mobile saranno disponibili e i relativi allarmi verrano segnalati                                                             #
#  vmc_master_sensori_off                                                                 # INVIO COMANDO SENSORI  OFF ALLA VMC PER DISATTIVARE I SENSORI; i valori rilevati dai sensori nella schermata INFO dell'App    #
#                                                                                           Mobile non saranno più disponibili e i relativi allarmi non verranno segnalati                                                #
#                                                                                                                                                                                                                         #
#                                                                                                                                                                                                                         #
#     LETTURA OGNI n SECONDI SULLO STATUS DELLA VENTOLA ATTRAVERSO IL SENSORE VMC_MASTER_STATUS_VENTOLA, CHE ASSUME IL VALORE LETTO NELL'INDICE [1] DELL'ARRAY, TRAMITE IL COMANDO PAYLOAD "VMGH?" INVIATO ALLA VMC       #
#                                                                                                                                                                                                                         #
#     ES: DI OUTPUT DI DEFAULT DELLA VMC:  VMGO,00001,00000,00000,00000,00000,00000,00000,00000,00000,00000,00000,00000,00000,00000,00000                                                                                 #
#     POSIZIONE INDICE ARRAY:              [0]  [1]   [2]   [3]   [4]   [5]   [6]   [7]   [8]   [9]   [10]  [11]  [12]  [13]  [14]  [15]                                                                                  #
#                                                                                                                                                                                                                         #
#                                               00000 = VELOCITA' 0     , ATTRAVERSO L'AUTOMAZIONE, LANCIA IL SERVIZIO: vmc_master_velocita_0                                                                             #
#                                               00001 = VELOCITA' 1     , ATTRAVERSO L'AUTOMAZIONE, LANCIA IL SERVIZIO: vmc_master_velocita_1                                                                             #
#                                               00002 = VELOCITA' 2     , ATTRAVERSO L'AUTOMAZIONE, LANCIA IL SERVIZIO: vmc_master_velocita_2                                                                             #
#                                               00003 = VELOCITA' 3     , ATTRAVERSO L'AUTOMAZIONE, LANCIA IL SERVIZIO: vmc_master_velocita_3                                                                             #
#                                               00004 = VELOCITA' 4     , ATTRAVERSO L'AUTOMAZIONE, LANCIA IL SERVIZIO: vmc_master_velocita_4                                                                             #
#                                               00005 = IPERVENTILAZIONE, ATTRAVERSO L'AUTOMAZIONE, LANCIA IL SERVIZIO: vmc_master_iperventilazione                                                                       #
#                                               00006 = NOTTE           , ATTRAVERSO L'AUTOMAZIONE, LANCIA IL SERVIZIO: vmc_master_notte                                                                                  #
#                                               00007 = FREECOOLING     , ATTRAVERSO L'AUTOMAZIONE, LANCIA IL SERVIZIO: vmc_master_freecooling                                                                            #
#                                                                                                                                                                                                                         #
###########################################################################################################################################################################################################################

################### Inizio Creazione Sensori di Lettura TEMPERATURA ESTERNA E UMITA' ESTERNA DELL'ENTITA' METEO INSTALLATA IN HOME ASSISTANT  #############################################################################
template:
  - sensor:
      - name: vmc_master_forecast_temp_esterna_status
        state: >
          {% set entity_id = states('input_select.vmc_master_selected_weather_entity') %}
          {% set temperature = state_attr(entity_id, 'temperature') %}
          {% if entity_id != 'Aggiorna Elenco Entità Meteo' and temperature is not none %}
            {{ temperature }}
          {% else %}
            0
          {% endif %}
        unit_of_measurement: "°C"

      - name: vmc_master_forecast_umidita_esterna_status
        state: >
          {% set entity_id = states('input_select.vmc_master_selected_weather_entity') %}
          {% set humidity = state_attr(entity_id, 'humidity') %}
          {% if entity_id != 'Aggiorna Elenco Entità Meteo' and humidity is not none %}
            {{ humidity }}
          {% else %}
            0
          {% endif %}
        unit_of_measurement: "%"
################### fINE Creazione Sensori di Lettura TEMPERATURA ESTERNA E UMITA' ESTERNA DELL'ENTITA' METEO INSTALLATA IN HOME ASSISTANT  ###############################################################################

################### Inizio Creazione Sensori Principali della VMC  ########################################################################################################################################################
command_line:
  - sensor:
      name: VMC_MASTER_STATUS_IP               # [CONFIGURAZIONE, PIU’ RICHIAMI] CREAZIONE DEL SENSORE PER VERIFICARE SE LA VMC E' ON-LINE O OFF-LINE
      command: "ping -c 1 192.168.1.160 >/dev/null && echo 'ON-Line' || echo 'OFF-Line'"
      scan_interval:
        seconds: 2                             # OGNI N° SECONDI RIPETE LA SCANSIONE 

sensor:
  - platform: tcp
    name: VMC_MASTER_STATUS_VENTOLA            # [CONFIGURAZIONE, PIU’ RICHIAMI] [INTERFACCIA, PIU’ RICHIAMI] CREAZIONE DEL SENSORE LETTURA STATI DI VENTILAZIONE; N.b non tutti i valori sono identificabili
    host: 192.168.1.160                        # INDIRIZZO IP DELLA VMC MASTER
    port: 5001                                 # PORTA 5001 DELLA VMC IMPOSTAZIONE DI DEFAULT
    timeout: 15
    payload: "VMGH?"                           # INVIO COMANDO VMGH? ALLA VMC MASTER, PER OTTENERE INFORMAZIONI SULLO STATO DI VENTILAZIONE DELLA VMC]
    scan_interval:                             # OGNI n SECONDI RIPETE LA SCANSIONE [SE SI COMANDA LA VMC CON IL TELECOMANDO L'AUTOMAZIONE LO RILEVERA' AD OGNI scan_interval -> seconds]
      seconds: 5                               # OGNI N° SECONDI RIPETE LA SCANSIONE

  - platform: tcp
    name: VMC_MASTER_SENSORI                   # [CONFIGURAZIONE, PIU’ RICHIAMI] [INTERFACCIA, PIU’ RICHIAMI] CREAZIONE DEL SENSORE LETTURA SENSORI; N.b non tutti i valori sono identificabili
    host: 192.168.1.160                        # INDIRIZZO IP DELLA VMC MASTER
    port: 5001                                 # PORTA 5001 DELLA VMC IMPOSTAZIONE DI DEFAULT
    timeout: 15
    payload: "VMGI?"                           # INVIO COMANDO VMGI? ALLA VMC MASTER, PER OTTENERE INFORMAZIONI SUI SENSORI DELLA VMC]
    scan_interval:
      seconds: 1200                            # OGNI N° SECONDI RIPETE LA SCANSIONE

  - platform: tcp
    name: VMC_MASTER_NOME                      # [CONFIGURAZIONE, PIU’ RICHIAMI] [INTERFACCIA, PIU’ RICHIAMI] CREAZIONE DEL SENSORE LETTURA NOME DELLA VMC
    host: 192.168.1.160                        # INDIRIZZO IP DELLA VMC MASTER
    port: 5001                                 # PORTA 5001 DELLA VMC IMPOSTAZIONE DI DEFAULT
    timeout: 15
    payload: "VMNM?"                           # INVIO COMANDO VMNM? ALLA VMC MASTER, PER OTTENERE INFORMAZIONI SUL NOME DELLA VMC]
    scan_interval:
      seconds: 43200                           # OGNI N° SECONDI RIPETE LA SCANSIONE

  - platform: tcp
    name: VMC_MASTER_LAN                       # [CONFIGURAZIONE, 0 RICHIAMI] [INTERFACCIA, PIU’ RICHIAMI] CREAZIONE DEL SENSORE LETTURA DATI LAN DELLA VMC; N.b non tutti i valori sono identificabili
    host: 192.168.1.160                        # INDIRIZZO IP DELLA VMC MASTER
    port: 5001                                 # PORTA 5001 DELLA VMC IMPOSTAZIONE DI DEFAULT
    timeout: 15
    payload: "VMSL?"                           # INVIO COMANDO VMSL? ALLA VMC MASTER, PER OTTENERE INFORMAZIONI SUI DATI LAN DELLA VMC]
    scan_interval:
      seconds: 43200                           # OGNI N° SECONDI RIPETE LA SCANSIONE

  - platform: rest
    name: vmc_master_versione_repository       # [CONFIGURAZIONE 0 RICHIAMI] [INTERFACCIA, PIU' RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI] SENSORE PER VISUALIZZARE LA VERSIONE CORRENTE NEL REPOSITORY DI GITHUB: https://github.com/DanRobo76/VMC-HELTY-FLOW DA CONFRONTARE CON LA VERSIONE CORRENTE INSTALLATA IN HOME ASSISTANT TRAMITE AUTOMAZIONE
    resource: https://api.github.com/repos/DanRobo76/VMC-HELTY-FLOW/releases/latest
    value_template: >-
      {% if value_json and value_json.tag_name %}
        {{ value_json.tag_name }}
      {% else %}
        Errore Connessione
      {% endif %}
    headers:
      Accept: application/vnd.github.v3+json
      Content-Type: application/json
      User-Agent: Home Assistant REST sensor
    scan_interval: 86400                        # OGNI N° SECONDI RIPETE LA SCANSIONE
    timeout: 10
################### Fine Creazione Sensori Principali della VMC  ##########################################################################################################################################################

################### Inizio Creazione Sensori di Lettura Collegamento tramite Status IP, Nome, Stato Ventola, Stato Sensoristico, Stato Led Pannello della VMC  ############################################################
  - platform: template
    sensors:
      vmc_master_versione_corrente:                                            # [CONFIGURAZIONE 0 RICHIAMI] [INTERFACCIA, PIU' RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI] SENSORE PER VISUALIZZARE LA VERSIONE CORRENTE INSTALLATA IN HOME ASSISTANT DA CONFRONTARE NEL REPOSITORY DI GITHUB: https://github.com/DanRobo76/VMC-HELTY-FLOW IN Releases TRAMITE AUTOMAZIONE
        friendly_name: "Package Ver."
        value_template: >
            v.4.3.0
        icon_template: mdi:check-decagram-outline

      vmc_master_verifica_ip_inserito:                                        # [CONFIGURAZIONE, 0 RICHIAMI] [INTERFACCIA, 0 RICHIAMI] [AUTOMAZIONE, PIU' RICHIAMI] VERIFICA DEL VALORE INSERIO NEL SENSORE "vmc_master_ip_insert" E' UN INDIRIZZO IP
        friendly_name: "IP"
        value_template: >
          {% if states.input_text.vmc_master_ip_insert.state is match("^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$") %}
            {{ states.input_text.vmc_master_ip_insert.state }}
          {% else %}
            IP non Valido    
          {% endif %}
        icon_template: mdi:ip    

      vmc_master_ip:                                                           # [CONFIGURAZIONE 0 RICHIAMI] [INTERFACCIA PIU’ RICHIAMI] SENSORE PER VISUALIZZARE L'IP NELL'INTERFACCIA
        friendly_name: "IP configurato su Porta 5001"
        value_template: >
            192.168.1.160
        icon_template: mdi:ip

      vmc_master_status_ip_interfaccia:                                        # [CONFIGURAZIONE 0 RICHIAMI] [INTERFACCIA, PIU’ RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI] SENSORE IMPIEGATO PER LA VISUALIZZAZIONE NELL'INTERFACCIA SE LA VMC E' IN RETE O MENO
        friendly_name: "Status VMC"
        value_template: >
          {% set stati = ['OFF-Line'] %}
          {{ 'OFF-Line' if states('sensor.vmc_master_status_ip') in stati else 'ON-Line' }}
        icon_template: >
          {% if states('sensor.vmc_master_status_ip') == 'OFF-Line' %}
            mdi:fan-alert
          {% else %}
            mdi:fan-chevron-down
          {% endif %}

      vmc_master_nome_status:                                                  # [CONFIGURAZIONE 0 RICHIAMI] [INTERFACCIA PIU’ RICHIAMI] SENSORE DI VERIFICA DI AVVENUTA LETTURA NOME MEMORIZZATA NELLA VMC
        friendly_name: "Nome"
        value_template: >
          {% set stati = ['unknown', 'unavailable'] %}
          {% set vmc_nome = states('sensor.vmc_master_nome') %}
          {% if vmc_nome.split(" ")|length >= 2 %}
            {{ vmc_nome.split(" ")[1] }}
          {% else %}
            Non disponibile
          {% endif %}
        icon_template: mdi:label-variant

      vmc_master_status_ventola_lettura_codice:                                # [CONFIGURAZIONE 0 RICHIAMI] SENSORE DI LETTURA DEI DATI "VELOCITA'" MEMORIZZATI NELLA VMC, PREVIA VERIFICA DI AVVENUTA LETTURA DEI DATI "VELOCITA'" MEMORIZZATI NELLA VMC
        friendly_name: "Codice Status Ventilazione"
        value_template: >
          {% set stati = ['unknown', 'unavailable'] %}
          {% set valid_stati = ['00000', '00001', '00002', '00003', '00004', '00005', '00006', '00007'] %}
          {% if states('sensor.vmc_master_status_ventola') in stati %}
            Non disponibile
          {% else %}
            {% set componenti = states('sensor.vmc_master_status_ventola').split(',') %}
            {% if componenti | length > 1 %}
              {% set codice_status = componenti[1] %}
              {{ codice_status if codice_status in valid_stati else 'Non disponibile' }}
            {% else %}
              Non disponibile
            {% endif %}
          {% endif %}
        icon_template: mdi:code-array

      vmc_master_status_ventola_lettura_codice_interpretato:                   # [CONFIGURAZIONE PIU' RICHIAMI] [INTERFACCIA 0] [AUTOMAZIONE, PIU’ RICHIAMI] SENSORE DI INTERPRETAZIONE DELLA LETTURA DEI DATI "VELOCITA'" MEMORIZZATI NELLA VMC CONVERITA IN "STRINGA", PREVIA VERIFICA DI AVVENUTA LETTURA DEI DATI "VELOCITA'"" MEMORIZZATI NELLA VMC
        friendly_name: "Status Ventilazione"
        value_template: >
          {% set stati = ['unknown', 'unavailable'] %}
          {% set codici = {'00000': 'Velocità 0', '00001': 'Velocità 1', '00002': 'Velocità 2', '00003': 'Velocità 3', 
                           '00004': 'Velocità 4', '00005': 'Iperventilazione', '00006': 'Notturna', '00007': 'Free Cooling'} %}
          {% if states('sensor.vmc_master_status_ventola') in stati %}
            Non disponibile
          {% else %}
            {% set componenti = states('sensor.vmc_master_status_ventola').split(',') %}
            {% if componenti | length > 1 %}
              {% set codice = componenti[1] %}
              {{ codici.get(codice, 'Non disponibile') }}
            {% else %}
              Non disponibile
            {% endif %}
          {% endif %}
        icon_template: mdi:fan

      vmc_master_status_ventola_lettura_codice_interpretato_interfaccia:       # [CONFIGURAZIONE 0 RICHIAMI] [INTERFACCIA, PIU’ RICHIAMI] [AUTOMAZIONE 0] SENSORE DI INTERPRETAZIONE DELLA LETTURA DEI DATI "VELOCITA'" MEMORIZZATI NELLA VMC CONVERITA IN "STRINGA" CON LA POSSIBILITA' DI VISUALIZZARE FREE COOLING O FREE HEATING O FREE C./H. (IN FUNZIONE DEL VALORE LETTO DEL SENSORE vmc_master_status_mese_corrente_freeheating_o_freecooling), PREVIA VERIFICA DI AVVENUTA LETTURA DEI DATI "VELOCITA'"" MEMORIZZATI NELLA VMC
        friendly_name: "Status Ventilazione"
        value_template: >
          {% set stati = ['unknown', 'unavailable'] %}
          {% set codici_base = {'00000': 'Velocità 0', '00001': 'Velocità 1', '00002': 'Velocità 2', '00003': 'Velocità 3',
                                '00004': 'Velocità 4', '00005': 'Iperventilazione', '00006': 'Notturna', '00007': 'Free Cooling'} %}
          {% if is_state('sensor.vmc_master_status_mese_corrente_freeheating_o_freecooling', 'Free Heating') %}
            {% set codici = {'00000': 'Velocità 0', '00001': 'Velocità 1', '00002': 'Velocità 2', '00003': 'Velocità 3',
                             '00004': 'Velocità 4', '00005': 'Iperventilazione', '00006': 'Notturna', '00007': 'Free Heating'} %}
          {% elif is_state('sensor.vmc_master_status_mese_corrente_freeheating_o_freecooling', 'Free Cooling') %}
            {% set codici = codici_base %}
          {% elif is_state('sensor.vmc_master_status_mese_corrente_freeheating_o_freecooling', 'Disabilitata') %}
            {% set codici = {'00000': 'Velocità 0', '00001': 'Velocità 1', '00002': 'Velocità 2', '00003': 'Velocità 3',
                             '00004': 'Velocità 4', '00005': 'Iperventilazione', '00006': 'Notturna', '00007': 'Free Cool./Heat.'} %}
          {% else %}
            {% set codici = codici_base %}
          {% endif %}
          {% if states('sensor.vmc_master_status_ventola') in stati %}
            Non disponibile
          {% else %}
            {% set componenti = states('sensor.vmc_master_status_ventola').split(',') %}
            {% if componenti | length > 1 %}
              {% set codice = componenti[1] %}
              {{ codici.get(codice, 'Non disponibile') }}
            {% else %}
              Non disponibile
            {% endif %}
          {% endif %}
        icon_template: mdi:fan

      vmc_master_status_sensori_lettura_codice_interpretato:                   # [CONFIGURAZIONE 0 RICHIAMI] [INTERFACCIA PIU’ RICHIAMI] SENSORE DI INTERPRETAZIONE DELL'ATTIVAZIONE O MENO DELLE ROUTINE MEMORIZZATE NELLA VMC (ES. SE PRESENTE ALLARME UMIDITA' -> MASSIMA VELOCITA'), CORRELATE AI SENSORI DELLA VMC CONVERITA IN "STRINGA", PREVIA VERIFICA DI AVVENUTA LETTURA DEI DATI "VELOCITA'" MEMORIZZATI NELLA VMC
        friendly_name: "Status Routine Sensori"
        value_template: >
          {% set stati = ['unknown', 'unavailable'] %}
          {% set codici = {'00003': 'Spenti', '00001': 'Accesi', '00002': 'Spenti', '00000': 'Accesi'} %}
          {% if states('sensor.vmc_master_status_ventola') in stati %}
            Non disponibile
          {% else %}
            {% set componenti = states('sensor.vmc_master_status_ventola').split(',') %}
            {% if componenti | length > 4 %}
              {% set codice = componenti[4] %}
              {{ codici.get(codice, 'Non disponibile') }}
            {% else %}
              Non disponibile
            {% endif %}
          {% endif %}
        icon_template: mdi:chip

      vmc_master_status_led_pannello_lettura_codice_interpretato:              # [CONFIGURAZIONE 0 RICHIAMI] [INTERFACCIA PIU’ RICHIAMI] SENSORE DI INTERPRETAZIONE DELLA LETTURA DELL'ATTIVAZIONE O MENO DEL PANNELLO LED MEMORIZZATI NELLA VMC, PREVIA VERIFICA DI AVVENUTA LETTURA DEI DATI "VELOCITA'" MEMORIZZATI NELLA VMC
        friendly_name: "Status Led Pannello"
        value_template: >
          {% set stati = ['unknown', 'unavailable'] %}
          {% if states('sensor.vmc_master_status_ventola') in stati %}
            Non disponibile
          {% else %}
            {% set componenti = states('sensor.vmc_master_status_ventola').split(',') %}
            {% if componenti | length > 14 %}
              {% set codice = componenti[14] %}
              {% if codice == '00000' %}
                Spento
              {% else %}
                Acceso
              {% endif %}
            {% else %}
              Non disponibile
            {% endif %}
          {% endif %}
        icon_template: mdi:led-on  
################### Fine Creazione Sensori di Lettura Collegamento tramite Status IP, Nome, Stato Ventola, Stato Sensoristico, Stato Led Pannello della VMC  #################################################################

################### Inizio Creazione Sensori di Lettura Temp. Interna, Esterna, Umidità, CO₂ e VOC della VMC  #################################################################################################################
      vmc_master_temp_interna_positivo_negativo:                               # [CONFIGURAZIONE, PIU’ RICHIAMI] SENSORE PER DETERMINARE SE IL VALORE DELLA TEMEPARTURA INTERNA SARA' POSITIVA O NEGATIVA; ATTENZIONE E' UNA PRESUNZIONE DELLO SCRIVENTE IN QUANTO NON HO MAI VISUALIZZATO UNA TEMPERATURA NEGATIVA NELLA VMC, VERIFICA CHE NELLA POSIZIONE DELL'ARRAY [1] IL PRIMO NUMERO E' 1 ES. [10200], OVVERO -20,0 °C
        friendly_name: "Segno Temperatura Interna"
        value_template: >
          {% set stati = ['unknown', 'unavailable'] %}
          {% if states('sensor.vmc_master_sensori') in stati %}
            Non disponibile
          {% else %}
            {% set componenti = states('sensor.vmc_master_sensori').split(',') %}
            {% if componenti | length > 1 %}
              {% set first_digit = componenti[1][0] %}
              {% if first_digit == '1' %}
                negativo
              {% else %}
                positivo
              {% endif %}
            {% else %}
              Non disponibile
            {% endif %}
          {% endif %}
        icon_template: mdi:home-thermometer

      vmc_master_temp_esterna_positivo_negativo:                               # [CONFIGURAZIONE, PIU’ RICHIAMI] SENSORE PER DETERMINARE SE IL VALORE DELLA TEMEPARTURA ESTERNA SARA' POSITIVA O NEGATIVA; ATTENZIONE E' UNA PRESUNZIONE DELLO SCRIVENTE IN QUANTO NON HO MAI VISUALIZZATO UNA TEMPERATURA NEGATIVA NELLA VMC, VERIFICA CHE NELLA POSIZIONE DELL'ARRAY [2] IL PRIMO NUMERO E' 1 ES. [10300], OVVERO -30,0 °C
        friendly_name: "Segno Temperatura Esterna"
        value_template: >
          {% set stati = ['unknown', 'unavailable'] %}
          {% if states('sensor.vmc_master_sensori') in stati %}
            Non disponibile
          {% else %}
            {% set componenti = states('sensor.vmc_master_sensori').split(',') %}
            {% if componenti | length > 2 %}
              {% set first_digit = componenti[2][0] %}
              {% if first_digit == '1' %}
                negativo
              {% else %}
                positivo
              {% endif %}
            {% else %}
              Non disponibile
            {% endif %}
          {% endif %}
        icon_template: mdi:home-thermometer-outline

      vmc_master_temp_interna_status:                                          # [CONFIGURAZIONE, PIU’ RICHIAMI] [INTERFACCIA, PIU’ RICHIAMI] SENSORE DI LETTURA TEMPERATURA INTERNA MEMORIZZATA NELLA VMC + OFFSET MANUALE, PREVIA VERIFICA DI AVVENUTA LETTURA DEI DATI "SENSORI" MEMORIZZATI NELLA VMC; ATTENZIONE NELLA PRESUNZIONE NEL CALCOLO DI VERIFICA SE LA TEMPERATURA E' POSITIVA O NEGATIVA; SE IL PRIMO VALORE DEL PRIMO CAMPO [1] DELL'ARRAY E' 1 IL CALCOLO VERRA' ESEGUITO ESCLUDENDO IL PRIMO VALORE [1][1:] ES. 10200 -> 0200 -> -20,0 °C
        friendly_name: "Temperatura Int. by VMC [°C]"
        value_template: >
          {% set stati = ['unknown', 'unavailable'] %}
          {% if states('sensor.vmc_master_sensori') in stati %}
            Non disponibile
          {% else %}
            {% set componenti = states('sensor.vmc_master_sensori').split(',') %}
            {% if componenti | length > 1 %}
              {% set raw_temp = componenti[1] %}
              {% set temp_interna_positivo = float(int(raw_temp) / 10) + float(states('input_number.vmc_master_offset_temp_interna')) %}
              {% set temp_interna_negativo = (- (float(int(raw_temp[1:]) / 10))) + float(states('input_number.vmc_master_offset_temp_interna')) %}
              {% if states('sensor.vmc_master_temp_interna_positivo_negativo') == "negativo" %}
                {{ temp_interna_negativo | round(1) }}
              {% else %}
                {{ temp_interna_positivo | round(1) }}
              {% endif %}
            {% else %}
              Non disponibile
            {% endif %}
          {% endif %}
        icon_template: mdi:home-thermometer

      vmc_master_temp_esterna_status_vmc:                                      # [CONFIGURAZIONE, PIU’ RICHIAMI] [INTERFACCIA, PIU’ RICHIAMI] SENSORE DI LETTURA TEMPERATUIRA ESTERNA  MEMORIZZATA NEL SENSORE vmc_master_forecast_temp_esterna_status + OFFSET MANUALE, PREVIA VERIFICA DI AVVENUTA LETTURA DEI DATI "SENSORI" MEMORIZZATI NELLA VMC; ATTENZIONE NELLA PRESUNZIONE NEL CALCOLO DI VERIFICA SE LA TEMPERATURA E' POSITIVA O NEGATIVA; SE IL PRIMO VALORE DEL SECONDO CAMPO [2] DELL'ARRAY E' 1 IL CALCOLO VERRA' ESEGUITO ESCLUDENDO IL PRIMO VALORE [2][1:] ES. 10200 -> 0200 -> -20,0 °C
        friendly_name: "Temperatura Ext. by VMC [°C]"
        value_template: >
          {% set stati = ['unknown', 'unavailable'] %}
          {% if states('sensor.vmc_master_sensori') in stati %}
            Non disponibile
          {% else %}
            {% set componenti = states('sensor.vmc_master_sensori').split(',') %}
            {% if componenti | length > 2 %}
              {% set raw_temp = componenti[2] %}
              {% set temp_esterna_positivo = float(int(raw_temp) / 10) + float(states('input_number.vmc_master_offset_temp_esterna')) %}
              {% set temp_esterna_negativo = (- (float(int(raw_temp[1:]) / 10))) + float(states('input_number.vmc_master_offset_temp_esterna')) %}
              {% if states('sensor.vmc_master_temp_esterna_positivo_negativo') == "negativo" %}
                {{ temp_esterna_negativo | round(1) }}
              {% else %}
                {{ temp_esterna_positivo | round(1) }}
              {% endif %}
            {% else %}
              Non disponibile
            {% endif %}
          {% endif %}
        icon_template: mdi:home-thermometer-outline

      vmc_master_temp_esterna_status:                                          # [CONFIGURAZIONE, 0 RICHIAMI] [INTERFACCIA, PIU’ RICHIAMI] SENSORE DI LETTURA TEMPERATUIRA ESTERNA  MEMORIZZATA NEL SENSORE vmc_master_forecast_temp_esterna_status + OFFSET MANUALE, PREVIA VERIFICA DI AVVENUTA LETTURA DEI DATI "SENSORI" MEMORIZZATI NELLA VMC
        friendly_name: "Temperatura Ext. by Meteo [°C]"
        value_template: >
          {% set stati = ['unknown', 'unavailable'] %}
          {% set temp_ext = states('sensor.vmc_master_forecast_temp_esterna_status') %}
          {% if states('sensor.vmc_master_sensori') in stati or temp_ext in stati %}
            Non disponibile
          {% else %}
            {% set temp_float = temp_ext | float(default='error') %}
            {% if temp_float == 'error' %}
              [Non Calcolabile]
            {% else %}
              {{ temp_float + float(states('input_number.vmc_master_offset_temp_esterna')) | round(1)}}
            {% endif %}
          {% endif %}
        icon_template: mdi:home-thermometer-outline
        
      vmc_master_temp_interna_status_senza_offset:                             # [CONFIGURAZIONE, PIU’ RICHIAMI] SENSORE DI LETTURA TEMPERATURA INTERNA MEMORIZZATA NELLA VMC SENZA OFFSET MANUALE, PREVIA VERIFICA DI AVVENUTA LETTURA DEI DATI "SENSORI" MEMORIZZATI NELLA VMC; ATTENZIONE NELLA PRESUNZIONE NEL CALCOLO DI VERIFICA SE LA TEMPERATURA E' POSITIVA O NEGATIVA; SE IL PRIMO VALORE DEL PRIMO CAMPO [1] DELL'ARRAY E' 1 IL CALCOLO VERRA' ESEGUITO ESCLUDENDO IL PRIMO VALORE [1][1:] ES. 10200 -> 0200 -> -20,0 °C
        friendly_name: "Temperatura Int. by VMC [°C] "
        value_template: >
          {% set stati = ['unknown', 'unavailable'] %}
          {% if states('sensor.vmc_master_sensori') in stati %}
            Non disponibile
          {% else %}
            {% set componenti = states('sensor.vmc_master_sensori').split(',') %}
            {% if componenti | length > 1 %}
              {% set raw_temp = componenti[1] %}
              {% set temp_interna_positivo = float(int(raw_temp) / 10) %}
              {% set temp_interna_negativo = (- (float(int(raw_temp[1:]) / 10))) %}
              {% if states('sensor.vmc_master_temp_interna_positivo_negativo') == "negativo" %}
                {{ temp_interna_negativo | round(1) }}
              {% else %}
                {{ temp_interna_positivo | round(1) }}
              {% endif %}
            {% else %}
              Non disponibile
            {% endif %}
          {% endif %}
        icon_template: mdi:home-thermometer

      vmc_master_temp_esterna_status_vmc_senza_offset:                         # [CONFIGURAZIONE, PIU’ RICHIAMI] SENSORE DI LETTURA TEMPERATUIRA ESTERNA  MEMORIZZATA NEL SENSORE vmc_master_forecast_temp_esterna_status SENZA OFFSET, PREVIA VERIFICA DI AVVENUTA LETTURA DEI DATI "SENSORI" MEMORIZZATI NELLA VMC; ATTENZIONE NELLA PRESUNZIONE NEL CALCOLO DI VERIFICA SE LA TEMPERATURA E' POSITIVA O NEGATIVA; SE IL PRIMO VALORE DEL SECONDO CAMPO [2] DELL'ARRAY E' 1 IL CALCOLO VERRA' ESEGUITO ESCLUDENDO IL PRIMO VALORE [2][1:] ES. 10200 -> 0200 -> -20,0 °C
        friendly_name: "Temperatura Ext. by VMC [°C]"
        value_template: >
          {% set stati = ['unknown', 'unavailable'] %}
          {% if states('sensor.vmc_master_sensori') in stati %}
            Non disponibile
          {% else %}
            {% set componenti = states('sensor.vmc_master_sensori').split(',') %}
            {% if componenti | length > 2 %}
              {% set raw_temp = componenti[2] %}
              {% set temp_esterna_positivo = float(int(raw_temp) / 10) %}
              {% set temp_esterna_negativo = (- (float(int(raw_temp[1:]) / 10))) %}
              {% if states('sensor.vmc_master_temp_esterna_positivo_negativo') == "negativo" %}
                {{ temp_esterna_negativo | round(1) }}
              {% else %}
                {{ temp_esterna_positivo | round(1) }}
              {% endif %}
            {% else %}
              Non disponibile
            {% endif %}
          {% endif %}
        icon_template: mdi:home-thermometer-outline

      vmc_master_temp_esterna_status_senza_offset:                             # [CONFIGURAZIONE, 0 RICHIAMI] [INTERFACCIA, PIU’ RICHIAMI] SENSORE DI LETTURA TEMPERATUIRA ESTERNA  MEMORIZZATA NEL SENSORE vmc_master_forecast_temp_esterna_status, SENZA OFFSET MANUALE, PREVIA VERIFICA DI AVVENUTA LETTURA DEI DATI "SENSORI" MEMORIZZATI NELLA VMC
        friendly_name: "Temperatura Ext. by Meteo [°C]"
        value_template: >
          {% set stati = ['unknown', 'unavailable'] %}
          {% set temp_ext = states('sensor.vmc_master_forecast_temp_esterna_status') %}
          {% if states('sensor.vmc_master_sensori') in stati or temp_ext in stati %}
            Non disponibile
          {% else %}
            {% set temp_float = temp_ext | float(default='error') %}
            {% if temp_float == 'error' %}
              [Non Calcolabile]
            {% else %}
              {{ temp_float | round(1) }}
            {% endif %}
          {% endif %}
        icon_template: mdi:home-thermometer-outline

      vmc_master_umidita_interna_status:                                         # [CONFIGURAZIONE, PIU’ RICHIAMI] [INTERFACCIA, PIU’ RICHIAMI] SENSORE DI LETTURA UMIDITA' INTERNA MEMORIZZATA NELLA VMC + OFFSET MANUALE, PREVIA VERIFICA DI AVVENUTA LETTURA DEI DATI "SENSORI" MEMORIZZATI NELLA VMC
        friendly_name: "Umidità Int. by VMC [%]"
        value_template: >
          {% set stati = ['unknown', 'unavailable'] %}
          {% set dati_sensori = states('sensor.vmc_master_sensori') %}
          {% if dati_sensori in stati %}
            Non disponibile
          {% else %}
            {% set componenti = dati_sensori.split(',') %}
            {% if componenti|length > 3 %}
              {% set umidita_relativa_raw = float(componenti[3]) / 10 %}
              {% set offset = float(states('input_number.vmc_master_offset_umidita_interna')) %}
              {% set umidita_relativa = umidita_relativa_raw + offset %}
              {% if umidita_relativa > 100 %}
                100
              {% elif umidita_relativa <= 0 %}
                [Non Calcolabile]
              {% else %}
                {{ umidita_relativa | round(1) }}
              {% endif %}
            {% else %}
              Non disponibile
            {% endif %}
          {% endif %}
        icon_template: mdi:cloud-percent

      vmc_master_umidita_interna_status_senza_offset:                            # [CONFIGURAZIONE 0 RICHIAMI] [INTERFACCIA, PIU’ RICHIAMI] SENSORE DI LETTURA UMIDITA' INTERNA MEMORIZZATA NELLA VMC SENZA OFFSET MANUALE, PREVIA VERIFICA DI AVVENUTA LETTURA DEI DATI "SENSORI" MEMORIZZATI NELLA VMC
        friendly_name: "Umidità Int. by VMC [%]"
        value_template: >
          {% set stati = ['unknown', 'unavailable'] %}
          {% set dati_sensori = states('sensor.vmc_master_sensori') %}
          {% if dati_sensori in stati %}
            Non disponibile
          {% else %}
            {% set componenti = dati_sensori.split(',') %}
            {% if componenti|length > 3 %}
              {% set umidita_relativa = (float(componenti[3]) / 10) %}
              {% if umidita_relativa > 100 %}
                100
              {% elif umidita_relativa <= 0 %}
                [Non Calcolabile]
              {% else %}
                {{ umidita_relativa | round(1) }}
              {% endif %}
            {% else %}
              Non disponibile
            {% endif %}
          {% endif %}
        icon_template: mdi:cloud-percent

      vmc_master_umidita_esterna_status:                                       # [CONFIGURAZIONE, PIU’ RICHIAMI] [INTERFACCIA, PIU’ RICHIAMI] SENSORE DI LETTURA UMIDITA' ESTERNA  MEMORIZZATA NEL SENSORE vmc_master_forecast_umidita_esterna_status + OFFSET MANUALE, PREVIA VERIFICA DI AVVENUTA LETTURA DEI DATI "SENSORI" MEMORIZZATI NELLA VMC
        friendly_name: "Umidità Ext. by Meteo [%]"
        value_template: >
          {% set stati = ['unknown', 'unavailable'] %}
          {% if states('sensor.vmc_master_sensori') in stati or states('sensor.vmc_master_forecast_umidita_esterna_status') in stati %}
            Non disponibile
          {% else %}
            {% set humidity = states('sensor.vmc_master_forecast_umidita_esterna_status') %}
            {% if humidity | float == none %}
              [Non Calcolabile]
            {% else %}
              {% set umidita_relativa_esterna = humidity | float + float(states('input_number.vmc_master_offset_umidita_esterna')) %}
              {% if umidita_relativa_esterna > 0 and umidita_relativa_esterna <= 100 %}
                {{ umidita_relativa_esterna }}
              {% elif umidita_relativa_esterna <= 0 %}
                [Non Calcolabile]
              {% else %}
                100
              {% endif %}
            {% endif %}
          {% endif %}
        icon_template: mdi:cloud-percent-outline

      vmc_master_umidita_esterna_status_senza_offset:                          # [CONFIGURAZIONE, 0 RICHIAMI] [INTERFACCIA, PIU’ RICHIAMI] SENSORE DI LETTURA UMIDITA' ESTERNA  MEMORIZZATA NEL SENSORE vmc_master_forecast_umidita_esterna_status, SENZA OFFSET MANUALE, PREVIA VERIFICA DI AVVENUTA LETTURA DEI DATI "SENSORI" MEMORIZZATI NELLA VMC
        friendly_name: "Umidità Ext. by Meteo [%]"
        value_template: >
          {% set stati = ['unknown', 'unavailable'] %}
          {% if states('sensor.vmc_master_sensori') in stati or states('sensor.vmc_master_forecast_umidita_esterna_status') in stati %}
            Non disponibile
          {% else %}
            {% set humidity = states('sensor.vmc_master_forecast_umidita_esterna_status') %}
            {% if humidity | float == none %}
              [Non Calcolabile]
            {% else %}
              {% set umidita_relativa_esterna = humidity | float %}
              {% if umidita_relativa_esterna > 0 and umidita_relativa_esterna <= 100 %}
                {{ umidita_relativa_esterna }}
              {% elif umidita_relativa_esterna <= 0 %}
                [Non Calcolabile]
              {% else %}
                100
              {% endif %}
            {% endif %}
          {% endif %}
        icon_template: mdi:cloud-percent-outline

      vmc_master_co2_status:                                                # [CONFIGURAZIONE] [INTERFACCIA] SENSORE DI LETTURA ANIDRIDE CARBONICA INTERNA MEMORIZZATA NELLA VMC + OFFSET MANUALE, PREVIA VERIFICA DI AVVENUTA LETTURA DEI DATI "SENSORI" MEMORIZZATI NELLA VMC
        friendly_name: "Anidride Carbonica, CO₂ Int. by VMC [ppm]"
        value_template: >
          {% set stati = ['unknown', 'unavailable'] %}
          {% set dati_sensori = states('sensor.vmc_master_sensori') %}
          {% if dati_sensori in stati %}
            Non disponibile
          {% else %}
            {% set componenti = dati_sensori.split(',') %}
            {% if componenti|length > 4 %}
              {% set co2 = float(componenti[4]) + float(states('input_number.vmc_master_offset_co2')) %}
              {% if co2 > 0 %}
                {{ co2|round(0) }}
              {% else %}
                -
              {% endif %}
            {% else %}
              Non disponibile
            {% endif %}
          {% endif %}
        icon_template: mdi:molecule-co2

      vmc_master_co2_status_senza_offset:                                        # [CONFIGURAZIONE] [INTERFACCIA] SENSORE DI LETTURA ANIDRIDE CARBONICA INTERNA MEMORIZZATA NELLA VMC SENZA OFFSET MANUALE, PREVIA VERIFICA DI AVVENUTA LETTURA DEI DATI "SENSORI" MEMORIZZATI NELLA VMC
        friendly_name: "Anidride Carbonica, CO₂ Int. by VMC [ppm]"
        value_template: >
          {% set stati = ['unknown', 'unavailable'] %}
          {% set dati_sensori = states('sensor.vmc_master_sensori') %}
          {% if dati_sensori in stati %}
            Non disponibile
          {% else %}
            {% set componenti = dati_sensori.split(',') %}
            {% if componenti|length > 4 %}
              {% set co2 = float(componenti[4]) %}
              {% if co2 > 0 %}
                {{ co2|round(0) }}
              {% else %}
                -
              {% endif %}
            {% else %}
              Non disponibile
            {% endif %}
          {% endif %}
        icon_template: mdi:molecule-co2

      vmc_master_voc_status:                                                    # [CONFIGURAZIONE] [INTERFACCIA] SENSORE DI LETTURA COMPOSTI ORGANICI VOLATICI INTERNI MEMORIZZATI NELLA VMC + OFFSET MANUALE TRASFORMATI DA PPB [DEFAULT VMC] IN PPM, PREVIA VERIFICA DI AVVENUTA LETTURA DEI DATI "SENSORI" MEMORIZZATI NELLA VMC
        friendly_name: "Composti Organici Volatici, VOC Int. by VMC [ppb]"
        value_template: >
          {% set stati = ['unknown', 'unavailable'] %}
          {% set dati_sensori = states('sensor.vmc_master_sensori') %}
          {% if dati_sensori in stati %}
            Non disponibile
          {% else %}
            {% set componenti = dati_sensori.split(',') %}
            {% if componenti|length > 11 %}
              {% set voc = float(componenti[11]) + float(states('input_number.vmc_master_offset_voc')) %}
              {% if voc > 0 %}
                {{ voc|round(0) }}
              {% else %}
                -
              {% endif %}
            {% else %}
              Non disponibile
            {% endif %}
          {% endif %}
        icon_template: mdi:weather-dust

      vmc_master_voc_status_senza_offset:                                       # [CONFIGURAZIONE] [INTERFACCIA] SENSORE DI LETTURA COMPOSTI ORGANICI VOLATICI INTERNI MEMORIZZATI NELLA VMC SENZA OFFSET MANUALE TRASFORMATI DA PPB [DEFAULT VMC] IN PPM, PREVIA VERIFICA DI AVVENUTA LETTURA DEI DATI "SENSORI" MEMORIZZATI NELLA VMC
        friendly_name: "Composti Organici Volatici, VOC Int. by VMC [ppb]"
        value_template: >
          {% set stati = ['unknown', 'unavailable'] %}
          {% set dati_sensori = states('sensor.vmc_master_sensori') %}
          {% if dati_sensori in stati %}
            Non disponibile
          {% else %}
            {% set componenti = dati_sensori.split(',') %}
            {% if componenti|length > 11 %}
              {% set voc = float(componenti[11]) %}
              {% if voc > 0 %}
                {{ voc|round(0) }}
              {% else %}
                -
              {% endif %}
            {% else %}
              Non disponibile
            {% endif %}
          {% endif %}
        icon_template: mdi:weather-dust
################### Fine Creazione Sensori di Lettura Temp. Interna, Esterna, Umidità, CO₂ e VOC della VMC  ################################################################################################################################################

################### Inizio Creazione Sensori per l'INTERFACCIA per la Lettura Umidità Verifica Superamento Lim. Δ P. di Rugiada, VMC Congelamento ≤ -18 [°C] Temp. Esterna ?, VMC Diff. Temp. Int-Est > 23 [°C] ? della VMC   ###################
      vmc_master_umidita_interna_status_verifica_soglia_valore:                # [CONFIGURAZIONE 0 RICHIAMI] [INTERFACCIA, PIU’ RICHIAMI] SENSORE MONITORAGGIO UMIDITA' INTERNA LETTA DALLA VMC
        friendly_name: "Livello di Umidità"
        value_template: >
          {% set stati = ['unknown', 'unavailable'] %}
          {% set umidita_soglia = states('sensor.vmc_master_umidita_interna_status') %}
          {% if umidita_soglia in stati %}
            [Non Calcolabile]
          {% else %}
            {% set umidita_soglia_float = umidita_soglia | float(default=none) %}
            {% if umidita_soglia_float is none %}
              [Non Calcolabile]
            {% else %}
              {% if umidita_soglia_float > 0 and umidita_soglia_float <= 35 %}
                UMIDITÀ AL {{ umidita_soglia_float }}%. POSSIBILE SECCHEZZA, DISIDRATAZIONE. SI CONSIGLIA DI UMIDIFICARE L'AMBIENTE.
              {% elif umidita_soglia_float > 35 and umidita_soglia_float <= 65 %}
                UMIDITÀ AL {{ umidita_soglia_float }}%. SITUAZIONE NORMALE.
              {% elif umidita_soglia_float > 65 and umidita_soglia_float <= 100 %}
                UMIDITÀ AL {{ umidita_soglia_float }}%. POTREBBE VERIFICARSI UNA PROLIFERAZIONE DI MUFFE E BATTERI. SI CONSIGLIA DI DEUMIDIFICARE L'AMBIENTE.
              {% else %}
                [Non Calcolabile]
              {% endif %}
            {% endif %}
          {% endif %}
        icon_template: mdi:water-percent

      vmc_master_punto_di_rugiada_verifica_confronto_valore:                   # [CONFIGURAZIONE 0 RICHIAMI] [INTERFACCIA, PIU’ RICHIAMI] SENSORE DI MONITORAGGIO DEL PUNTO DI RUGIADA ESTERNO - PUNTO DI RUGIADA INTERNO < DELTA (OVVERO IL VALORE DEL SENSORE vmc_master_offset_verifica_impiego_vmc [°C]); DIVERSAMENTE NON DEVE ESSERE IMPIEGATA LA VMC
        friendly_name: "Verifica Superamento Lim. Δ P. di Rugiada"
        value_template: >
          {% set stati = ['unknown', 'unavailable'] %}
          {% if states('sensor.vmc_master_sensori') in stati %}
            Non disponibile
          {% else %}
            {% set PdRi = states('sensor.vmc_master_punto_di_rugiada_interno') | float(0) %}
            {% set PdRe = states('sensor.vmc_master_punto_di_rugiada_esterno') | float(0) %}
            {% set Delta = states('input_number.vmc_master_offset_verifica_impiego_vmc') | float(0) %}
            {% if (states('sensor.vmc_master_punto_di_rugiada_interno_esterno_non_calcolabile') != '[Non Calcolabile]') %}
              {% if (PdRe - PdRi) < Delta %}
                Δ PUNTO DI RUGIADA RILEVATO {{ (PdRe - PdRi)|round(2) }} °C MINORE DI {{states('input_number.vmc_master_offset_verifica_impiego_vmc')}} °C DEL VALORE SETTATO.
              {% elif (PdRe - PdRi) == Delta %}
                Δ PUNTO DI RUGIADA RILEVATO {{ (PdRe - PdRi)|round(2) }} °C UGUALE A {{states('input_number.vmc_master_offset_verifica_impiego_vmc')}} °C DEL VALORE SETTATO.              
              {% else %}
                Δ PUNTO DI RUGIADA RILEVATO {{ (PdRe - PdRi)|round(2) }} °C MAGGIORE DI {{states('input_number.vmc_master_offset_verifica_impiego_vmc')}} °C DEL VALORE SETTATO.
              {% endif %}
            {% else %}
              [Non Calcolabile]
            {% endif %}
          {% endif %}
        icon_template: mdi:hvac

      vmc_master_punto_di_rugiada_valore:                                       # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, 0 RICHIAMI] [INTERFACCIA, PIU’ RICHIAMI] SENSORE DI MONITORAGGIO DEL PUNTO DI RUGIADA ESTERNO - PUNTO DI RUGIADA INTERNO
        friendly_name: "Δ Punto di Rugiada [Ext-Int] [°C]"
        value_template: >
          {% set stati = ['unknown', 'unavailable'] %}
          {% if states('sensor.vmc_master_sensori') in stati %}
           Non disponibile
          {% else %}
            {% set PdRi = states('sensor.vmc_master_punto_di_rugiada_interno') | float(0) %}
            {% set PdRe = states('sensor.vmc_master_punto_di_rugiada_esterno') | float(0) %}
            {% if (states('sensor.vmc_master_punto_di_rugiada_interno_esterno_non_calcolabile') != '[Non Calcolabile]') %}
              {{ (PdRe - PdRi)|round(2) }} 
            {% else %}
              [Non Calcolabile]
            {% endif %}
          {% endif %}
        icon_template: mdi:hvac

      vmc_master_congelamento_verifica_soglia_valore:                          # [CONFIGURAZIONE 0 RICHIAMI] [INTERFACCIA PIU’ RICHIAMI] SENSORE MONITORAGGIO CONGELAMENTO INTERNO NELLA VMC -> BLOCCO DELL'UNITA' PER DEFAULT, IMPARTITO DAL COSTRUTTORE
        friendly_name: "VMC Congelamento ≤ -18 [°C] Temp. Esterna ?"
        value_template: >
          {% set stati = ['unknown', 'unavailable'] %}
          {% if states('sensor.vmc_master_sensori') in stati %}
            Non disponibile
          {% else %}   
            {% set congelamento = states('sensor.vmc_master_temp_esterna_status') | float(0) %}
            {% if congelamento <= -18 %}
              ARRESTO DELLA VMC PER CONGELAMENTO. TEMPERATURA RILEVATA {{congelamento}} °C.
            {% elif congelamento > -18 and congelamento <= -15 %}
              VMC IN PROSSIMITÀ DI ARRESTO PER CONGELAMENTO. TEMPERATURA RILEVATA {{congelamento}} °C.
            {% else %}
              LA TEMPERATURA ESTERNA RILEVATA È DI {{states('sensor.vmc_master_temp_esterna_status')}} °C, NON C'È PERICOLO DI CONGELAMENTO DELLA VMC.
            {% endif %}
          {% endif %}   
        icon_template: mdi:hvac

      vmc_master_delta_temp_verifica_soglia_valore:                            # [CONFIGURAZIONE 0 RICHIAMI] [INTERFACCIA, PIU’ RICHIAMI] SENSORE MONITORAGGIO DIFFERENZA DI TEMPERATURA (> 23 GRADI [°C]) NELLA VMC -> VELOCITA' 1 DELL'UNITA' PER DEFAULT, IMPARTITO DAL COSTRUTTORE
        friendly_name: "VMC Diff. Temp. Int-Est > 23 [°C] ?"
        value_template: >
          {% set stati = ['unknown', 'unavailable'] %}
          {% if states('sensor.vmc_master_sensori') in stati %}
            Non disponibile
          {% else %}
            {% set temperatura_esterna = states('sensor.vmc_master_temp_esterna_status_senza_offset') | float(0) %}
            {% set temperatura_interna = states('sensor.vmc_master_temp_interna_status_senza_offset') | float(0) %}
            {% set congelamento = states('sensor.vmc_master_temp_esterna_status') | float(0) %}
            {% if temperatura_esterna == 'Non disponibile' or temperatura_interna == 'Non disponibile' %}
              [Non Disponibile]
            {% else %}
              {% set delta = (temperatura_interna - temperatura_esterna) | round(1) %}
              {% if delta > 23 and congelamento > -18 %}
                RILEVATA UNA DIFFERENZA TRA LA TEMP. INTERNA E TEMP. ESTERNA DI {{delta}} °C. LA VELOCITÀ VERRÀ IMPOSTATA SU VELOCITA' 1
              {% elif delta >= 20 and delta <= 23 and congelamento > -18 %}
                RILEVATA UNA DIFFERENZA TRA LA TEMP. INTERNA E TEMP. ESTERNA DI {{delta}} °C. POSSIBILE PROSSIMO CAMBIO DI VELOCITÀ A VELOCITA' 1
              {% else %}
                RILEVATA UNA DIFFERENZA TRA LA TEMP. INTERNA E TEMP. ESTERNA DI {{delta}} °C. NON È PREVISTO NESSUN CAMBIO DI VELOCITÀ.
              {% endif %}
            {% endif %}
          {% endif %}
        icon_template: mdi:hvac
################### Fine Creazione Sensori per l'INTERFACCIA per la Lettura Umidità, Verifica Superamento Lim. Δ P. di Rugiada, VMC Congelamento ≤ -18 [°C] Temp. Esterna ?, VMC Diff. Temp. Int-Est > 23 [°C] ? della VMC  ###################

################### Inizio Creazione Sensori di Monitoraggio per fare scattare i PopUp ove richiesto #############################################################################################################################
      vmc_master_umidita_interna_status_verifica_soglia:                       # [CONFIGURAZIONE POP-UP, PIU’ RICHIAMI] [INTERFACCIA, PIU’ RICHIAMI] SENSORE MONITORAGGIO UMIDITA' INTERNA LETTA DALLA VMC
        friendly_name: "Livello di Umidità"
        value_template: >
          {% set stati = ['unknown', 'unavailable'] %}
          {% if states('sensor.vmc_master_sensori') in stati %}
            Non disponibile
          {% else %}
            {% set umidita_soglia = states('sensor.vmc_master_umidita_interna_status') %}
            {% if umidita_soglia not in ['unknown', 'unavailable', '[Non Calcolabile]'] %}
              {% set umidita_float = umidita_soglia | float(default=none) %}
              {% if umidita_float is none %}
                [Non Calcolabile]
              {% else %}
                {% if umidita_float >= 1 and umidita_float <= 35 %}
                  Possibile Secchezza, Disidratazione
                {% elif umidita_float > 35 and umidita_float <= 65 %}
                  Normale
                {% elif umidita_float > 65 and umidita_float <= 100 %}
                  Possibile Muffe, Batteri
                {% else %}
                  [Non Calcolabile]
                {% endif %}
              {% endif %}
            {% else %}
              [Non Calcolabile]
            {% endif %}
          {% endif %}
        icon_template: mdi:alarm-light-outline

      vmc_master_co2_status_verifica_soglia:                                   # [CONFIGURAZIONE] [INTERFACCIA] SENSORE DI MONITORAGIO DELLA CONCENTRAZIONE DI ANIDRIDE CARBONICA, IN FUNZIONE DEL VALORE LETTO NEL SENSORE vmc_master_co2_status , FORNENDO UN LIVELLO DI ATTENZIONE; VALORE DI SOGLIA IMPOSTATO NELLA VMC DI DEFAULT 1200 PPM 
        friendly_name: "Livello di Concentrazione CO₂ [ppm]"
        value_template: >
          {% set stati = ['unknown', 'unavailable'] %}
          {% if states('sensor.vmc_master_sensori') in stati %}
            Non disponibile
          {% else %}        
            {% set co2 = states('sensor.vmc_master_co2_status') | float(0) %}
            {% if co2 <= 0 %}
              -
            {% elif co2 > 0 and co2 <= 350 %}
              Bassa Contentrazione
            {% elif co2 > 350 and co2 <= 600 %}
              Moderata Concentrazione
            {% elif co2 > 600 and co2 < 1200 %}
              Alta Concentrazione
            {% else %}
              Pessima Concentrazione
            {% endif %}
          {% endif %}
        icon_template: mdi:alarm-light-outline

      vmc_master_voc_status_verifica_soglia:                                   # [CONFIGURAZIONE] [INTERFACCIA] SENSORE DI MONITORAGIO DELLA CONCENTRAZIONE DEI COMPOSTI ORGANICI VOLATICI INTERNI, IN FUNZIONE DEL VALORE LETTO NEL SENSORE vmc_master_voc_status , FORNENDO UN LIVELLO DI ATTENZIONE; VALORE DI SOGLIA IMPOSTATO NELLA VMC DI DEFAULT 600 PPB
        friendly_name: "Livello di Concentrazione VOC [ppb]"
        value_template: >
          {% set stati = ['unknown', 'unavailable'] %}
          {% if states('sensor.vmc_master_sensori') in stati %}
            Non disponibile
          {% else %}  
            {% set voc = states('sensor.vmc_master_voc_status') | float(0) %}
            {% if voc <= 0 %}
              -
            {% elif voc > 0 and voc <= 300 %}
              Bassa Contentrazione
            {% elif voc > 300 and voc <= 600 %}
              Moderata Concentrazione
            {% else %}
              Pessima Concentrazione
            {% endif %}
          {% endif %}
        icon_template: mdi:alarm-light-outline

      vmc_master_congelamento_verifica_soglia:                                 # [CONFIGURAZIONE POP-UP, PIU’ RICHIAMI] [INTERFACCIA, PIU’ RICHIAMI] SENSORE MONITORAGGIO CONGELAMENTO INTERNO NELLA VMC -> BLOCCO DELL'UNITA' PER DEFAULT, IMPARTITO DAL COSTRUTTORE
        friendly_name: "VMC Congelamento ≤ -18 [°C] Temp. Esterna ?"
        value_template: >
          {% set stati = ['unknown', 'unavailable'] %}
          {% if states('sensor.vmc_master_sensori') in stati %}
            Non disponibile
          {% else %}
            {% set congelamento = states('sensor.vmc_master_temp_esterna_status') | float(0) %}
            {% if congelamento == 'Non disponibile' %}
              [Non Disponibile]
            {% elif congelamento <= -18 %}
              Si
            {% elif congelamento > -18 and congelamento <= -15 %}
              [No ma Prossimo]
            {% else %}
              No
            {% endif %}
          {% endif %}
        icon_template: mdi:alarm-light-outline

      vmc_master_delta_temp_verifica_soglia:                                   # [CONFIGURAZIONE POP-UP, PIU’ RICHIAMI] [INTERFACCIA, PIU’ RICHIAMI] SENSORE MONITORAGGIO DIFFERENZA DI TEMPERATURA (> 23 GRADI [°C]) NELLA VMC -> VELOCITA' 1 DELL'UNITA' PER DEFAULT, IMPARTITO DAL COSTRUTTORE
        friendly_name: "VMC Diff. Temp. Int-Est > 23 [°C] ?"
        value_template: >
          {% set stati = ['unknown', 'unavailable'] %}
          {% if states('sensor.vmc_master_sensori') in stati %}
            Non disponibile
          {% else %}
            {% set temperatura_esterna = states('sensor.vmc_master_temp_esterna_status_senza_offset') | float(0) %}
            {% set temperatura_interna = states('sensor.vmc_master_temp_interna_status_senza_offset') | float(0) %}
            {% set congelamento = states('sensor.vmc_master_temp_esterna_status') | float(0) %}
            {% if temperatura_esterna == 'Non disponibile' or temperatura_interna == 'Non disponibile' %}
              [Non Disponibile]
            {% else %}
              {% set delta = (temperatura_interna - temperatura_esterna) | round(1) %}
              {% if delta > 23 and congelamento > -18 %}
                Si
              {% elif (delta >= 20 and delta <= 23) and congelamento > -18 %}
                [No ma Prossimo]
              {% else %}
                No
              {% endif %}
            {% endif %}
          {% endif %}
        icon_template: mdi:alarm-light-outline

      vmc_master_punto_di_rugiada_interno:                                     # [CONFIGURAZIONE, PIU’ RICHIAMI] [INTERFACCIA, PIU’ RICHIAMI] SENSORE DI MONITORAGIO DEL PUNTO DI RUGIADA INTERNO, IN FUNZIONE DELLA TEMEPRATURA INTERNA ED UMIDITA' INTERNA LETTA DALLA VMC
        friendly_name: "Punto di Rugiada Int. [°C]"
        value_template: >
          {% set stati = ['unknown', 'unavailable'] %}
          {% if states('sensor.vmc_master_sensori') in stati %}
            Non disponibile
          {% else %}  
            {% set Rh = states('sensor.vmc_master_umidita_interna_status') | float(0) %}
            {% set Tc = states('sensor.vmc_master_temp_interna_status') | float(0) %}
            {% set Es = 6.11 * 10**((7.5*Tc)/(237.7+Tc)) %}
            {% set E = Es * Rh / 100 %}
            {% if ( ( Rh > 0 ) and ( Rh <= 100 ) and ( E > 0 ) ) %}
              {% set Dp = (-430.22 + 237.7 * log(E)) / (-log(E) + 19.08) %}
                {{ Dp|round(2) }}
            {% else %}
                [Non Calcolabile]
            {% endif %}
          {% endif %}
        icon_template: mdi:thermometer-water
        
      vmc_master_punto_di_rugiada_esterno:                                     # [CONFIGURAZIONE, PIU’ RICHIAMI] [INTERFACCIA, PIU’ RICHIAMI] SENSORE DI MONITORAGIO DEL PUNTO DI RUGIADA ESTERNO, IN FUNZIONE DELLA TEMEPRATURA ESTERNA LETTA DALLA VMC E DALL'UMNIDITA' ESTERNA LETTA DAL SENSORE vmc_master_selected_weather_entity
        value_template: >
          {% set stati = ['unknown', 'unavailable'] %}
          {% if states('sensor.vmc_master_sensori') in stati %}
            Non disponibile
          {% else %}  
            {% set Rh = states('sensor.vmc_master_umidita_esterna_status') | float(0) %}
            {% set Tc = states('sensor.vmc_master_temp_esterna_status') | float(0) %}
            {% set Es = 6.11 * 10**((7.5*Tc)/(237.7+Tc)) %}
            {% set E = Es * Rh / 100 %}
            {% if ( ( Rh > 0 ) and ( Rh <= 100 ) and ( E > 0 ) ) %}
              {% set Dp = (-430.22 + 237.7 * log(E)) / (-log(E) + 19.08) %}
                {{ Dp|round(2) }}
            {% else %}
                [Non Calcolabile]
            {% endif %}
          {% endif %}
        icon_template: mdi:water-thermometer-outline

      vmc_master_punto_di_rugiada_interno_esterno_non_calcolabile:             # [CONFIGURAZIONE PIU’ RICHIAMI] [AUTOMAZIONE 0 RICHIAMI] [INTERFACCIA 0] SENSORE DI MONITORAGGIO DEL PUNTO DI RUGIADA ESTERNO E PUNTO DI RUGIADA INTERNO DIVERSO DA "NON CALCOLABILE"
        friendly_name: "Verifica Punto di Rugiada Ext o Int se Calcolabile"
        value_template: >
          {% set stati = ['unknown', 'unavailable'] %}
          {% if states('sensor.vmc_master_sensori') in stati %}
           Non disponibile
          {% else %}
            {% set PdRi = states('sensor.vmc_master_punto_di_rugiada_interno') | float(0) %}
            {% set PdRe = states('sensor.vmc_master_punto_di_rugiada_esterno') | float(0) %}
            {% if (states('sensor.vmc_master_punto_di_rugiada_interno') == '[Non Calcolabile]') or (states('sensor.vmc_master_punto_di_rugiada_esterno') == '[Non Calcolabile]') %}
              [Non Calcolabile]
            {% else %}
              Si può impiegare
            {% endif %}
          {% endif %}
        icon_template: mdi:hvac

      vmc_master_punto_di_rugiada_verifica_confronto:                          # [CONFIGURAZIONE POP-UP, PIU’ RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI] [INTERFACCIA, PIU’ RICHIAMI] SENSORE DI MONITORAGGIO DEL PUNTO DI RUGIADA ESTERNO - PUNTO DI RUGIADA INTERNO < DELTA (OVVERO IL VALORE DEL SENSORE vmc_master_offset_verifica_impiego_vmc [°C]); DIVERSAMENTE NON DEVE ESSERE IMPIEGATA LA VMC
        friendly_name: "Verifica Lim. Δ P. di Rugiada"
        value_template: >
          {% set stati = ['unknown', 'unavailable'] %}
          {% if states('sensor.vmc_master_sensori') in stati %}
           Non disponibile
          {% else %}
            {% set PdRi = states('sensor.vmc_master_punto_di_rugiada_interno') | float(0) %}
            {% set PdRe = states('sensor.vmc_master_punto_di_rugiada_esterno') | float(0) %}
            {% set Delta = states('input_number.vmc_master_offset_verifica_impiego_vmc') | float(0) %}
            {% if (states('sensor.vmc_master_punto_di_rugiada_interno_esterno_non_calcolabile') != '[Non Calcolabile]') %}
              {% if (PdRe - PdRi) < Delta %}
                Si può impiegare
              {% else %}
                Se ne sconsiglia l'impiego
              {% endif %}
            {% else %}
              [Non Calcolabile]
            {% endif %}
          {% endif %}
        icon_template: mdi:alarm-light-outline

      vmc_master_umidita_assoluta_interna:                                     # [CONFIGURAZIONE O RICHIAMI] [INTERFACCIA, PIU’ RICHIAMI] SENSORE DI MONITORAGGIO DELL' UMIDITA' ASSOLUTA INTERNA
        friendly_name: "Umidità Assoluta Int. [g/m³]"
        value_template: >
          {% set stati = ['unknown', 'unavailable'] %}
          {% if states('sensor.vmc_master_sensori') in stati %}
            Non disponibile
          {% else %}
            {% set h = states('sensor.vmc_master_umidita_interna_status') | float(0) %}
            {% set t = states('sensor.vmc_master_temp_interna_status') | float(0) %}
            {% if h <= 0 or h == "Non Calcolabile" or t <= 0 %}
              [Non Calcolabile] 
            {% else %}
              {{ (h*6.112*2.1674*e**((t*17.67)/(t+243.5))/(t+273.15))|round(2) }}
            {% endif %}
          {% endif %}
        icon_template: mdi:cloud-percent

      vmc_master_umidita_assoluta_esterna:                                     # [CONFIGURAZIONE 0 RICHIAMI] [INTERFACCIA, PIU’ RICHIAMI] SENSORE DI MONITORAGGIO DELL' UMIDITA' ASSOLUTA INTERNA
        friendly_name: "Umidità Assoluta Ext. [g/m³]"
        value_template: >
          {% set stati = ['unknown', 'unavailable'] %}
          {% if states('sensor.vmc_master_sensori') in stati %}
            Non disponibile
          {% else %}
            {% set h = states('sensor.vmc_master_umidita_esterna_status') | float(0) %}
            {% set t = states('sensor.vmc_master_temp_esterna_status') | float(0) %}
            {% if h <= 0 or h == "Non Calcolabile" or t <= 0 %}
              [Non Calcolabile] 
            {% else %}
              {{ (h*6.112*2.1674*e**((t*17.67)/(t+243.5))/(t+273.15))|round(2) }}
            {% endif %}
          {% endif %}
        icon_template: mdi:cloud-percent-outline

      vmc_master_status_portata_ventola_lettura_codice_interpretato:           # [CONFIGURAZIONE, PIU’ RICHIAMI] [INTERFACCIA, PIU’ RICHIAMI] SENSORE DI LETTURA DEI DATI "VELOCITA'" MEMORIZZATI NELLA VMC CONVERITA IN PORTATA D'ARIA m3/h [AD ESCLUSIONE DELLA VELOCITA' NOTTURNA E Free Cool./Heat.], PREVIA VERIFICA DI AVVENUTA LETTURA DEI DATI "VELOCITA'"" MEMORIZZATI NELLA VMC
        friendly_name: "Portata d'Aria [M³/h]"
        value_template: >
          {% set stati = ['unknown', 'unavailable'] %}
          {% if states('sensor.vmc_master_status_ventola') in stati %}
            Non disponibile
          {% else %}
            {% set componenti = states('sensor.vmc_master_status_ventola').split(',') %}
            {% if componenti | length > 1 %}
              {% set codice = componenti[1] %}
              {% set codici = {'00000': '-', '00001': '10', '00002': '17', '00003': '26', '00004': '37', '00005': '42', '00006': '10', '00007': '-'} %}
              {{ codici.get(codice, 'Non disponibile') }}
            {% else %}
              Non disponibile
            {% endif %}
          {% endif %}
        icon_template: mdi:window-open-variant

      vmc_master_status_calcolo_portata_ventola:                               # [CONFIGURAZIONE 0 RICHIAMI] [INTERFACCIA, PIU’ RICHIAMI] SENSORE PER IL CALCOLO IN MINUTI NECESSARI PER UN CAMBIO TOTALE DELL'AMBIENTE
        friendly_name: "Tempo ricambio aria"
        value_template: >
          {% set stati = ['unknown', 'unavailable'] %}
          {% if states('sensor.vmc_master_sensori') in stati %}
            Non disponibile
          {% else %}
            {% if states('sensor.vmc_master_status_portata_ventola_lettura_codice_interpretato') not in ['-', '0'] and states('input_number.vmc_master_volume_da_inserire') | float(0) != 0%}
              {% set volume = states('input_number.vmc_master_volume_da_inserire') | float(0) %}
              {% set portata = states('sensor.vmc_master_status_portata_ventola_lettura_codice_interpretato') | float(0) %}
              {% if portata != 0 %}
              {% set tempo_minuti = ((volume/portata)*60)|round(0) %}
              {% set ore = tempo_minuti // 60 %}
              {% set minuti = tempo_minuti % 60 %}
                {% if ore == 0 %}
                  {{ minuti }} minuti
                {% elif minuti == 0 %}
                  {{ ore }} ore
                {% else %}
                  {{ ore }} ore e {{ minuti }} minuti
                {% endif %}
              {% else %}
                -
              {% endif %}
            {% else %}
              -
            {% endif %}
          {% endif %}
        icon_template: mdi:home-clock-outline
################### Fine Creazione Sensori di Monitoraggio per fare scattare i PopUp ove richiesto ###########################################################################################################################

########################################################################################### INIZIO SENSORI PER POP-UP MONITORAGGIO ###########################################################################################
      vmc_master_alert_monitoraggio_umidita:                                    # [CONFIGURAZIONE, PIU’ RICHIAMI] [INTERFACCIA, PIU’ RICHIAMI] SENSORE POP-UP MONITORAGGIO UMIDITA'; SENSORE MONITORAGGIO SCHEDA AVVISI 
        friendly_name: "Monitoraggio Umidità"
        value_template: >
          {% set stati = ['unknown', 'unavailable'] %}
          {% if states('sensor.vmc_master_sensori') in stati %}
            Non disponibile
          {% else %}
            {% set umidità = states('sensor.vmc_master_umidita_interna_status_verifica_soglia') %}
            {% if (umidità == 'Possibile Secchezza, Disidratazione') or (umidità == 'Possibile Muffe, Batteri') %}
              Allerta
            {% else %}
              Nessuna Allerta
            {% endif %}
          {% endif %}
        icon_template: mdi:alarm-light-outline

      vmc_master_alert_monitoraggio_co2:                                        # [CONFIGURAZIONE] [AUTOMAZIONE] SENSORE POP-UP MONITORAGGIO SUPERAMENTO DEL Livello di Concentrazione CO₂ [ppm]
        friendly_name: "Monitoraggio CO₂"
        value_template: >
          {% set stati = ['unknown', 'unavailable'] %}
          {% if states('sensor.vmc_master_sensori') in stati %}
            Non disponibile
          {% else %}
            {% set co2 = states('sensor.vmc_master_co2_status_verifica_soglia') %}
            {% if ( (co2 == 'Moderata Concentrazione') or (co2 == 'Alta Concentrazione') or (co2 == 'Pessima Concentrazione') ) %}
              Allerta
            {% else %}
              Nessuna Allerta
            {% endif %}
          {% endif %}
        icon_template: mdi:alarm-light-outline

      vmc_master_alert_monitoraggio_voc:                                        # [CONFIGURAZIONE] [AUTOMAZIONE] SENSORE POP-UP MONITORAGGIO SUPERAMENTO DEL Livello di Concentrazione VOC [ppb]
        friendly_name: "Monitoraggio VOC"
        value_template: >
          {% set stati = ['unknown', 'unavailable'] %}
          {% if states('sensor.vmc_master_sensori') in stati %}
            Non disponibile
          {% else %}
            {% set voc = states('sensor.vmc_master_voc_status_verifica_soglia') %}
            {% if ( (voc == 'Moderata Concentrazione') or (voc == 'Pessima Concentrazione') ) %}
              Allerta
            {% else %}
              Nessuna Allerta
            {% endif %}
          {% endif %}
        icon_template: mdi:alarm-light-outline

      vmc_master_alert_monitoraggio_pdr:                                        # [CONFIGURAZIONE, PIU’ RICHIAMI] [INTERFACCIA, PIU’ RICHIAMI] SENSORE POP-UP MONITORAGGIO Verifica uso VMC? OVVERO SUPERAMENTO DEL Set Lim. Δ Punto di Rugiada; SENSORE MONITORAGGIO SCHEDA AVVISI 
        friendly_name: "Superamento Lim. Δ Punto di Rugiada"
        value_template: >
          {% set stati = ['unknown', 'unavailable'] %}
          {% if states('sensor.vmc_master_sensori') in stati %}
            Non disponibile
          {% else %}
            {% set PdRvc = states('sensor.vmc_master_punto_di_rugiada_verifica_confronto') %}            
            {% if ( PdRvc == 'Se ne sconsiglia l\'impiego' ) %}
              Allerta
            {% else %}
              Nessuna Allerta
            {% endif %}
          {% endif %}
        icon_template: mdi:alarm-light-outline

      vmc_master_alert_monitoraggio_congelamento:                               # [CONFIGURAZIONE, PIU’ RICHIAMI] [INTERFACCIA, PIU’ RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI]SENSORE POP-UP MONITORAGGIO VMC Congelamento ≤ -18 [°C] Temp. Esterna ?; SENSORE MONITORAGGIO SCHEDA AVVISI 
        friendly_name: "Monitoraggio Congelamento"
        value_template: >
          {% set stati = ['unknown', 'unavailable'] %}
          {% if states('sensor.vmc_master_sensori') in stati %}
            Non disponibile
          {% else %}
            {% set congelamento = states('sensor.vmc_master_congelamento_verifica_soglia') %}            
            {% if ( (congelamento == 'Si') ) %}
              Allerta
            {% else %}
              Nessuna Allerta
            {% endif %}
          {% endif %}
        icon_template: mdi:alarm-light-outline

      vmc_master_alert_monitoraggio_delta:                                      # [CONFIGURAZIONE, PIU’ RICHIAMI] [INTERFACCIA, PIU’ RICHIAMI] SENSORE POP-UP MONITORAGGIO VMC Diff. Temp. Int-Est > 23 [°C] ?; SENSORE MONITORAGGIO SCHEDA AVVISI 
        friendly_name: "Monitoraggio Diff. Temp. Int-Est > 23 [°C]"
        value_template: >
          {% set stati = ['unknown', 'unavailable'] %}
          {% if states('sensor.vmc_master_sensori') in stati %}
            Non disponibile
          {% else %}
            {% set delta = states('sensor.vmc_master_delta_temp_verifica_soglia') %}
            {% if ( (delta == 'Si') ) %}
              Allerta
            {% else %}
              Nessuna Allerta
            {% endif %}
          {% endif %}
        icon_template: mdi:alarm-light-outline

      vmc_master_alert_monitoraggio_free_heating_o_free_cooling:                                      # [CONFIGURAZIONE, PIU’ RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI] [INTERFACCIA, 0 RICHIAMI] SENSORE MONITORAGGIO IMPIEGO DELLA VELOCITA' FREE HEATING/ FREE COOLING
        friendly_name: "Monitoraggio Free H./C."
        value_template: >
          {% set stati = ['unknown', 'unavailable'] %}
          {% if states('sensor.vmc_master_sensori') in stati %}
            Non disponibile
          {% else %}
            {% set automazione_free_cooling = states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_freecooling') %}
            {% set automazione_free_heating = states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_freeheating') %} 
            {% set tipologia = states('sensor.vmc_master_status_mese_corrente_freeheating_o_freecooling') %}
            {% set velocita = states('sensor.vmc_master_status_ventola_lettura_codice_interpretato') %}
            {% set temp_interna = states('sensor.vmc_master_temp_interna_status') | float(0) %}
            {% set temp_esterna = states('sensor.vmc_master_temp_esterna_status') | float(0) %}
            {% if   ( (tipologia == "Free Heating") and (velocita == "Free Cooling") and (automazione_free_heating == "on") and ((temp_interna > temp_esterna) | float(0)) )%}
              Allerta Free Heating Programmato (Raffrescamento in atto)
            {% elif ( (tipologia == "Free Heating") and (velocita == "Free Cooling") and ((temp_interna > temp_esterna) | float(0)) )%}
              Allerta Raffrescamento in atto
            {% elif ( (tipologia == "Free Cooling") and (velocita == "Free Cooling") and (automazione_free_cooling == "on") and ((temp_esterna > temp_interna) | float(0)) ) %}
              Allerta Free Cooling Programmato (Riscaldamento in atto)
            {% elif ( (tipologia == "Free Cooling") and (velocita == "Free Cooling") and ((temp_esterna > temp_interna) | float(0)) ) %}
              Allerta Riscaldamento in atto
            {% elif ( (tipologia == "Disabilitata") and (velocita == "Free Cooling") and ((temp_interna > temp_esterna) | float(0)) ) %}
              Raffrescamento in atto
            {% elif ( (tipologia == "Disabilitata") and (velocita == "Free Cooling") and ((temp_esterna > temp_interna) | float(0)) ) %}
              Riscaldamento in atto
            {% else %}
              Nessuna Allerta
            {% endif %}   
          {% endif %}
        icon_template: mdi:alarm-light-outline

      vmc_master_alert_monitoraggio_free_heating_o_free_cooling_allert_interfaccia_avvisi:                                      # [CONFIGURAZIONE, PIU' RICHIAMI] [AUTOMAZIONE, 0 RICHIAMI] [INTERFACCIA, PIU’ RICHIAMI] SENSORE MONITORAGGIO IMPIEGO DELLA VELOCITA' FREE HEATING/ FREE COOLING -- IMPIEGO DEGLI AVVISI NEI POP-UP INTERFACCIA (VEDERE NUMERAZIONE)
        friendly_name: "Free H./C."
        value_template: >
          {% set stati = ['unknown', 'unavailable'] %}
          {% if states('sensor.vmc_master_sensori') in stati %}
            Non disponibile
          {% else %}
            {% set spia_free_cooling = states('input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio_per_programmazione_freecooling') %}
            {% set spia_free_heating = states('input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio_per_programmazione_freeheating') %}
            {% set co2 = states('sensor.vmc_master_alert_monitoraggio_co2') %}
            {% set voc = states('sensor.vmc_master_alert_monitoraggio_voc') %}  
            {% set automazione_free_cooling = states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_freecooling') %}
            {% set automazione_free_heating = states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_freeheating') %} 
            {% set tipologia = states('sensor.vmc_master_status_mese_corrente_freeheating_o_freecooling') %}
            {% set velocita = states('sensor.vmc_master_status_ventola_lettura_codice_interpretato') %}
            {% set temp_interna = states('sensor.vmc_master_temp_interna_status') | float(0) %}
            {% set temp_esterna = states('sensor.vmc_master_temp_esterna_status') | float(0) %} 

            {# ------------------------------------- INIZIO FREE HEATING ------------------------------ #}
            {# 1 #}
            {% if ( tipologia == "Free Heating" and velocita == "Velocità 0" and automazione_free_heating == "on" and temp_interna > temp_esterna | float(0) and spia_free_heating=="on" and ((co2 !="Allerta") and (voc !="Allerta")) ) %}
              Allerta Free Heating Programmato (Raffrescamento Arrestato)
            {# 2 #}
            {% elif ( tipologia == "Free Heating" and velocita == "Free Cooling" and automazione_free_heating == "on" and temp_interna > temp_esterna | float(0) and spia_free_heating=="on" and ((co2 =="Allerta") or (voc =="Allerta")) ) %}
              Allerta Free Heating Programmato (Raffrescamento in atto, Presenza di Inquinanti)
            {# 3 #}
            {% elif ( tipologia == "Free Heating" and velocita == "Velocità 0" and automazione_free_heating == "on" and temp_interna > temp_esterna | float(0) and spia_free_heating=="on" and ((co2 =="Allerta") or (voc =="Allerta")) ) %}
              Allerta Free Heating Programmato (Raffrescamento Arrestato, Presenza di Inquinanti)
            {# 4 #}
            {% elif ( tipologia == "Free Heating" and velocita == "Free Cooling" and automazione_free_heating == "on" and temp_interna > temp_esterna | float(0) and spia_free_heating=="on" and ((co2 !="Allerta") and (voc !="Allerta")) ) %}
              Allerta Free Heating Programmato (Raffrescamento in atto)
            {# 5 #}
            {% elif ( tipologia == "Free Heating" and velocita == "Free Cooling" and automazione_free_heating == "on" and temp_interna > temp_esterna | float(0) and spia_free_heating=="off" and ((co2 =="Allerta") or (voc =="Allerta")) ) %}
              Allerta Free Heating Programmato (Raffrescamento in atto, Presenza di Inquinanti)
            {# 6 #}
            {% elif ( tipologia == "Free Heating" and velocita == "Free Cooling" and automazione_free_heating == "on" and temp_interna > temp_esterna | float(0) and spia_free_heating=="off" and ((co2 !="Allerta") and (voc !="Allerta")) ) %}
              Allerta Free Heating Programmato (Raffrescamento in atto)
            {# 7 #}
            {% elif ( tipologia == "Free Heating" and velocita != "Velocità 0" and  velocita != "Free Cooling" and automazione_free_heating == "on" and temp_interna > temp_esterna | float(0) and spia_free_heating=="on" and ((co2 !="Allerta") and (voc !="Allerta")) ) %}
              Allerta Free Heating Programmato (Raffrescamento Arrestato)
            {# 8 #}
            {% elif ( tipologia == "Free Heating" and velocita != "Velocità 0" and  velocita != "Free Cooling" and automazione_free_heating == "on" and temp_interna > temp_esterna | float(0) and spia_free_heating=="on" and ((co2 =="Allerta") or (voc =="Allerta")) ) %}
              Allerta Free Heating Programmato (Raffrescamento Arrestato, Presenza di Inquinanti)
            {# 9 #}
            {% elif ( tipologia == "Free Heating" and velocita == "Free Cooling" and automazione_free_heating == "on" and temp_interna <= temp_esterna | float(0) and ((co2 !="Allerta") and (voc !="Allerta")) ) %}
              Nessuna Allerta Free Heating Programmato
            {# 10 #}
            {% elif ( tipologia == "Free Heating" and velocita == "Free Cooling" and automazione_free_heating == "on" and temp_interna <= temp_esterna | float(0) and ((co2 =="Allerta") or (voc =="Allerta")) ) %}
              Nessuna Allerta Free Heating Programmato, Presenza di Inquinanti
            {# 11 #}
            {% elif ( tipologia == "Free Heating" and velocita == "Velocità 0" and automazione_free_heating == "on" and temp_interna <= temp_esterna | float(0) and ((co2 !="Allerta") and (voc !="Allerta")) ) %}
              Nessuna Allerta Free Heating Programmato
            {# 12 #}
            {% elif ( tipologia == "Free Heating" and velocita == "Velocità 0" and automazione_free_heating == "on" and temp_interna <= temp_esterna | float(0) and ((co2 =="Allerta") or (voc =="Allerta")) ) %}
              Nessuna Allerta Free Heating Programmato, Presenza di Inquinanti
            {# 13 #}
            {% elif ( tipologia == "Free Heating" and velocita != "Free Cooling" and automazione_free_heating == "on" and temp_interna > temp_esterna | float(0) and spia_free_heating=="off") and ((co2 !="Allerta") and (voc !="Allerta"))%}
              Non Avviare in Velocità Free Heating Programmato (Allerta Raffrescamento)
            {# 14 #}
            {% elif ( tipologia == "Free Heating" and velocita != "Free Cooling" and automazione_free_heating == "on" and temp_interna > temp_esterna | float(0) and spia_free_heating=="off") and ((co2 =="Allerta") or (voc =="Allerta"))%}
              Non Avviare in Velocità Free Heating Programmato (Allerta Raffrescamento, Presenza di Inquinanti)
            {# 15 #}
            {% elif ( tipologia == "Free Heating" and velocita != "Velocità 0" and  velocita != "Free Cooling" and automazione_free_heating == "on" and temp_interna <= temp_esterna | float(0) and ((co2 !="Allerta") and (voc !="Allerta")) ) %}
              Nessuna Allerta Free Heating Programmato
            {# 16 #}
            {% elif ( tipologia == "Free Heating" and velocita != "Velocità 0" and  velocita != "Free Cooling" and automazione_free_heating == "on" and temp_interna <= temp_esterna | float(0) and ((co2 =="Allerta") or (voc =="Allerta")) ) %}
              Nessuna Allerta Free Heating Programmato, Presenza di Inquinanti

            {# ------------------------------------- INIZIO FREE COOLING ------------------------------ #}
            {# 1 #}
            {% elif ( tipologia == "Free Cooling" and velocita == "Velocità 0" and automazione_free_cooling == "on" and temp_esterna > temp_interna | float(0) and spia_free_cooling=="on" and ((co2 !="Allerta") and (voc !="Allerta")) ) %}
              Allerta Free Cooling Programmato (Riscaldamento Arrestato)
            {# 2 #}
            {% elif ( tipologia == "Free Cooling" and velocita == "Free Cooling" and automazione_free_cooling == "on" and temp_esterna > temp_interna | float(0) and spia_free_cooling=="on" and ((co2 =="Allerta") or (voc =="Allerta")) ) %}
              Allerta Free Cooling Programmato (Riscaldamento in atto, Presenza di Inquinanti)
            {# 3 #}
            {% elif ( tipologia == "Free Cooling" and velocita == "Velocità 0" and automazione_free_cooling == "on" and temp_esterna > temp_interna | float(0) and spia_free_cooling=="on" and ((co2 =="Allerta") or (voc =="Allerta")) ) %}
              Allerta Free Cooling Programmato (Riscaldamento Arrestato, Presenza di Inquinanti)
            {# 4 #}
            {% elif ( tipologia == "Free Cooling" and velocita == "Free Cooling" and automazione_free_cooling == "on" and temp_esterna > temp_interna | float(0) and spia_free_cooling=="on" and ((co2 !="Allerta") and (voc !="Allerta")) ) %}
              Allerta Free Cooling Programmato (Riscaldamento in atto)
            {# 5 #}
            {% elif ( tipologia == "Free Cooling" and velocita == "Free Cooling" and automazione_free_cooling == "on" and temp_esterna > temp_interna | float(0) and spia_free_cooling=="off" and ((co2 =="Allerta") or (voc =="Allerta")) ) %}
              Allerta Free Cooling Programmato (Riscaldamento in atto, Presenza di Inquinanti)
            {# 6 #}
            {% elif ( tipologia == "Free Cooling" and velocita == "Free Cooling" and automazione_free_cooling == "on" and temp_esterna > temp_interna | float(0) and spia_free_cooling=="off" and ((co2 !="Allerta") and (voc !="Allerta")) ) %}
              Allerta Free Cooling Programmato (Riscaldamento in atto)
            {# 7 #}
            {% elif ( tipologia == "Free Cooling" and velocita != "Velocità 0" and  velocita != "Free Cooling" and automazione_free_cooling == "on" and temp_esterna > temp_interna | float(0) and spia_free_cooling=="on" and ((co2 !="Allerta") and (voc !="Allerta")) ) %}
              Allerta Free Cooling Programmato (Riscaldamento Arrestato)
            {# 8 #}
            {% elif ( tipologia == "Free Cooling" and velocita != "Velocità 0" and  velocita != "Free Cooling" and automazione_free_cooling == "on" and temp_esterna > temp_interna | float(0) and spia_free_cooling=="on" and ((co2 =="Allerta") or (voc =="Allerta")) ) %}
              Allerta Free Cooling Programmato (Riscaldamento Arrestato, Presenza di Inquinanti)
            {# 9 #}
            {% elif ( tipologia == "Free Cooling" and velocita == "Free Cooling" and automazione_free_cooling == "on" and temp_esterna <= temp_interna | float(0) and ((co2 !="Allerta") and (voc !="Allerta")) ) %}
              Nessuna Allerta Free Cooling Programmato
            {# 10 #}
            {% elif ( tipologia == "Free Cooling" and velocita == "Free Cooling" and automazione_free_cooling == "on" and temp_esterna <= temp_interna | float(0) and ((co2 =="Allerta") or (voc =="Allerta")) ) %}
              Nessuna Allerta Free Cooling Programmato, Presenza di Inquinanti
            {# 11 #}
            {% elif ( tipologia == "Free Cooling" and velocita == "Velocità 0" and automazione_free_cooling == "on" and temp_esterna <= temp_interna | float(0) and ((co2 !="Allerta") and (voc !="Allerta")) ) %}
              Nessuna Allerta Free Cooling Programmato
            {# 12 #}
            {% elif ( tipologia == "Free Cooling" and velocita == "Velocità 0" and automazione_free_cooling == "on" and temp_esterna <= temp_interna | float(0) and ((co2 =="Allerta") or (voc =="Allerta")) ) %}
              Nessuna Allerta Free Cooling Programmato, Presenza di Inquinanti
            {# 13 #}
            {% elif ( tipologia == "Free Cooling" and velocita != "Free Cooling" and automazione_free_cooling == "on" and temp_esterna > temp_interna | float(0) and spia_free_cooling=="off") and ((co2 !="Allerta") and (voc !="Allerta"))%}
              Non Avviare in Velocità Free Cooling Programmato (Allerta Riscaldamento)
            {# 14 #}
            {% elif ( tipologia == "Free Cooling" and velocita != "Free Cooling" and automazione_free_cooling == "on" and temp_esterna > temp_interna | float(0) and spia_free_cooling=="off") and ((co2 =="Allerta") or (voc =="Allerta"))%}
              Non Avviare in Velocità Free Cooling Programmato (Allerta Riscaldamento, Presenza di Inquinanti)
            {# 15 #}
            {% elif ( tipologia == "Free Cooling" and velocita != "Velocità 0" and  velocita != "Free Cooling" and automazione_free_cooling == "on" and temp_esterna <= temp_interna | float(0) and ((co2 !="Allerta") and (voc !="Allerta")) ) %}
              Nessuna Allerta Free Cooling Programmato
            {# 16 #}
            {% elif ( tipologia == "Free Cooling" and velocita != "Velocità 0" and  velocita != "Free Cooling" and automazione_free_cooling == "on" and temp_esterna <= temp_interna | float(0) and ((co2 =="Allerta") or (voc =="Allerta")) ) %}
              Nessuna Allerta Free Cooling Programmato, Presenza di Inquinanti


            {# ------------------------------------- INIZIO FREE HEATING, FREE HEATING DISABILITATO ------------------------------ #}
            {# 33 #}
            {% elif ( tipologia == "Disabilitata" and velocita == "Free Cooling" and temp_interna > temp_esterna | float(0) and ((co2 !="Allerta") and (voc !="Allerta")) ) %}
              Allerta Raffrescamento in atto
            {# 34 #}
            {% elif ( tipologia == "Disabilitata" and velocita == "Free Cooling" and temp_interna > temp_esterna | float(0) and ((co2 =="Allerta") or (voc =="Allerta")) ) %}
              Allerta Raffrescamento in atto, Presenza di Inquinanti
            {# 35 #}
            {% elif ( tipologia == "Disabilitata" and velocita == "Free Cooling" and temp_esterna > temp_interna | float(0) and ((co2 !="Allerta") and (voc !="Allerta")) ) %}
              Allerta Riscaldamento in atto
            {# 36 #}
            {% elif ( tipologia == "Disabilitata" and velocita == "Free Cooling" and temp_esterna > temp_interna | float(0) and ((co2 =="Allerta") or (voc =="Allerta")) ) %}
              Allerta Riscaldamento in atto, Presenza di Inquinanti
            {# 37 #}
            {% elif ( tipologia == "Disabilitata" and velocita == "Free Cooling" and temp_interna == temp_esterna | float(0) and ((co2 !="Allerta") and (voc !="Allerta")) ) %}
              Nessuna Allerta
            {# 38 #}
            {% elif ( tipologia == "Disabilitata" and velocita == "Free Cooling" and temp_interna ==temp_esterna | float(0) and ((co2 =="Allerta") or (voc =="Allerta")) ) %}
              Nessuna Allerta, Presenza di Inquinanti
            {# 39 #}
            {% elif ( tipologia == "Disabilitata" and velocita != "Free Cooling" and temp_interna > temp_esterna | float(0) and ((co2 !="Allerta") and (voc !="Allerta")) ) %}
              Se Avviata in Velocità Free Cool./Heat. (Allerta Raffrescamento)
            {# 40 #}
            {% elif ( tipologia == "Disabilitata" and velocita != "Free Cooling" and temp_interna > temp_esterna | float(0) and ((co2 =="Allerta") or (voc =="Allerta")) ) %}
              Se Avviata in Velocità Free Cool./Heat. (Allerta Raffrescamento, Presenza di Inquinanti)
            {# 41 #}
            {% elif ( tipologia == "Disabilitata" and  velocita != "Free Cooling" and temp_esterna > temp_interna | float(0) and ((co2 !="Allerta") and (voc !="Allerta")) ) %}
              Se Avviata in Velocità Free Cool./Heat. (Allerta Riscaldamento)
            {# 42 #}
            {% elif ( tipologia == "Disabilitata" and velocita != "Free Cooling" and temp_esterna > temp_interna | float(0) and ((co2 =="Allerta") or (voc =="Allerta")) ) %}
              Se Avviata in Velocità Free Cool./Heat. (Allerta Riscaldamento, Presenza di Inquinanti)
            {# 43 #}
            {% elif ( tipologia == "Disabilitata" and  velocita != "Free Cooling" and temp_esterna == temp_interna | float(0) and ((co2 !="Allerta") and (voc !="Allerta")) ) %}
              Nessuna Allerta
            {# 44 #}
            {% elif ( tipologia == "Disabilitata" and  velocita != "Free Cooling" and temp_esterna == temp_interna | float(0) and ((co2 =="Allerta") or (voc =="Allerta")) ) %}
              Nessuna Allerta, Presenza di Inquinanti
            {% else %}
              Nessuna Allerta
            {% endif %}   
          {% endif %}
        icon_template: mdi:alarm-light-outline

      vmc_master_alert_monitoraggio_free_heating_o_free_cooling_disabilitato:        # [CONFIGURAZIONE, PIU’ RICHIAMI] [AUTOMAZIONE, 0 RICHIAMI] [INTERFACCIA, PIU' RICHIAMI] SENSORE CHE RACCHIUDE TUTTE LE ALLERTE DOVUTE ALL' IMPIEGO DELLA VELOCITA' FREE HEATING/ FREE COOLING DISABILITATO (AD ECCEZZIONE "Nessuna Allerta, Presenza di Inquinanti")
        friendly_name: "Verifica Allerte Free H./C."
        value_template: >
          {% set stati = ['unknown', 'unavailable'] %}
          {% if states('sensor.vmc_master_sensori') in stati %}
            Non disponibile
          {% else %}
            {% set avviso_disabilitato = states('sensor.vmc_master_alert_monitoraggio_free_heating_o_free_cooling_allert_interfaccia_avvisi') %}
            {% if avviso_disabilitato == "Allerta Free Heating Programmato (Raffrescamento Arrestato)" or
               avviso_disabilitato == "Allerta Free Heating Programmato (Raffrescamento in atto)" or
               avviso_disabilitato == "Allerta Free Heating Programmato (Raffrescamento in atto, Presenza di Inquinanti)" or
               avviso_disabilitato == "Allerta Free Heating Programmato (Raffrescamento Arrestato, Presenza di Inquinanti)" or
               avviso_disabilitato == "Allerta Free Cooling Programmato (Riscaldamento in atto)" or
               avviso_disabilitato == "Allerta Free Cooling Programmato (Riscaldamento Arrestato)" or
               avviso_disabilitato == "Allerta Free Cooling Programmato (Riscaldamento Arrestato, Presenza di Inquinanti)" or
               avviso_disabilitato == "Allerta Free Cooling Programmato (Riscaldamento in atto, Presenza di Inquinanti)" or
               avviso_disabilitato == "Allerta Raffrescamento in atto" or
               avviso_disabilitato == "Allerta Riscaldamento in atto" or
               avviso_disabilitato == "Allerta Riscaldamento in atto, Presenza di Inquinanti" or
               avviso_disabilitato == "Allerta Raffrescamento in atto, Presenza di Inquinanti" or
               avviso_disabilitato == "Non Avviare in Velocità Free Heating Programmato (Allerta Raffrescamento)" or
               avviso_disabilitato == "Non Avviare in Velocità Free Heating Programmato (Allerta Raffrescamento, Presenza di Inquinanti)" or
               avviso_disabilitato == "Non Avviare in Velocità Free Cooling Programmato (Allerta Riscaldamento)" or
               avviso_disabilitato == "Non Avviare in Velocità Free Cooling Programmato (Allerta Riscaldamento, Presenza di Inquinanti)" or
               avviso_disabilitato == "Se Avviata in Velocità Free Cool./Heat. (Allerta Raffrescamento)" or
               avviso_disabilitato == "Se Avviata in Velocità Free Cool./Heat. (Allerta Riscaldamento)" or
               avviso_disabilitato == "Se Avviata in Velocità Free Cool./Heat. (Allerta Raffrescamento, Presenza di Inquinanti)" or
               avviso_disabilitato == "Se Avviata in Velocità Free Cool./Heat. (Allerta Riscaldamento, Presenza di Inquinanti)" %}
              OK
            {% else %}
              NOT OK
            {% endif %}   
          {% endif %}
        icon_template: mdi:alarm-light-outline

      vmc_master_alert_monitoraggio_offset_tutti_min:                          # [CONFIGURAZIONE, PIU’ RICHIAMI] [AUTOMAZIONE, 0 RICHIAMI] [INTERFACCIA, PIU’ RICHIAMI] SENSORE POP-UP CHE VERIFICA SE GLI OFFSET SONO TUTTI AL MINIMO
        friendly_name: "Verifica Offset se sono settati tutti al Minimo"
        value_template: >
          {% set stati = ['unknown', 'unavailable'] %}
          {% if states('sensor.vmc_master_sensori') in stati %}
            Non disponibile
          {% else %}
            {% set valore_minimo_temp_esterna = state_attr('input_number.vmc_master_offset_temp_esterna', 'min') | float %}
            {% set valore_minimo_temp_interna = state_attr('input_number.vmc_master_offset_temp_interna', 'min') | float %}
            {% set valore_minimo_umidita_esterna = state_attr('input_number.vmc_master_offset_umidita_esterna', 'min') | float %}
            {% set valore_minimo_umidita_interna = state_attr('input_number.vmc_master_offset_umidita_interna', 'min') | float %}
            {% set valore_minimo_co2 = state_attr('input_number.vmc_master_offset_co2', 'min') | float %}
            {% set valore_minimo_voc = state_attr('input_number.vmc_master_offset_voc', 'min') | float %}
            {% if (states('input_number.vmc_master_offset_temp_interna') | float == valore_minimo_temp_interna and 
                   states('input_number.vmc_master_offset_temp_esterna') | float == valore_minimo_temp_esterna and 
                   states('input_number.vmc_master_offset_umidita_interna') | float == valore_minimo_umidita_interna and 
                   states('input_number.vmc_master_offset_umidita_esterna') | float == valore_minimo_umidita_esterna and
                   states('input_number.vmc_master_offset_co2') | float == valore_minimo_co2 and 
                   states('input_number.vmc_master_offset_voc') | float == valore_minimo_voc) %}
              NOT OK
            {% else %}
              OK
            {% endif %}
          {% endif %}
        icon_template: mdi:alarm-light-outline

      vmc_master_alert_monitoraggio_black_out:                                 # [CONFIGURAZIONE, PIU’ RICHIAMI] [AUTOMAZIONE, 0 RICHIAMI] [INTERFACCIA, PIU’ RICHIAMI] SENSORE DI AVVISO PER UN BLACK-OUT
        friendly_name: "Verifica Black-Out"
        value_template: >
          {% set stati = ['unknown', 'unavailable'] %}
          {% if states('sensor.vmc_master_sensori') in stati %}
            Non disponibile
          {% else %}
            {% if (
              is_state('input_boolean.vmc_master_spia_velocita_0', 'on') or
              is_state('input_boolean.vmc_master_spia_velocita_1', 'on') or
              is_state('input_boolean.vmc_master_spia_velocita_2', 'on') or
              is_state('input_boolean.vmc_master_spia_velocita_3', 'on') or
              is_state('input_boolean.vmc_master_spia_velocita_4', 'on') or
              is_state('input_boolean.vmc_master_spia_velocita_notturna', 'on') or
              is_state('input_boolean.vmc_master_spia_velocita_freecooling', 'on') or
              is_state('input_boolean.vmc_master_spia_velocita_iperventilazione', 'on')
            ) %}
              Rilevato
            {% else %}
              Non Rilevato
            {% endif %}
          {% endif %}
        icon_template: mdi:alarm-light-outline

      vmc_master_alert_monitoraggio_totale:                                    # [CONFIGURAZIONE PIU' RICHIAMI] [AUTOMAZIONE, 0 RICHIAMI] [INTERFACCIA, 0 RICHIAMI] SENSORE ALLERTA MONITORAGGIO TOTALE: Umidità, CO₂, VOC, PdR, Congelamento, Delta, Free Heating Programmato e Free Cooling Programmato
        friendly_name: "Status Monitoraggio"
        value_template: >
          {% set stati = ['unknown', 'unavailable'] %}
          {% if states('sensor.vmc_master_sensori') in stati %}
            Non disponibile
          {% else %}
            {% set umidità = states('sensor.vmc_master_alert_monitoraggio_umidita') %}
            {% set umidità_non_calcolabile = states('sensor.vmc_master_umidita_interna_status') %}
            {% set umidità_esterna_non_calcolabile = states('sensor.vmc_master_umidita_esterna_status') %}
            {% set co2 = states('sensor.vmc_master_alert_monitoraggio_co2') %}
            {% set voc = states('sensor.vmc_master_alert_monitoraggio_voc') %}            
            {% set PdRvc = states('sensor.vmc_master_alert_monitoraggio_pdr') %}
            {% set congelamento = states('sensor.vmc_master_alert_monitoraggio_congelamento') %}
            {% set delta = states('sensor.vmc_master_alert_monitoraggio_delta') %}
            {% set offset = states('sensor.vmc_master_alert_monitoraggio_offset_tutti_min') %}
            {% set freeheating_freecooling = states('sensor.vmc_master_alert_monitoraggio_free_heating_o_free_cooling_disabilitato') %}
            {% set black_out = states('sensor.vmc_master_alert_monitoraggio_black_out') %}
            {% if ( (black_out == 'Rilevato') or (umidità == 'Allerta' ) or (umidità_non_calcolabile == '[Non Calcolabile]') or (umidità_esterna_non_calcolabile == '[Non Calcolabile]') or (co2 =='Allerta') or (voc =='Allerta') or (PdRvc =='Allerta') or (congelamento == 'Allerta') or (delta == 'Allerta')  or (freeheating_freecooling == 'OK') or (offset == 'NOT OK')) %}
              Allerta
            {% else %}
              Nessuna Allerta
            {% endif %}
          {% endif %}
        icon_template: mdi:incognito-circle

      vmc_master_spia_pannello_alert_monitoraggio_totale:                      # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, 0 RICHIAMI] [INTERFACCIA, PIU’ RICHIAMI] SENSORE PER MOSTRARE ALLERTA MONITORAGGIO TOTALE: Umidità, CO₂, VOC, PdR, Congelamento, Delta, Free Heating e Free Cooling
        friendly_name: "Avvisi"
        value_template: >
          {% set stati = ['unknown', 'unavailable'] %}
          {% if states('sensor.vmc_master_sensori') in stati %}
            Non disponibile
          {% else %}
            {% set monitoraggio = states('sensor.vmc_master_alert_monitoraggio_totale') %}
            {% set spia_avvisi = states('input_boolean.vmc_master_opzioni_accendi_spegni_avvisi') %}
            {% if monitoraggio == 'Nessuna Allerta' %}
              Non Presenti
            {% elif monitoraggio == 'Allerta' and spia_avvisi == "on" %}
              Presenti
            {% elif monitoraggio == 'Allerta' and spia_avvisi == "off" %}
              Presenti ma Disabilitati
            {% endif %}
          {% endif %}
        icon_template: mdi:alert-rhombus-outline
########################################################################################### FINE SENSORI PER POP-UP MONITORAGGIO #####################################################################################################

################### Inizio Creazione Sensori Interfaccia Calendario  #################################################################################################################################################################
########################################################################################################################
# LOGICA DI FUNZIONAMENTO DEGLI ORARI NELLE FASCE DI INSERIMENTO NEL CALENDARIO, LE VERIFICHE DEVONO ESSERE TUTTE TRUE #
# Accensione  1° <  Spegnimento 1° True                                                                                #
# Accensione  1° <  Accensione  2° True                                                                                #
# Spegnimento 1° <  Spegnimento 2° True                                                                                #
# Accensiore  2° <  Spegnimento 2° True                                                                                #
# Accensiore  2° >  Spegnimento 1° True                                                                                #
# Accensione  1° <> Spegnimento 1° True                                                                                #
# Accensione  1° <> Accensione  2° True                                                                                #
# Spegnimento 1° <> Spegnimento 2° True                                                                                #
# Spegnimento 1° <> Accensione  2° True                                                                                #
# Accensione  2° <> Spegnimento 2° True                                                                                #
# Verifica Calendario Acceso:      True                                                                                #
########################################################################################################################

      vmc_master_status_accensione_vmc_tramite_calendario_interfaccia:                     # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE 0] [INTERFACCIA, PIU’ RICHIAMI] SENSORE DI VERIFICA 1° FASCIA ACCENSIONE SE GLI ORARI SONO STATI INSERITI CORRETTAMENTE, DIVERSAMENTE MOSTRERA' "DISABILITATA"
        friendly_name: "1° Accensione programmata"
        value_template: >-
          {% set stati = ['unknown', 'unavailable'] %}
          {% if states('sensor.vmc_master_sensori') in stati %}
            Non disponibile
          {% else %}        
            {% set weekday = now().weekday() %}
            {% if weekday == 0 and states('input_datetime.vmc_master_accensione_lunedi') < states('input_datetime.vmc_master_spegnimento_lunedi') and states('input_datetime.vmc_master_accensione_lunedi') != states('input_datetime.vmc_master_spegnimento_lunedi') and states('input_datetime.vmc_master_accensione_lunedi_2') < states('input_datetime.vmc_master_spegnimento_lunedi_2') and states('input_datetime.vmc_master_accensione_lunedi_2') != states('input_datetime.vmc_master_spegnimento_lunedi_2') and states('input_datetime.vmc_master_accensione_lunedi') < states('input_datetime.vmc_master_accensione_lunedi_2') and states('input_datetime.vmc_master_spegnimento_lunedi') < states('input_datetime.vmc_master_spegnimento_lunedi_2') and states('input_datetime.vmc_master_accensione_lunedi') != states('input_datetime.vmc_master_accensione_lunedi_2') and states('input_datetime.vmc_master_spegnimento_lunedi') != states('input_datetime.vmc_master_spegnimento_lunedi_2') and states('input_datetime.vmc_master_spegnimento_lunedi') != states('input_datetime.vmc_master_accensione_lunedi_2') and states('input_datetime.vmc_master_accensione_lunedi_2') > states('input_datetime.vmc_master_spegnimento_lunedi') and states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_calendario') == 'on' %}
              Lunedi, {{ states('input_datetime.vmc_master_accensione_lunedi')[0:5] }}
            {% elif weekday == 1 and states('input_datetime.vmc_master_accensione_martedi') < states('input_datetime.vmc_master_spegnimento_martedi') and states('input_datetime.vmc_master_accensione_martedi') != states('input_datetime.vmc_master_spegnimento_martedi') and states('input_datetime.vmc_master_accensione_martedi_2') < states('input_datetime.vmc_master_spegnimento_martedi_2') and states('input_datetime.vmc_master_accensione_martedi_2') != states('input_datetime.vmc_master_spegnimento_martedi_2') and states('input_datetime.vmc_master_accensione_martedi') < states('input_datetime.vmc_master_accensione_martedi_2') and states('input_datetime.vmc_master_spegnimento_martedi') < states('input_datetime.vmc_master_spegnimento_martedi_2') and states('input_datetime.vmc_master_accensione_martedi') != states('input_datetime.vmc_master_accensione_martedi_2') and states('input_datetime.vmc_master_spegnimento_martedi') != states('input_datetime.vmc_master_spegnimento_martedi_2') and states('input_datetime.vmc_master_spegnimento_martedi') != states('input_datetime.vmc_master_accensione_martedi_2') and states('input_datetime.vmc_master_accensione_martedi_2') > states('input_datetime.vmc_master_spegnimento_martedi') and states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_calendario') == 'on' %}
              Martedi, {{ states('input_datetime.vmc_master_accensione_martedi')[0:5] }}
            {% elif weekday == 2 and states('input_datetime.vmc_master_accensione_mercoledi') < states('input_datetime.vmc_master_spegnimento_mercoledi') and states('input_datetime.vmc_master_accensione_mercoledi') != states('input_datetime.vmc_master_spegnimento_mercoledi') and states('input_datetime.vmc_master_accensione_mercoledi_2') < states('input_datetime.vmc_master_spegnimento_mercoledi_2') and states('input_datetime.vmc_master_accensione_mercoledi_2') != states('input_datetime.vmc_master_spegnimento_mercoledi_2') and states('input_datetime.vmc_master_accensione_mercoledi') < states('input_datetime.vmc_master_accensione_mercoledi_2') and states('input_datetime.vmc_master_spegnimento_mercoledi') < states('input_datetime.vmc_master_spegnimento_mercoledi_2') and states('input_datetime.vmc_master_accensione_mercoledi') != states('input_datetime.vmc_master_accensione_mercoledi_2') and states('input_datetime.vmc_master_spegnimento_mercoledi') != states('input_datetime.vmc_master_spegnimento_mercoledi_2') and states('input_datetime.vmc_master_spegnimento_mercoledi') != states('input_datetime.vmc_master_accensione_mercoledi_2') and states('input_datetime.vmc_master_accensione_mercoledi_2') > states('input_datetime.vmc_master_spegnimento_mercoledi') and states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_calendario') == 'on' %}
              Mercoledi, {{ states('input_datetime.vmc_master_accensione_mercoledi')[0:5] }}
            {% elif weekday == 3 and states('input_datetime.vmc_master_accensione_giovedi') < states('input_datetime.vmc_master_spegnimento_giovedi') and states('input_datetime.vmc_master_accensione_giovedi') != states('input_datetime.vmc_master_spegnimento_giovedi') and states('input_datetime.vmc_master_accensione_giovedi_2') < states('input_datetime.vmc_master_spegnimento_giovedi_2') and states('input_datetime.vmc_master_accensione_giovedi_2') != states('input_datetime.vmc_master_spegnimento_giovedi_2') and states('input_datetime.vmc_master_accensione_giovedi') < states('input_datetime.vmc_master_accensione_giovedi_2') and states('input_datetime.vmc_master_spegnimento_giovedi') < states('input_datetime.vmc_master_spegnimento_giovedi_2') and states('input_datetime.vmc_master_accensione_giovedi') != states('input_datetime.vmc_master_accensione_giovedi_2') and states('input_datetime.vmc_master_spegnimento_giovedi') != states('input_datetime.vmc_master_spegnimento_giovedi_2') and states('input_datetime.vmc_master_spegnimento_giovedi') != states('input_datetime.vmc_master_accensione_giovedi_2') and states('input_datetime.vmc_master_accensione_giovedi_2') > states('input_datetime.vmc_master_spegnimento_giovedi') and states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_calendario') == 'on' %}
              Giovedi, {{ states('input_datetime.vmc_master_accensione_giovedi')[0:5] }}
            {% elif weekday == 4 and states('input_datetime.vmc_master_accensione_venerdi') < states('input_datetime.vmc_master_spegnimento_venerdi') and states('input_datetime.vmc_master_accensione_venerdi') != states('input_datetime.vmc_master_spegnimento_venerdi') and states('input_datetime.vmc_master_accensione_venerdi_2') < states('input_datetime.vmc_master_spegnimento_venerdi_2') and states('input_datetime.vmc_master_accensione_venerdi_2') != states('input_datetime.vmc_master_spegnimento_venerdi_2') and states('input_datetime.vmc_master_accensione_venerdi') < states('input_datetime.vmc_master_accensione_venerdi_2') and states('input_datetime.vmc_master_spegnimento_venerdi') < states('input_datetime.vmc_master_spegnimento_venerdi_2') and states('input_datetime.vmc_master_accensione_venerdi') != states('input_datetime.vmc_master_accensione_venerdi_2') and states('input_datetime.vmc_master_spegnimento_venerdi') != states('input_datetime.vmc_master_spegnimento_venerdi_2') and states('input_datetime.vmc_master_spegnimento_venerdi') != states('input_datetime.vmc_master_accensione_venerdi_2') and states('input_datetime.vmc_master_accensione_venerdi_2') > states('input_datetime.vmc_master_spegnimento_venerdi') and states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_calendario') == 'on' %}
              Venerdi, {{ states('input_datetime.vmc_master_accensione_venerdi')[0:5] }}
            {% elif weekday == 5 and states('input_datetime.vmc_master_accensione_sabato') < states('input_datetime.vmc_master_spegnimento_sabato') and states('input_datetime.vmc_master_accensione_sabato') != states('input_datetime.vmc_master_spegnimento_sabato') and states('input_datetime.vmc_master_accensione_sabato_2') < states('input_datetime.vmc_master_spegnimento_sabato_2') and states('input_datetime.vmc_master_accensione_sabato_2') != states('input_datetime.vmc_master_spegnimento_sabato_2') and states('input_datetime.vmc_master_accensione_sabato') < states('input_datetime.vmc_master_accensione_sabato_2') and states('input_datetime.vmc_master_spegnimento_sabato') < states('input_datetime.vmc_master_spegnimento_sabato_2') and states('input_datetime.vmc_master_accensione_sabato') != states('input_datetime.vmc_master_accensione_sabato_2') and states('input_datetime.vmc_master_spegnimento_sabato') != states('input_datetime.vmc_master_spegnimento_sabato_2') and states('input_datetime.vmc_master_spegnimento_sabato') != states('input_datetime.vmc_master_accensione_sabato_2') and states('input_datetime.vmc_master_accensione_sabato_2') > states('input_datetime.vmc_master_spegnimento_sabato') and states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_calendario') == 'on' %}
              Sabato, {{ states('input_datetime.vmc_master_accensione_sabato')[0:5] }}
            {% elif weekday == 6 and states('input_datetime.vmc_master_accensione_domenica') < states('input_datetime.vmc_master_spegnimento_domenica') and states('input_datetime.vmc_master_accensione_domenica') != states('input_datetime.vmc_master_spegnimento_domenica') and states('input_datetime.vmc_master_accensione_domenica_2') < states('input_datetime.vmc_master_spegnimento_domenica_2') and states('input_datetime.vmc_master_accensione_domenica_2') != states('input_datetime.vmc_master_spegnimento_domenica_2') and states('input_datetime.vmc_master_accensione_domenica') < states('input_datetime.vmc_master_accensione_domenica_2') and states('input_datetime.vmc_master_spegnimento_domenica') < states('input_datetime.vmc_master_spegnimento_domenica_2') and states('input_datetime.vmc_master_accensione_domenica') != states('input_datetime.vmc_master_accensione_domenica_2') and states('input_datetime.vmc_master_spegnimento_domenica') != states('input_datetime.vmc_master_spegnimento_domenica_2') and states('input_datetime.vmc_master_spegnimento_domenica') != states('input_datetime.vmc_master_accensione_domenica_2') and states('input_datetime.vmc_master_accensione_domenica_2') > states('input_datetime.vmc_master_spegnimento_domenica') and states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_calendario') == 'on' %}
              Domenica, {{ states('input_datetime.vmc_master_accensione_domenica')[0:5] }}
              {% else %}
                Disabilitata
              {% endif %}
          {% endif %}            
        icon_template: mdi:timer-play-outline

      vmc_master_status_accensione_vmc_tramite_calendario_2_interfaccia:                   #  [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE 0] [INTERFACCIA, PIU’ RICHIAMI] SENSORE DI VERIFICA 2° FASCIA ACCENSIONE SE GLI ORARI SONO STATI INSERITI CORRETTAMENTE, DIVERSAMENTE MOSTRERA' "DISABILITATA"
        friendly_name: "2° Accensione programmata"
        value_template: >-
          {% set stati = ['unknown', 'unavailable'] %}
          {% if states('sensor.vmc_master_sensori') in stati %}
            Non disponibile
          {% else %}        
            {% set weekday = now().weekday() %}
            {% if weekday == 0 and states('input_datetime.vmc_master_accensione_lunedi') < states('input_datetime.vmc_master_spegnimento_lunedi') and states('input_datetime.vmc_master_accensione_lunedi') != states('input_datetime.vmc_master_spegnimento_lunedi') and states('input_datetime.vmc_master_accensione_lunedi_2') < states('input_datetime.vmc_master_spegnimento_lunedi_2') and states('input_datetime.vmc_master_accensione_lunedi_2') != states('input_datetime.vmc_master_spegnimento_lunedi_2') and states('input_datetime.vmc_master_accensione_lunedi') < states('input_datetime.vmc_master_accensione_lunedi_2') and states('input_datetime.vmc_master_spegnimento_lunedi') < states('input_datetime.vmc_master_spegnimento_lunedi_2') and states('input_datetime.vmc_master_accensione_lunedi') != states('input_datetime.vmc_master_accensione_lunedi_2') and states('input_datetime.vmc_master_spegnimento_lunedi') != states('input_datetime.vmc_master_spegnimento_lunedi_2') and states('input_datetime.vmc_master_spegnimento_lunedi') != states('input_datetime.vmc_master_accensione_lunedi_2') and states('input_datetime.vmc_master_accensione_lunedi_2') > states('input_datetime.vmc_master_spegnimento_lunedi') and states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_calendario') == 'on' %}
              Lunedi, {{ states('input_datetime.vmc_master_accensione_lunedi_2')[0:5] }}
            {% elif weekday == 1 and states('input_datetime.vmc_master_accensione_martedi') < states('input_datetime.vmc_master_spegnimento_martedi') and states('input_datetime.vmc_master_accensione_martedi') != states('input_datetime.vmc_master_spegnimento_martedi') and states('input_datetime.vmc_master_accensione_martedi_2') < states('input_datetime.vmc_master_spegnimento_martedi_2') and states('input_datetime.vmc_master_accensione_martedi_2') != states('input_datetime.vmc_master_spegnimento_martedi_2') and states('input_datetime.vmc_master_accensione_martedi') < states('input_datetime.vmc_master_accensione_martedi_2') and states('input_datetime.vmc_master_spegnimento_martedi') < states('input_datetime.vmc_master_spegnimento_martedi_2') and states('input_datetime.vmc_master_accensione_martedi') != states('input_datetime.vmc_master_accensione_martedi_2') and states('input_datetime.vmc_master_spegnimento_martedi') != states('input_datetime.vmc_master_spegnimento_martedi_2') and states('input_datetime.vmc_master_spegnimento_martedi') != states('input_datetime.vmc_master_accensione_martedi_2') and states('input_datetime.vmc_master_accensione_martedi_2') > states('input_datetime.vmc_master_spegnimento_martedi') and states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_calendario') == 'on' %}
              Martedi, {{ states('input_datetime.vmc_master_accensione_martedi_2')[0:5] }}
            {% elif weekday == 2 and states('input_datetime.vmc_master_accensione_mercoledi') < states('input_datetime.vmc_master_spegnimento_mercoledi') and states('input_datetime.vmc_master_accensione_mercoledi') != states('input_datetime.vmc_master_spegnimento_mercoledi') and states('input_datetime.vmc_master_accensione_mercoledi_2') < states('input_datetime.vmc_master_spegnimento_mercoledi_2') and states('input_datetime.vmc_master_accensione_mercoledi_2') != states('input_datetime.vmc_master_spegnimento_mercoledi_2') and states('input_datetime.vmc_master_accensione_mercoledi') < states('input_datetime.vmc_master_accensione_mercoledi_2') and states('input_datetime.vmc_master_spegnimento_mercoledi') < states('input_datetime.vmc_master_spegnimento_mercoledi_2') and states('input_datetime.vmc_master_accensione_mercoledi') != states('input_datetime.vmc_master_accensione_mercoledi_2') and states('input_datetime.vmc_master_spegnimento_mercoledi') != states('input_datetime.vmc_master_spegnimento_mercoledi_2') and states('input_datetime.vmc_master_spegnimento_mercoledi') != states('input_datetime.vmc_master_accensione_mercoledi_2') and states('input_datetime.vmc_master_accensione_mercoledi_2') > states('input_datetime.vmc_master_spegnimento_mercoledi') and states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_calendario') == 'on' %}
              Mercoledi, {{ states('input_datetime.vmc_master_accensione_mercoledi_2')[0:5] }}
            {% elif weekday == 3 and states('input_datetime.vmc_master_accensione_giovedi') < states('input_datetime.vmc_master_spegnimento_giovedi') and states('input_datetime.vmc_master_accensione_giovedi') != states('input_datetime.vmc_master_spegnimento_giovedi') and states('input_datetime.vmc_master_accensione_giovedi_2') < states('input_datetime.vmc_master_spegnimento_giovedi_2') and states('input_datetime.vmc_master_accensione_giovedi_2') != states('input_datetime.vmc_master_spegnimento_giovedi_2') and states('input_datetime.vmc_master_accensione_giovedi') < states('input_datetime.vmc_master_accensione_giovedi_2') and states('input_datetime.vmc_master_spegnimento_giovedi') < states('input_datetime.vmc_master_spegnimento_giovedi_2') and states('input_datetime.vmc_master_accensione_giovedi') != states('input_datetime.vmc_master_accensione_giovedi_2') and states('input_datetime.vmc_master_spegnimento_giovedi') != states('input_datetime.vmc_master_spegnimento_giovedi_2') and states('input_datetime.vmc_master_spegnimento_giovedi') != states('input_datetime.vmc_master_accensione_giovedi_2') and states('input_datetime.vmc_master_accensione_giovedi_2') > states('input_datetime.vmc_master_spegnimento_giovedi') and states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_calendario') == 'on' %}
              Giovedi, {{ states('input_datetime.vmc_master_accensione_giovedi_2')[0:5] }}
            {% elif weekday == 4 and states('input_datetime.vmc_master_accensione_venerdi') < states('input_datetime.vmc_master_spegnimento_venerdi') and states('input_datetime.vmc_master_accensione_venerdi') != states('input_datetime.vmc_master_spegnimento_venerdi') and states('input_datetime.vmc_master_accensione_venerdi_2') < states('input_datetime.vmc_master_spegnimento_venerdi_2') and states('input_datetime.vmc_master_accensione_venerdi_2') != states('input_datetime.vmc_master_spegnimento_venerdi_2') and states('input_datetime.vmc_master_accensione_venerdi') < states('input_datetime.vmc_master_accensione_venerdi_2') and states('input_datetime.vmc_master_spegnimento_venerdi') < states('input_datetime.vmc_master_spegnimento_venerdi_2') and states('input_datetime.vmc_master_accensione_venerdi') != states('input_datetime.vmc_master_accensione_venerdi_2') and states('input_datetime.vmc_master_spegnimento_venerdi') != states('input_datetime.vmc_master_spegnimento_venerdi_2') and states('input_datetime.vmc_master_spegnimento_venerdi') != states('input_datetime.vmc_master_accensione_venerdi_2') and states('input_datetime.vmc_master_accensione_venerdi_2') > states('input_datetime.vmc_master_spegnimento_venerdi') and states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_calendario') == 'on' %}
              Venerdi, {{ states('input_datetime.vmc_master_accensione_venerdi_2')[0:5] }}
            {% elif weekday == 5 and states('input_datetime.vmc_master_accensione_sabato') < states('input_datetime.vmc_master_spegnimento_sabato') and states('input_datetime.vmc_master_accensione_sabato') != states('input_datetime.vmc_master_spegnimento_sabato') and states('input_datetime.vmc_master_accensione_sabato_2') < states('input_datetime.vmc_master_spegnimento_sabato_2') and states('input_datetime.vmc_master_accensione_sabato_2') != states('input_datetime.vmc_master_spegnimento_sabato_2') and states('input_datetime.vmc_master_accensione_sabato') < states('input_datetime.vmc_master_accensione_sabato_2') and states('input_datetime.vmc_master_spegnimento_sabato') < states('input_datetime.vmc_master_spegnimento_sabato_2') and states('input_datetime.vmc_master_accensione_sabato') != states('input_datetime.vmc_master_accensione_sabato_2') and states('input_datetime.vmc_master_spegnimento_sabato') != states('input_datetime.vmc_master_spegnimento_sabato_2') and states('input_datetime.vmc_master_spegnimento_sabato') != states('input_datetime.vmc_master_accensione_sabato_2') and states('input_datetime.vmc_master_accensione_sabato_2') > states('input_datetime.vmc_master_spegnimento_sabato') and states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_calendario') == 'on' %}
              Sabato, {{ states('input_datetime.vmc_master_accensione_sabato_2')[0:5] }}
            {% elif weekday == 6 and states('input_datetime.vmc_master_accensione_domenica') < states('input_datetime.vmc_master_spegnimento_domenica') and states('input_datetime.vmc_master_accensione_domenica') != states('input_datetime.vmc_master_spegnimento_domenica') and states('input_datetime.vmc_master_accensione_domenica_2') < states('input_datetime.vmc_master_spegnimento_domenica_2') and states('input_datetime.vmc_master_accensione_domenica_2') != states('input_datetime.vmc_master_spegnimento_domenica_2') and states('input_datetime.vmc_master_accensione_domenica') < states('input_datetime.vmc_master_accensione_domenica_2') and states('input_datetime.vmc_master_spegnimento_domenica') < states('input_datetime.vmc_master_spegnimento_domenica_2') and states('input_datetime.vmc_master_accensione_domenica') != states('input_datetime.vmc_master_accensione_domenica_2') and states('input_datetime.vmc_master_spegnimento_domenica') != states('input_datetime.vmc_master_spegnimento_domenica_2') and states('input_datetime.vmc_master_spegnimento_domenica') != states('input_datetime.vmc_master_accensione_domenica_2') and states('input_datetime.vmc_master_accensione_domenica_2') > states('input_datetime.vmc_master_spegnimento_domenica') and states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_calendario') == 'on' %}
              Domenica, {{ states('input_datetime.vmc_master_accensione_domenica_2')[0:5] }}
              {% else %}
                Disabilitata
              {% endif %}
          {% endif %}            
        icon_template: mdi:timer-play-outline

      vmc_master_status_spegnimento_vmc_tramite_calendario_interfaccia:                    # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE 0] [INTERFACCIA, PIU’ RICHIAMI]  SENSORE DI VERIFICA 1° FASCIA SPEGNIMENTO SE GLI ORARI SONO STATI INSERITI CORRETTAMENTE, DIVERSAMENTE MOSTRERA' "DISABILITATO"
        friendly_name: "1° Spegnimento programmato"
        value_template: >-
          {% set stati = ['unknown', 'unavailable'] %}
          {% if states('sensor.vmc_master_sensori') in stati %}
            Non disponibile
          {% else %}        
            {% set weekday = now().weekday() %}
            {% if weekday == 0 and states('input_datetime.vmc_master_accensione_lunedi') < states('input_datetime.vmc_master_spegnimento_lunedi') and states('input_datetime.vmc_master_accensione_lunedi') != states('input_datetime.vmc_master_spegnimento_lunedi') and states('input_datetime.vmc_master_accensione_lunedi_2') < states('input_datetime.vmc_master_spegnimento_lunedi_2') and states('input_datetime.vmc_master_accensione_lunedi_2') != states('input_datetime.vmc_master_spegnimento_lunedi_2') and states('input_datetime.vmc_master_accensione_lunedi') < states('input_datetime.vmc_master_accensione_lunedi_2') and states('input_datetime.vmc_master_spegnimento_lunedi') < states('input_datetime.vmc_master_spegnimento_lunedi_2') and states('input_datetime.vmc_master_accensione_lunedi') != states('input_datetime.vmc_master_accensione_lunedi_2') and states('input_datetime.vmc_master_spegnimento_lunedi') != states('input_datetime.vmc_master_spegnimento_lunedi_2') and states('input_datetime.vmc_master_spegnimento_lunedi') != states('input_datetime.vmc_master_accensione_lunedi_2') and states('input_datetime.vmc_master_accensione_lunedi_2') > states('input_datetime.vmc_master_spegnimento_lunedi') and states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_calendario') == 'on' %}
              Lunedi, {{ states('input_datetime.vmc_master_spegnimento_lunedi')[0:5] }}
            {% elif weekday == 1 and states('input_datetime.vmc_master_accensione_martedi') < states('input_datetime.vmc_master_spegnimento_martedi') and states('input_datetime.vmc_master_accensione_martedi') != states('input_datetime.vmc_master_spegnimento_martedi') and states('input_datetime.vmc_master_accensione_martedi_2') < states('input_datetime.vmc_master_spegnimento_martedi_2') and states('input_datetime.vmc_master_accensione_martedi_2') != states('input_datetime.vmc_master_spegnimento_martedi_2') and states('input_datetime.vmc_master_accensione_martedi') < states('input_datetime.vmc_master_accensione_martedi_2') and states('input_datetime.vmc_master_spegnimento_martedi') < states('input_datetime.vmc_master_spegnimento_martedi_2') and states('input_datetime.vmc_master_accensione_martedi') != states('input_datetime.vmc_master_accensione_martedi_2') and states('input_datetime.vmc_master_spegnimento_martedi') != states('input_datetime.vmc_master_spegnimento_martedi_2') and states('input_datetime.vmc_master_spegnimento_martedi') != states('input_datetime.vmc_master_accensione_martedi_2') and states('input_datetime.vmc_master_accensione_martedi_2') > states('input_datetime.vmc_master_spegnimento_martedi') and states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_calendario') == 'on' %}
              Martedi, {{ states('input_datetime.vmc_master_spegnimento_martedi')[0:5] }}
            {% elif weekday == 2 and states('input_datetime.vmc_master_accensione_mercoledi') < states('input_datetime.vmc_master_spegnimento_mercoledi') and states('input_datetime.vmc_master_accensione_mercoledi') != states('input_datetime.vmc_master_spegnimento_mercoledi') and states('input_datetime.vmc_master_accensione_mercoledi_2') < states('input_datetime.vmc_master_spegnimento_mercoledi_2') and states('input_datetime.vmc_master_accensione_mercoledi_2') != states('input_datetime.vmc_master_spegnimento_mercoledi_2') and states('input_datetime.vmc_master_accensione_mercoledi') < states('input_datetime.vmc_master_accensione_mercoledi_2') and states('input_datetime.vmc_master_spegnimento_mercoledi') < states('input_datetime.vmc_master_spegnimento_mercoledi_2') and states('input_datetime.vmc_master_accensione_mercoledi') != states('input_datetime.vmc_master_accensione_mercoledi_2') and states('input_datetime.vmc_master_spegnimento_mercoledi') != states('input_datetime.vmc_master_spegnimento_mercoledi_2') and states('input_datetime.vmc_master_spegnimento_mercoledi') != states('input_datetime.vmc_master_accensione_mercoledi_2') and states('input_datetime.vmc_master_accensione_mercoledi_2') > states('input_datetime.vmc_master_spegnimento_mercoledi') and states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_calendario') == 'on' %}
              Mercoledi, {{ states('input_datetime.vmc_master_spegnimento_mercoledi')[0:5] }}
            {% elif weekday == 3 and states('input_datetime.vmc_master_accensione_giovedi') < states('input_datetime.vmc_master_spegnimento_giovedi') and states('input_datetime.vmc_master_accensione_giovedi') != states('input_datetime.vmc_master_spegnimento_giovedi') and states('input_datetime.vmc_master_accensione_giovedi_2') < states('input_datetime.vmc_master_spegnimento_giovedi_2') and states('input_datetime.vmc_master_accensione_giovedi_2') != states('input_datetime.vmc_master_spegnimento_giovedi_2') and states('input_datetime.vmc_master_accensione_giovedi') < states('input_datetime.vmc_master_accensione_giovedi_2') and states('input_datetime.vmc_master_spegnimento_giovedi') < states('input_datetime.vmc_master_spegnimento_giovedi_2') and states('input_datetime.vmc_master_accensione_giovedi') != states('input_datetime.vmc_master_accensione_giovedi_2') and states('input_datetime.vmc_master_spegnimento_giovedi') != states('input_datetime.vmc_master_spegnimento_giovedi_2') and states('input_datetime.vmc_master_spegnimento_giovedi') != states('input_datetime.vmc_master_accensione_giovedi_2') and states('input_datetime.vmc_master_accensione_giovedi_2') > states('input_datetime.vmc_master_spegnimento_giovedi') and states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_calendario') == 'on' %}
              Giovedi, {{ states('input_datetime.vmc_master_spegnimento_giovedi')[0:5] }}
            {% elif weekday == 4 and states('input_datetime.vmc_master_accensione_venerdi') < states('input_datetime.vmc_master_spegnimento_venerdi') and states('input_datetime.vmc_master_accensione_venerdi') != states('input_datetime.vmc_master_spegnimento_venerdi') and states('input_datetime.vmc_master_accensione_venerdi_2') < states('input_datetime.vmc_master_spegnimento_venerdi_2') and states('input_datetime.vmc_master_accensione_venerdi_2') != states('input_datetime.vmc_master_spegnimento_venerdi_2') and states('input_datetime.vmc_master_accensione_venerdi') < states('input_datetime.vmc_master_accensione_venerdi_2') and states('input_datetime.vmc_master_spegnimento_venerdi') < states('input_datetime.vmc_master_spegnimento_venerdi_2') and states('input_datetime.vmc_master_accensione_venerdi') != states('input_datetime.vmc_master_accensione_venerdi_2') and states('input_datetime.vmc_master_spegnimento_venerdi') != states('input_datetime.vmc_master_spegnimento_venerdi_2') and states('input_datetime.vmc_master_spegnimento_venerdi') != states('input_datetime.vmc_master_accensione_venerdi_2') and states('input_datetime.vmc_master_accensione_venerdi_2') > states('input_datetime.vmc_master_spegnimento_venerdi') and states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_calendario') == 'on' %}
              Venerdi, {{ states('input_datetime.vmc_master_spegnimento_venerdi')[0:5] }}
            {% elif weekday == 5 and states('input_datetime.vmc_master_accensione_sabato') < states('input_datetime.vmc_master_spegnimento_sabato') and states('input_datetime.vmc_master_accensione_sabato') != states('input_datetime.vmc_master_spegnimento_sabato') and states('input_datetime.vmc_master_accensione_sabato_2') < states('input_datetime.vmc_master_spegnimento_sabato_2') and states('input_datetime.vmc_master_accensione_sabato_2') != states('input_datetime.vmc_master_spegnimento_sabato_2') and states('input_datetime.vmc_master_accensione_sabato') < states('input_datetime.vmc_master_accensione_sabato_2') and states('input_datetime.vmc_master_spegnimento_sabato') < states('input_datetime.vmc_master_spegnimento_sabato_2') and states('input_datetime.vmc_master_accensione_sabato') != states('input_datetime.vmc_master_accensione_sabato_2') and states('input_datetime.vmc_master_spegnimento_sabato') != states('input_datetime.vmc_master_spegnimento_sabato_2') and states('input_datetime.vmc_master_spegnimento_sabato') != states('input_datetime.vmc_master_accensione_sabato_2') and states('input_datetime.vmc_master_accensione_sabato_2') > states('input_datetime.vmc_master_spegnimento_sabato') and states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_calendario') == 'on' %}
              Sabato, {{ states('input_datetime.vmc_master_spegnimento_sabato')[0:5] }}
            {% elif weekday == 6 and states('input_datetime.vmc_master_accensione_domenica') < states('input_datetime.vmc_master_spegnimento_domenica') and states('input_datetime.vmc_master_accensione_domenica') != states('input_datetime.vmc_master_spegnimento_domenica') and states('input_datetime.vmc_master_accensione_domenica_2') < states('input_datetime.vmc_master_spegnimento_domenica_2') and states('input_datetime.vmc_master_accensione_domenica_2') != states('input_datetime.vmc_master_spegnimento_domenica_2') and states('input_datetime.vmc_master_accensione_domenica') < states('input_datetime.vmc_master_accensione_domenica_2') and states('input_datetime.vmc_master_spegnimento_domenica') < states('input_datetime.vmc_master_spegnimento_domenica_2') and states('input_datetime.vmc_master_accensione_domenica') != states('input_datetime.vmc_master_accensione_domenica_2') and states('input_datetime.vmc_master_spegnimento_domenica') != states('input_datetime.vmc_master_spegnimento_domenica_2') and states('input_datetime.vmc_master_spegnimento_domenica') != states('input_datetime.vmc_master_accensione_domenica_2') and states('input_datetime.vmc_master_accensione_domenica_2') > states('input_datetime.vmc_master_spegnimento_domenica') and states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_calendario') == 'on' %}
              Domenica, {{ states('input_datetime.vmc_master_spegnimento_domenica')[0:5] }}
              {% else %}
                Disabilitata
              {% endif %}
          {% endif %}         
        icon_template: mdi:timer-stop-outline

      vmc_master_status_spegnimento_vmc_tramite_calendario_2_interfaccia:                  # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE 0] [INTERFACCIA, PIU’ RICHIAMI]  SENSORE DI VERIFICA 2° FASCIA SPEGNIMENTO SE GLI ORARI SONO STATI INSERITI CORRETTAMENTE, DIVERSAMENTE MOSTRERA' "DISABILITATO"
        friendly_name: "2° Spegnimento programmato"
        value_template: >-
          {% set stati = ['unknown', 'unavailable'] %}
          {% if states('sensor.vmc_master_sensori') in stati %}
            Non disponibile
          {% else %}        
            {% set weekday = now().weekday() %}
            {% if weekday == 0 and states('input_datetime.vmc_master_accensione_lunedi') < states('input_datetime.vmc_master_spegnimento_lunedi') and states('input_datetime.vmc_master_accensione_lunedi') != states('input_datetime.vmc_master_spegnimento_lunedi') and states('input_datetime.vmc_master_accensione_lunedi_2') < states('input_datetime.vmc_master_spegnimento_lunedi_2') and states('input_datetime.vmc_master_accensione_lunedi_2') != states('input_datetime.vmc_master_spegnimento_lunedi_2') and states('input_datetime.vmc_master_accensione_lunedi') < states('input_datetime.vmc_master_accensione_lunedi_2') and states('input_datetime.vmc_master_spegnimento_lunedi') < states('input_datetime.vmc_master_spegnimento_lunedi_2') and states('input_datetime.vmc_master_accensione_lunedi') != states('input_datetime.vmc_master_accensione_lunedi_2') and states('input_datetime.vmc_master_spegnimento_lunedi') != states('input_datetime.vmc_master_spegnimento_lunedi_2') and states('input_datetime.vmc_master_spegnimento_lunedi') != states('input_datetime.vmc_master_accensione_lunedi_2') and states('input_datetime.vmc_master_accensione_lunedi_2') > states('input_datetime.vmc_master_spegnimento_lunedi') and states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_calendario') == 'on' %}
              Lunedi, {{ states('input_datetime.vmc_master_spegnimento_lunedi_2')[0:5] }}
            {% elif weekday == 1 and states('input_datetime.vmc_master_accensione_martedi') < states('input_datetime.vmc_master_spegnimento_martedi') and states('input_datetime.vmc_master_accensione_martedi') != states('input_datetime.vmc_master_spegnimento_martedi') and states('input_datetime.vmc_master_accensione_martedi_2') < states('input_datetime.vmc_master_spegnimento_martedi_2') and states('input_datetime.vmc_master_accensione_martedi_2') != states('input_datetime.vmc_master_spegnimento_martedi_2') and states('input_datetime.vmc_master_accensione_martedi') < states('input_datetime.vmc_master_accensione_martedi_2') and states('input_datetime.vmc_master_spegnimento_martedi') < states('input_datetime.vmc_master_spegnimento_martedi_2') and states('input_datetime.vmc_master_accensione_martedi') != states('input_datetime.vmc_master_accensione_martedi_2') and states('input_datetime.vmc_master_spegnimento_martedi') != states('input_datetime.vmc_master_spegnimento_martedi_2') and states('input_datetime.vmc_master_spegnimento_martedi') != states('input_datetime.vmc_master_accensione_martedi_2') and states('input_datetime.vmc_master_accensione_martedi_2') > states('input_datetime.vmc_master_spegnimento_martedi') and states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_calendario') == 'on' %}
              Martedi, {{ states('input_datetime.vmc_master_spegnimento_martedi_2')[0:5] }}
            {% elif weekday == 2 and states('input_datetime.vmc_master_accensione_mercoledi') < states('input_datetime.vmc_master_spegnimento_mercoledi') and states('input_datetime.vmc_master_accensione_mercoledi') != states('input_datetime.vmc_master_spegnimento_mercoledi') and states('input_datetime.vmc_master_accensione_mercoledi_2') < states('input_datetime.vmc_master_spegnimento_mercoledi_2') and states('input_datetime.vmc_master_accensione_mercoledi_2') != states('input_datetime.vmc_master_spegnimento_mercoledi_2') and states('input_datetime.vmc_master_accensione_mercoledi') < states('input_datetime.vmc_master_accensione_mercoledi_2') and states('input_datetime.vmc_master_spegnimento_mercoledi') < states('input_datetime.vmc_master_spegnimento_mercoledi_2') and states('input_datetime.vmc_master_accensione_mercoledi') != states('input_datetime.vmc_master_accensione_mercoledi_2') and states('input_datetime.vmc_master_spegnimento_mercoledi') != states('input_datetime.vmc_master_spegnimento_mercoledi_2') and states('input_datetime.vmc_master_spegnimento_mercoledi') != states('input_datetime.vmc_master_accensione_mercoledi_2') and states('input_datetime.vmc_master_accensione_mercoledi_2') > states('input_datetime.vmc_master_spegnimento_mercoledi') and states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_calendario') == 'on' %}
              Mercoledi, {{ states('input_datetime.vmc_master_spegnimento_mercoledi_2')[0:5] }}
            {% elif weekday == 3 and states('input_datetime.vmc_master_accensione_giovedi') < states('input_datetime.vmc_master_spegnimento_giovedi') and states('input_datetime.vmc_master_accensione_giovedi') != states('input_datetime.vmc_master_spegnimento_giovedi') and states('input_datetime.vmc_master_accensione_giovedi_2') < states('input_datetime.vmc_master_spegnimento_giovedi_2') and states('input_datetime.vmc_master_accensione_giovedi_2') != states('input_datetime.vmc_master_spegnimento_giovedi_2') and states('input_datetime.vmc_master_accensione_giovedi') < states('input_datetime.vmc_master_accensione_giovedi_2') and states('input_datetime.vmc_master_spegnimento_giovedi') < states('input_datetime.vmc_master_spegnimento_giovedi_2') and states('input_datetime.vmc_master_accensione_giovedi') != states('input_datetime.vmc_master_accensione_giovedi_2') and states('input_datetime.vmc_master_spegnimento_giovedi') != states('input_datetime.vmc_master_spegnimento_giovedi_2') and states('input_datetime.vmc_master_spegnimento_giovedi') != states('input_datetime.vmc_master_accensione_giovedi_2') and states('input_datetime.vmc_master_accensione_giovedi_2') > states('input_datetime.vmc_master_spegnimento_giovedi') and states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_calendario') == 'on' %}
              Giovedi, {{ states('input_datetime.vmc_master_spegnimento_giovedi_2')[0:5] }}
            {% elif weekday == 4 and states('input_datetime.vmc_master_accensione_venerdi') < states('input_datetime.vmc_master_spegnimento_venerdi') and states('input_datetime.vmc_master_accensione_venerdi') != states('input_datetime.vmc_master_spegnimento_venerdi') and states('input_datetime.vmc_master_accensione_venerdi_2') < states('input_datetime.vmc_master_spegnimento_venerdi_2') and states('input_datetime.vmc_master_accensione_venerdi_2') != states('input_datetime.vmc_master_spegnimento_venerdi_2') and states('input_datetime.vmc_master_accensione_venerdi') < states('input_datetime.vmc_master_accensione_venerdi_2') and states('input_datetime.vmc_master_spegnimento_venerdi') < states('input_datetime.vmc_master_spegnimento_venerdi_2') and states('input_datetime.vmc_master_accensione_venerdi') != states('input_datetime.vmc_master_accensione_venerdi_2') and states('input_datetime.vmc_master_spegnimento_venerdi') != states('input_datetime.vmc_master_spegnimento_venerdi_2') and states('input_datetime.vmc_master_spegnimento_venerdi') != states('input_datetime.vmc_master_accensione_venerdi_2') and states('input_datetime.vmc_master_accensione_venerdi_2') > states('input_datetime.vmc_master_spegnimento_venerdi') and states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_calendario') == 'on' %}
              Venerdi, {{ states('input_datetime.vmc_master_spegnimento_venerdi_2')[0:5] }}
            {% elif weekday == 5 and states('input_datetime.vmc_master_accensione_sabato') < states('input_datetime.vmc_master_spegnimento_sabato') and states('input_datetime.vmc_master_accensione_sabato') != states('input_datetime.vmc_master_spegnimento_sabato') and states('input_datetime.vmc_master_accensione_sabato_2') < states('input_datetime.vmc_master_spegnimento_sabato_2') and states('input_datetime.vmc_master_accensione_sabato_2') != states('input_datetime.vmc_master_spegnimento_sabato_2') and states('input_datetime.vmc_master_accensione_sabato') < states('input_datetime.vmc_master_accensione_sabato_2') and states('input_datetime.vmc_master_spegnimento_sabato') < states('input_datetime.vmc_master_spegnimento_sabato_2') and states('input_datetime.vmc_master_accensione_sabato') != states('input_datetime.vmc_master_accensione_sabato_2') and states('input_datetime.vmc_master_spegnimento_sabato') != states('input_datetime.vmc_master_spegnimento_sabato_2') and states('input_datetime.vmc_master_spegnimento_sabato') != states('input_datetime.vmc_master_accensione_sabato_2') and states('input_datetime.vmc_master_accensione_sabato_2') > states('input_datetime.vmc_master_spegnimento_sabato') and states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_calendario') == 'on' %}
              Sabato, {{ states('input_datetime.vmc_master_spegnimento_sabato_2')[0:5] }}
            {% elif weekday == 6 and states('input_datetime.vmc_master_accensione_domenica') < states('input_datetime.vmc_master_spegnimento_domenica') and states('input_datetime.vmc_master_accensione_domenica') != states('input_datetime.vmc_master_spegnimento_domenica') and states('input_datetime.vmc_master_accensione_domenica_2') < states('input_datetime.vmc_master_spegnimento_domenica_2') and states('input_datetime.vmc_master_accensione_domenica_2') != states('input_datetime.vmc_master_spegnimento_domenica_2') and states('input_datetime.vmc_master_accensione_domenica') < states('input_datetime.vmc_master_accensione_domenica_2') and states('input_datetime.vmc_master_spegnimento_domenica') < states('input_datetime.vmc_master_spegnimento_domenica_2') and states('input_datetime.vmc_master_accensione_domenica') != states('input_datetime.vmc_master_accensione_domenica_2') and states('input_datetime.vmc_master_spegnimento_domenica') != states('input_datetime.vmc_master_spegnimento_domenica_2') and states('input_datetime.vmc_master_spegnimento_domenica') != states('input_datetime.vmc_master_accensione_domenica_2') and states('input_datetime.vmc_master_accensione_domenica_2') > states('input_datetime.vmc_master_spegnimento_domenica') and states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_calendario') == 'on' %}
              Domenica, {{ states('input_datetime.vmc_master_spegnimento_domenica_2')[0:5] }}
              {% else %}
                Disabilitata
              {% endif %}
          {% endif %}         
        icon_template: mdi:timer-stop-outline
        
      vmc_master_status_accensione_vmc_tramite_calendario:                     # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI] [INTERFACCIA, PIU’ RICHIAMI] SENSORE DI VERIFICA 1° FASCIA ACCENSIONE SE GLI ORARI SONO STATI INSERITI CORRETTAMENTE, DIVERSAMENTE MOSTRERA' "DISABILITATA"
        friendly_name: "1° Accensione programmata"
        value_template: >-
          {% set stati = ['unknown', 'unavailable'] %}
          {% if states('sensor.vmc_master_sensori') in stati %}
            Non disponibile
          {% else %}        
            {% set weekday = now().weekday() %}
            {% if weekday == 0 and states('input_datetime.vmc_master_accensione_lunedi') < states('input_datetime.vmc_master_spegnimento_lunedi') and states('input_datetime.vmc_master_accensione_lunedi') != states('input_datetime.vmc_master_spegnimento_lunedi') and states('input_datetime.vmc_master_accensione_lunedi_2') < states('input_datetime.vmc_master_spegnimento_lunedi_2') and states('input_datetime.vmc_master_accensione_lunedi_2') != states('input_datetime.vmc_master_spegnimento_lunedi_2') and states('input_datetime.vmc_master_accensione_lunedi') < states('input_datetime.vmc_master_accensione_lunedi_2') and states('input_datetime.vmc_master_spegnimento_lunedi') < states('input_datetime.vmc_master_spegnimento_lunedi_2') and states('input_datetime.vmc_master_accensione_lunedi') != states('input_datetime.vmc_master_accensione_lunedi_2') and states('input_datetime.vmc_master_spegnimento_lunedi') != states('input_datetime.vmc_master_spegnimento_lunedi_2') and states('input_datetime.vmc_master_spegnimento_lunedi') != states('input_datetime.vmc_master_accensione_lunedi_2') and states('input_datetime.vmc_master_accensione_lunedi_2') > states('input_datetime.vmc_master_spegnimento_lunedi') and states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_calendario') == 'on' %}
              Lunedi
            {% elif weekday == 1 and states('input_datetime.vmc_master_accensione_martedi') < states('input_datetime.vmc_master_spegnimento_martedi') and states('input_datetime.vmc_master_accensione_martedi') != states('input_datetime.vmc_master_spegnimento_martedi') and states('input_datetime.vmc_master_accensione_martedi_2') < states('input_datetime.vmc_master_spegnimento_martedi_2') and states('input_datetime.vmc_master_accensione_martedi_2') != states('input_datetime.vmc_master_spegnimento_martedi_2') and states('input_datetime.vmc_master_accensione_martedi') < states('input_datetime.vmc_master_accensione_martedi_2') and states('input_datetime.vmc_master_spegnimento_martedi') < states('input_datetime.vmc_master_spegnimento_martedi_2') and states('input_datetime.vmc_master_accensione_martedi') != states('input_datetime.vmc_master_accensione_martedi_2') and states('input_datetime.vmc_master_spegnimento_martedi') != states('input_datetime.vmc_master_spegnimento_martedi_2') and states('input_datetime.vmc_master_spegnimento_martedi') != states('input_datetime.vmc_master_accensione_martedi_2') and states('input_datetime.vmc_master_accensione_martedi_2') > states('input_datetime.vmc_master_spegnimento_martedi') and states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_calendario') == 'on' %}
              Martedi
            {% elif weekday == 2 and states('input_datetime.vmc_master_accensione_mercoledi') < states('input_datetime.vmc_master_spegnimento_mercoledi') and states('input_datetime.vmc_master_accensione_mercoledi') != states('input_datetime.vmc_master_spegnimento_mercoledi') and states('input_datetime.vmc_master_accensione_mercoledi_2') < states('input_datetime.vmc_master_spegnimento_mercoledi_2') and states('input_datetime.vmc_master_accensione_mercoledi_2') != states('input_datetime.vmc_master_spegnimento_mercoledi_2') and states('input_datetime.vmc_master_accensione_mercoledi') < states('input_datetime.vmc_master_accensione_mercoledi_2') and states('input_datetime.vmc_master_spegnimento_mercoledi') < states('input_datetime.vmc_master_spegnimento_mercoledi_2') and states('input_datetime.vmc_master_accensione_mercoledi') != states('input_datetime.vmc_master_accensione_mercoledi_2') and states('input_datetime.vmc_master_spegnimento_mercoledi') != states('input_datetime.vmc_master_spegnimento_mercoledi_2') and states('input_datetime.vmc_master_spegnimento_mercoledi') != states('input_datetime.vmc_master_accensione_mercoledi_2') and states('input_datetime.vmc_master_accensione_mercoledi_2') > states('input_datetime.vmc_master_spegnimento_mercoledi') and states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_calendario') == 'on' %}
              Mercoledi
            {% elif weekday == 3 and states('input_datetime.vmc_master_accensione_giovedi') < states('input_datetime.vmc_master_spegnimento_giovedi') and states('input_datetime.vmc_master_accensione_giovedi') != states('input_datetime.vmc_master_spegnimento_giovedi') and states('input_datetime.vmc_master_accensione_giovedi_2') < states('input_datetime.vmc_master_spegnimento_giovedi_2') and states('input_datetime.vmc_master_accensione_giovedi_2') != states('input_datetime.vmc_master_spegnimento_giovedi_2') and states('input_datetime.vmc_master_accensione_giovedi') < states('input_datetime.vmc_master_accensione_giovedi_2') and states('input_datetime.vmc_master_spegnimento_giovedi') < states('input_datetime.vmc_master_spegnimento_giovedi_2') and states('input_datetime.vmc_master_accensione_giovedi') != states('input_datetime.vmc_master_accensione_giovedi_2') and states('input_datetime.vmc_master_spegnimento_giovedi') != states('input_datetime.vmc_master_spegnimento_giovedi_2') and states('input_datetime.vmc_master_spegnimento_giovedi') != states('input_datetime.vmc_master_accensione_giovedi_2') and states('input_datetime.vmc_master_accensione_giovedi_2') > states('input_datetime.vmc_master_spegnimento_giovedi') and states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_calendario') == 'on' %}
              Giovedi
            {% elif weekday == 4 and states('input_datetime.vmc_master_accensione_venerdi') < states('input_datetime.vmc_master_spegnimento_venerdi') and states('input_datetime.vmc_master_accensione_venerdi') != states('input_datetime.vmc_master_spegnimento_venerdi') and states('input_datetime.vmc_master_accensione_venerdi_2') < states('input_datetime.vmc_master_spegnimento_venerdi_2') and states('input_datetime.vmc_master_accensione_venerdi_2') != states('input_datetime.vmc_master_spegnimento_venerdi_2') and states('input_datetime.vmc_master_accensione_venerdi') < states('input_datetime.vmc_master_accensione_venerdi_2') and states('input_datetime.vmc_master_spegnimento_venerdi') < states('input_datetime.vmc_master_spegnimento_venerdi_2') and states('input_datetime.vmc_master_accensione_venerdi') != states('input_datetime.vmc_master_accensione_venerdi_2') and states('input_datetime.vmc_master_spegnimento_venerdi') != states('input_datetime.vmc_master_spegnimento_venerdi_2') and states('input_datetime.vmc_master_spegnimento_venerdi') != states('input_datetime.vmc_master_accensione_venerdi_2') and states('input_datetime.vmc_master_accensione_venerdi_2') > states('input_datetime.vmc_master_spegnimento_venerdi') and states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_calendario') == 'on' %}
              Venerdi
            {% elif weekday == 5 and states('input_datetime.vmc_master_accensione_sabato') < states('input_datetime.vmc_master_spegnimento_sabato') and states('input_datetime.vmc_master_accensione_sabato') != states('input_datetime.vmc_master_spegnimento_sabato') and states('input_datetime.vmc_master_accensione_sabato_2') < states('input_datetime.vmc_master_spegnimento_sabato_2') and states('input_datetime.vmc_master_accensione_sabato_2') != states('input_datetime.vmc_master_spegnimento_sabato_2') and states('input_datetime.vmc_master_accensione_sabato') < states('input_datetime.vmc_master_accensione_sabato_2') and states('input_datetime.vmc_master_spegnimento_sabato') < states('input_datetime.vmc_master_spegnimento_sabato_2') and states('input_datetime.vmc_master_accensione_sabato') != states('input_datetime.vmc_master_accensione_sabato_2') and states('input_datetime.vmc_master_spegnimento_sabato') != states('input_datetime.vmc_master_spegnimento_sabato_2') and states('input_datetime.vmc_master_spegnimento_sabato') != states('input_datetime.vmc_master_accensione_sabato_2') and states('input_datetime.vmc_master_accensione_sabato_2') > states('input_datetime.vmc_master_spegnimento_sabato') and states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_calendario') == 'on' %}
              Sabato
            {% elif weekday == 6 and states('input_datetime.vmc_master_accensione_domenica') < states('input_datetime.vmc_master_spegnimento_domenica') and states('input_datetime.vmc_master_accensione_domenica') != states('input_datetime.vmc_master_spegnimento_domenica') and states('input_datetime.vmc_master_accensione_domenica_2') < states('input_datetime.vmc_master_spegnimento_domenica_2') and states('input_datetime.vmc_master_accensione_domenica_2') != states('input_datetime.vmc_master_spegnimento_domenica_2') and states('input_datetime.vmc_master_accensione_domenica') < states('input_datetime.vmc_master_accensione_domenica_2') and states('input_datetime.vmc_master_spegnimento_domenica') < states('input_datetime.vmc_master_spegnimento_domenica_2') and states('input_datetime.vmc_master_accensione_domenica') != states('input_datetime.vmc_master_accensione_domenica_2') and states('input_datetime.vmc_master_spegnimento_domenica') != states('input_datetime.vmc_master_spegnimento_domenica_2') and states('input_datetime.vmc_master_spegnimento_domenica') != states('input_datetime.vmc_master_accensione_domenica_2') and states('input_datetime.vmc_master_accensione_domenica_2') > states('input_datetime.vmc_master_spegnimento_domenica') and states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_calendario') == 'on' %}
              Domenica
              {% else %}
                Disabilitata
              {% endif %}
          {% endif %}            
        icon_template: mdi:timer-play-outline

      vmc_master_status_accensione_vmc_tramite_calendario_2:                   #  [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI] [INTERFACCIA, PIU’ RICHIAMI] SENSORE DI VERIFICA 2° FASCIA ACCENSIONE SE GLI ORARI SONO STATI INSERITI CORRETTAMENTE, DIVERSAMENTE MOSTRERA' "DISABILITATA"
        friendly_name: "2° Accensione programmata"
        value_template: >-
          {% set stati = ['unknown', 'unavailable'] %}
          {% if states('sensor.vmc_master_sensori') in stati %}
            Non disponibile
          {% else %}        
            {% set weekday = now().weekday() %}
            {% if weekday == 0 and states('input_datetime.vmc_master_accensione_lunedi') < states('input_datetime.vmc_master_spegnimento_lunedi') and states('input_datetime.vmc_master_accensione_lunedi') != states('input_datetime.vmc_master_spegnimento_lunedi') and states('input_datetime.vmc_master_accensione_lunedi_2') < states('input_datetime.vmc_master_spegnimento_lunedi_2') and states('input_datetime.vmc_master_accensione_lunedi_2') != states('input_datetime.vmc_master_spegnimento_lunedi_2') and states('input_datetime.vmc_master_accensione_lunedi') < states('input_datetime.vmc_master_accensione_lunedi_2') and states('input_datetime.vmc_master_spegnimento_lunedi') < states('input_datetime.vmc_master_spegnimento_lunedi_2') and states('input_datetime.vmc_master_accensione_lunedi') != states('input_datetime.vmc_master_accensione_lunedi_2') and states('input_datetime.vmc_master_spegnimento_lunedi') != states('input_datetime.vmc_master_spegnimento_lunedi_2') and states('input_datetime.vmc_master_spegnimento_lunedi') != states('input_datetime.vmc_master_accensione_lunedi_2') and states('input_datetime.vmc_master_accensione_lunedi_2') > states('input_datetime.vmc_master_spegnimento_lunedi') and states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_calendario') == 'on' %}
              Lunedi
            {% elif weekday == 1 and states('input_datetime.vmc_master_accensione_martedi') < states('input_datetime.vmc_master_spegnimento_martedi') and states('input_datetime.vmc_master_accensione_martedi') != states('input_datetime.vmc_master_spegnimento_martedi') and states('input_datetime.vmc_master_accensione_martedi_2') < states('input_datetime.vmc_master_spegnimento_martedi_2') and states('input_datetime.vmc_master_accensione_martedi_2') != states('input_datetime.vmc_master_spegnimento_martedi_2') and states('input_datetime.vmc_master_accensione_martedi') < states('input_datetime.vmc_master_accensione_martedi_2') and states('input_datetime.vmc_master_spegnimento_martedi') < states('input_datetime.vmc_master_spegnimento_martedi_2') and states('input_datetime.vmc_master_accensione_martedi') != states('input_datetime.vmc_master_accensione_martedi_2') and states('input_datetime.vmc_master_spegnimento_martedi') != states('input_datetime.vmc_master_spegnimento_martedi_2') and states('input_datetime.vmc_master_spegnimento_martedi') != states('input_datetime.vmc_master_accensione_martedi_2') and states('input_datetime.vmc_master_accensione_martedi_2') > states('input_datetime.vmc_master_spegnimento_martedi') and states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_calendario') == 'on' %}
              Martedi
            {% elif weekday == 2 and states('input_datetime.vmc_master_accensione_mercoledi') < states('input_datetime.vmc_master_spegnimento_mercoledi') and states('input_datetime.vmc_master_accensione_mercoledi') != states('input_datetime.vmc_master_spegnimento_mercoledi') and states('input_datetime.vmc_master_accensione_mercoledi_2') < states('input_datetime.vmc_master_spegnimento_mercoledi_2') and states('input_datetime.vmc_master_accensione_mercoledi_2') != states('input_datetime.vmc_master_spegnimento_mercoledi_2') and states('input_datetime.vmc_master_accensione_mercoledi') < states('input_datetime.vmc_master_accensione_mercoledi_2') and states('input_datetime.vmc_master_spegnimento_mercoledi') < states('input_datetime.vmc_master_spegnimento_mercoledi_2') and states('input_datetime.vmc_master_accensione_mercoledi') != states('input_datetime.vmc_master_accensione_mercoledi_2') and states('input_datetime.vmc_master_spegnimento_mercoledi') != states('input_datetime.vmc_master_spegnimento_mercoledi_2') and states('input_datetime.vmc_master_spegnimento_mercoledi') != states('input_datetime.vmc_master_accensione_mercoledi_2') and states('input_datetime.vmc_master_accensione_mercoledi_2') > states('input_datetime.vmc_master_spegnimento_mercoledi') and states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_calendario') == 'on' %}
              Mercoledi
            {% elif weekday == 3 and states('input_datetime.vmc_master_accensione_giovedi') < states('input_datetime.vmc_master_spegnimento_giovedi') and states('input_datetime.vmc_master_accensione_giovedi') != states('input_datetime.vmc_master_spegnimento_giovedi') and states('input_datetime.vmc_master_accensione_giovedi_2') < states('input_datetime.vmc_master_spegnimento_giovedi_2') and states('input_datetime.vmc_master_accensione_giovedi_2') != states('input_datetime.vmc_master_spegnimento_giovedi_2') and states('input_datetime.vmc_master_accensione_giovedi') < states('input_datetime.vmc_master_accensione_giovedi_2') and states('input_datetime.vmc_master_spegnimento_giovedi') < states('input_datetime.vmc_master_spegnimento_giovedi_2') and states('input_datetime.vmc_master_accensione_giovedi') != states('input_datetime.vmc_master_accensione_giovedi_2') and states('input_datetime.vmc_master_spegnimento_giovedi') != states('input_datetime.vmc_master_spegnimento_giovedi_2') and states('input_datetime.vmc_master_spegnimento_giovedi') != states('input_datetime.vmc_master_accensione_giovedi_2') and states('input_datetime.vmc_master_accensione_giovedi_2') > states('input_datetime.vmc_master_spegnimento_giovedi') and states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_calendario') == 'on' %}
              Giovedi
            {% elif weekday == 4 and states('input_datetime.vmc_master_accensione_venerdi') < states('input_datetime.vmc_master_spegnimento_venerdi') and states('input_datetime.vmc_master_accensione_venerdi') != states('input_datetime.vmc_master_spegnimento_venerdi') and states('input_datetime.vmc_master_accensione_venerdi_2') < states('input_datetime.vmc_master_spegnimento_venerdi_2') and states('input_datetime.vmc_master_accensione_venerdi_2') != states('input_datetime.vmc_master_spegnimento_venerdi_2') and states('input_datetime.vmc_master_accensione_venerdi') < states('input_datetime.vmc_master_accensione_venerdi_2') and states('input_datetime.vmc_master_spegnimento_venerdi') < states('input_datetime.vmc_master_spegnimento_venerdi_2') and states('input_datetime.vmc_master_accensione_venerdi') != states('input_datetime.vmc_master_accensione_venerdi_2') and states('input_datetime.vmc_master_spegnimento_venerdi') != states('input_datetime.vmc_master_spegnimento_venerdi_2') and states('input_datetime.vmc_master_spegnimento_venerdi') != states('input_datetime.vmc_master_accensione_venerdi_2') and states('input_datetime.vmc_master_accensione_venerdi_2') > states('input_datetime.vmc_master_spegnimento_venerdi') and states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_calendario') == 'on' %}
              Venerdi
            {% elif weekday == 5 and states('input_datetime.vmc_master_accensione_sabato') < states('input_datetime.vmc_master_spegnimento_sabato') and states('input_datetime.vmc_master_accensione_sabato') != states('input_datetime.vmc_master_spegnimento_sabato') and states('input_datetime.vmc_master_accensione_sabato_2') < states('input_datetime.vmc_master_spegnimento_sabato_2') and states('input_datetime.vmc_master_accensione_sabato_2') != states('input_datetime.vmc_master_spegnimento_sabato_2') and states('input_datetime.vmc_master_accensione_sabato') < states('input_datetime.vmc_master_accensione_sabato_2') and states('input_datetime.vmc_master_spegnimento_sabato') < states('input_datetime.vmc_master_spegnimento_sabato_2') and states('input_datetime.vmc_master_accensione_sabato') != states('input_datetime.vmc_master_accensione_sabato_2') and states('input_datetime.vmc_master_spegnimento_sabato') != states('input_datetime.vmc_master_spegnimento_sabato_2') and states('input_datetime.vmc_master_spegnimento_sabato') != states('input_datetime.vmc_master_accensione_sabato_2') and states('input_datetime.vmc_master_accensione_sabato_2') > states('input_datetime.vmc_master_spegnimento_sabato') and states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_calendario') == 'on' %}
              Sabato
            {% elif weekday == 6 and states('input_datetime.vmc_master_accensione_domenica') < states('input_datetime.vmc_master_spegnimento_domenica') and states('input_datetime.vmc_master_accensione_domenica') != states('input_datetime.vmc_master_spegnimento_domenica') and states('input_datetime.vmc_master_accensione_domenica_2') < states('input_datetime.vmc_master_spegnimento_domenica_2') and states('input_datetime.vmc_master_accensione_domenica_2') != states('input_datetime.vmc_master_spegnimento_domenica_2') and states('input_datetime.vmc_master_accensione_domenica') < states('input_datetime.vmc_master_accensione_domenica_2') and states('input_datetime.vmc_master_spegnimento_domenica') < states('input_datetime.vmc_master_spegnimento_domenica_2') and states('input_datetime.vmc_master_accensione_domenica') != states('input_datetime.vmc_master_accensione_domenica_2') and states('input_datetime.vmc_master_spegnimento_domenica') != states('input_datetime.vmc_master_spegnimento_domenica_2') and states('input_datetime.vmc_master_spegnimento_domenica') != states('input_datetime.vmc_master_accensione_domenica_2') and states('input_datetime.vmc_master_accensione_domenica_2') > states('input_datetime.vmc_master_spegnimento_domenica') and states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_calendario') == 'on' %}
              Domenica
              {% else %}
                Disabilitata
              {% endif %}
          {% endif %}            
        icon_template: mdi:timer-play-outline

      vmc_master_status_spegnimento_vmc_tramite_calendario:                    # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI] [INTERFACCIA, PIU’ RICHIAMI]  SENSORE DI VERIFICA 1° FASCIA SPEGNIMENTO SE GLI ORARI SONO STATI INSERITI CORRETTAMENTE, DIVERSAMENTE MOSTRERA' "DISABILITATO"
        friendly_name: "1° Spegnimento programmato"
        value_template: >-
          {% set stati = ['unknown', 'unavailable'] %}
          {% if states('sensor.vmc_master_sensori') in stati %}
            Non disponibile
          {% else %}        
            {% set weekday = now().weekday() %}
            {% if weekday == 0 and states('input_datetime.vmc_master_accensione_lunedi') < states('input_datetime.vmc_master_spegnimento_lunedi') and states('input_datetime.vmc_master_accensione_lunedi') != states('input_datetime.vmc_master_spegnimento_lunedi') and states('input_datetime.vmc_master_accensione_lunedi_2') < states('input_datetime.vmc_master_spegnimento_lunedi_2') and states('input_datetime.vmc_master_accensione_lunedi_2') != states('input_datetime.vmc_master_spegnimento_lunedi_2') and states('input_datetime.vmc_master_accensione_lunedi') < states('input_datetime.vmc_master_accensione_lunedi_2') and states('input_datetime.vmc_master_spegnimento_lunedi') < states('input_datetime.vmc_master_spegnimento_lunedi_2') and states('input_datetime.vmc_master_accensione_lunedi') != states('input_datetime.vmc_master_accensione_lunedi_2') and states('input_datetime.vmc_master_spegnimento_lunedi') != states('input_datetime.vmc_master_spegnimento_lunedi_2') and states('input_datetime.vmc_master_spegnimento_lunedi') != states('input_datetime.vmc_master_accensione_lunedi_2') and states('input_datetime.vmc_master_accensione_lunedi_2') > states('input_datetime.vmc_master_spegnimento_lunedi') and states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_calendario') == 'on' %}
              Lunedi
            {% elif weekday == 1 and states('input_datetime.vmc_master_accensione_martedi') < states('input_datetime.vmc_master_spegnimento_martedi') and states('input_datetime.vmc_master_accensione_martedi') != states('input_datetime.vmc_master_spegnimento_martedi') and states('input_datetime.vmc_master_accensione_martedi_2') < states('input_datetime.vmc_master_spegnimento_martedi_2') and states('input_datetime.vmc_master_accensione_martedi_2') != states('input_datetime.vmc_master_spegnimento_martedi_2') and states('input_datetime.vmc_master_accensione_martedi') < states('input_datetime.vmc_master_accensione_martedi_2') and states('input_datetime.vmc_master_spegnimento_martedi') < states('input_datetime.vmc_master_spegnimento_martedi_2') and states('input_datetime.vmc_master_accensione_martedi') != states('input_datetime.vmc_master_accensione_martedi_2') and states('input_datetime.vmc_master_spegnimento_martedi') != states('input_datetime.vmc_master_spegnimento_martedi_2') and states('input_datetime.vmc_master_spegnimento_martedi') != states('input_datetime.vmc_master_accensione_martedi_2') and states('input_datetime.vmc_master_accensione_martedi_2') > states('input_datetime.vmc_master_spegnimento_martedi') and states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_calendario') == 'on' %}
              Martedi
            {% elif weekday == 2 and states('input_datetime.vmc_master_accensione_mercoledi') < states('input_datetime.vmc_master_spegnimento_mercoledi') and states('input_datetime.vmc_master_accensione_mercoledi') != states('input_datetime.vmc_master_spegnimento_mercoledi') and states('input_datetime.vmc_master_accensione_mercoledi_2') < states('input_datetime.vmc_master_spegnimento_mercoledi_2') and states('input_datetime.vmc_master_accensione_mercoledi_2') != states('input_datetime.vmc_master_spegnimento_mercoledi_2') and states('input_datetime.vmc_master_accensione_mercoledi') < states('input_datetime.vmc_master_accensione_mercoledi_2') and states('input_datetime.vmc_master_spegnimento_mercoledi') < states('input_datetime.vmc_master_spegnimento_mercoledi_2') and states('input_datetime.vmc_master_accensione_mercoledi') != states('input_datetime.vmc_master_accensione_mercoledi_2') and states('input_datetime.vmc_master_spegnimento_mercoledi') != states('input_datetime.vmc_master_spegnimento_mercoledi_2') and states('input_datetime.vmc_master_spegnimento_mercoledi') != states('input_datetime.vmc_master_accensione_mercoledi_2') and states('input_datetime.vmc_master_accensione_mercoledi_2') > states('input_datetime.vmc_master_spegnimento_mercoledi') and states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_calendario') == 'on' %}
              Mercoledi
            {% elif weekday == 3 and states('input_datetime.vmc_master_accensione_giovedi') < states('input_datetime.vmc_master_spegnimento_giovedi') and states('input_datetime.vmc_master_accensione_giovedi') != states('input_datetime.vmc_master_spegnimento_giovedi') and states('input_datetime.vmc_master_accensione_giovedi_2') < states('input_datetime.vmc_master_spegnimento_giovedi_2') and states('input_datetime.vmc_master_accensione_giovedi_2') != states('input_datetime.vmc_master_spegnimento_giovedi_2') and states('input_datetime.vmc_master_accensione_giovedi') < states('input_datetime.vmc_master_accensione_giovedi_2') and states('input_datetime.vmc_master_spegnimento_giovedi') < states('input_datetime.vmc_master_spegnimento_giovedi_2') and states('input_datetime.vmc_master_accensione_giovedi') != states('input_datetime.vmc_master_accensione_giovedi_2') and states('input_datetime.vmc_master_spegnimento_giovedi') != states('input_datetime.vmc_master_spegnimento_giovedi_2') and states('input_datetime.vmc_master_spegnimento_giovedi') != states('input_datetime.vmc_master_accensione_giovedi_2') and states('input_datetime.vmc_master_accensione_giovedi_2') > states('input_datetime.vmc_master_spegnimento_giovedi') and states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_calendario') == 'on' %}
              Giovedi
            {% elif weekday == 4 and states('input_datetime.vmc_master_accensione_venerdi') < states('input_datetime.vmc_master_spegnimento_venerdi') and states('input_datetime.vmc_master_accensione_venerdi') != states('input_datetime.vmc_master_spegnimento_venerdi') and states('input_datetime.vmc_master_accensione_venerdi_2') < states('input_datetime.vmc_master_spegnimento_venerdi_2') and states('input_datetime.vmc_master_accensione_venerdi_2') != states('input_datetime.vmc_master_spegnimento_venerdi_2') and states('input_datetime.vmc_master_accensione_venerdi') < states('input_datetime.vmc_master_accensione_venerdi_2') and states('input_datetime.vmc_master_spegnimento_venerdi') < states('input_datetime.vmc_master_spegnimento_venerdi_2') and states('input_datetime.vmc_master_accensione_venerdi') != states('input_datetime.vmc_master_accensione_venerdi_2') and states('input_datetime.vmc_master_spegnimento_venerdi') != states('input_datetime.vmc_master_spegnimento_venerdi_2') and states('input_datetime.vmc_master_spegnimento_venerdi') != states('input_datetime.vmc_master_accensione_venerdi_2') and states('input_datetime.vmc_master_accensione_venerdi_2') > states('input_datetime.vmc_master_spegnimento_venerdi') and states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_calendario') == 'on' %}
              Venerdi
            {% elif weekday == 5 and states('input_datetime.vmc_master_accensione_sabato') < states('input_datetime.vmc_master_spegnimento_sabato') and states('input_datetime.vmc_master_accensione_sabato') != states('input_datetime.vmc_master_spegnimento_sabato') and states('input_datetime.vmc_master_accensione_sabato_2') < states('input_datetime.vmc_master_spegnimento_sabato_2') and states('input_datetime.vmc_master_accensione_sabato_2') != states('input_datetime.vmc_master_spegnimento_sabato_2') and states('input_datetime.vmc_master_accensione_sabato') < states('input_datetime.vmc_master_accensione_sabato_2') and states('input_datetime.vmc_master_spegnimento_sabato') < states('input_datetime.vmc_master_spegnimento_sabato_2') and states('input_datetime.vmc_master_accensione_sabato') != states('input_datetime.vmc_master_accensione_sabato_2') and states('input_datetime.vmc_master_spegnimento_sabato') != states('input_datetime.vmc_master_spegnimento_sabato_2') and states('input_datetime.vmc_master_spegnimento_sabato') != states('input_datetime.vmc_master_accensione_sabato_2') and states('input_datetime.vmc_master_accensione_sabato_2') > states('input_datetime.vmc_master_spegnimento_sabato') and states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_calendario') == 'on' %}
              Sabato
            {% elif weekday == 6 and states('input_datetime.vmc_master_accensione_domenica') < states('input_datetime.vmc_master_spegnimento_domenica') and states('input_datetime.vmc_master_accensione_domenica') != states('input_datetime.vmc_master_spegnimento_domenica') and states('input_datetime.vmc_master_accensione_domenica_2') < states('input_datetime.vmc_master_spegnimento_domenica_2') and states('input_datetime.vmc_master_accensione_domenica_2') != states('input_datetime.vmc_master_spegnimento_domenica_2') and states('input_datetime.vmc_master_accensione_domenica') < states('input_datetime.vmc_master_accensione_domenica_2') and states('input_datetime.vmc_master_spegnimento_domenica') < states('input_datetime.vmc_master_spegnimento_domenica_2') and states('input_datetime.vmc_master_accensione_domenica') != states('input_datetime.vmc_master_accensione_domenica_2') and states('input_datetime.vmc_master_spegnimento_domenica') != states('input_datetime.vmc_master_spegnimento_domenica_2') and states('input_datetime.vmc_master_spegnimento_domenica') != states('input_datetime.vmc_master_accensione_domenica_2') and states('input_datetime.vmc_master_accensione_domenica_2') > states('input_datetime.vmc_master_spegnimento_domenica') and states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_calendario') == 'on' %}
              Domenica
              {% else %}
                Disabilitata
              {% endif %}
          {% endif %}         
        icon_template: mdi:timer-stop-outline

      vmc_master_status_spegnimento_vmc_tramite_calendario_2:                  # vmc_master_status_spegnimento_vmc_tramite_calendario SENSORE DI VERIFICA 2° FASCIA SPEGNIMENTO SE GLI ORARI SONO STATI INSERITI CORRETTAMENTE, DIVERSAMENTE MOSTRERA' "DISABILITATO"
        friendly_name: "2° Spegnimento programmato"
        value_template: >-
          {% set stati = ['unknown', 'unavailable'] %}
          {% if states('sensor.vmc_master_sensori') in stati %}
            Non disponibile
          {% else %}        
            {% set weekday = now().weekday() %}
            {% if weekday == 0 and states('input_datetime.vmc_master_accensione_lunedi') < states('input_datetime.vmc_master_spegnimento_lunedi') and states('input_datetime.vmc_master_accensione_lunedi') != states('input_datetime.vmc_master_spegnimento_lunedi') and states('input_datetime.vmc_master_accensione_lunedi_2') < states('input_datetime.vmc_master_spegnimento_lunedi_2') and states('input_datetime.vmc_master_accensione_lunedi_2') != states('input_datetime.vmc_master_spegnimento_lunedi_2') and states('input_datetime.vmc_master_accensione_lunedi') < states('input_datetime.vmc_master_accensione_lunedi_2') and states('input_datetime.vmc_master_spegnimento_lunedi') < states('input_datetime.vmc_master_spegnimento_lunedi_2') and states('input_datetime.vmc_master_accensione_lunedi') != states('input_datetime.vmc_master_accensione_lunedi_2') and states('input_datetime.vmc_master_spegnimento_lunedi') != states('input_datetime.vmc_master_spegnimento_lunedi_2') and states('input_datetime.vmc_master_spegnimento_lunedi') != states('input_datetime.vmc_master_accensione_lunedi_2') and states('input_datetime.vmc_master_accensione_lunedi_2') > states('input_datetime.vmc_master_spegnimento_lunedi') and states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_calendario') == 'on' %}
              Lunedi
            {% elif weekday == 1 and states('input_datetime.vmc_master_accensione_martedi') < states('input_datetime.vmc_master_spegnimento_martedi') and states('input_datetime.vmc_master_accensione_martedi') != states('input_datetime.vmc_master_spegnimento_martedi') and states('input_datetime.vmc_master_accensione_martedi_2') < states('input_datetime.vmc_master_spegnimento_martedi_2') and states('input_datetime.vmc_master_accensione_martedi_2') != states('input_datetime.vmc_master_spegnimento_martedi_2') and states('input_datetime.vmc_master_accensione_martedi') < states('input_datetime.vmc_master_accensione_martedi_2') and states('input_datetime.vmc_master_spegnimento_martedi') < states('input_datetime.vmc_master_spegnimento_martedi_2') and states('input_datetime.vmc_master_accensione_martedi') != states('input_datetime.vmc_master_accensione_martedi_2') and states('input_datetime.vmc_master_spegnimento_martedi') != states('input_datetime.vmc_master_spegnimento_martedi_2') and states('input_datetime.vmc_master_spegnimento_martedi') != states('input_datetime.vmc_master_accensione_martedi_2') and states('input_datetime.vmc_master_accensione_martedi_2') > states('input_datetime.vmc_master_spegnimento_martedi') and states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_calendario') == 'on' %}
              Martedi
            {% elif weekday == 2 and states('input_datetime.vmc_master_accensione_mercoledi') < states('input_datetime.vmc_master_spegnimento_mercoledi') and states('input_datetime.vmc_master_accensione_mercoledi') != states('input_datetime.vmc_master_spegnimento_mercoledi') and states('input_datetime.vmc_master_accensione_mercoledi_2') < states('input_datetime.vmc_master_spegnimento_mercoledi_2') and states('input_datetime.vmc_master_accensione_mercoledi_2') != states('input_datetime.vmc_master_spegnimento_mercoledi_2') and states('input_datetime.vmc_master_accensione_mercoledi') < states('input_datetime.vmc_master_accensione_mercoledi_2') and states('input_datetime.vmc_master_spegnimento_mercoledi') < states('input_datetime.vmc_master_spegnimento_mercoledi_2') and states('input_datetime.vmc_master_accensione_mercoledi') != states('input_datetime.vmc_master_accensione_mercoledi_2') and states('input_datetime.vmc_master_spegnimento_mercoledi') != states('input_datetime.vmc_master_spegnimento_mercoledi_2') and states('input_datetime.vmc_master_spegnimento_mercoledi') != states('input_datetime.vmc_master_accensione_mercoledi_2') and states('input_datetime.vmc_master_accensione_mercoledi_2') > states('input_datetime.vmc_master_spegnimento_mercoledi') and states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_calendario') == 'on' %}
              Mercoledi
            {% elif weekday == 3 and states('input_datetime.vmc_master_accensione_giovedi') < states('input_datetime.vmc_master_spegnimento_giovedi') and states('input_datetime.vmc_master_accensione_giovedi') != states('input_datetime.vmc_master_spegnimento_giovedi') and states('input_datetime.vmc_master_accensione_giovedi_2') < states('input_datetime.vmc_master_spegnimento_giovedi_2') and states('input_datetime.vmc_master_accensione_giovedi_2') != states('input_datetime.vmc_master_spegnimento_giovedi_2') and states('input_datetime.vmc_master_accensione_giovedi') < states('input_datetime.vmc_master_accensione_giovedi_2') and states('input_datetime.vmc_master_spegnimento_giovedi') < states('input_datetime.vmc_master_spegnimento_giovedi_2') and states('input_datetime.vmc_master_accensione_giovedi') != states('input_datetime.vmc_master_accensione_giovedi_2') and states('input_datetime.vmc_master_spegnimento_giovedi') != states('input_datetime.vmc_master_spegnimento_giovedi_2') and states('input_datetime.vmc_master_spegnimento_giovedi') != states('input_datetime.vmc_master_accensione_giovedi_2') and states('input_datetime.vmc_master_accensione_giovedi_2') > states('input_datetime.vmc_master_spegnimento_giovedi') and states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_calendario') == 'on' %}
              Giovedi
            {% elif weekday == 4 and states('input_datetime.vmc_master_accensione_venerdi') < states('input_datetime.vmc_master_spegnimento_venerdi') and states('input_datetime.vmc_master_accensione_venerdi') != states('input_datetime.vmc_master_spegnimento_venerdi') and states('input_datetime.vmc_master_accensione_venerdi_2') < states('input_datetime.vmc_master_spegnimento_venerdi_2') and states('input_datetime.vmc_master_accensione_venerdi_2') != states('input_datetime.vmc_master_spegnimento_venerdi_2') and states('input_datetime.vmc_master_accensione_venerdi') < states('input_datetime.vmc_master_accensione_venerdi_2') and states('input_datetime.vmc_master_spegnimento_venerdi') < states('input_datetime.vmc_master_spegnimento_venerdi_2') and states('input_datetime.vmc_master_accensione_venerdi') != states('input_datetime.vmc_master_accensione_venerdi_2') and states('input_datetime.vmc_master_spegnimento_venerdi') != states('input_datetime.vmc_master_spegnimento_venerdi_2') and states('input_datetime.vmc_master_spegnimento_venerdi') != states('input_datetime.vmc_master_accensione_venerdi_2') and states('input_datetime.vmc_master_accensione_venerdi_2') > states('input_datetime.vmc_master_spegnimento_venerdi') and states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_calendario') == 'on' %}
              Venerdi
            {% elif weekday == 5 and states('input_datetime.vmc_master_accensione_sabato') < states('input_datetime.vmc_master_spegnimento_sabato') and states('input_datetime.vmc_master_accensione_sabato') != states('input_datetime.vmc_master_spegnimento_sabato') and states('input_datetime.vmc_master_accensione_sabato_2') < states('input_datetime.vmc_master_spegnimento_sabato_2') and states('input_datetime.vmc_master_accensione_sabato_2') != states('input_datetime.vmc_master_spegnimento_sabato_2') and states('input_datetime.vmc_master_accensione_sabato') < states('input_datetime.vmc_master_accensione_sabato_2') and states('input_datetime.vmc_master_spegnimento_sabato') < states('input_datetime.vmc_master_spegnimento_sabato_2') and states('input_datetime.vmc_master_accensione_sabato') != states('input_datetime.vmc_master_accensione_sabato_2') and states('input_datetime.vmc_master_spegnimento_sabato') != states('input_datetime.vmc_master_spegnimento_sabato_2') and states('input_datetime.vmc_master_spegnimento_sabato') != states('input_datetime.vmc_master_accensione_sabato_2') and states('input_datetime.vmc_master_accensione_sabato_2') > states('input_datetime.vmc_master_spegnimento_sabato') and states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_calendario') == 'on' %}
              Sabato
            {% elif weekday == 6 and states('input_datetime.vmc_master_accensione_domenica') < states('input_datetime.vmc_master_spegnimento_domenica') and states('input_datetime.vmc_master_accensione_domenica') != states('input_datetime.vmc_master_spegnimento_domenica') and states('input_datetime.vmc_master_accensione_domenica_2') < states('input_datetime.vmc_master_spegnimento_domenica_2') and states('input_datetime.vmc_master_accensione_domenica_2') != states('input_datetime.vmc_master_spegnimento_domenica_2') and states('input_datetime.vmc_master_accensione_domenica') < states('input_datetime.vmc_master_accensione_domenica_2') and states('input_datetime.vmc_master_spegnimento_domenica') < states('input_datetime.vmc_master_spegnimento_domenica_2') and states('input_datetime.vmc_master_accensione_domenica') != states('input_datetime.vmc_master_accensione_domenica_2') and states('input_datetime.vmc_master_spegnimento_domenica') != states('input_datetime.vmc_master_spegnimento_domenica_2') and states('input_datetime.vmc_master_spegnimento_domenica') != states('input_datetime.vmc_master_accensione_domenica_2') and states('input_datetime.vmc_master_accensione_domenica_2') > states('input_datetime.vmc_master_spegnimento_domenica') and states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_calendario') == 'on' %}
              Domenica
              {% else %}
                Disabilitata
              {% endif %}
          {% endif %}         
        icon_template: mdi:timer-stop-outline

################### Fine Creazione Sensori Interfaccia Calendario  #################################################################################################################################################################

################### Inizio Creazione Sensori Interfaccia Free Heating - Free Cooling ###############################################################################################################################################

      vmc_master_status_check_freeheating_freecooling:
        friendly_name: "Check Range Free Heating e Free Cooling"
        value_template: >
          {% set stati = ['unknown', 'unavailable'] %}
          {% if states('sensor.vmc_master_sensori') in stati %}
            Non disponibile
          {% else %}
            {% set input1 = states('sensor.vmc_master_mese_1_fascia_freeheating') %}
            {% set input2 = states('sensor.vmc_master_mese_2_fascia_freeheating') %}
            {% set input3 = states('sensor.vmc_master_mese_1_fascia_freecooling') %}
            {% set input4 = states('sensor.vmc_master_mese_2_fascia_freecooling') %}
            {% if input1 in stati or input2 in stati or input3 in stati or input4 in stati %}
              Non disponibile
            {% else %}      
              {% if input1=='Gennaio'%}
                {% set month_numbers = {'Gennaio': 1, 'Febbraio': 2, 'Marzo': 3, 'Aprile': 4, 'Maggio': 5, 'Giugno': 6, 'Luglio': 7, 'Agosto': 8, 'Settembre': 9, 'Ottobre': 10, 'Novembre': 11, 'Dicembre': 12} %}
                {% set month_number1 = month_numbers.get(input1) | int%}
                {% set month_number2 = month_numbers.get(input2) | int%}
                {% set month_number3 = month_numbers.get(input3) | int%}
                {% set month_number4 = month_numbers.get(input4) | int%}
              {% elif input1=='Febbraio'%}   
                {% set month_numbers = {'Gennaio': 12, 'Febbraio': 1, 'Marzo': 2, 'Aprile': 3, 'Maggio': 4, 'Giugno': 5, 'Luglio': 6, 'Agosto': 7, 'Settembre': 8, 'Ottobre': 9, 'Novembre': 10, 'Dicembre': 11} %} 
                {% set month_number1 = month_numbers.get(input1) | int%}
                {% set month_number2 = month_numbers.get(input2) | int%}
                {% set month_number3 = month_numbers.get(input3) | int%}
                {% set month_number4 = month_numbers.get(input4) | int%}
              {% elif input1=='Marzo'%}   
                {% set month_numbers = {'Gennaio': 11, 'Febbraio': 12, 'Marzo': 1, 'Aprile': 2, 'Maggio': 3, 'Giugno': 4, 'Luglio': 5, 'Agosto': 6, 'Settembre': 7, 'Ottobre': 8, 'Novembre': 9, 'Dicembre': 10} %}   
                {% set month_number1 = month_numbers.get(input1) | int%}
                {% set month_number2 = month_numbers.get(input2) | int%}
                {% set month_number3 = month_numbers.get(input3) | int%}
                {% set month_number4 = month_numbers.get(input4) | int%}
              {% elif input1=='Aprile'%}   
                {% set month_numbers = {'Gennaio': 10, 'Febbraio': 11, 'Marzo': 12, 'Aprile': 1, 'Maggio': 2, 'Giugno': 3, 'Luglio': 4, 'Agosto': 5, 'Settembre': 6, 'Ottobre': 7, 'Novembre': 8, 'Dicembre': 9} %}  
                {% set month_number1 = month_numbers.get(input1) | int%}
                {% set month_number2 = month_numbers.get(input2) | int%}
                {% set month_number3 = month_numbers.get(input3) | int%}
                {% set month_number4 = month_numbers.get(input4) | int%}
              {% elif input1=='Maggio'%}   
                {% set month_numbers = {'Gennaio': 9, 'Febbraio': 10, 'Marzo': 11, 'Aprile': 12, 'Maggio': 1, 'Giugno': 2, 'Luglio': 3, 'Agosto': 4, 'Settembre': 5, 'Ottobre': 6, 'Novembre': 7, 'Dicembre': 8} %}  
                {% set month_number1 = month_numbers.get(input1) | int%}
                {% set month_number2 = month_numbers.get(input2) | int%}
                {% set month_number3 = month_numbers.get(input3) | int%}
                {% set month_number4 = month_numbers.get(input4) | int%}
              {% elif input1=='Giugno'%}   
                {% set month_numbers = {'Gennaio': 8, 'Febbraio': 9, 'Marzo': 10, 'Aprile': 11, 'Maggio': 12, 'Giugno': 1, 'Luglio': 2, 'Agosto': 3, 'Settembre': 4, 'Ottobre': 5, 'Novembre': 6, 'Dicembre': 7} %}  
                {% set month_number1 = month_numbers.get(input1) | int%}
                {% set month_number2 = month_numbers.get(input2) | int%}
                {% set month_number3 = month_numbers.get(input3) | int%}
                {% set month_number4 = month_numbers.get(input4) | int%}
              {% elif input1=='Luglio'%}   
                {% set month_numbers = {'Gennaio': 7, 'Febbraio': 8, 'Marzo': 9, 'Aprile': 10, 'Maggio': 11, 'Giugno': 12, 'Luglio': 1, 'Agosto': 2, 'Settembre': 3, 'Ottobre': 4, 'Novembre': 5, 'Dicembre': 6} %}  
                {% set month_number1 = month_numbers.get(input1) | int%}
                {% set month_number2 = month_numbers.get(input2) | int%}
                {% set month_number3 = month_numbers.get(input3) | int%}
                {% set month_number4 = month_numbers.get(input4) | int%}
              {% elif input1=='Agosto'%}   
                {% set month_numbers = {'Gennaio': 6, 'Febbraio': 7, 'Marzo': 8, 'Aprile': 9, 'Maggio': 10, 'Giugno': 11, 'Luglio': 12, 'Agosto': 1, 'Settembre': 2, 'Ottobre': 3, 'Novembre': 4, 'Dicembre': 5} %}  
                {% set month_number1 = month_numbers.get(input1) | int%}
                {% set month_number2 = month_numbers.get(input2) | int%}
                {% set month_number3 = month_numbers.get(input3) | int%}
                {% set month_number4 = month_numbers.get(input4) | int%}
              {% elif input1=='Settembre'%}   
                {% set month_numbers = {'Gennaio': 5, 'Febbraio': 6, 'Marzo': 7, 'Aprile': 8, 'Maggio': 9, 'Giugno': 10, 'Luglio': 11, 'Agosto': 12, 'Settembre': 1, 'Ottobre': 2, 'Novembre': 3, 'Dicembre': 4} %}  
                {% set month_number1 = month_numbers.get(input1) | int%}
                {% set month_number2 = month_numbers.get(input2) | int%}
                {% set month_number3 = month_numbers.get(input3) | int%}
                {% set month_number4 = month_numbers.get(input4) | int%}
              {% elif input1=='Ottobre'%}   
                {% set month_numbers = {'Gennaio': 4, 'Febbraio': 5, 'Marzo': 6, 'Aprile': 7, 'Maggio': 8, 'Giugno': 9, 'Luglio': 10, 'Agosto': 11, 'Settembre': 12, 'Ottobre': 1, 'Novembre': 2, 'Dicembre': 3} %}  
                {% set month_number1 = month_numbers.get(input1) | int%}
                {% set month_number2 = month_numbers.get(input2) | int%}
                {% set month_number3 = month_numbers.get(input3) | int%}
                {% set month_number4 = month_numbers.get(input4) | int%}
              {% elif input1=='Novembre'%}   
                {% set month_numbers = {'Gennaio': 3, 'Febbraio': 4, 'Marzo': 5, 'Aprile': 6, 'Maggio': 7, 'Giugno': 8, 'Luglio': 9, 'Agosto': 10, 'Settembre': 11, 'Ottobre': 12, 'Novembre': 1, 'Dicembre': 2} %}  
                {% set month_number1 = month_numbers.get(input1) | int%}
                {% set month_number2 = month_numbers.get(input2) | int%}
                {% set month_number3 = month_numbers.get(input3) | int%}
                {% set month_number4 = month_numbers.get(input4) | int%}
              {% elif input1=='Dicembre'%}   
                {% set month_numbers = {'Gennaio': 2, 'Febbraio': 3, 'Marzo': 4, 'Aprile': 5, 'Maggio': 6, 'Giugno': 7, 'Luglio': 8, 'Agosto': 9, 'Settembre': 10, 'Ottobre': 11, 'Novembre': 12, 'Dicembre': 1} %} 
                {% set month_number1 = month_numbers.get(input1) | int%}
                {% set month_number2 = month_numbers.get(input2) | int%}
                {% set month_number3 = month_numbers.get(input3) | int%}
                {% set month_number4 = month_numbers.get(input4) | int%}
              {% endif %}
              {% if month_number1 != month_number2 and month_number2 != month_number3 and month_number3 != month_number4 and month_number1 < month_number2 and month_number2 < month_number3 and month_number3 < month_number4 %}
                OK
              {% else %}
                NOT OK
              {% endif %}
            {% endif %}
          {% endif %}
        icon_template: mdi:checkbox-marked

      vmc_master_status_freeheating:
        friendly_name: "Check Free Heating"
        value_template: >
          {% set stati = ['unknown', 'unavailable'] %}
          {% if states('sensor.vmc_master_sensori') in stati %}
            Non disponibile
          {% else %}
            {% set input1_freeheating = states('sensor.vmc_master_mese_1_fascia_freeheating') %}
            {% set input2_freeheating = states('sensor.vmc_master_mese_2_fascia_freeheating') %}
            {% set check = states('sensor.vmc_master_status_check_freeheating_freecooling') %}
            {% set mese_corrente = now().strftime('%B') %}
            {% if input1_freeheating in stati or input2_freeheating in stati or check in stati %}
              Non disponibile
            {% else %}      
              {% if mese_corrente == 'January' %}
                {% set mese_corrente = 'Gennaio' %}
              {% elif mese_corrente == 'February' %}
                {% set mese_corrente = 'Febbraio' %}
              {% elif mese_corrente == 'March' %}
                {% set mese_corrente = 'Marzo' %}
              {% elif mese_corrente == 'April' %}
                {% set mese_corrente = 'Aprile' %}
              {% elif mese_corrente == 'May' %}
                {% set mese_corrente = 'Maggio' %}
              {% elif mese_corrente == 'June' %}
                {% set mese_corrente = 'Giugno' %}
              {% elif mese_corrente == 'July' %}
                {% set mese_corrente = 'Luglio' %}
              {% elif mese_corrente == 'August' %}
                {% set mese_corrente = 'Agosto' %}
              {% elif mese_corrente == 'September' %}
                {% set mese_corrente = 'Settembre' %}
              {% elif mese_corrente == 'October' %}
                {% set mese_corrente = 'Ottobre' %}
              {% elif mese_corrente == 'November' %}
                {% set mese_corrente = 'Novembre' %}
              {% elif mese_corrente == 'December' %}
                {% set mese_corrente = 'Dicembre' %}
              {% endif %}
              {% if input1_freeheating=='Gennaio'%}
                {% set months_freeheating = ['Gennaio', 'Febbraio', 'Marzo', 'Aprile', 'Maggio', 'Giugno', 'Luglio', 'Agosto', 'Settembre', 'Ottobre', 'Novembre', 'Dicembre'] %}
                {% set interval_1_freeheating = months_freeheating[months_freeheating.index(input1_freeheating):months_freeheating.index(input2_freeheating)+1] %}
              {% elif input1_freeheating=='Febbraio'%}
                {% set months_freeheating = ['Febbraio', 'Marzo', 'Aprile', 'Maggio', 'Giugno', 'Luglio', 'Agosto', 'Settembre', 'Ottobre', 'Novembre', 'Dicembre', 'Gennaio'] %}
                {% set interval_1_freeheating = months_freeheating[months_freeheating.index(input1_freeheating):months_freeheating.index(input2_freeheating)+1] %}
              {% elif input1_freeheating=='Marzo'%}
                {% set months_freeheating = ['Marzo', 'Aprile', 'Maggio', 'Giugno', 'Luglio', 'Agosto', 'Settembre', 'Ottobre', 'Novembre', 'Dicembre', 'Gennaio', 'Febbraio'] %}
                {% set interval_1_freeheating = months_freeheating[months_freeheating.index(input1_freeheating):months_freeheating.index(input2_freeheating)+1] %}
              {% elif input1_freeheating=='Aprile'%}
                {% set months_freeheating = ['Aprile', 'Maggio', 'Giugno', 'Luglio', 'Agosto', 'Settembre', 'Ottobre', 'Novembre', 'Dicembre', 'Gennaio', 'Febbraio', 'Marzo'] %}
                {% set interval_1_freeheating = months_freeheating[months_freeheating.index(input1_freeheating):months_freeheating.index(input2_freeheating)+1] %}
              {% elif input1_freeheating=='Maggio'%}
                {% set months_freeheating = ['Maggio', 'Giugno', 'Luglio', 'Agosto', 'Settembre', 'Ottobre', 'Novembre', 'Dicembre', 'Gennaio', 'Febbraio', 'Marzo', 'Aprile'] %}
                {% set interval_1_freeheating = months_freeheating[months_freeheating.index(input1_freeheating):months_freeheating.index(input2_freeheating)+1] %}
              {% elif input1_freeheating=='Giugno'%}
                {% set months_freeheating = ['Giugno', 'Luglio', 'Agosto', 'Settembre', 'Ottobre', 'Novembre', 'Dicembre', 'Gennaio', 'Febbraio', 'Marzo', 'Aprile', 'Maggio'] %}
                {% set interval_1_freeheating = months_freeheating[months_freeheating.index(input1_freeheating):months_freeheating.index(input2_freeheating)+1] %}
              {% elif input1_freeheating=='Luglio'%}
                {% set months_freeheating = ['Luglio', 'Agosto', 'Settembre', 'Ottobre', 'Novembre', 'Dicembre', 'Gennaio', 'Febbraio', 'Marzo', 'Aprile', 'Maggio', 'Giugno'] %}
                {% set interval_1_freeheating = months_freeheating[months_freeheating.index(input1_freeheating):months_freeheating.index(input2_freeheating)+1] %}
              {% elif input1_freeheating=='Agosto'%}
                {% set months_freeheating = ['Agosto', 'Settembre', 'Ottobre', 'Novembre', 'Dicembre', 'Gennaio', 'Febbraio', 'Marzo', 'Aprile', 'Maggio', 'Giugno', 'Luglio'] %}
                {% set interval_1_freeheating = months_freeheating[months_freeheating.index(input1_freeheating):months_freeheating.index(input2_freeheating)+1] %}
              {% elif input1_freeheating=='Settembre'%}
                {% set months_freeheating = ['Settembre', 'Ottobre', 'Novembre', 'Dicembre', 'Gennaio', 'Febbraio', 'Marzo', 'Aprile', 'Maggio', 'Giugno', 'Luglio', 'Agosto'] %}
                {% set interval_1_freeheating = months_freeheating[months_freeheating.index(input1_freeheating):months_freeheating.index(input2_freeheating)+1] %}
              {% elif input1_freeheating=='Ottobre'%}
                {% set months_freeheating = ['Ottobre', 'Novembre', 'Dicembre', 'Gennaio', 'Febbraio', 'Marzo', 'Aprile', 'Maggio', 'Giugno', 'Luglio', 'Agosto', 'Settembre'] %}
                {% set interval_1_freeheating = months_freeheating[months_freeheating.index(input1_freeheating):months_freeheating.index(input2_freeheating)+1] %}
              {% elif input1_freeheating=='Novembre'%}
                {% set months_freeheating = ['Novembre', 'Dicembre', 'Gennaio', 'Febbraio', 'Marzo', 'Aprile', 'Maggio', 'Giugno', 'Luglio', 'Agosto','Settembre', 'Ottobre'] %}
                {% set interval_1_freeheating = months_freeheating[months_freeheating.index(input1_freeheating):months_freeheating.index(input2_freeheating)+1] %}
              {% elif input1_freeheating=='Dicembre'%}
                {% set months_freeheating = ['Dicembre', 'Gennaio', 'Febbraio', 'Marzo', 'Aprile', 'Maggio', 'Giugno', 'Luglio', 'Agosto','Settembre','Ottobre', 'Novembre'] %}
                {% set interval_1_freeheating = months_freeheating[months_freeheating.index(input1_freeheating):months_freeheating.index(input2_freeheating)+1] %}
              {% endif %}
              {% if check == "OK" %}
                {% if mese_corrente in interval_1_freeheating %}
                  OK
                {% else %}
                  -
                {% endif %}
              {% else %}
                NOT OK
              {% endif %}
            {% endif %}      
          {% endif %}
        icon_template: mdi:checkbox-marked

      vmc_master_status_freecooling:
        friendly_name: "Check Free Cooling"
        value_template: >
          {% set stati = ['unknown', 'unavailable'] %}
          {% if states('sensor.vmc_master_sensori') in stati %}
            Non disponibile
          {% else %}
            {% set input1_freecooling = states('sensor.vmc_master_mese_1_fascia_freecooling') %}
            {% set input2_freecooling = states('sensor.vmc_master_mese_2_fascia_freecooling') %}
            {% set check = states('sensor.vmc_master_status_check_freeheating_freecooling') %}
            {% set mese_corrente = now().strftime('%B') %}
            {% if input1_freecooling in stati or input2_freecooling in stati or check in stati %}
              Non disponibile
            {% else %}      
              {% if mese_corrente == 'January' %}
                {% set mese_corrente = 'Gennaio' %}
              {% elif mese_corrente == 'February' %}
                {% set mese_corrente = 'Febbraio' %}
              {% elif mese_corrente == 'March' %}
                {% set mese_corrente = 'Marzo' %}
              {% elif mese_corrente == 'April' %}
                {% set mese_corrente = 'Aprile' %}
              {% elif mese_corrente == 'May' %}
                {% set mese_corrente = 'Maggio' %}
              {% elif mese_corrente == 'June' %}
                {% set mese_corrente = 'Giugno' %}
              {% elif mese_corrente == 'July' %}
                {% set mese_corrente = 'Luglio' %}
              {% elif mese_corrente == 'August' %}
                {% set mese_corrente = 'Agosto' %}
              {% elif mese_corrente == 'September' %}
                {% set mese_corrente = 'Settembre' %}
              {% elif mese_corrente == 'October' %}
                {% set mese_corrente = 'Ottobre' %}
              {% elif mese_corrente == 'November' %}
                {% set mese_corrente = 'Novembre' %}
              {% elif mese_corrente == 'December' %}
                {% set mese_corrente = 'Dicembre' %}
              {% endif %}
              {% if input1_freecooling=='Gennaio'%}
                {% set months_freecooling = ['Gennaio', 'Febbraio', 'Marzo', 'Aprile', 'Maggio', 'Giugno', 'Luglio', 'Agosto', 'Settembre', 'Ottobre', 'Novembre', 'Dicembre'] %}
                {% set interval_1_freecooling = months_freecooling[months_freecooling.index(input1_freecooling):months_freecooling.index(input2_freecooling)+1] %}
              {% elif input1_freecooling=='Febbraio'%}
                {% set months_freecooling = ['Febbraio', 'Marzo', 'Aprile', 'Maggio', 'Giugno', 'Luglio', 'Agosto', 'Settembre', 'Ottobre', 'Novembre', 'Dicembre', 'Gennaio'] %}
                {% set interval_1_freecooling = months_freecooling[months_freecooling.index(input1_freecooling):months_freecooling.index(input2_freecooling)+1] %}
              {% elif input1_freecooling=='Marzo'%}
                {% set months_freecooling = ['Marzo', 'Aprile', 'Maggio', 'Giugno', 'Luglio', 'Agosto', 'Settembre', 'Ottobre', 'Novembre', 'Dicembre', 'Gennaio', 'Febbraio'] %}
                {% set interval_1_freecooling = months_freecooling[months_freecooling.index(input1_freecooling):months_freecooling.index(input2_freecooling)+1] %}
              {% elif input1_freecooling=='Aprile'%}
                {% set months_freecooling = ['Aprile', 'Maggio', 'Giugno', 'Luglio', 'Agosto', 'Settembre', 'Ottobre', 'Novembre', 'Dicembre', 'Gennaio', 'Febbraio', 'Marzo'] %}
                {% set interval_1_freecooling = months_freecooling[months_freecooling.index(input1_freecooling):months_freecooling.index(input2_freecooling)+1] %}
              {% elif input1_freecooling=='Maggio'%}
                {% set months_freecooling = ['Maggio', 'Giugno', 'Luglio', 'Agosto', 'Settembre', 'Ottobre', 'Novembre', 'Dicembre', 'Gennaio', 'Febbraio', 'Marzo', 'Aprile'] %}
                {% set interval_1_freecooling = months_freecooling[months_freecooling.index(input1_freecooling):months_freecooling.index(input2_freecooling)+1] %}
              {% elif input1_freecooling=='Giugno'%}
                {% set months_freecooling = ['Giugno', 'Luglio', 'Agosto', 'Settembre', 'Ottobre', 'Novembre', 'Dicembre', 'Gennaio', 'Febbraio', 'Marzo', 'Aprile', 'Maggio'] %}
                {% set interval_1_freecooling = months_freecooling[months_freecooling.index(input1_freecooling):months_freecooling.index(input2_freecooling)+1] %}
              {% elif input1_freecooling=='Luglio'%}
                {% set months_freecooling = ['Luglio', 'Agosto', 'Settembre', 'Ottobre', 'Novembre', 'Dicembre', 'Gennaio', 'Febbraio', 'Marzo', 'Aprile', 'Maggio', 'Giugno'] %}
                {% set interval_1_freecooling = months_freecooling[months_freecooling.index(input1_freecooling):months_freecooling.index(input2_freecooling)+1] %}
              {% elif input1_freecooling=='Agosto'%}
                {% set months_freecooling = ['Agosto', 'Settembre', 'Ottobre', 'Novembre', 'Dicembre', 'Gennaio', 'Febbraio', 'Marzo', 'Aprile', 'Maggio', 'Giugno', 'Luglio'] %}
                {% set interval_1_freecooling = months_freecooling[months_freecooling.index(input1_freecooling):months_freecooling.index(input2_freecooling)+1] %}
              {% elif input1_freecooling=='Settembre'%}
                {% set months_freecooling = ['Settembre', 'Ottobre', 'Novembre', 'Dicembre', 'Gennaio', 'Febbraio', 'Marzo', 'Aprile', 'Maggio', 'Giugno', 'Luglio', 'Agosto'] %}
                {% set interval_1_freecooling = months_freecooling[months_freecooling.index(input1_freecooling):months_freecooling.index(input2_freecooling)+1] %}
              {% elif input1_freecooling=='Ottobre'%}
                {% set months_freecooling = ['Ottobre', 'Novembre', 'Dicembre', 'Gennaio', 'Febbraio', 'Marzo', 'Aprile', 'Maggio', 'Giugno', 'Luglio', 'Agosto', 'Settembre'] %}
                {% set interval_1_freecooling = months_freecooling[months_freecooling.index(input1_freecooling):months_freecooling.index(input2_freecooling)+1] %}
              {% elif input1_freecooling=='Novembre'%}
                {% set months_freecooling = ['Novembre', 'Dicembre', 'Gennaio', 'Febbraio', 'Marzo', 'Aprile', 'Maggio', 'Giugno', 'Luglio', 'Agosto','Settembre', 'Ottobre'] %}
                {% set interval_1_freecooling = months_freecooling[months_freecooling.index(input1_freecooling):months_freecooling.index(input2_freecooling)+1] %}
              {% elif input1_freecooling=='Dicembre'%}
                {% set months_freecooling = ['Dicembre', 'Gennaio', 'Febbraio', 'Marzo', 'Aprile', 'Maggio', 'Giugno', 'Luglio', 'Agosto','Settembre','Ottobre', 'Novembre'] %}
                {% set interval_1_freecooling = months_freecooling[months_freecooling.index(input1_freecooling):months_freecooling.index(input2_freecooling)+1] %}
              {% endif %}
              {% if check == "OK" %}
                {% if mese_corrente in interval_1_freecooling %}
                  OK
                {% else %}
                  -
                {% endif %}
              {% else %}
                NOT OK
              {% endif %}
            {% endif %}      
          {% endif %}
        icon_template: mdi:checkbox-marked

      vmc_master_status_mese_corrente_freeheating_o_freecooling:
        friendly_name: "Mese Corrente Programmato:"
        value_template: >
          {% set stati = ['unknown', 'unavailable'] %}
          {% if states('sensor.vmc_master_sensori') in stati %}
            Non disponibile
          {% else %}
            {% set input1 = states('sensor.vmc_master_status_freeheating') %}
            {% set input2 = states('sensor.vmc_master_status_freecooling') %}
            {% set interruttore_freecooling = states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_freecooling') %}
            {% set interruttore_freeheating = states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_freeheating') %}   
            {% if input1_freecooling in stati or input2_freecooling in stati %}
              Non disponibile
            {% else %}     
              {% if input1 == "OK" and interruttore_freeheating == 'on' %}
                Free Heating
              {% elif input2 == "OK" and interruttore_freecooling == 'on' %}
                Free Cooling
              {% else %}
                Disabilitata
              {% endif %}
            {% endif %}    
          {% endif %}
        icon_template: mdi:calendar-month-outline
################### Fine Creazione Sensori Interfaccia Free Heating - Free Cooling ##########################################################################################################################################

################### Inizio Creazione Lettura Valore Etichette ###############################################################################################################################################################
      vmc_master_speed_1_fascia_calendario:                                    # [CONFIGURAZIONE 0 RICHIAMI] SENSORE DI LETTURA DEL VALORE INSERITO TRAMITE INTERFACCIA, NEL SENSORE input_select vmc_master_speed
        friendly_name: "Set Velocità 1° Fascia Calendario"
        value_template: "{{ states('input_select.vmc_master_speed_1_fascia_calendario') | default('') }}"

      vmc_master_speed_2_fascia_calendario:                                    # [CONFIGURAZIONE 0 RICHIAMI] SENSORE DI LETTURA DEL VALORE INSERITO TRAMITE INTERFACCIA, NEL SENSORE input_select vmc_master_speed
        friendly_name: "Set Velocità 2° Fascia Calendario"
        value_template: "{{ states('input_select.vmc_master_speed_2_fascia_calendario') | default('') }}"

      vmc_master_mese_1_fascia_freeheating:                                    # [CONFIGURAZIONE 0 RICHIAMI] SENSORE DI LETTURA DEL VALORE INSERITO TRAMITE INTERFACCIA, NEL SENSORE input_select.vmc_master_mese_1_fascia_freeheating
        friendly_name: "Set Mese 1° Fascia Free Heating"
        value_template: "{{ states('input_select.vmc_master_mese_1_fascia_freeheating') | default('') }}"

      vmc_master_mese_2_fascia_freeheating:                                    # [CONFIGURAZIONE 0 RICHIAMI] SENSORE DI LETTURA DEL VALORE INSERITO TRAMITE INTERFACCIA, NEL SENSORE input_select.vmc_master_mese_2_fascia_freeheating
        friendly_name: "Set Mese 2° Fascia Free Heating"
        value_template: "{{ states('input_select.vmc_master_mese_2_fascia_freeheating') | default('') }}"

      vmc_master_mese_1_fascia_freecooling:                                    # [CONFIGURAZIONE 0 RICHIAMI] SENSORE DI LETTURA DEL VALORE INSERITO TRAMITE INTERFACCIA, NEL SENSORE input_select.vmc_master_mese_1_fascia_freeheating
        friendly_name: "Set Mese 1° Fascia Free Cooling"
        value_template: "{{ states('input_select.vmc_master_mese_1_fascia_freecooling') | default('') }}"

      vmc_master_mese_2_fascia_freecooling:                                    # [CONFIGURAZIONE 0 RICHIAMI] SENSORE DI LETTURA DEL VALORE INSERITO TRAMITE INTERFACCIA, NEL SENSORE input_select.vmc_master_mese_2_fascia_freeheating
        friendly_name: "Set Mese 2° Fascia Free Cooling"
        value_template: "{{ states('input_select.vmc_master_mese_2_fascia_freecooling') | default('') }}"
################### Fine Creazione Lettura Valore Etichette ###############################################################################################################################################################

################### Inizio Creazione Etichette Interfaccia Lovelace #######################################################################################################################################################
input_text:
  vmc_master_nome_da_inserire:                                                 # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU' RICHIAMI] [INTERFACCIA, PIU' RICHIAMI] SENSORE DI MEMORIZZAZIONE DEL NOE DELLA VMC CHE SI DESIDERA IMPOSTARE NELLA VMC
    name: "VMC Rinomina"
    initial: ""
    min: 0
    max: 10
    icon: mdi:form-textbox
        
  vmc_master_ip_insert:
    name: IP da configurare su Porta 5001 della VMC (Riavvio di H.A.)
    initial: ""
    icon: mdi:form-textbox

  vmc_master_last_weather_entity:
    name: Ultima Entità Meteo Selezionata
    icon: mdi:form-textbox

input_select:
  vmc_master_speed_1_fascia_calendario:                                        # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU' RICHIAMI] [INTERFACCIA, PIU' RICHIAMI] SENSORE DI MEMORIZZAZIONE DELLA VELOCITA' CHE SI DESIDERA IMPOSTARE NELLA VMC
    name: "Set Velocità 1° Fascia Calendario"
    options:
      - Velocità 0
      - Velocità 1
      - Velocità 2
      - Velocità 3
      - Velocità 4
      - Notturna
      - Iperventilazione
      - Free Cool./Heat.
    icon: mdi:fan    

  vmc_master_speed_2_fascia_calendario:                                        # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU' RICHIAMI] [INTERFACCIA, PIU' RICHIAMI] SENSORE DI MEMORIZZAZIONE DELLA VELOCITA' CHE SI DESIDERA IMPOSTARE NELLA VMC
    name: "Set Velocità 2° Fascia Calendario"
    options:
      - Velocità 0
      - Velocità 1
      - Velocità 2
      - Velocità 3
      - Velocità 4
      - Notturna
      - Iperventilazione
      - Free Cool./Heat.
    icon: mdi:fan    

  vmc_master_mese_1_fascia_freeheating:                                        # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU' RICHIAMI] [INTERFACCIA, PIU' RICHIAMI] SENSORE DI MEMORIZZAZIONE INIZIO 1°RANGE, PER AVVIO VELOCITà FREECOOLING
    name: "Set Inizio Mese Free Heating"
    options:
      - Gennaio
      - Febbraio
      - Marzo
      - Aprile
      - Maggio
      - Giugno
      - Luglio
      - Agosto
      - Settembre
      - Ottobre
      - Novembre
      - Dicembre
    icon: mdi:calendar-month-outline    

  vmc_master_mese_2_fascia_freeheating:                                        # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU' RICHIAMI] [INTERFACCIA, PIU' RICHIAMI] SENSORE DI MEMORIZZAZIONE FINE 1°RANGE, PER AVVIO VELOCITà FREECOOLING (FREEHEATING)
    name: "Set Fine Mese Free Heating"
    options:
      - Gennaio
      - Febbraio
      - Marzo
      - Aprile
      - Maggio
      - Giugno
      - Luglio
      - Agosto
      - Settembre
      - Ottobre
      - Novembre
      - Dicembre
    icon: mdi:calendar-month-outline    

  vmc_master_mese_1_fascia_freecooling:                                        # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU' RICHIAMI] [INTERFACCIA, PIU' RICHIAMI] SENSORE DI MEMORIZZAZIONE INIZIO 1°RANGE, PER AVVIO VELOCITà FREECOOLING
    name: "Set Inizio Mese Free Cooling"
    options:
      - Gennaio
      - Febbraio
      - Marzo
      - Aprile
      - Maggio
      - Giugno
      - Luglio
      - Agosto
      - Settembre
      - Ottobre
      - Novembre
      - Dicembre
    icon: mdi:calendar-month-outline    

  vmc_master_mese_2_fascia_freecooling:                                        # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU' RICHIAMI] [INTERFACCIA, PIU' RICHIAMI] SENSORE DI MEMORIZZAZIONE FINE 1°RANGE, PER AVVIO VELOCITà FREECOOLING (FREEHEATING)
    name: "Set Fine Mese Free Cooling"
    options:
      - Gennaio
      - Febbraio
      - Marzo
      - Aprile
      - Maggio
      - Giugno
      - Luglio
      - Agosto
      - Settembre
      - Ottobre
      - Novembre
      - Dicembre
    icon: mdi:calendar-month-outline  

  vmc_master_selected_weather_entity:                                          # [CONFIGURAZIONE PIU' RICHIAMI] [AUTOMAZIONE, PIU' RICHIAMI] [INTERFACCIA, PIU' RICHIAMI] SENSORE DI MEMORIZZAZIONE DI TUTTE LE ENTITA' WEATHER
    name: Seleziona Entità Meteo
    options:
      - "Aggiorna Elenco Entità Meteo"
    icon: mdi:form-textbox
    
input_number:
  vmc_master_offset_temp_interna:                                              # [CONFIGURAZIONE, PIU’ RICHIAMI] [INTERFACCIA PIU’ RICHIAMI] SENSORE DI MEMORIZZAZIONE DELL'OFFSET PER LA TEMPERATURA INTERNA CHE VERRA' SOMMATA NEL SENSORE vmc_master_temp_interna_status
    name: "Offset Temperatura"
    min: -50
    max: 50
    step: 0.1
    unit_of_measurement: "°C"
    icon: mdi:counter

  vmc_master_offset_temp_esterna:                                              # [CONFIGURAZIONE, PIU’ RICHIAMI] [INTERFACCIA PIU’ RICHIAMI] SENSORE DI MEMORIZZAZIONE DELL'OFFSET PER LA TEMPERATURA ESTERNA CHE VERRA' SOMMATA NEL SENSORE vmc_master_temp_esterna_status
    name: "Offset Temperatura Ext."
    min: -50
    max: 50
    step: 0.1
    unit_of_measurement: "°C"
    icon: mdi:counter

  vmc_master_offset_umidita_interna:                                           # [CONFIGURAZIONE, PIU’ RICHIAMI] [INTERFACCIA PIU’ RICHIAMI] SENSORE DI MEMORIZZAZIONE DELL'OFFSET PER L'UMIDITA' INTERNA CHE VERRA' SOMMATA NEL SENSORE vmc_master_umidita_interna_status
    name: "Offset Umidità Int."
    min: -100
    max: 100
    step: 0.1
    unit_of_measurement: "%"
    icon: mdi:counter
    
  vmc_master_offset_umidita_esterna:                                           # [CONFIGURAZIONE, PIU’ RICHIAMI] [INTERFACCIA PIU’ RICHIAMI] SENSORE DI MEMORIZZAZIONE DELL'OFFSET PER L'UMIDITA' ESTERNA CHE VERRA' SOMMATA NEL SENSORE vmc_master_umidita_esterna_status
    name: "Offset Umidità Ext."
    min: -100
    max: 100
    step: 0.1
    unit_of_measurement: "%"
    icon: mdi:counter

  vmc_master_offset_co2:                                                       # [CONFIGURAZIONE] [INTERFACCIA] SENSORE DI MEMORIZZAZIONE DELL'OFFSET PER L'ANIDRIDE CARBONICA CHE VERRA' SOMMATA NEL SENSORE vmc_master_co2_status
    name: "Offset CO₂ Int."
    min: -1500
    max: 1500
    step: 1
    unit_of_measurement: "ppm"
    icon: mdi:counter
    
  vmc_master_offset_voc:                                                       # [CONFIGURAZIONE] [INTERFACCIA] SENSORE DI MEMORIZZAZIONE DELL'OFFSET PER I COMPOSTI ORGANICI VOLATICI ESPRESSO IN PPM [DI DEFAULT NELLA VMC SONO ESPRESSI IN PPB] CHE VERRANNO SOMMATI NEL SENSORE vmc_master_voc_status
    name: "Offset VOC Int."
    min: -1000
    max: 1000
    step: 1
    unit_of_measurement: "ppb"
    icon: mdi:counter  

  vmc_master_offset_verifica_impiego_vmc:                                      # [CONFIGURAZIONE, PIU’ RICHIAMI] [INTERFACCIA PIU’ RICHIAMI]  SENSORE DI CONFRONTO CON LA DIFFERENZA TRA IL PUNTO DI RUGIADA ESTERNO - IL PUNTO DI RUGIADA INTERNO, SE MINORE SI PUO' IMPIEGARE LA VMC, DIVERSAMENTE NON SI PUO' IMPIEGARE LA VMC
    name: "Set Lim. Δ Punto di Rugiada"
    min: -10
    max: 10
    step: 1
    unit_of_measurement: "°C"
    icon: mdi:counter

  vmc_master_volume_da_inserire:                                               # [CONFIGURAZIONE, PIU’ RICHIAMI] [INTERFACCIA PIU’ RICHIAMI]  SENSORE PER L'ACQUISIZIONE DEL VOLUME IMPIEGATO PER IL CALCOLO DEL TEMPO NECESSARIO PER RINNOVARE TUTTA L'ARIA, TRAMITE IL SENSORE vmc_master_status_calcolo_portata_ventola
    name: "Volume ambiente Int."
    min: 0
    max: 1000
    step: 0.5
    mode: box
    unit_of_measurement: "[M³]"
    icon: mdi:cube-scan
################### Fine Creazione Etichette Interfaccia Lovelace  ############################################################################################################################################################################

################### Inizio Creazione Switch Booleani impiegati nell'Interfaccia Lovelace per mostrare o meno le Opzioni ####################################################################################
input_boolean:
  vmc_master_opzioni_avvisi:                                                  # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU' RICHIAMI] [INTERFACCIA, PIU' RICHIAMI]
    name: "Avvisi"
    initial: false
    icon: mdi:alert-rhombus-outline

  vmc_master_opzioni_avvisi_grafici:                                          # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU' RICHIAMI] [INTERFACCIA, PIU' RICHIAMI]
    name: "Grafici"
    initial: false
    icon: mdi:chart-bell-curve-cumulative

  vmc_master_opzioni_vmc:                                                      # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU' RICHIAMI] [INTERFACCIA, PIU' RICHIAMI]
    name: "Telecomando"
    initial: false
    icon: mdi:remote-tv

  vmc_master_opzioni_offset_sensori:                                           # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU' RICHIAMI] [INTERFACCIA, PIU' RICHIAMI]
    name: "Opzioni"
    initial: false
    icon: mdi:format-list-checkbox

  vmc_master_opzioni_interruttore_offset_sensori:                              # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU' RICHIAMI] [INTERFACCIA, PIU' RICHIAMI]
    name: "Sensori - Offset"
    initial: false
    icon: mdi:format-list-checkbox

  vmc_master_opzioni_monitoraggio_sensori:                                     # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU' RICHIAMI] [INTERFACCIA, PIU' RICHIAMI]
    name: "Sensori"
    initial: false
    icon: mdi:memory

  vmc_master_opzioni_interruttore_monitoraggio_sensori_extra:                  # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU' RICHIAMI] [INTERFACCIA, PIU' RICHIAMI]
    name: "Sensori - Extra"
    initial: false
    icon: mdi:memory

  vmc_master_opzioni_calendario_main:                                          # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU' RICHIAMI] [INTERFACCIA, PIU' RICHIAMI]
    name: "Calendario"
    initial: false
    icon: mdi:calendar-multiselect

  vmc_master_opzioni_calendario:                                               # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU' RICHIAMI] [INTERFACCIA, PIU' RICHIAMI]
    name: "Programmazione Calendario"
    initial: false
    icon: mdi:calendar-clock-outline

  vmc_master_opzioni_punto_di_rugiada:                                         # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU' RICHIAMI] [INTERFACCIA, PIU' RICHIAMI]
    name: "Lim. Δ P. di Rugiada"
    initial: false
    icon: mdi:thermometer-water

  vmc_master_opzioni_free_heating_o_free_cooling:                              # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU' RICHIAMI] [INTERFACCIA, PIU' RICHIAMI]
    name: "Calendario Free Heating / Free Cooling"
    initial: false
    icon: mdi:sun-snowflake-variant

  vmc_master_opzioni_interruttore_calendario:                                  # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU' RICHIAMI] [INTERFACCIA, PIU' RICHIAMI]
    name: "Status Programmazione Giornaliera"
    initial: false
    icon: mdi:calendar-today

  vmc_master_opzioni_lettura_sensori:                                          # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU' RICHIAMI] [INTERFACCIA, PIU' RICHIAMI]
    name: "Informazioni"
    initial: false
    icon: mdi:information-slab-box-outline

  vmc_master_opzioni_accendi_spegni_vmc_vs_pdr:                                # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU' RICHIAMI] [INTERFACCIA, PIU' RICHIAMI]  VERIFICA IL VALORE DEL SENZORE vmc_master_punto_di_rugiada_verifica_confronto OVVERO SE IL VALORE DIVENTE "SE NE SCONSIGLIA L'IMPIEGO"; SOLAMENTE SE VIENE ACCESO (ON), LA VMC VERRA' SPENTA IN AUTOMATICO SE IL VALORE DIVENTA "SE NE SCONSIGLIA L'IMPIEGO" 
    name: "VMC ON/OFF, in Funzione del Lim. Δ P. di Rugiada"
    icon: mdi:light-switch-off

  vmc_master_opzioni_accendi_spegni_vmc_vs_calendario:                         # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU' RICHIAMI] [INTERFACCIA, PIU' RICHIAMI]  VERIFICA SE RENDERE AUTONOMA LA VMC, SE "ON" VERRA' IMPIEGATO IL CALENDARIO AVVIANDO IN AUTONOMIA L'ACCENSIONE E LO SPEGNIMENTO; SE "OFF" NON VERRA' IMPIEGATO IL CALENDARIO PERTENDO L'AUTONOMIA DI ACCENSIONE E SPEGNIMENTO AUTOMATICO
    name: "VMC ON/OFF, in Funzione del Calendario"
    icon: mdi:light-switch-off

  vmc_master_opzioni_accendi_spegni_vmc_vs_freeheating:                        # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU' RICHIAMI] [INTERFACCIA, PIU' RICHIAMI]  
    name: "VMC ON/OFF, in Funzione della Vel. Free Heating"
    icon: mdi:light-switch-off

  vmc_master_opzioni_accendi_spegni_vmc_vs_freecooling:                        # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU' RICHIAMI] [INTERFACCIA, PIU' RICHIAMI]  
    name: "VMC ON/OFF, in Funzione della Vel. Free Cooling"
    icon: mdi:light-switch-off

  vmc_master_opzioni_accendi_spegni_avvisi:                                    # [CONFIGURAZIONE PIU' RICHIAMI] [AUTOMAZIONE, PIU' RICHIAMI] [INTERFACCIA, PIU' RICHIAMI]  
    name: "Mostra o Nascondi gli Avvisi"
    icon: mdi:light-switch-off

  vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc:                          # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU' RICHIAMI] [INTERFACCIA, PIU' RICHIAMI]  VERIFICA IL VALORE DI PERICOLOSITA' DEI SENZORE CO2 E VOC; SOLAMENTE; LA VMC VERRA' SI AVVIERA' IN AUTOMATICO SE VIENE ACCESO (ON), QUALORA I VALORI RISULTINO PERICOLOSI  
    name: "VMC ON/OFF, in Funzione del Lim. CO₂ e/o VOC"
    icon: mdi:light-switch-off

  vmc_master_opzioni_accendi_spegni_avvisi_spia:                               # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU' RICHIAMI] [INTERFACCIA, PIU' RICHIAMI]  
    name: "Spia Avvisi"
    icon: mdi:alert-rhombus-outline
################### Fine Creazione Switch Booleani impiegati nell'Interfaccia Lovelace per mostrare o meno le Opzioni ####################################################################################
  vmc_master_popup_versione_corrente_vs_repository:                             # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI] SENSORE TRACCIAMENTO POPUP AGGIORNAMENTO
    name: "PopUp Notifica Aggiornamento Package"
    initial: false
    icon: mdi:human-handsup
################### Inizio Creazione Switch Booleani impiegati nell'Automazione, per valutare la Velocità in caso di Black-Out e/o SUPERAMENTO DEL Set Lim. Δ Punto di Rugiada ##############################################################
  vmc_master_spia_velocita_0:                                                  # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI] SENSORE TRACCIAMENTO VELOCITA' 0, IN CASO DI BLACK-OUT
    name: "Spia Velocità 0"
    icon: mdi:memory

  vmc_master_spia_velocita_1:                                                  # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI] SENSORE TRACCIAMENTO VELOCITA' 1, IN CASO DI BLACK-OUT
    name: "Spia Velocità 1"
    icon: mdi:memory

  vmc_master_spia_velocita_2:                                                  # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI] SENSORE TRACCIAMENTO VELOCITA' 2, IN CASO DI BLACK-OUT
    name: "Spia Velocità 2"
    icon: mdi:memory

  vmc_master_spia_velocita_3:                                                  # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI] SENSORE TRACCIAMENTO VELOCITA' 3, IN CASO DI BLACK-OUT
    name: "Spia Velocità 3"
    icon: mdi:memory
    
  vmc_master_spia_velocita_4:                                                  # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI] SENSORE TRACCIAMENTO VELOCITA' 4, IN CASO DI BLACK-OUT
    name: "Spia Velocità 4"
    icon: mdi:memory

  vmc_master_spia_velocita_iperventilazione:                                   # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI] SENSORE TRACCIAMENTO VELOCITA' IPERVENTILAZIONE, IN CASO DI BLACK-OUT
    name: "Spia Velocità Iperventilazione"
    icon: mdi:memory

  vmc_master_spia_velocita_notturna:                                           # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI] SENSORE TRACCIAMENTO VELOCITA' NOTTURNA, IN CASO DI BLACK-OUT
    name: "Spia Velocità Notturna"
    icon: mdi:memory

  vmc_master_spia_velocita_freecooling:                                        # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI] SENSORE TRACCIAMENTO VELOCITA' FREE-COOLING, IN CASO DI BLACK-OUT
    name: "Spia Velocità Free Cool./Heat."
    icon: mdi:memory    

  vmc_master_spia_calendario_lunedi_1:                                        # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU' RICHIAMI] SENSORE TRACCIAMENTO, QUANDO SI E' ALL'INTERNO DEL LUNEDì 1° FASCIA DEL CALENDARIO
    name: "Spia all'interno del Calendario Lunedì 1°"
    icon: mdi:memory

  vmc_master_spia_calendario_lunedi_2:                                        # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU' RICHIAMI] SENSORE TRACCIAMENTO, QUANDO SI E' ALL'INTERNO DEL LUNEDì 2° FASCIA DEL CALENDARIO
    name: "Spia all'interno del Calendario Lunedì 2°"
    icon: mdi:memory

  vmc_master_spia_calendario_martedi_1:                                        # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU' RICHIAMI] SENSORE TRACCIAMENTO, QUANDO SI E' ALL'INTERNO DEL MARTEDì 1° FASCIA DEL CALENDARIO
    name: "Spia all'interno del Calendario Martedì 1°"
    icon: mdi:memory

  vmc_master_spia_calendario_martedi_2:                                        # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU' RICHIAMI] SENSORE TRACCIAMENTO, QUANDO SI E' ALL'INTERNO DEL MARTEDì 2° FASCIA DEL CALENDARIO
    name: "Spia all'interno del Calendario Martedì 2°"
    icon: mdi:memory

  vmc_master_spia_calendario_mercoledi_1:                                        # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU' RICHIAMI] SENSORE TRACCIAMENTO, QUANDO SI E' ALL'INTERNO DEL MERCOLEDì 1° FASCIA DEL CALENDARIO
    name: "Spia all'interno del Calendario Mercoledì 1°"
    icon: mdi:memory

  vmc_master_spia_calendario_mercoledi_2:                                        # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU' RICHIAMI] SENSORE TRACCIAMENTO, QUANDO SI E' ALL'INTERNO DEL MERCOLEDì 2° FASCIA DEL CALENDARIO
    name: "Spia all'interno del Calendario Mercoledì 2°"
    icon: mdi:memory

  vmc_master_spia_calendario_giovedi_1:                                        # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU' RICHIAMI] SENSORE TRACCIAMENTO, QUANDO SI E' ALL'INTERNO DEL GIOVEDì 1° FASCIA DEL CALENDARIO
    name: "Spia all'interno del Calendario Giovedì 1°"
    icon: mdi:memory

  vmc_master_spia_calendario_giovedi_2:                                        # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU' RICHIAMI] SENSORE TRACCIAMENTO, QUANDO SI E' ALL'INTERNO DEL GIOVEDì 2° FASCIA DEL CALENDARIO
    name: "Spia all'interno del Calendario Giovedì 2°"
    icon: mdi:memory

  vmc_master_spia_calendario_venerdi_1:                                        # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU' RICHIAMI] SENSORE TRACCIAMENTO, QUANDO SI E' ALL'INTERNO DEL VENERDì 1° FASCIA DEL CALENDARIO
    name: "Spia all'interno del Calendario Venerdì 1°"
    icon: mdi:memory

  vmc_master_spia_calendario_venerdi_2:                                        # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU' RICHIAMI] SENSORE TRACCIAMENTO, QUANDO SI E' ALL'INTERNO DEL VENERDì 2° FASCIA DEL CALENDARIO
    name: "Spia all'interno del Calendario Venerdì 2°"
    icon: mdi:memory

  vmc_master_spia_calendario_sabato_1:                                        # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU' RICHIAMI] SENSORE TRACCIAMENTO, QUANDO SI E' ALL'INTERNO DEL SABATO 1° FASCIA DEL CALENDARIO
    name: "Spia all'interno del Calendario Sabato 1°"
    icon: mdi:memory

  vmc_master_spia_calendario_sabato_2:                                        # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU' RICHIAMI] SENSORE TRACCIAMENTO, QUANDO SI E' ALL'INTERNO DEL SABATO 2° FASCIA DEL CALENDARIO
    name: "Spia all'interno del Calendario Sabato 2°"
    icon: mdi:memory

  vmc_master_spia_calendario_domenica_1:                                        # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU' RICHIAMI] SENSORE TRACCIAMENTO, QUANDO SI E' ALL'INTERNO DEL DOMENICA 1° FASCIA DEL CALENDARIO
    name: "Spia all'interno del Calendario Domenica 1°"
    icon: mdi:memory

  vmc_master_spia_calendario_domenica_2:                                        # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU' RICHIAMI] SENSORE TRACCIAMENTO, QUANDO SI E' ALL'INTERNO DEL DOMENICA 2° FASCIA DEL CALENDARIO
    name: "Spia all'interno del Calendario Domenica 2°"
    icon: mdi:memory

  vmc_master_spia_velocita_0_un_solo_avvio:                                    # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU' RICHIAMI] SENSORE DI SUPPORTO NELL'AUTOMAZIONE PER IL RIPRISTINO DELLA VELOCITA' 0, IN CASO SUPERAMENTO del Lim. Δ P. di Rugiada
    name: "Spia Velocità 0 1° Avvio"
    icon: mdi:memory

  vmc_master_spia_velocita_1_un_solo_avvio:                                    # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU' RICHIAMI] SENSORE DI SUPPORTO NELL'AUTOMAZIONE PER IL RIPRISTINO DELLA VELOCITA' 1, IN CASO SUPERAMENTO del Lim. Δ P. di Rugiada
    name: "Spia Velocità 1 1° Avvio"
    icon: mdi:memory

  vmc_master_spia_velocita_2_un_solo_avvio:                                    # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU' RICHIAMI] SENSORE DI SUPPORTO NELL'AUTOMAZIONE PER IL RIPRISTINO DELLA VELOCITA' 2, IN CASO SUPERAMENTO del Lim. Δ P. di Rugiada
    name: "Spia Velocità 2 1° Avvio"
    icon: mdi:memory

  vmc_master_spia_velocita_3_un_solo_avvio:                                    # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU' RICHIAMI] SENSORE DI SUPPORTO NELL'AUTOMAZIONE PER IL RIPRISTINO DELLA VELOCITA' 3, IN CASO SUPERAMENTO del Lim. Δ P. di Rugiada
    name: "Spia Velocità 3 1° Avvio"
    icon: mdi:memory

  vmc_master_spia_velocita_4_un_solo_avvio:                                    # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU' RICHIAMI] SENSORE DI SUPPORTO NELL'AUTOMAZIONE PER IL RIPRISTINO DELLA VELOCITA' 4, IN CASO SUPERAMENTO del Lim. Δ P. di Rugiada
    name: "Spia Velocità 4 1° Avvio"
    icon: mdi:memory

  vmc_master_spia_velocita_iperventilazione_un_solo_avvio:                     # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU' RICHIAMI] SENSORE DI SUPPORTO NELL'AUTOMAZIONE PER IL RIPRISTINO DELLA VELOCITA' IPERVENTILAZIONE, IN CASO SUPERAMENTO del Lim. Δ P. di Rugiada
    name: "Spia Velocità Iperventilazione 1° Avvio"
    icon: mdi:memory

  vmc_master_spia_velocita_notturna_un_solo_avvio:                             # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU' RICHIAMI] SENSORE DI SUPPORTO NELL'AUTOMAZIONE PER IL RIPRISTINO DELLA VELOCITA' NOTTURNA, IN CASO SUPERAMENTO del Lim. Δ P. di Rugiada
    name: "Spia Velocità notturna 1° Avvio"
    icon: mdi:memory

  vmc_master_spia_velocita_freecooling_un_solo_avvio:                          # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU' RICHIAMI] SENSORE DI SUPPORTO NELL'AUTOMAZIONE PER IL RIPRISTINO DELLA VELOCITA' FREE-COOLING, IN CASO SUPERAMENTO del Lim. Δ P. di Rugiada
    name: "Spia Velocità freecooling 1° Avvio"
    icon: mdi:memory

  vmc_master_spia_velocita_freecooling_un_solo_avvio_per_programmazione_freecooling:  # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU' RICHIAMI] SENSORE DI SUPPORTO NELL'AUTOMAZIONE PER IL RIPRISTINO DELLA VELOCITA' FREE-COOLING, IN CASO DI ALLERTA PROGRAMMATA DEL FREE COOLING
    name: "Spia su Programmazione Velocità Free Cooling 1° Avvio"
    icon: mdi:memory

  vmc_master_spia_velocita_freecooling_un_solo_avvio_per_programmazione_freeheating:  # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU' RICHIAMI] SENSORE DI SUPPORTO NELL'AUTOMAZIONE PER IL RIPRISTINO DELLA VELOCITA' FREE-COOLING, IN CASO DI ALLERTA PROGRAMMATA DEL FREE HEATING
    name: "Spia su Programmazione Velocità Free Heating 1° Avvio"
    icon: mdi:memory
################### Fine Creazione Switch Booleani impiegati nell'Automazione, per valutare la Velocità in caso di Black-Out e/o SUPERAMENTO DEL Set Lim. Δ Punto di Rugiada ##############################################

################### Inizio Creazione Switch Booleani impiegati nell'Automazione, per valutare gli inquinanti CO2 e VOC ##############################################

  vmc_master_spia_co2_o_voc:                                                   # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU' RICHIAMI] SENSORE DI SUPPORTO NELL'AUTOMAZIONE PER LA VERIFICA DI INQUINANTI CO2 E VOC
    name: "Spia Inquinanti CO₂ e/o VOC"
    icon: mdi:memory

  vmc_master_spia_co2_o_voc_partenza_ritorno_velocita_0:                       # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU' RICHIAMI] SENSORE DI SUPPORTO NELL'AUTOMAZIONE PER LA VERIFICA DI INQUINANTI CO2 E VOC PARTENZA DA VELOCITA' 0 E RITORNO A VELOCITA' 0
    name: "Spia di Richiamo Vel. 0 CO₂ e/o VOC "
    icon: mdi:memory

  vmc_master_spia_velocita_0_co2_o_voc:                                        # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI] SENSORE TRACCIAMENTO VELOCITA' 0, IN CASO DI INQUINANTI CO2 E VOC
    name: "Spia Velocità 0 CO₂ e/o VOC"
    icon: mdi:memory

  vmc_master_spia_velocita_1_co2_o_voc:                                        # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI] SENSORE TRACCIAMENTO VELOCITA' 1, IN CASO DI INQUINANTI CO2 E VOCT
    name: "Spia Velocità 1 CO₂ e/o VOC"
    icon: mdi:memory

  vmc_master_spia_velocita_2_co2_o_voc:                                        # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI] SENSORE TRACCIAMENTO VELOCITA' 2, IN CASO DI INQUINANTI CO2 E VOC
    name: "Spia Velocità 2 CO₂ e/o VOC"
    icon: mdi:memory

  vmc_master_spia_velocita_3_co2_o_voc:                                        # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI] SENSORE TRACCIAMENTO VELOCITA' 3, IN CASO DI INQUINANTI CO2 E VOC
    name: "Spia Velocità 3 CO₂ e/o VOC"
    icon: mdi:memory
    
  vmc_master_spia_velocita_4_co2_o_voc:                                        # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI] SENSORE TRACCIAMENTO VELOCITA' 4, IN CASO DI INQUINANTI CO2 E VOC
    name: "Spia Velocità 4 CO₂ e/o VOC"
    icon: mdi:memory

  vmc_master_spia_velocita_iperventilazione_co2_o_voc:                         # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI] SENSORE TRACCIAMENTO VELOCITA' IPERVENTILAZIONE, IN CASO DI INQUINANTI CO2 E VOC
    name: "Spia Velocità Iperventilazione CO₂ e/o VOC"
    icon: mdi:memory

  vmc_master_spia_velocita_notturna_co2_o_voc:                                 # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI] SENSORE TRACCIAMENTO VELOCITA' NOTTURNA, IN CASO DI INQUINANTI CO2 E VOC
    name: "Spia Velocità Notturna CO₂ e/o VOC"
    icon: mdi:memory

  vmc_master_spia_velocita_freecooling_co2_o_voc:                              # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI] SENSORE TRACCIAMENTO VELOCITA' FREE-COOLING, IN CASO DI INQUINANTI CO2 E VOC
    name: "Spia Velocità Free Cool./Heat. CO₂ e/o VOC"
    icon: mdi:memory        

  vmc_master_spia_velocita_1_co2_o_voc_pdr:                                    # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI] SENSORE TRACCIAMENTO VELOCITA' 1, IN CASO DI AVVIO PUNTO DI RUGIADA A VELOCITA 1 E INQUINANTI CO2 E VOC ASSENTI MA PRECEDENTEMENTE PRESENTI A VELOCITA 0
    name: "Spia Velocità 1 CO₂ e/o VOC Vs PdR"
    icon: mdi:memory

################### Fine Creazione Switch Booleani impiegati nell'Automazione, per valutare gli inquinanti CO2 e VOC ##############################################


################### Inizio Creazione Switch Booleani impiegati nell'Automazione, per valutare CONGELAMENTO ############################

  vmc_master_congelamento_verifica_soglia_valore_spia:                         # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI] SENSORE TRACCIAMENTO CONGELAMENTO
    name: "Spia VMC Congelamento ≤ -18 [°C] Temp. Esterna ?"
    icon: mdi:memory

  vmc_master_spia_velocita_0_congelamento:                                     # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI] SENSORE TRACCIAMENTO VELOCITA' 0, IN CASO DI CONGELAMENTO
    name: "Spia Velocità 0 Congelamento"
    icon: mdi:memory

  vmc_master_spia_velocita_1_congelamento:                                     # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI] SENSORE TRACCIAMENTO VELOCITA' 1, IN CASO DI CONGELAMENTO
    name: "Spia Velocità 1 Congelamento"
    icon: mdi:memory

  vmc_master_spia_velocita_2_congelamento:                                     # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI] SENSORE TRACCIAMENTO VELOCITA' 2, IN CASO DI CONGELAMENTO
    name: "Spia Velocità 2 Congelamento"
    icon: mdi:memory

  vmc_master_spia_velocita_3_congelamento:                                     # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI] SENSORE TRACCIAMENTO VELOCITA' 3, IN CASO DI CONGELAMENTO
    name: "Spia Velocità 3 Congelamento"
    icon: mdi:memory
    
  vmc_master_spia_velocita_4_congelamento:                                     # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI] SENSORE TRACCIAMENTO VELOCITA' 4, IN CASO DI CONGELAMENTO
    name: "Spia Velocità 4 Congelamento"
    icon: mdi:memory

  vmc_master_spia_velocita_iperventilazione_congelamento:                      # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI] SENSORE TRACCIAMENTO VELOCITA' IPERVENTILAZIONE, IN CASO DI CONGELAMENTO
    name: "Spia Velocità Iperventilazione Congelamento"
    icon: mdi:memory

  vmc_master_spia_velocita_notturna_congelamento:                              # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI] SENSORE TRACCIAMENTO VELOCITA' NOTTURNA, IN CASO DI CONGELAMENTO
    name: "Spia Velocità Notturna Congelamento"
    icon: mdi:memory

  vmc_master_spia_velocita_freecooling_congelamento:                           # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI] SENSORE TRACCIAMENTO VELOCITA' FREE-COOLING, IN CASO DI CONGELAMENTO
    name: "Spia Velocità Free Cool./Heat. Congelamento"
    icon: mdi:memory        

################### Fine Creazione Switch Booleani impiegati nell'Automazione, per valutare CONGELAMENTO #############################


################### Inizio Creazione Switch Booleani impiegati nell'Automazione, per valutare DIFFERENZA DI TEMPERATURA ############################

  vmc_master_delta_temp_verifica_soglia_valore_spia:                           # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI] SENSORE TRACCIAMENTO DIFFERENZA DI TEMPERATURA > 23 °C
    name: "Spia VMC Diff. Temp. Int-Est > 23 [°C] ?"
    icon: mdi:memory

  vmc_master_spia_velocita_0_delta_temp_verifica_soglia_valore:                # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI] SENSORE TRACCIAMENTO VELOCITA' 0, IN CASO DI DIFFERENZA DI TEMPERATURA > 23 °C
    name: "Spia Velocità 0 Diff. Temp. Int-Est > 23 [°C]"
    icon: mdi:memory

  vmc_master_spia_velocita_1_delta_temp_verifica_soglia_valore:                # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI] SENSORE TRACCIAMENTO VELOCITA' 1, IN CASO DI DIFFERENZA DI TEMPERATURA > 23 °C
    name: "Spia Velocità 1 Diff. Temp. Int-Est > 23 [°C]"
    icon: mdi:memory

  vmc_master_spia_velocita_2_delta_temp_verifica_soglia_valore:                # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI] SENSORE TRACCIAMENTO VELOCITA' 2, IN CASO DI DIFFERENZA DI TEMPERATURA > 23 °C
    name: "Spia Velocità 2 Diff. Temp. Int-Est > 23 [°C]"
    icon: mdi:memory

  vmc_master_spia_velocita_3_delta_temp_verifica_soglia_valore:                # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI] SENSORE TRACCIAMENTO VELOCITA' 3, IN CASO DI DIFFERENZA DI TEMPERATURA > 23 °C
    name: "Spia Velocità 3 Diff. Temp. Int-Est > 23 [°C]"
    icon: mdi:memory
    
  vmc_master_spia_velocita_4_delta_temp_verifica_soglia_valore:                # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI] SENSORE TRACCIAMENTO VELOCITA' 4, IN CASO DI DIFFERENZA DI TEMPERATURA > 23 °C
    name: "Spia Velocità 4 Diff. Temp. Int-Est > 23 [°C]"
    icon: mdi:memory

  vmc_master_spia_velocita_iperventilazione_delta_temp_verifica_soglia_valore: # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI] SENSORE TRACCIAMENTO VELOCITA' IPERVENTILAZIONE, IN CASO DI DIFFERENZA DI TEMPERATURA > 23 °C
    name: "Spia Velocità Iperventilazione Diff. Temp. Int-Est > 23 [°C]"
    icon: mdi:memory

  vmc_master_spia_velocita_notturna_delta_temp_verifica_soglia_valore:         # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI] SENSORE TRACCIAMENTO VELOCITA' NOTTURNA, IN CASO DI DIFFERENZA DI TEMPERATURA > 23 °C
    name: "Spia Velocità Notturna Diff. Temp. Int-Est > 23 [°C]"
    icon: mdi:memory

  vmc_master_spia_velocita_freecooling_delta_temp_verifica_soglia_valore:      # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI] SENSORE TRACCIAMENTO VELOCITA' FREE-COOLING, IN CASO DI DIFFERENZA DI TEMPERATURA > 23 °C
    name: "Spia Velocità Free Cool./Heat. Diff. Temp. Int-Est > 23 [°C]"
    icon: mdi:memory        

################### Fine Creazione Switch Booleani impiegati nell'Automazione, per valutare DIFFERENZA DI TEMPERATURA  #############################


################### Inizio Creazione input datetime per l'accensione e lo spegnimento della VMC per ogni giorno della settimana ###########################################################################################
input_datetime:
  vmc_master_accensione_lunedi:                                                # [CONFIGURAZIONE, PIU’ RICHIAMI] [INTERFACCIA, PIU’ RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI] 
    name: "Lun. 1°"
    has_date: false
    has_time: true
    icon: mdi:timer-play-outline

  vmc_master_spegnimento_lunedi:                                               # [CONFIGURAZIONE, PIU’ RICHIAMI] [INTERFACCIA, PIU’ RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI]
    name: "Lun. 1°"
    has_date: false
    has_time: true
    icon: mdi:timer-stop-outline

  vmc_master_accensione_lunedi_2:                                              # [CONFIGURAZIONE, PIU’ RICHIAMI] [INTERFACCIA, PIU’ RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI]
    name: "Lun. 2°"
    has_date: false
    has_time: true
    icon: mdi:timer-play-outline
    
  vmc_master_spegnimento_lunedi_2:                                             # [CONFIGURAZIONE, PIU’ RICHIAMI] [INTERFACCIA, PIU’ RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI]
    name: "Lun. 2°"
    has_date: false
    has_time: true
    icon: mdi:timer-stop-outline

  vmc_master_accensione_martedi:                                               # [CONFIGURAZIONE, PIU’ RICHIAMI] [INTERFACCIA, PIU’ RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI]
    name: "Mar. 1°"
    has_date: false
    has_time: true
    icon: mdi:timer-play-outline

  vmc_master_spegnimento_martedi:                                              # [CONFIGURAZIONE, PIU’ RICHIAMI] [INTERFACCIA, PIU’ RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI]
    name: "Mar. 1°"
    has_date: false
    has_time: true
    icon: mdi:timer-stop-outline
    
  vmc_master_accensione_martedi_2:                                             # [CONFIGURAZIONE, PIU’ RICHIAMI] [INTERFACCIA, PIU’ RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI]
    name: "Mar. 2°"
    has_date: false
    has_time: true
    icon: mdi:timer-play-outline
    
  vmc_master_spegnimento_martedi_2:                                            # [CONFIGURAZIONE, PIU’ RICHIAMI] [INTERFACCIA, PIU’ RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI]
    name: "Mar. 2°"
    has_date: false
    has_time: true
    icon: mdi:timer-stop-outline
    
  vmc_master_accensione_mercoledi:                                             # [CONFIGURAZIONE, PIU’ RICHIAMI] [INTERFACCIA, PIU’ RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI]
    name: "Mer. 1°"
    has_date: false
    has_time: true
    icon: mdi:timer-play-outline

  vmc_master_spegnimento_mercoledi:                                            # [CONFIGURAZIONE, PIU’ RICHIAMI] [INTERFACCIA, PIU’ RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI]
    name: "Mer. 1°"
    has_date: false
    has_time: true
    icon: mdi:timer-stop-outline

  vmc_master_accensione_mercoledi_2:                                           # [CONFIGURAZIONE, PIU’ RICHIAMI] [INTERFACCIA, PIU’ RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI]
    name: "Mer. 2°"
    has_date: false
    has_time: true
    icon: mdi:timer-play-outline
    
  vmc_master_spegnimento_mercoledi_2:                                          # [CONFIGURAZIONE, PIU’ RICHIAMI] [INTERFACCIA, PIU’ RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI]
    name: "Mer. 2°"
    has_date: false
    has_time: true
    icon: mdi:timer-stop-outline

  vmc_master_accensione_giovedi:                                               # [CONFIGURAZIONE, PIU’ RICHIAMI] [INTERFACCIA, PIU’ RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI]
    name: "Gio. 1°"
    has_date: false
    has_time: true
    icon: mdi:timer-play-outline

  vmc_master_spegnimento_giovedi:                                              # [CONFIGURAZIONE, PIU’ RICHIAMI] [INTERFACCIA, PIU’ RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI]
    name: "Gio. 1°"
    has_date: false
    has_time: true
    icon: mdi:timer-stop-outline

  vmc_master_accensione_giovedi_2:                                             # [CONFIGURAZIONE, PIU’ RICHIAMI] [INTERFACCIA, PIU’ RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI]
    name: "Gio. 2°"
    has_date: false
    has_time: true
    icon: mdi:timer-play-outline

  vmc_master_spegnimento_giovedi_2:                                            # [CONFIGURAZIONE, PIU’ RICHIAMI] [INTERFACCIA, PIU’ RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI]
    name: "Gio. 2°"
    has_date: false
    has_time: true
    icon: mdi:timer-stop-outline
    
  vmc_master_accensione_venerdi:                                               # [CONFIGURAZIONE, PIU’ RICHIAMI] [INTERFACCIA, PIU’ RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI]
    name: "Ven. 1°"
    has_date: false
    has_time: true
    icon: mdi:timer-play-outline

  vmc_master_spegnimento_venerdi:                                              # [CONFIGURAZIONE, PIU’ RICHIAMI] [INTERFACCIA, PIU’ RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI]
    name: "Ven. 1°"
    has_date: false
    has_time: true
    icon: mdi:timer-stop-outline

  vmc_master_accensione_venerdi_2:                                             # [CONFIGURAZIONE, PIU’ RICHIAMI] [INTERFACCIA, PIU’ RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI]
    name: "Ven. 2°"
    has_date: false
    has_time: true
    icon: mdi:timer-play-outline

  vmc_master_spegnimento_venerdi_2:                                            # [CONFIGURAZIONE, PIU’ RICHIAMI] [INTERFACCIA, PIU’ RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI]
    name: "Ven. 2°"
    has_date: false
    has_time: true
    icon: mdi:timer-stop-outline
    
  vmc_master_accensione_sabato:                                                # [CONFIGURAZIONE, PIU’ RICHIAMI] [INTERFACCIA, PIU’ RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI]
    name: "Sab. 1°"
    has_date: false
    has_time: true
    icon: mdi:timer-play-outline

  vmc_master_spegnimento_sabato:                                               # [CONFIGURAZIONE, PIU’ RICHIAMI] [INTERFACCIA, PIU’ RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI]
    name: "Sab. 1°"
    has_date: false
    has_time: true
    icon: mdi:timer-stop-outline

  vmc_master_accensione_sabato_2:                                              # [CONFIGURAZIONE, PIU’ RICHIAMI] [INTERFACCIA, PIU’ RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI]
    name: "Sab. 2°"
    has_date: false
    has_time: true
    icon: mdi:timer-play-outline
    
  vmc_master_spegnimento_sabato_2:                                             # [CONFIGURAZIONE, PIU’ RICHIAMI] [INTERFACCIA, PIU’ RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI]
    name: "Sab. 2°"
    has_date: false
    has_time: true
    icon: mdi:timer-stop-outline
    
  vmc_master_accensione_domenica:                                              # [CONFIGURAZIONE, PIU’ RICHIAMI] [INTERFACCIA, PIU’ RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI]
    name: "Dom. 1°"
    has_date: false
    has_time: true
    icon: mdi:timer-play-outline

  vmc_master_spegnimento_domenica:                                             # [CONFIGURAZIONE, PIU’ RICHIAMI] [INTERFACCIA, PIU’ RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI]
    name: "Dom. 1°"
    has_date: false
    has_time: true
    icon: mdi:timer-stop-outline

  vmc_master_accensione_domenica_2:                                            # [CONFIGURAZIONE, PIU’ RICHIAMI] [INTERFACCIA, PIU’ RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI]
    name: "Dom. 2°"
    has_date: false
    has_time: true
    icon: mdi:timer-play-outline
    
  vmc_master_spegnimento_domenica_2:                                           # [CONFIGURAZIONE, PIU’ RICHIAMI] [INTERFACCIA, PIU’ RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI]
    name: "Dom. 2°"
    has_date: false
    has_time: true
    icon: mdi:timer-stop-outline
################### Fine Creazione input datetime per l'accensione e lo spegnimento della VMC per ogni giorno della settimana ###########################################################################################

################### Inizio Creazione Automazione ########################################################################################################################################################################

################### Fine Creazione Automazione ##########################################################################################################################################################################

################### Inizio Creazione Scripts ############################################################################################################################################################################
script:
  vmc_master_aggiorna_elenco_entita_meteo:
    alias: VMC Master - Aggiorna Elenco Entità Meteo
    sequence:
      # Aggiorna le opzioni dell'input_select con le entità meteo disponibili
      - service: input_select.set_options
        target:
          entity_id: input_select.vmc_master_selected_weather_entity
        data:
          options: >
            {% set weather_entities = states.weather | map(attribute='entity_id') | list %}
            {% if "Aggiorna Elenco Entità Meteo" not in weather_entities %}
              {{ ["Aggiorna Elenco Entità Meteo"] + weather_entities }}
            {% else %}
              {{ weather_entities }}
            {% endif %}
      - delay: "00:00:02"
      # Verifica se l'entità selezionata è valida
      - choose:
          # Se l'entità meteo selezionata non è valida
          - conditions:
              - condition: template
                value_template: >
                  {% set selected_entity = states('input_select.vmc_master_selected_weather_entity') %}
                  {{ selected_entity == "Aggiorna Elenco Entità Meteo" or selected_entity == "" or selected_entity == "sconosciuto" or selected_entity == "unknown" or selected_entity == empty }}
            sequence:
              # Ripristina l'ultima entità meteo selezionata se esiste
              - choose:
                  - conditions:
                      - condition: template
                        value_template: >
                          {% set last_weather_entity = states('input_text.vmc_master_last_weather_entity') %}
                          {{ last_weather_entity != "sconosciuto" and last_weather_entity != "unknown" and last_weather_entity != "" and last_weather_entity != empty }}
                    sequence:
                      - service: input_select.select_option
                        target:
                          entity_id: input_select.vmc_master_selected_weather_entity
                        data:
                          option: "{{ states('input_text.vmc_master_last_weather_entity') }}"
              # Se l'ultima entità non è valida, seleziona la prima disponibile
              - choose:
                  - conditions:
                      - condition: template
                        value_template: >
                          {% set last_weather_entity = states('input_text.vmc_master_last_weather_entity') %}
                          {{ last_weather_entity == "sconosciuto" or last_weather_entity == "unknown" or last_weather_entity == "" or last_weather_entity == empty }}
                    sequence:
                      - service: input_select.select_option
                        target:
                          entity_id: input_select.vmc_master_selected_weather_entity
                        data:
                          option: >
                            {% set weather_entities = states.weather | map(attribute='entity_id') | list %}
                            {{ weather_entities[0] }}
              # Aggiorna l'ultima entità meteo selezionata
              - service: input_text.set_value
                target:
                  entity_id: input_text.vmc_master_last_weather_entity
                data:
                  value: "{{ states('input_select.vmc_master_selected_weather_entity') }}"
            alias: Seleziona o ripristina l'entità meteo valida
          # Se l'entità meteo selezionata è valida
          - conditions:
              - condition: template
                value_template: >
                  {% set selected_entity = states('input_select.vmc_master_selected_weather_entity') %}
                  {{ selected_entity != "Aggiorna Elenco Entità Meteo" and selected_entity != "" and selected_entity != "sconosciuto" and selected_entity != "unknown" and selected_entity != empty }}
            sequence:
              - service: input_text.set_value
                target:
                  entity_id: input_text.vmc_master_last_weather_entity
                data:
                  value: "{{ states('input_select.vmc_master_selected_weather_entity') }}"
            alias: Aggiorna ultima entità meteo valida
      - delay:
          hours: 0
          minutes: 0
          seconds: 2
          milliseconds: 0
      - service: homeassistant.update_entity
        target:
          entity_id:
            - input_select.vmc_master_selected_weather_entity
            - input_text.vmc_master_last_weather_entity
    icon: mdi:cursor-pointer
    description: Permette di selezionare l'entità meteo preferita per determinare la Temperatura Esterna e l'Umidità Esterna

  vmc_master_azzera_booleans:
    alias: VMC Master - Booleans Off
    sequence:
      - service: input_boolean.turn_off
        data: {}
        target:
          entity_id: 
            - input_boolean.vmc_master_opzioni_avvisi
            - input_boolean.vmc_master_opzioni_avvisi_grafici            
            - input_boolean.vmc_master_opzioni_vmc 
            - input_boolean.vmc_master_opzioni_offset_sensori
            - input_boolean.vmc_master_opzioni_interruttore_offset_sensori
            - input_boolean.vmc_master_opzioni_monitoraggio_sensori
            - input_boolean.vmc_master_opzioni_interruttore_monitoraggio_sensori_extra
            - input_boolean.vmc_master_opzioni_calendario_main
            - input_boolean.vmc_master_opzioni_calendario
            - input_boolean.vmc_master_opzioni_punto_di_rugiada
            - input_boolean.vmc_master_opzioni_free_heating_o_free_cooling
            - input_boolean.vmc_master_opzioni_interruttore_calendario
            - input_boolean.vmc_master_opzioni_lettura_sensori
            - input_boolean.vmc_master_opzioni_accendi_spegni_avvisi_spia
            - input_boolean.vmc_master_spia_velocita_0
            - input_boolean.vmc_master_spia_velocita_1
            - input_boolean.vmc_master_spia_velocita_2
            - input_boolean.vmc_master_spia_velocita_3
            - input_boolean.vmc_master_spia_velocita_4
            - input_boolean.vmc_master_spia_velocita_iperventilazione
            - input_boolean.vmc_master_spia_velocita_notturna
            - input_boolean.vmc_master_spia_velocita_freecooling
            - input_boolean.vmc_master_spia_calendario_lunedi_1
            - input_boolean.vmc_master_spia_calendario_lunedi_2
            - input_boolean.vmc_master_spia_calendario_martedi_1
            - input_boolean.vmc_master_spia_calendario_martedi_2
            - input_boolean.vmc_master_spia_calendario_mercoledi_1
            - input_boolean.vmc_master_spia_calendario_mercoledi_2
            - input_boolean.vmc_master_spia_calendario_giovedi_1
            - input_boolean.vmc_master_spia_calendario_giovedi_2
            - input_boolean.vmc_master_spia_calendario_venerdi_1
            - input_boolean.vmc_master_spia_calendario_venerdi_2
            - input_boolean.vmc_master_spia_calendario_sabato_1
            - input_boolean.vmc_master_spia_calendario_sabato_2
            - input_boolean.vmc_master_spia_calendario_domenica_1
            - input_boolean.vmc_master_spia_calendario_domenica_2
            - input_boolean.vmc_master_spia_velocita_0_un_solo_avvio
            - input_boolean.vmc_master_spia_velocita_1_un_solo_avvio
            - input_boolean.vmc_master_spia_velocita_2_un_solo_avvio
            - input_boolean.vmc_master_spia_velocita_3_un_solo_avvio
            - input_boolean.vmc_master_spia_velocita_4_un_solo_avvio
            - input_boolean.vmc_master_spia_velocita_iperventilazione_un_solo_avvio
            - input_boolean.vmc_master_spia_velocita_notturna_un_solo_avvio
            - input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio
            - input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio_per_programmazione_freecooling
            - input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio_per_programmazione_freeheating
            - input_boolean.vmc_master_spia_co2_o_voc_partenza_ritorno_velocita_0
            - input_boolean.vmc_master_spia_velocita_0_co2_o_voc
            - input_boolean.vmc_master_spia_velocita_1_co2_o_voc
            - input_boolean.vmc_master_spia_velocita_2_co2_o_voc
            - input_boolean.vmc_master_spia_velocita_3_co2_o_voc
            - input_boolean.vmc_master_spia_velocita_4_co2_o_voc
            - input_boolean.vmc_master_spia_velocita_iperventilazione_co2_o_voc
            - input_boolean.vmc_master_spia_velocita_notturna_co2_o_voc
            - input_boolean.vmc_master_spia_velocita_freecooling_co2_o_voc
            - input_boolean.vmc_master_spia_co2_o_voc
            - input_boolean.vmc_master_spia_velocita_1_co2_o_voc_pdr
            - input_boolean.vmc_master_congelamento_verifica_soglia_valore_spia
            - input_boolean.vmc_master_spia_velocita_0_congelamento
            - input_boolean.vmc_master_spia_velocita_1_congelamento
            - input_boolean.vmc_master_spia_velocita_2_congelamento
            - input_boolean.vmc_master_spia_velocita_3_congelamento
            - input_boolean.vmc_master_spia_velocita_4_congelamento
            - input_boolean.vmc_master_spia_velocita_iperventilazione_congelamento
            - input_boolean.vmc_master_spia_velocita_notturna_congelamento
            - input_boolean.vmc_master_spia_velocita_freecooling_congelamento
            - input_boolean.vmc_master_delta_temp_verifica_soglia_valore_spia
            - input_boolean.vmc_master_spia_velocita_0_delta_temp_verifica_soglia_valore
            - input_boolean.vmc_master_spia_velocita_1_delta_temp_verifica_soglia_valore
            - input_boolean.vmc_master_spia_velocita_2_delta_temp_verifica_soglia_valore
            - input_boolean.vmc_master_spia_velocita_3_delta_temp_verifica_soglia_valore
            - input_boolean.vmc_master_spia_velocita_4_delta_temp_verifica_soglia_valore
            - input_boolean.vmc_master_spia_velocita_iperventilazione_delta_temp_verifica_soglia_valore
            - input_boolean.vmc_master_spia_velocita_notturna_delta_temp_verifica_soglia_valore
            - input_boolean.vmc_master_spia_velocita_freecooling_delta_temp_verifica_soglia_valore
            - input_boolean.vmc_master_opzioni_accendi_spegni_avvisi
    mode: restart
    icon: mdi:cursor-pointer

  vmc_master_azzera_offset_sensors:
    alias: VMC Master - Azzera gli Offset dei Sensori
    sequence:
      - delay:
          hours: 0
          minutes: 0
          seconds: 0
          milliseconds: 0
      - service: input_number.set_value
        data:
          entity_id:
            - input_number.vmc_master_offset_temp_esterna
            - input_number.vmc_master_offset_temp_interna
            - input_number.vmc_master_offset_umidita_esterna
            - input_number.vmc_master_offset_umidita_interna
            - input_number.vmc_master_offset_co2
            - input_number.vmc_master_offset_voc
          value: 0
    mode: restart
    icon: mdi:cursor-pointer

  vmc_master_upgrade_sensors:
    alias: VMC Master - Aggiorna i Sensori Manualmente (30 Sec.)
    sequence:
      - delay:
          hours: 0
          minutes: 0
          seconds: 5
          milliseconds: 0
      - service: homeassistant.update_entity
        target:
          entity_id:
            - sensor.vmc_master_status_ip
      - delay:
          hours: 0
          minutes: 0
          seconds: 5
          milliseconds: 0
      - service: homeassistant.update_entity
        target:
          entity_id:
            - sensor.vmc_master_status_ventola
      - delay:
          hours: 0
          minutes: 0
          seconds: 5
          milliseconds: 0
      - service: homeassistant.update_entity
        target:
          entity_id:
            - sensor.vmc_master_sensori
      - delay:
          hours: 0
          minutes: 0
          seconds: 5
          milliseconds: 0
      - service: homeassistant.update_entity
        target:
          entity_id:
            - sensor.vmc_master_nome
      - delay:
          hours: 0
          minutes: 0
          seconds: 5
          milliseconds: 0
      - service: homeassistant.update_entity
        target:
          entity_id:
            - sensor.vmc_master_lan
      - delay:
          hours: 0
          minutes: 0
          seconds: 5
          milliseconds: 0
      - service: homeassistant.update_entity
        target:
          entity_id:
            - sensor.vmc_master_versione_repository
      - service: script.turn_on
        entity_id: script.vmc_master_aggiorna_elenco_entita_meteo
      - delay:
          hours: 0
          minutes: 0
          seconds: 5
          milliseconds: 0
      - service: homeassistant.update_entity
        target:
          entity_id:
            - sensor.vmc_master_forecast_temp_esterna_status
            - sensor.vmc_master_forecast_umidita_esterna_status
    mode: restart
    icon: mdi:cursor-pointer

  vmc_master_profilo_calendario:
    alias: VMC Master - Profilo Calendario
    sequence:
      - delay:
          hours: 0
          minutes: 0
          seconds: 5
          milliseconds: 0
      - service: input_datetime.set_datetime
        data:
          time: "00:05:00"
        target:
          entity_id:
            - input_datetime.vmc_master_accensione_lunedi
            - input_datetime.vmc_master_accensione_martedi
            - input_datetime.vmc_master_accensione_mercoledi
            - input_datetime.vmc_master_accensione_giovedi
            - input_datetime.vmc_master_accensione_venerdi
            - input_datetime.vmc_master_accensione_sabato
            - input_datetime.vmc_master_accensione_domenica
      - service: input_datetime.set_datetime
        data:
          time: "06:00:00"
        target:
          entity_id:
            - input_datetime.vmc_master_spegnimento_lunedi
            - input_datetime.vmc_master_spegnimento_martedi
            - input_datetime.vmc_master_spegnimento_mercoledi
            - input_datetime.vmc_master_spegnimento_giovedi
            - input_datetime.vmc_master_spegnimento_venerdi
            - input_datetime.vmc_master_spegnimento_sabato
            - input_datetime.vmc_master_spegnimento_domenica  
      - service: input_datetime.set_datetime
        data:
          time: "20:00:00"
        target:
          entity_id:
            - input_datetime.vmc_master_accensione_lunedi_2
            - input_datetime.vmc_master_accensione_martedi_2
            - input_datetime.vmc_master_accensione_mercoledi_2
            - input_datetime.vmc_master_accensione_giovedi_2
            - input_datetime.vmc_master_accensione_venerdi_2
            - input_datetime.vmc_master_accensione_sabato_2
            - input_datetime.vmc_master_accensione_domenica_2
      - service: input_datetime.set_datetime
        data:
          time: "23:59:00"
        target:
          entity_id:
            - input_datetime.vmc_master_spegnimento_lunedi_2
            - input_datetime.vmc_master_spegnimento_martedi_2
            - input_datetime.vmc_master_spegnimento_mercoledi_2
            - input_datetime.vmc_master_spegnimento_giovedi_2
            - input_datetime.vmc_master_spegnimento_venerdi_2
            - input_datetime.vmc_master_spegnimento_sabato_2
            - input_datetime.vmc_master_spegnimento_domenica_2  
      - service: input_select.select_option
        data:
          option: Velocità 1
        target:
          entity_id:
            - input_select.vmc_master_speed_1_fascia_calendario
      - service: input_select.reload
        data: {}
      - service: input_select.select_option
        data:
          option: Velocità 1
        target:
          entity_id:
            - input_select.vmc_master_speed_2_fascia_calendario    
      - service: input_select.reload
        data: {}
      - service: input_boolean.turn_on
        data: {}
        target:
          entity_id: input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_calendario
    mode: restart
    icon: mdi:cursor-pointer
    
  vmc_master_profilo_free_heating_cooling:
    alias: VMC Master - Profilo Free Heating/Cooling
    sequence:
      - delay:
          hours: 0
          minutes: 0
          seconds: 5
          milliseconds: 0
      - service: input_boolean.turn_on
        data: {}
        target:
          entity_id: 
            - input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_freeheating
            - input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_freecooling
      - service: input_select.select_option
        data:
          entity_id: input_select.vmc_master_mese_1_fascia_freeheating
          option: Ottobre
      - service: input_select.reload
        data: {}
      - service: input_select.select_option
        data:
          entity_id: input_select.vmc_master_mese_2_fascia_freeheating
          option: Giugno
      - service: input_select.reload
        data: {}
      - service: input_select.select_option
        data:
          entity_id: input_select.vmc_master_mese_1_fascia_freecooling
          option: Luglio
      - service: input_select.reload
        data: {}
      - service: input_select.select_option
        data:
          entity_id: input_select.vmc_master_mese_2_fascia_freecooling 
          option: Settembre
      - service: input_select.reload
        data: {}
    mode: restart
    icon: mdi:cursor-pointer

  vmc_master_profilo_pdr:
    alias: VMC Master - Profilo Lim. Δ P. di Rugiada
    sequence:
      - delay:
          hours: 0
          minutes: 0
          seconds: 5
          milliseconds: 0
      - service: input_number.set_value
        data:
          entity_id:
            - input_number.vmc_master_offset_verifica_impiego_vmc
          value: 0
      - service: input_boolean.turn_on
        data: {}
        target:
          entity_id: 
            - input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr
    mode: restart
    icon: mdi:cursor-pointer

  vmc_master_profilo_inizializzazione:
    alias: VMC Master - Profilo Inizializzazione (20 Sec. Riavvio H.A.)
    sequence:
      - service: automation.turn_off
        data: {}
        target:
          entity_id: automation.automazione_vmc_master
      - service: script.turn_on
        entity_id: script.vmc_master_azzera_booleans
      - service: script.turn_on
        entity_id: script.vmc_master_azzera_offset_sensors
      - service: script.turn_on
        entity_id: script.vmc_master_profilo_calendario
      - delay:
          hours: 0
          minutes: 0
          seconds: 5
          milliseconds: 0
      - service: script.turn_on
        entity_id: script.vmc_master_profilo_free_heating_cooling
      - service: script.turn_on
        entity_id: script.vmc_master_profilo_pdr
      - service: shell_command.vmc_master_velocita_0
      - delay:
          hours: 0
          minutes: 0
          seconds: 5
          milliseconds: 0
      - service: shell_command.vmc_master_sensori_off
      - delay:
          hours: 0
          minutes: 0
          seconds: 5
          milliseconds: 0
      - service: shell_command.vmc_master_pannello_led_on
      - service: input_boolean.turn_on
        data: {}
        target:
          entity_id: 
            - input_boolean.vmc_master_opzioni_accendi_spegni_avvisi
            - input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr
            - input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_calendario
            - input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_freeheating
            - input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_freecooling
            - input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc
      - service: automation.turn_on
        data: {}
        target:
          entity_id: automation.automazione_vmc_master
      - delay:
          hours: 0
          minutes: 0
          seconds: 5
          milliseconds: 0
      - service: homeassistant.restart
        data: {}
    mode: restart
    icon: mdi:cursor-pointer

  vmc_master_bottone_panico:
    alias: VMC Master - Panic Botton (5 Sec. Riavvio Package)
    sequence:
      - service: automation.turn_off
        data: {}
        target:
          entity_id: automation.automazione_vmc_master
      - service: input_boolean.turn_off
        data: {}
        target:
          entity_id: 
            - input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr
            - input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_calendario
            - input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_freeheating
            - input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_freecooling
            - input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc
      - service: script.turn_on
        entity_id: script.vmc_master_azzera_booleans
      - service: shell_command.vmc_master_velocita_0
      - delay:
          hours: 0
          minutes: 0
          seconds: 5
          milliseconds: 0
      - service: automation.turn_on
        data: {}
        target:
          entity_id: automation.automazione_vmc_master
    mode: restart
    icon: mdi:cursor-pointer
#------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
#------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  vmc_master_calendario_fascia_1_o_2_off:
    alias: VMC Master - Calendario Fascia 1 o 2 Off
    sequence:
      - service: automation.turn_off
        data: {}
        target:
          entity_id: automation.automazione_vmc_master
      - service: script.turn_on
        entity_id: script.vmc_master_azzera_booleans
      - service: shell_command.vmc_master_velocita_0
      - delay:
          hours: 0
          minutes: 0
          seconds: 5
          milliseconds: 0
      - service: automation.turn_on
        data: {}
        target:
          entity_id: automation.automazione_vmc_master
    mode: restart
    icon: mdi:cursor-pointer
#------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
#------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  vmc_master_calendario_fascia_1_on:
    alias: VMC Master - Calendario Fascia 1 On
    sequence:
      - choose:
          - conditions:
              - alias: Velocità 0 in Assenza di Congelamento e Delta Temperatura
                condition: and
                conditions:
                  - condition: state
                    entity_id: sensor.vmc_master_speed_1_fascia_calendario
                    state: Velocità 0
                  - condition: template
                    value_template: >-
                      {{(states('input_boolean.vmc_master_congelamento_verifica_soglia_valore_spia')==
                      'off' and
                      states('input_boolean.vmc_master_delta_temp_verifica_soglia_valore_spia')==
                      'off')}}
                    alias: Congelamento Assente e Delta Temperatura Assente
            sequence:
              - service: input_boolean.turn_off
                data: {}
                target:
                  entity_id:
                    - >-
                      input_boolean.vmc_master_spia_co2_o_voc_partenza_ritorno_velocita_0
                    - input_boolean.vmc_master_spia_velocita_1_co2_o_voc_pdr
                    - input_boolean.vmc_master_spia_velocita_0_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_1_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_2_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_3_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_4_co2_o_voc
                    - >-
                      input_boolean.vmc_master_spia_velocita_iperventilazione_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_notturna_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_freecooling_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_0_un_solo_avvio
                    - input_boolean.vmc_master_spia_velocita_1_un_solo_avvio
                    - input_boolean.vmc_master_spia_velocita_2_un_solo_avvio
                    - input_boolean.vmc_master_spia_velocita_3_un_solo_avvio
                    - input_boolean.vmc_master_spia_velocita_4_un_solo_avvio
                    - input_boolean.vmc_master_spia_velocita_notturna_un_solo_avvio
                    - >-
                      input_boolean.vmc_master_spia_velocita_iperventilazione_un_solo_avvio
                    - >-
                      input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio
                    - >-
                      input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio_per_programmazione_freecooling
                    - >-
                      input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio_per_programmazione_freeheating
              - choose:
                  - conditions:
                      - condition: and
                        conditions:
                          - condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr')=='on'}}
                            alias: Interruttore PdR ON
                          - condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc')=='on'}}
                            alias: Interruttore Inquinanti ON
                    sequence:
                      - choose:
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                                alias: Verifica CASO PDR ON E INQUINANTI ON
                            sequence:
                              - service: input_boolean.turn_on
                                data: {}
                                target:
                                  entity_id:
                                    - >-
                                      input_boolean.vmc_master_spia_velocita_1_co2_o_voc_pdr
                                    - >-
                                      input_boolean.vmc_master_spia_co2_o_voc_partenza_ritorno_velocita_0
                                    - input_boolean.vmc_master_spia_co2_o_voc
                                    - >-
                                      input_boolean.vmc_master_spia_velocita_1_co2_o_voc
                              - repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_velocita_1
                                      metadata: {}
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                        1'}}
                                alias: Ripeti Finchè Non Diventa Velocità 1
                            alias: CASO PDR ON E INQUINANTI ON
                          - conditions:
                              - alias: Verifica CASO PDR ON E INQUINANTI OFF
                                condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - alias: Ripeti Finchè Non Diventa Velocità 0
                                repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_velocita_0
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                        0'}}
                            alias: CASO PDR ON E INQUINANTI OFF
                          - conditions:
                              - alias: Verifica CASO PDR OFF E INQUINANTI ON
                                condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - service: input_boolean.turn_on
                                data: {}
                                target:
                                  entity_id:
                                    - >-
                                      input_boolean.vmc_master_spia_velocita_1_co2_o_voc_pdr
                                    - >-
                                      input_boolean.vmc_master_spia_co2_o_voc_partenza_ritorno_velocita_0
                                    - input_boolean.vmc_master_spia_co2_o_voc
                                    - >-
                                      input_boolean.vmc_master_spia_velocita_1_co2_o_voc
                              - repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_velocita_1
                                      metadata: {}
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                        1'}}
                                alias: Ripeti Finchè Non Diventa Velocità 1
                            alias: CASO PDR OFF E INQUINANTI ON
                          - conditions:
                              - alias: Verifica CASO PDR OFF E INQUINANTI OFF
                                condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - alias: Ripeti Finchè Non Diventa Velocità 0
                                repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_velocita_0
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                        0'}}
                            alias: CASO PDR OFF E INQUINANTI OFF
                    alias: Interruttore PdR ON e Interruttore Inquinanti ON
                  - conditions:
                      - condition: and
                        conditions:
                          - condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr')=='on'}}
                            alias: Interruttore PdR ON
                          - alias: Interruttore Inquinanti OFF
                            condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc')=='off'}}
                    sequence:
                      - choose:
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                                alias: Verifica CASO PDR ON E INQUINANTI ON
                            sequence:
                              - alias: Ripeti Finchè Non Diventa Velocità 0
                                repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_velocita_0
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                        0'}}
                            alias: CASO PDR ON E INQUINANTI ON
                          - conditions:
                              - alias: Verifica CASO PDR ON E INQUINANTI OFF
                                condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - alias: Ripeti Finchè Non Diventa Velocità 0
                                repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_velocita_0
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                        0'}}
                            alias: CASO PDR ON E INQUINANTI OFF
                          - conditions:
                              - alias: Verifica CASO PDR OFF E INQUINANTI ON
                                condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - alias: Ripeti Finchè Non Diventa Velocità 0
                                repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_velocita_0
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                        0'}}
                            alias: CASO PDR OFF E INQUINANTI ON
                          - conditions:
                              - alias: Verifica CASO PDR OFF E INQUINANTI OFF
                                condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - alias: Ripeti Finchè Non Diventa Velocità 0
                                repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_velocita_0
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                        0'}}
                            alias: CASO PDR OFF E INQUINANTI OFF
                    alias: Interruttore PdR ON e Interruttore Inquinanti OFF
                  - conditions:
                      - condition: and
                        conditions:
                          - alias: Interruttore PdR OFF
                            condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr')=='off'}}
                          - condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc')=='on'}}
                            alias: Interruttore Inquinanti ON
                    sequence:
                      - choose:
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                                alias: Verifica CASO PDR ON E INQUINANTI ON
                            sequence:
                              - service: input_boolean.turn_on
                                data: {}
                                target:
                                  entity_id:
                                    - >-
                                      input_boolean.vmc_master_spia_velocita_1_co2_o_voc_pdr
                                    - >-
                                      input_boolean.vmc_master_spia_co2_o_voc_partenza_ritorno_velocita_0
                                    - input_boolean.vmc_master_spia_co2_o_voc
                                    - >-
                                      input_boolean.vmc_master_spia_velocita_1_co2_o_voc
                              - repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_velocita_1
                                      metadata: {}
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                        1'}}
                                alias: Ripeti Finchè Non Diventa Velocità 1
                            alias: CASO PDR ON E INQUINANTI ON
                          - conditions:
                              - alias: Verifica CASO PDR ON E INQUINANTI OFF
                                condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - alias: Ripeti Finchè Non Diventa Velocità 0
                                repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_velocita_0
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                        0'}}
                            alias: CASO PDR ON E INQUINANTI OFF
                          - conditions:
                              - alias: Verifica CASO PDR OFF E INQUINANTI ON
                                condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - service: input_boolean.turn_on
                                data: {}
                                target:
                                  entity_id:
                                    - >-
                                      input_boolean.vmc_master_spia_velocita_1_co2_o_voc_pdr
                                    - >-
                                      input_boolean.vmc_master_spia_co2_o_voc_partenza_ritorno_velocita_0
                                    - input_boolean.vmc_master_spia_co2_o_voc
                                    - >-
                                      input_boolean.vmc_master_spia_velocita_1_co2_o_voc
                              - repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_velocita_1
                                      metadata: {}
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                        1'}}
                                alias: Ripeti Finchè Non Diventa Velocità 1
                            alias: CASO PDR OFF E INQUINANTI ON
                          - conditions:
                              - alias: Verifica CASO PDR OFF E INQUINANTI OFF
                                condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - alias: Ripeti Finchè Non Diventa Velocità 0
                                repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_velocita_0
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                        0'}}
                            alias: CASO PDR OFF E INQUINANTI OFF
                    alias: Interruttore PdR OFF e Interruttore Inquinanti ON
                  - conditions:
                      - condition: and
                        conditions:
                          - alias: Interruttore PdR OFF
                            condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr')=='off'}}
                          - alias: Interruttore Inquinanti OFF
                            condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc')=='off'}}
                    sequence:
                      - choose:
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                                alias: Verifica CASO PDR ON E INQUINANTI ON
                            sequence:
                              - alias: Ripeti Finchè Non Diventa Velocità 0
                                repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_velocita_0
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                        0'}}
                            alias: CASO PDR ON E INQUINANTI ON
                          - conditions:
                              - alias: Verifica CASO PDR ON E INQUINANTI OFF
                                condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - alias: Ripeti Finchè Non Diventa Velocità 0
                                repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_velocita_0
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                        0'}}
                            alias: CASO PDR ON E INQUINANTI OFF
                          - conditions:
                              - alias: Verifica CASO PDR OFF E INQUINANTI ON
                                condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - alias: Ripeti Finchè Non Diventa Velocità 0
                                repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_velocita_0
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                        0'}}
                            alias: CASO PDR OFF E INQUINANTI ON
                          - conditions:
                              - alias: Verifica CASO PDR OFF E INQUINANTI OFF
                                condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - alias: Ripeti Finchè Non Diventa Velocità 0
                                repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_velocita_0
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                        0'}}
                            alias: CASO PDR OFF E INQUINANTI OFF
                    alias: Interruttore PdR OFF e Interruttore Inquinanti OFF
          - conditions:
              - alias: Velocità 1 in Assenza di Congelamento e Delta Temperatura
                condition: and
                conditions:
                  - condition: state
                    entity_id: sensor.vmc_master_speed_1_fascia_calendario
                    state: Velocità 1
                  - condition: template
                    value_template: >-
                      {{(states('input_boolean.vmc_master_congelamento_verifica_soglia_valore_spia')==
                      'off' and
                      states('input_boolean.vmc_master_delta_temp_verifica_soglia_valore_spia')==
                      'off')}}
                    alias: Congelamento Assente e Delta Temperatura Assente
            sequence:
              - service: input_boolean.turn_off
                data: {}
                target:
                  entity_id:
                    - >-
                      input_boolean.vmc_master_spia_co2_o_voc_partenza_ritorno_velocita_0
                    - input_boolean.vmc_master_spia_velocita_1_co2_o_voc_pdr
                    - input_boolean.vmc_master_spia_velocita_0_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_1_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_2_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_3_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_4_co2_o_voc
                    - >-
                      input_boolean.vmc_master_spia_velocita_iperventilazione_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_notturna_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_freecooling_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_0_un_solo_avvio
                    - input_boolean.vmc_master_spia_velocita_1_un_solo_avvio
                    - input_boolean.vmc_master_spia_velocita_2_un_solo_avvio
                    - input_boolean.vmc_master_spia_velocita_3_un_solo_avvio
                    - input_boolean.vmc_master_spia_velocita_4_un_solo_avvio
                    - input_boolean.vmc_master_spia_velocita_notturna_un_solo_avvio
                    - >-
                      input_boolean.vmc_master_spia_velocita_iperventilazione_un_solo_avvio
                    - >-
                      input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio
                    - >-
                      input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio_per_programmazione_freecooling
                    - >-
                      input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio_per_programmazione_freeheating
              - choose:
                  - conditions:
                      - condition: and
                        conditions:
                          - condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr')=='on'}}
                            alias: Interruttore PdR ON
                          - condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc')=='on'}}
                            alias: Interruttore Inquinanti ON
                    sequence:
                      - choose:
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - service: input_boolean.turn_on
                                metadata: {}
                                data: {}
                                target:
                                  entity_id:
                                    - >-
                                      input_boolean.vmc_master_spia_velocita_1_un_solo_avvio
                                    - >-
                                      input_boolean.vmc_master_spia_velocita_1_co2_o_voc
                              - repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_velocita_1
                                      metadata: {}
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                        1'}}
                                alias: Ripeti Finchè Non Diventa Velocità 1
                            alias: CASO PDR ON E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - service: input_boolean.turn_on
                                metadata: {}
                                data: {}
                                target:
                                  entity_id: >-
                                    input_boolean.vmc_master_spia_velocita_1_un_solo_avvio
                              - alias: Ripeti Finchè Non Diventa Velocità 0
                                repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_velocita_0
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                        0'}}
                            alias: CASO PDR ON E INQUINANTI OFF
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - service: input_boolean.turn_on
                                metadata: {}
                                data: {}
                                target:
                                  entity_id:
                                    - >-
                                      input_boolean.vmc_master_spia_velocita_1_co2_o_voc
                              - repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_velocita_1
                                      metadata: {}
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                        1'}}
                                alias: Ripeti Finchè Non Diventa Velocità 1
                            alias: CASO PDR OFF E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_velocita_1
                                      metadata: {}
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                        1'}}
                                alias: Ripeti Finchè Non Diventa Velocità 1
                            alias: CASO PDR OFF E INQUINANTI OFF
                    alias: Interruttore PdR ON e Interruttore Inquinanti ON
                  - conditions:
                      - condition: and
                        conditions:
                          - condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr')=='on'}}
                            alias: Interruttore PdR ON
                          - alias: Interruttore Inquinanti OFF
                            condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc')=='off'}}
                    sequence:
                      - choose:
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - service: input_boolean.turn_on
                                metadata: {}
                                data: {}
                                target:
                                  entity_id:
                                    - >-
                                      input_boolean.vmc_master_spia_velocita_1_un_solo_avvio
                              - alias: Ripeti Finchè Non Diventa Velocità 0
                                repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_velocita_0
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                        0'}}
                            alias: CASO PDR ON E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - service: input_boolean.turn_on
                                metadata: {}
                                data: {}
                                target:
                                  entity_id: >-
                                    input_boolean.vmc_master_spia_velocita_1_un_solo_avvio
                              - alias: Ripeti Finchè Non Diventa Velocità 0
                                repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_velocita_0
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                        0'}}
                            alias: CASO PDR ON E INQUINANTI OFF
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_velocita_1
                                      metadata: {}
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                        1'}}
                                alias: Ripeti Finchè Non Diventa Velocità 1
                            alias: CASO PDR OFF E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_velocita_1
                                      metadata: {}
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                        1'}}
                                alias: Ripeti Finchè Non Diventa Velocità 1
                            alias: CASO PDR OFF E INQUINANTI OFF
                    alias: Interruttore PdR ON e Interruttore Inquinanti OFF
                  - conditions:
                      - condition: and
                        conditions:
                          - alias: Interruttore PdR OFF
                            condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr')=='off'}}
                          - condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc')=='on'}}
                            alias: Interruttore Inquinanti ON
                    sequence:
                      - choose:
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - service: input_boolean.turn_on
                                metadata: {}
                                data: {}
                                target:
                                  entity_id:
                                    - >-
                                      input_boolean.vmc_master_spia_velocita_1_co2_o_voc
                              - repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_velocita_1
                                      metadata: {}
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                        1'}}
                                alias: Ripeti Finchè Non Diventa Velocità 1
                            alias: CASO PDR ON E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - alias: Ripeti Finchè Non Diventa Velocità 1
                                repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_velocita_1
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                        1'}}
                            alias: CASO PDR ON E INQUINANTI OFF
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - service: input_boolean.turn_on
                                metadata: {}
                                data: {}
                                target:
                                  entity_id:
                                    - >-
                                      input_boolean.vmc_master_spia_velocita_1_co2_o_voc
                              - repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_velocita_1
                                      metadata: {}
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                        1'}}
                                alias: Ripeti Finchè Non Diventa Velocità 1
                            alias: CASO PDR OFF E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_velocita_1
                                      metadata: {}
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                        1'}}
                                alias: Ripeti Finchè Non Diventa Velocità 1
                            alias: CASO PDR OFF E INQUINANTI OFF
                    alias: Interruttore PdR OFF e Interruttore Inquinanti ON
                  - conditions:
                      - condition: and
                        conditions:
                          - alias: Interruttore PdR OFF
                            condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr')=='off'}}
                          - alias: Interruttore Inquinanti OFF
                            condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc')=='off'}}
                    sequence:
                      - choose:
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - alias: Ripeti Finchè Non Diventa Velocità 1
                                repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_velocita_1
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                        1'}}
                            alias: CASO PDR ON E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - alias: Ripeti Finchè Non Diventa Velocità 1
                                repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_velocita_1
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                        1'}}
                            alias: CASO PDR ON E INQUINANTI OFF
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_velocita_1
                                      metadata: {}
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                        1'}}
                                alias: Ripeti Finchè Non Diventa Velocità 1
                            alias: CASO PDR OFF E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_velocita_1
                                      metadata: {}
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                        1'}}
                                alias: Ripeti Finchè Non Diventa Velocità 1
                            alias: CASO PDR OFF E INQUINANTI OFF
                    alias: Interruttore PdR OFF e Interruttore Inquinanti OFF
          - conditions:
              - alias: Velocità 2 in Assenza di Congelamento e Delta Temperatura
                condition: and
                conditions:
                  - condition: state
                    entity_id: sensor.vmc_master_speed_1_fascia_calendario
                    state: Velocità 2
                  - condition: template
                    value_template: >-
                      {{(states('input_boolean.vmc_master_congelamento_verifica_soglia_valore_spia')==
                      'off' and
                      states('input_boolean.vmc_master_delta_temp_verifica_soglia_valore_spia')==
                      'off')}}
                    alias: Congelamento Assente e Delta Temperatura Assente
            sequence:
              - service: input_boolean.turn_off
                data: {}
                target:
                  entity_id:
                    - >-
                      input_boolean.vmc_master_spia_co2_o_voc_partenza_ritorno_velocita_0
                    - input_boolean.vmc_master_spia_velocita_1_co2_o_voc_pdr
                    - input_boolean.vmc_master_spia_velocita_0_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_1_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_2_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_3_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_4_co2_o_voc
                    - >-
                      input_boolean.vmc_master_spia_velocita_iperventilazione_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_notturna_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_freecooling_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_0_un_solo_avvio
                    - input_boolean.vmc_master_spia_velocita_1_un_solo_avvio
                    - input_boolean.vmc_master_spia_velocita_2_un_solo_avvio
                    - input_boolean.vmc_master_spia_velocita_3_un_solo_avvio
                    - input_boolean.vmc_master_spia_velocita_4_un_solo_avvio
                    - input_boolean.vmc_master_spia_velocita_notturna_un_solo_avvio
                    - >-
                      input_boolean.vmc_master_spia_velocita_iperventilazione_un_solo_avvio
                    - >-
                      input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio
                    - >-
                      input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio_per_programmazione_freecooling
                    - >-
                      input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio_per_programmazione_freeheating
              - choose:
                  - conditions:
                      - condition: and
                        conditions:
                          - condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr')=='on'}}
                            alias: Interruttore PdR ON
                          - condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc')=='on'}}
                            alias: Interruttore Inquinanti ON
                    sequence:
                      - choose:
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - service: input_boolean.turn_on
                                metadata: {}
                                data: {}
                                target:
                                  entity_id:
                                    - >-
                                      input_boolean.vmc_master_spia_velocita_2_un_solo_avvio
                                    - >-
                                      input_boolean.vmc_master_spia_velocita_2_co2_o_voc
                              - alias: Ripeti Finchè Non Diventa Velocità 2
                                repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_velocita_2
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                        2'}}
                            alias: CASO PDR ON E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - service: input_boolean.turn_on
                                metadata: {}
                                data: {}
                                target:
                                  entity_id: >-
                                    input_boolean.vmc_master_spia_velocita_2_un_solo_avvio
                              - alias: Ripeti Finchè Non Diventa Velocità 0
                                repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_velocita_0
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                        0'}}
                            alias: CASO PDR ON E INQUINANTI OFF
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - service: input_boolean.turn_on
                                metadata: {}
                                data: {}
                                target:
                                  entity_id:
                                    - >-
                                      input_boolean.vmc_master_spia_velocita_2_co2_o_voc
                              - alias: Ripeti Finchè Non Diventa Velocità 2
                                repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_velocita_2
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                        2'}}
                            alias: CASO PDR OFF E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - alias: Ripeti Finchè Non Diventa Velocità 2
                                repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_velocita_2
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                        2'}}
                            alias: CASO PDR OFF E INQUINANTI OFF
                    alias: Interruttore PdR ON e Interruttore Inquinanti ON
                  - conditions:
                      - condition: and
                        conditions:
                          - condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr')=='on'}}
                            alias: Interruttore PdR ON
                          - alias: Interruttore Inquinanti OFF
                            condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc')=='off'}}
                    sequence:
                      - choose:
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - service: input_boolean.turn_on
                                metadata: {}
                                data: {}
                                target:
                                  entity_id:
                                    - >-
                                      input_boolean.vmc_master_spia_velocita_2_un_solo_avvio
                              - alias: Ripeti Finchè Non Diventa Velocità 0
                                repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_velocita_0
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                        0'}}
                            alias: CASO PDR ON E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - service: input_boolean.turn_on
                                metadata: {}
                                data: {}
                                target:
                                  entity_id: >-
                                    input_boolean.vmc_master_spia_velocita_2_un_solo_avvio
                              - alias: Ripeti Finchè Non Diventa Velocità 0
                                repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_velocita_0
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                        0'}}
                            alias: CASO PDR ON E INQUINANTI OFF
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - alias: Ripeti Finchè Non Diventa Velocità 2
                                repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_velocita_2
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                        2'}}
                            alias: CASO PDR OFF E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - alias: Ripeti Finchè Non Diventa Velocità 2
                                repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_velocita_2
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                        2'}}
                            alias: CASO PDR OFF E INQUINANTI OFF
                    alias: Interruttore PdR ON e Interruttore Inquinanti OFF
                  - conditions:
                      - condition: and
                        conditions:
                          - alias: Interruttore PdR OFF
                            condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr')=='off'}}
                          - condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc')=='on'}}
                            alias: Interruttore Inquinanti ON
                    sequence:
                      - choose:
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - service: input_boolean.turn_on
                                metadata: {}
                                data: {}
                                target:
                                  entity_id:
                                    - >-
                                      input_boolean.vmc_master_spia_velocita_2_co2_o_voc
                              - alias: Ripeti Finchè Non Diventa Velocità 2
                                repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_velocita_2
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                        2'}}
                            alias: CASO PDR ON E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - alias: Ripeti Finchè Non Diventa Velocità 2
                                repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_velocita_2
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                        2'}}
                            alias: CASO PDR ON E INQUINANTI OFF
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - service: input_boolean.turn_on
                                metadata: {}
                                data: {}
                                target:
                                  entity_id:
                                    - >-
                                      input_boolean.vmc_master_spia_velocita_2_co2_o_voc
                              - alias: Ripeti Finchè Non Diventa Velocità 2
                                repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_velocita_2
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                        2'}}
                            alias: CASO PDR OFF E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - alias: Ripeti Finchè Non Diventa Velocità 2
                                repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_velocita_2
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                        2'}}
                            alias: CASO PDR OFF E INQUINANTI OFF
                    alias: Interruttore PdR OFF e Interruttore Inquinanti ON
                  - conditions:
                      - condition: and
                        conditions:
                          - alias: Interruttore PdR OFF
                            condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr')=='off'}}
                          - alias: Interruttore Inquinanti OFF
                            condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc')=='off'}}
                    sequence:
                      - choose:
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - alias: Ripeti Finchè Non Diventa Velocità 2
                                repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_velocita_2
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                        2'}}
                            alias: CASO PDR ON E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - alias: Ripeti Finchè Non Diventa Velocità 2
                                repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_velocita_2
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                        2'}}
                            alias: CASO PDR ON E INQUINANTI OFF
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - alias: Ripeti Finchè Non Diventa Velocità 2
                                repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_velocita_2
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                        2'}}
                            alias: CASO PDR OFF E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - alias: Ripeti Finchè Non Diventa Velocità 2
                                repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_velocita_2
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                        2'}}
                            alias: CASO PDR OFF E INQUINANTI OFF
                    alias: Interruttore PdR OFF e Interruttore Inquinanti OFF
          - conditions:
              - alias: Velocità 3 in Assenza di Congelamento e Delta Temperatura
                condition: and
                conditions:
                  - condition: state
                    entity_id: sensor.vmc_master_speed_1_fascia_calendario
                    state: Velocità 3
                  - condition: template
                    value_template: >-
                      {{(states('input_boolean.vmc_master_congelamento_verifica_soglia_valore_spia')==
                      'off' and
                      states('input_boolean.vmc_master_delta_temp_verifica_soglia_valore_spia')==
                      'off')}}
                    alias: Congelamento Assente e Delta Temperatura Assente
            sequence:
              - service: input_boolean.turn_off
                data: {}
                target:
                  entity_id:
                    - >-
                      input_boolean.vmc_master_spia_co2_o_voc_partenza_ritorno_velocita_0
                    - input_boolean.vmc_master_spia_velocita_1_co2_o_voc_pdr
                    - input_boolean.vmc_master_spia_velocita_0_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_1_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_2_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_3_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_4_co2_o_voc
                    - >-
                      input_boolean.vmc_master_spia_velocita_iperventilazione_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_notturna_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_freecooling_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_0_un_solo_avvio
                    - input_boolean.vmc_master_spia_velocita_1_un_solo_avvio
                    - input_boolean.vmc_master_spia_velocita_2_un_solo_avvio
                    - input_boolean.vmc_master_spia_velocita_3_un_solo_avvio
                    - input_boolean.vmc_master_spia_velocita_4_un_solo_avvio
                    - input_boolean.vmc_master_spia_velocita_notturna_un_solo_avvio
                    - >-
                      input_boolean.vmc_master_spia_velocita_iperventilazione_un_solo_avvio
                    - >-
                      input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio
                    - >-
                      input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio_per_programmazione_freecooling
                    - >-
                      input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio_per_programmazione_freeheating
              - choose:
                  - conditions:
                      - condition: and
                        conditions:
                          - condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr')=='on'}}
                            alias: Interruttore PdR ON
                          - condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc')=='on'}}
                            alias: Interruttore Inquinanti ON
                    sequence:
                      - choose:
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - service: input_boolean.turn_on
                                metadata: {}
                                data: {}
                                target:
                                  entity_id:
                                    - >-
                                      input_boolean.vmc_master_spia_velocita_3_un_solo_avvio
                                    - >-
                                      input_boolean.vmc_master_spia_velocita_3_co2_o_voc
                              - repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_velocita_3
                                      metadata: {}
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                        3'}}
                                alias: Ripeti Finchè Non Diventa Velocità 3
                            alias: CASO PDR ON E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - service: input_boolean.turn_on
                                metadata: {}
                                data: {}
                                target:
                                  entity_id: >-
                                    input_boolean.vmc_master_spia_velocita_3_un_solo_avvio
                              - alias: Ripeti Finchè Non Diventa Velocità 0
                                repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_velocita_0
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                        0'}}
                            alias: CASO PDR ON E INQUINANTI OFF
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - service: input_boolean.turn_on
                                metadata: {}
                                data: {}
                                target:
                                  entity_id:
                                    - >-
                                      input_boolean.vmc_master_spia_velocita_3_co2_o_voc
                              - repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_velocita_3
                                      metadata: {}
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                        3'}}
                                alias: Ripeti Finchè Non Diventa Velocità 3
                            alias: CASO PDR OFF E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_velocita_3
                                      metadata: {}
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                        3'}}
                                alias: Ripeti Finchè Non Diventa Velocità 3
                            alias: CASO PDR OFF E INQUINANTI OFF
                    alias: Interruttore PdR ON e Interruttore Inquinanti ON
                  - conditions:
                      - condition: and
                        conditions:
                          - condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr')=='on'}}
                            alias: Interruttore PdR ON
                          - alias: Interruttore Inquinanti OFF
                            condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc')=='off'}}
                    sequence:
                      - choose:
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - service: input_boolean.turn_on
                                metadata: {}
                                data: {}
                                target:
                                  entity_id:
                                    - >-
                                      input_boolean.vmc_master_spia_velocita_3_un_solo_avvio
                              - alias: Ripeti Finchè Non Diventa Velocità 0
                                repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_velocita_0
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                        0'}}
                            alias: CASO PDR ON E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - service: input_boolean.turn_on
                                metadata: {}
                                data: {}
                                target:
                                  entity_id: >-
                                    input_boolean.vmc_master_spia_velocita_3_un_solo_avvio
                              - alias: Ripeti Finchè Non Diventa Velocità 0
                                repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_velocita_0
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                        0'}}
                            alias: CASO PDR ON E INQUINANTI OFF
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_velocita_3
                                      metadata: {}
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                        3'}}
                                alias: Ripeti Finchè Non Diventa Velocità 3
                            alias: CASO PDR OFF E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_velocita_3
                                      metadata: {}
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                        3'}}
                                alias: Ripeti Finchè Non Diventa Velocità 3
                            alias: CASO PDR OFF E INQUINANTI OFF
                    alias: Interruttore PdR ON e Interruttore Inquinanti OFF
                  - conditions:
                      - condition: and
                        conditions:
                          - alias: Interruttore PdR OFF
                            condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr')=='off'}}
                          - condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc')=='on'}}
                            alias: Interruttore Inquinanti ON
                    sequence:
                      - choose:
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - service: input_boolean.turn_on
                                metadata: {}
                                data: {}
                                target:
                                  entity_id:
                                    - >-
                                      input_boolean.vmc_master_spia_velocita_3_co2_o_voc
                              - repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_velocita_3
                                      metadata: {}
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                        3'}}
                                alias: Ripeti Finchè Non Diventa Velocità 3
                            alias: CASO PDR ON E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - alias: Ripeti Finchè Non Diventa Velocità 3
                                repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_velocita_3
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                        3'}}
                            alias: CASO PDR ON E INQUINANTI OFF
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - service: input_boolean.turn_on
                                metadata: {}
                                data: {}
                                target:
                                  entity_id:
                                    - >-
                                      input_boolean.vmc_master_spia_velocita_3_co2_o_voc
                              - repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_velocita_3
                                      metadata: {}
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                        3'}}
                                alias: Ripeti Finchè Non Diventa Velocità 3
                            alias: CASO PDR OFF E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_velocita_3
                                      metadata: {}
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                        3'}}
                                alias: Ripeti Finchè Non Diventa Velocità 3
                            alias: CASO PDR OFF E INQUINANTI OFF
                    alias: Interruttore PdR OFF e Interruttore Inquinanti ON
                  - conditions:
                      - condition: and
                        conditions:
                          - alias: Interruttore PdR OFF
                            condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr')=='off'}}
                          - alias: Interruttore Inquinanti OFF
                            condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc')=='off'}}
                    sequence:
                      - choose:
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - alias: Ripeti Finchè Non Diventa Velocità 3
                                repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_velocita_3
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                        3'}}
                            alias: CASO PDR ON E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - alias: Ripeti Finchè Non Diventa Velocità 3
                                repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_velocita_3
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                        3'}}
                            alias: CASO PDR ON E INQUINANTI OFF
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_velocita_3
                                      metadata: {}
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                        3'}}
                                alias: Ripeti Finchè Non Diventa Velocità 3
                            alias: CASO PDR OFF E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_velocita_3
                                      metadata: {}
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                        3'}}
                                alias: Ripeti Finchè Non Diventa Velocità 3
                            alias: CASO PDR OFF E INQUINANTI OFF
                    alias: Interruttore PdR OFF e Interruttore Inquinanti OFF
          - conditions:
              - alias: Velocità 4 in Assenza di Congelamento e Delta Temperatura
                condition: and
                conditions:
                  - condition: state
                    entity_id: sensor.vmc_master_speed_1_fascia_calendario
                    state: Velocità 4
                  - condition: template
                    value_template: >-
                      {{(states('input_boolean.vmc_master_congelamento_verifica_soglia_valore_spia')==
                      'off' and
                      states('input_boolean.vmc_master_delta_temp_verifica_soglia_valore_spia')==
                      'off')}}
                    alias: Congelamento Assente e Delta Temperatura Assente
            sequence:
              - service: input_boolean.turn_off
                data: {}
                target:
                  entity_id:
                    - >-
                      input_boolean.vmc_master_spia_co2_o_voc_partenza_ritorno_velocita_0
                    - input_boolean.vmc_master_spia_velocita_1_co2_o_voc_pdr
                    - input_boolean.vmc_master_spia_velocita_0_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_1_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_2_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_3_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_4_co2_o_voc
                    - >-
                      input_boolean.vmc_master_spia_velocita_iperventilazione_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_notturna_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_freecooling_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_0_un_solo_avvio
                    - input_boolean.vmc_master_spia_velocita_1_un_solo_avvio
                    - input_boolean.vmc_master_spia_velocita_2_un_solo_avvio
                    - input_boolean.vmc_master_spia_velocita_3_un_solo_avvio
                    - input_boolean.vmc_master_spia_velocita_4_un_solo_avvio
                    - input_boolean.vmc_master_spia_velocita_notturna_un_solo_avvio
                    - >-
                      input_boolean.vmc_master_spia_velocita_iperventilazione_un_solo_avvio
                    - >-
                      input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio
                    - >-
                      input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio_per_programmazione_freecooling
                    - >-
                      input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio_per_programmazione_freeheating
              - choose:
                  - conditions:
                      - condition: and
                        conditions:
                          - condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr')=='on'}}
                            alias: Interruttore PdR ON
                          - condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc')=='on'}}
                            alias: Interruttore Inquinanti ON
                    sequence:
                      - choose:
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - service: input_boolean.turn_on
                                metadata: {}
                                data: {}
                                target:
                                  entity_id:
                                    - >-
                                      input_boolean.vmc_master_spia_velocita_4_un_solo_avvio
                                    - >-
                                      input_boolean.vmc_master_spia_velocita_4_co2_o_voc
                              - repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_velocita_4
                                      metadata: {}
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                        4'}}
                                alias: Ripeti Finchè Non Diventa Velocità 4
                            alias: CASO PDR ON E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - service: input_boolean.turn_on
                                metadata: {}
                                data: {}
                                target:
                                  entity_id: >-
                                    input_boolean.vmc_master_spia_velocita_4_un_solo_avvio
                              - alias: Ripeti Finchè Non Diventa Velocità 0
                                repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_velocita_0
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                        0'}}
                            alias: CASO PDR ON E INQUINANTI OFF
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - service: input_boolean.turn_on
                                metadata: {}
                                data: {}
                                target:
                                  entity_id:
                                    - >-
                                      input_boolean.vmc_master_spia_velocita_4_co2_o_voc
                              - repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_velocita_4
                                      metadata: {}
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                        4'}}
                                alias: Ripeti Finchè Non Diventa Velocità 4
                            alias: CASO PDR OFF E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_velocita_4
                                      metadata: {}
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                        4'}}
                                alias: Ripeti Finchè Non Diventa Velocità 4
                            alias: CASO PDR OFF E INQUINANTI OFF
                    alias: Interruttore PdR ON e Interruttore Inquinanti ON
                  - conditions:
                      - condition: and
                        conditions:
                          - condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr')=='on'}}
                            alias: Interruttore PdR ON
                          - alias: Interruttore Inquinanti OFF
                            condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc')=='off'}}
                    sequence:
                      - choose:
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - service: input_boolean.turn_on
                                metadata: {}
                                data: {}
                                target:
                                  entity_id:
                                    - >-
                                      input_boolean.vmc_master_spia_velocita_4_un_solo_avvio
                              - alias: Ripeti Finchè Non Diventa Velocità 0
                                repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_velocita_0
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                        0'}}
                            alias: CASO PDR ON E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - service: input_boolean.turn_on
                                metadata: {}
                                data: {}
                                target:
                                  entity_id: >-
                                    input_boolean.vmc_master_spia_velocita_4_un_solo_avvio
                              - alias: Ripeti Finchè Non Diventa Velocità 0
                                repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_velocita_0
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                        0'}}
                            alias: CASO PDR ON E INQUINANTI OFF
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_velocita_4
                                      metadata: {}
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                        4'}}
                                alias: Ripeti Finchè Non Diventa Velocità 4
                            alias: CASO PDR OFF E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_velocita_4
                                      metadata: {}
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                        4'}}
                                alias: Ripeti Finchè Non Diventa Velocità 4
                            alias: CASO PDR OFF E INQUINANTI OFF
                    alias: Interruttore PdR ON e Interruttore Inquinanti OFF
                  - conditions:
                      - condition: and
                        conditions:
                          - alias: Interruttore PdR OFF
                            condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr')=='off'}}
                          - condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc')=='on'}}
                            alias: Interruttore Inquinanti ON
                    sequence:
                      - choose:
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - service: input_boolean.turn_on
                                metadata: {}
                                data: {}
                                target:
                                  entity_id:
                                    - >-
                                      input_boolean.vmc_master_spia_velocita_4_co2_o_voc
                              - repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_velocita_4
                                      metadata: {}
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                        4'}}
                                alias: Ripeti Finchè Non Diventa Velocità 4
                            alias: CASO PDR ON E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - alias: Ripeti Finchè Non Diventa Velocità 4
                                repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_velocita_4
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                        4'}}
                            alias: CASO PDR ON E INQUINANTI OFF
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - service: input_boolean.turn_on
                                metadata: {}
                                data: {}
                                target:
                                  entity_id:
                                    - >-
                                      input_boolean.vmc_master_spia_velocita_4_co2_o_voc
                              - repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_velocita_4
                                      metadata: {}
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                        4'}}
                                alias: Ripeti Finchè Non Diventa Velocità 4
                            alias: CASO PDR OFF E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_velocita_4
                                      metadata: {}
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                        4'}}
                                alias: Ripeti Finchè Non Diventa Velocità 4
                            alias: CASO PDR OFF E INQUINANTI OFF
                    alias: Interruttore PdR OFF e Interruttore Inquinanti ON
                  - conditions:
                      - condition: and
                        conditions:
                          - alias: Interruttore PdR OFF
                            condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr')=='off'}}
                          - alias: Interruttore Inquinanti OFF
                            condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc')=='off'}}
                    sequence:
                      - choose:
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - alias: Ripeti Finchè Non Diventa Velocità 4
                                repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_velocita_4
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                        4'}}
                            alias: CASO PDR ON E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - alias: Ripeti Finchè Non Diventa Velocità 4
                                repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_velocita_4
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                        4'}}
                            alias: CASO PDR ON E INQUINANTI OFF
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_velocita_4
                                      metadata: {}
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                        4'}}
                                alias: Ripeti Finchè Non Diventa Velocità 4
                            alias: CASO PDR OFF E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_velocita_4
                                      metadata: {}
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                        4'}}
                                alias: Ripeti Finchè Non Diventa Velocità 4
                            alias: CASO PDR OFF E INQUINANTI OFF
                    alias: Interruttore PdR OFF e Interruttore Inquinanti OFF
          - conditions:
              - alias: Velocità Notturna in Assenza di Congelamento e Delta Temperatura
                condition: and
                conditions:
                  - condition: state
                    entity_id: sensor.vmc_master_speed_1_fascia_calendario
                    state: Notturna
                  - condition: template
                    value_template: >-
                      {{(states('input_boolean.vmc_master_congelamento_verifica_soglia_valore_spia')==
                      'off' and
                      states('input_boolean.vmc_master_delta_temp_verifica_soglia_valore_spia')==
                      'off')}}
                    alias: Congelamento Assente e Delta Temperatura Assente
            sequence:
              - service: input_boolean.turn_off
                data: {}
                target:
                  entity_id:
                    - >-
                      input_boolean.vmc_master_spia_co2_o_voc_partenza_ritorno_velocita_0
                    - input_boolean.vmc_master_spia_velocita_1_co2_o_voc_pdr
                    - input_boolean.vmc_master_spia_velocita_0_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_1_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_2_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_3_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_4_co2_o_voc
                    - >-
                      input_boolean.vmc_master_spia_velocita_iperventilazione_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_notturna_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_freecooling_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_0_un_solo_avvio
                    - input_boolean.vmc_master_spia_velocita_1_un_solo_avvio
                    - input_boolean.vmc_master_spia_velocita_2_un_solo_avvio
                    - input_boolean.vmc_master_spia_velocita_3_un_solo_avvio
                    - input_boolean.vmc_master_spia_velocita_4_un_solo_avvio
                    - input_boolean.vmc_master_spia_velocita_notturna_un_solo_avvio
                    - >-
                      input_boolean.vmc_master_spia_velocita_iperventilazione_un_solo_avvio
                    - >-
                      input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio
                    - >-
                      input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio_per_programmazione_freecooling
                    - >-
                      input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio_per_programmazione_freeheating
              - choose:
                  - conditions:
                      - condition: and
                        conditions:
                          - condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr')=='on'}}
                            alias: Interruttore PdR ON
                          - condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc')=='on'}}
                            alias: Interruttore Inquinanti ON
                    sequence:
                      - choose:
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - service: input_boolean.turn_on
                                metadata: {}
                                data: {}
                                target:
                                  entity_id:
                                    - >-
                                      input_boolean.vmc_master_spia_velocita_notturna_un_solo_avvio
                                    - >-
                                      input_boolean.vmc_master_spia_velocita_notturna_co2_o_voc
                              - alias: Ripeti Finchè Non Diventa Velocità Notturna
                                repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_notturna
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Notturna'}}
                            alias: CASO PDR ON E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - service: input_boolean.turn_on
                                metadata: {}
                                data: {}
                                target:
                                  entity_id: >-
                                    input_boolean.vmc_master_spia_velocita_notturna_un_solo_avvio
                              - alias: Ripeti Finchè Non Diventa Velocità 0
                                repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_velocita_0
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                        0'}}
                            alias: CASO PDR ON E INQUINANTI OFF
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - service: input_boolean.turn_on
                                metadata: {}
                                data: {}
                                target:
                                  entity_id:
                                    - >-
                                      input_boolean.vmc_master_spia_velocita_notturna_co2_o_voc
                              - alias: Ripeti Finchè Non Diventa Velocità Notturna
                                repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_notturna
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Notturna'}}
                            alias: CASO PDR OFF E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - alias: Ripeti Finchè Non Diventa Velocità Notturna
                                repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_notturna
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Notturna'}}
                            alias: CASO PDR OFF E INQUINANTI OFF
                    alias: Interruttore PdR ON e Interruttore Inquinanti ON
                  - conditions:
                      - condition: and
                        conditions:
                          - condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr')=='on'}}
                            alias: Interruttore PdR ON
                          - alias: Interruttore Inquinanti OFF
                            condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc')=='off'}}
                    sequence:
                      - choose:
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - service: input_boolean.turn_on
                                metadata: {}
                                data: {}
                                target:
                                  entity_id:
                                    - >-
                                      input_boolean.vmc_master_spia_velocita_notturna_un_solo_avvio
                              - alias: Ripeti Finchè Non Diventa Velocità 0
                                repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_velocita_0
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                        0'}}
                            alias: CASO PDR ON E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - service: input_boolean.turn_on
                                metadata: {}
                                data: {}
                                target:
                                  entity_id: >-
                                    input_boolean.vmc_master_spia_velocita_notturna_un_solo_avvio
                              - alias: Ripeti Finchè Non Diventa Velocità 0
                                repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_velocita_0
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                        0'}}
                            alias: CASO PDR ON E INQUINANTI OFF
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - alias: Ripeti Finchè Non Diventa Velocità Notturna
                                repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_notturna
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Notturna'}}
                            alias: CASO PDR OFF E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - alias: Ripeti Finchè Non Diventa Velocità Notturna
                                repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_notturna
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Notturna'}}
                            alias: CASO PDR OFF E INQUINANTI OFF
                    alias: Interruttore PdR ON e Interruttore Inquinanti OFF
                  - conditions:
                      - condition: and
                        conditions:
                          - alias: Interruttore PdR OFF
                            condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr')=='off'}}
                          - condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc')=='on'}}
                            alias: Interruttore Inquinanti ON
                    sequence:
                      - choose:
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - service: input_boolean.turn_on
                                metadata: {}
                                data: {}
                                target:
                                  entity_id:
                                    - >-
                                      input_boolean.vmc_master_spia_velocita_notturna_co2_o_voc
                              - alias: Ripeti Finchè Non Diventa Velocità Notturna
                                repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_notturna
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Notturna'}}
                            alias: CASO PDR ON E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - alias: Ripeti Finchè Non Diventa Velocità Notturna
                                repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_notturna
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Notturna'}}
                            alias: CASO PDR ON E INQUINANTI OFF
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - service: input_boolean.turn_on
                                metadata: {}
                                data: {}
                                target:
                                  entity_id:
                                    - >-
                                      input_boolean.vmc_master_spia_velocita_notturna_co2_o_voc
                              - alias: Ripeti Finchè Non Diventa Velocità Notturna
                                repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_notturna
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Notturna'}}
                            alias: CASO PDR OFF E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - alias: Ripeti Finchè Non Diventa Velocità Notturna
                                repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_notturna
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Notturna'}}
                            alias: CASO PDR OFF E INQUINANTI OFF
                    alias: Interruttore PdR OFF e Interruttore Inquinanti ON
                  - conditions:
                      - condition: and
                        conditions:
                          - alias: Interruttore PdR OFF
                            condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr')=='off'}}
                          - alias: Interruttore Inquinanti OFF
                            condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc')=='off'}}
                    sequence:
                      - choose:
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - alias: Ripeti Finchè Non Diventa Velocità Notturna
                                repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_notturna
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Notturna'}}
                            alias: CASO PDR ON E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - alias: Ripeti Finchè Non Diventa Velocità Notturna
                                repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_notturna
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Notturna'}}
                            alias: CASO PDR ON E INQUINANTI OFF
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - alias: Ripeti Finchè Non Diventa Velocità Notturna
                                repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_notturna
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Notturna'}}
                            alias: CASO PDR OFF E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - alias: Ripeti Finchè Non Diventa Velocità Notturna
                                repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_notturna
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Notturna'}}
                            alias: CASO PDR OFF E INQUINANTI OFF
                    alias: Interruttore PdR OFF e Interruttore Inquinanti OFF
          - conditions:
              - alias: >-
                  Velocità Iperventilazione in Assenza di Congelamento e Delta
                  Temperatura
                condition: and
                conditions:
                  - condition: state
                    entity_id: sensor.vmc_master_speed_1_fascia_calendario
                    state: Iperventilazione
                  - condition: template
                    value_template: >-
                      {{(states('input_boolean.vmc_master_congelamento_verifica_soglia_valore_spia')==
                      'off' and
                      states('input_boolean.vmc_master_delta_temp_verifica_soglia_valore_spia')==
                      'off')}}
                    alias: Congelamento Assente e Delta Temperatura Assente
            sequence:
              - service: input_boolean.turn_off
                data: {}
                target:
                  entity_id:
                    - >-
                      input_boolean.vmc_master_spia_co2_o_voc_partenza_ritorno_velocita_0
                    - input_boolean.vmc_master_spia_velocita_1_co2_o_voc_pdr
                    - input_boolean.vmc_master_spia_velocita_0_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_1_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_2_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_3_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_4_co2_o_voc
                    - >-
                      input_boolean.vmc_master_spia_velocita_iperventilazione_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_notturna_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_freecooling_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_0_un_solo_avvio
                    - input_boolean.vmc_master_spia_velocita_1_un_solo_avvio
                    - input_boolean.vmc_master_spia_velocita_2_un_solo_avvio
                    - input_boolean.vmc_master_spia_velocita_3_un_solo_avvio
                    - input_boolean.vmc_master_spia_velocita_4_un_solo_avvio
                    - input_boolean.vmc_master_spia_velocita_notturna_un_solo_avvio
                    - >-
                      input_boolean.vmc_master_spia_velocita_iperventilazione_un_solo_avvio
                    - >-
                      input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio
                    - >-
                      input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio_per_programmazione_freecooling
                    - >-
                      input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio_per_programmazione_freeheating
              - choose:
                  - conditions:
                      - condition: and
                        conditions:
                          - condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr')=='on'}}
                            alias: Interruttore PdR ON
                          - condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc')=='on'}}
                            alias: Interruttore Inquinanti ON
                    sequence:
                      - choose:
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - service: input_boolean.turn_on
                                metadata: {}
                                data: {}
                                target:
                                  entity_id:
                                    - >-
                                      input_boolean.vmc_master_spia_velocita_iperventilazione_un_solo_avvio
                                    - >-
                                      input_boolean.vmc_master_spia_velocita_iperventilazione_co2_o_voc
                              - alias: >-
                                  Ripeti Finchè Non Diventa Velocità
                                  Iperventilazione
                                repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_iperventilazione
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Iperventilazione'}}
                            alias: CASO PDR ON E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - service: input_boolean.turn_on
                                metadata: {}
                                data: {}
                                target:
                                  entity_id: >-
                                    input_boolean.vmc_master_spia_velocita_iperventilazione_un_solo_avvio
                              - alias: Ripeti Finchè Non Diventa Velocità 0
                                repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_velocita_0
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                        0'}}
                            alias: CASO PDR ON E INQUINANTI OFF
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - service: input_boolean.turn_on
                                metadata: {}
                                data: {}
                                target:
                                  entity_id:
                                    - >-
                                      input_boolean.vmc_master_spia_velocita_iperventilazione_co2_o_voc
                              - alias: >-
                                  Ripeti Finchè Non Diventa Velocità
                                  Iperventilazione
                                repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_iperventilazione
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Iperventilazione'}}
                            alias: CASO PDR OFF E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - alias: >-
                                  Ripeti Finchè Non Diventa Velocità
                                  Iperventilazione
                                repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_iperventilazione
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Iperventilazione'}}
                            alias: CASO PDR OFF E INQUINANTI OFF
                    alias: Interruttore PdR ON e Interruttore Inquinanti ON
                  - conditions:
                      - condition: and
                        conditions:
                          - condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr')=='on'}}
                            alias: Interruttore PdR ON
                          - alias: Interruttore Inquinanti OFF
                            condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc')=='off'}}
                    sequence:
                      - choose:
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - service: input_boolean.turn_on
                                metadata: {}
                                data: {}
                                target:
                                  entity_id:
                                    - >-
                                      input_boolean.vmc_master_spia_velocita_iperventilazione_un_solo_avvio
                              - alias: Ripeti Finchè Non Diventa Velocità 0
                                repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_velocita_0
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                        0'}}
                            alias: CASO PDR ON E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - service: input_boolean.turn_on
                                metadata: {}
                                data: {}
                                target:
                                  entity_id: >-
                                    input_boolean.vmc_master_spia_velocita_iperventilazione_un_solo_avvio
                              - alias: Ripeti Finchè Non Diventa Velocità 0
                                repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_velocita_0
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                        0'}}
                            alias: CASO PDR ON E INQUINANTI OFF
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - alias: >-
                                  Ripeti Finchè Non Diventa Velocità
                                  Iperventilazione
                                repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_iperventilazione
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Iperventilazione'}}
                            alias: CASO PDR OFF E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - alias: >-
                                  Ripeti Finchè Non Diventa Velocità
                                  Iperventilazione
                                repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_iperventilazione
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Iperventilazione'}}
                            alias: CASO PDR OFF E INQUINANTI OFF
                    alias: Interruttore PdR ON e Interruttore Inquinanti OFF
                  - conditions:
                      - condition: and
                        conditions:
                          - alias: Interruttore PdR OFF
                            condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr')=='off'}}
                          - condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc')=='on'}}
                            alias: Interruttore Inquinanti ON
                    sequence:
                      - choose:
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - service: input_boolean.turn_on
                                metadata: {}
                                data: {}
                                target:
                                  entity_id:
                                    - >-
                                      input_boolean.vmc_master_spia_velocita_iperventilazione_co2_o_voc
                              - alias: >-
                                  Ripeti Finchè Non Diventa Velocità
                                  Iperventilazione
                                repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_iperventilazione
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Iperventilazione'}}
                            alias: CASO PDR ON E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - alias: >-
                                  Ripeti Finchè Non Diventa Velocità
                                  Iperventilazione
                                repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_iperventilazione
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Iperventilazione'}}
                            alias: CASO PDR ON E INQUINANTI OFF
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - service: input_boolean.turn_on
                                metadata: {}
                                data: {}
                                target:
                                  entity_id:
                                    - >-
                                      input_boolean.vmc_master_spia_velocita_iperventilazione_co2_o_voc
                              - alias: >-
                                  Ripeti Finchè Non Diventa Velocità
                                  Iperventilazione
                                repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_iperventilazione
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Iperventilazione'}}
                            alias: CASO PDR OFF E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - alias: >-
                                  Ripeti Finchè Non Diventa Velocità
                                  Iperventilazione
                                repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_iperventilazione
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Iperventilazione'}}
                            alias: CASO PDR OFF E INQUINANTI OFF
                    alias: Interruttore PdR OFF e Interruttore Inquinanti ON
                  - conditions:
                      - condition: and
                        conditions:
                          - alias: Interruttore PdR OFF
                            condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr')=='off'}}
                          - alias: Interruttore Inquinanti OFF
                            condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc')=='off'}}
                    sequence:
                      - choose:
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - alias: >-
                                  Ripeti Finchè Non Diventa Velocità
                                  Iperventilazione
                                repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_iperventilazione
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Iperventilazione'}}
                            alias: CASO PDR ON E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - alias: >-
                                  Ripeti Finchè Non Diventa Velocità
                                  Iperventilazione
                                repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_iperventilazione
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Iperventilazione'}}
                            alias: CASO PDR ON E INQUINANTI OFF
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - alias: >-
                                  Ripeti Finchè Non Diventa Velocità
                                  Iperventilazione
                                repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_iperventilazione
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Iperventilazione'}}
                            alias: CASO PDR OFF E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - alias: >-
                                  Ripeti Finchè Non Diventa Velocità
                                  Iperventilazione
                                repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_iperventilazione
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Iperventilazione'}}
                            alias: CASO PDR OFF E INQUINANTI OFF
                    alias: Interruttore PdR OFF e Interruttore Inquinanti OFF
          - conditions:
              - alias: >-
                  Velocità Free Cool./Heat. in Assenza di Congelamento e Delta
                  Temperatura
                condition: and
                conditions:
                  - condition: state
                    entity_id: sensor.vmc_master_speed_1_fascia_calendario
                    state: Free Cool./Heat.
                  - condition: template
                    value_template: >-
                      {{(states('input_boolean.vmc_master_congelamento_verifica_soglia_valore_spia')==
                      'off' and
                      states('input_boolean.vmc_master_delta_temp_verifica_soglia_valore_spia')==
                      'off')}}
                    alias: Congelamento Assente e Delta Temperatura Assente
            sequence:
              - service: input_boolean.turn_off
                data: {}
                target:
                  entity_id:
                    - >-
                      input_boolean.vmc_master_spia_co2_o_voc_partenza_ritorno_velocita_0
                    - input_boolean.vmc_master_spia_velocita_1_co2_o_voc_pdr
                    - input_boolean.vmc_master_spia_velocita_0_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_1_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_2_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_3_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_4_co2_o_voc
                    - >-
                      input_boolean.vmc_master_spia_velocita_iperventilazione_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_notturna_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_freecooling_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_0_un_solo_avvio
                    - input_boolean.vmc_master_spia_velocita_1_un_solo_avvio
                    - input_boolean.vmc_master_spia_velocita_2_un_solo_avvio
                    - input_boolean.vmc_master_spia_velocita_3_un_solo_avvio
                    - input_boolean.vmc_master_spia_velocita_4_un_solo_avvio
                    - input_boolean.vmc_master_spia_velocita_notturna_un_solo_avvio
                    - >-
                      input_boolean.vmc_master_spia_velocita_iperventilazione_un_solo_avvio
                    - >-
                      input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio
                    - >-
                      input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio_per_programmazione_freecooling
                    - >-
                      input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio_per_programmazione_freeheating
              - choose:
                  - conditions:
                      - alias: Verifica Programmato Mese Free Heating
                        condition: template
                        value_template: >-
                          {{
                          states('sensor.vmc_master_status_mese_corrente_freeheating_o_freecooling')
                          == "Free Heating" }}
                    sequence:
                      - alias: Spia Free Heating ON o Spia Free Heating OFF ?
                        choose:
                          - conditions:
                              - alias: Allerte Free Heating ON
                                condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_alert_monitoraggio_free_heating_o_free_cooling_allert_interfaccia_avvisi')
                                  != "Nessuna Allerta Free Heating Programmato" or
                                  states('sensor.vmc_master_alert_monitoraggio_free_heating_o_free_cooling_allert_interfaccia_avvisi')
                                  != "Nessuna Allerta Free Heating Programmato,
                                  Presenza di Inquinanti" }}
                            sequence:
                              - choose:
                                  - conditions:
                                      - condition: and
                                        conditions:
                                          - condition: template
                                            value_template: >-
                                              {{
                                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr')=='on'}}
                                            alias: Interruttore PdR ON
                                          - condition: template
                                            value_template: >-
                                              {{
                                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc')=='on'}}
                                            alias: Interruttore Inquinanti ON
                                    sequence:
                                      - choose:
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Allerta' or
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Allerta')}}
                                            sequence:
                                              - service: input_boolean.turn_on
                                                metadata: {}
                                                data: {}
                                                target:
                                                  entity_id:
                                                    - >-
                                                      input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio
                                                    - >-
                                                      input_boolean.vmc_master_spia_velocita_1_co2_o_voc
                                                    - >-
                                                      input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio_per_programmazione_freeheating
                                              - repeat:
                                                  sequence:
                                                    - service: shell_command.vmc_master_velocita_1
                                                      metadata: {}
                                                      data: {}
                                                  until:
                                                    - condition: template
                                                      value_template: >-
                                                        {{
                                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                                        1'}}
                                                alias: Ripeti Finchè Non Diventa Velocità 1
                                            alias: CASO PDR ON E INQUINANTI ON
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Nessuna Allerta' and
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Nessuna Allerta')}}
                                            sequence:
                                              - service: input_boolean.turn_on
                                                metadata: {}
                                                data: {}
                                                target:
                                                  entity_id:
                                                    - >-
                                                      input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio_per_programmazione_freeheating
                                                    - >-
                                                      input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio
                                              - alias: Ripeti Finchè Non Diventa Velocità 0
                                                repeat:
                                                  sequence:
                                                    - service: shell_command.vmc_master_velocita_0
                                                      data: {}
                                                  until:
                                                    - condition: template
                                                      value_template: >-
                                                        {{
                                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                                        0'}}
                                            alias: CASO PDR ON E INQUINANTI OFF
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Allerta' or
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Allerta')}}
                                            sequence:
                                              - service: input_boolean.turn_on
                                                metadata: {}
                                                data: {}
                                                target:
                                                  entity_id:
                                                    - >-
                                                      input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio_per_programmazione_freeheating
                                                    - >-
                                                      input_boolean.vmc_master_spia_velocita_1_co2_o_voc
                                              - repeat:
                                                  sequence:
                                                    - service: shell_command.vmc_master_velocita_1
                                                      metadata: {}
                                                      data: {}
                                                  until:
                                                    - condition: template
                                                      value_template: >-
                                                        {{
                                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                                        1'}}
                                                alias: Ripeti Finchè Non Diventa Velocità 1
                                            alias: CASO PDR OFF E INQUINANTI ON
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Nessuna Allerta' and
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Nessuna Allerta')}}
                                            sequence:
                                              - service: input_boolean.turn_on
                                                metadata: {}
                                                data: {}
                                                target:
                                                  entity_id: >-
                                                    input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio_per_programmazione_freeheating
                                              - alias: Ripeti Finchè Non Diventa Velocità 0
                                                repeat:
                                                  sequence:
                                                    - service: shell_command.vmc_master_velocita_0
                                                      data: {}
                                                  until:
                                                    - condition: template
                                                      value_template: >-
                                                        {{
                                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                                        0'}}
                                            alias: CASO PDR OFF E INQUINANTI OFF
                                    alias: >-
                                      Interruttore PdR ON e Interruttore Inquinanti
                                      ON
                                  - conditions:
                                      - condition: and
                                        conditions:
                                          - condition: template
                                            value_template: >-
                                              {{
                                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr')=='on'}}
                                            alias: Interruttore PdR ON
                                          - alias: Interruttore Inquinanti OFF
                                            condition: template
                                            value_template: >-
                                              {{
                                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc')=='off'}}
                                    sequence:
                                      - choose:
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Allerta' or
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Allerta')}}
                                            sequence:
                                              - service: input_boolean.turn_on
                                                metadata: {}
                                                data: {}
                                                target:
                                                  entity_id:
                                                    - >-
                                                      input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio
                                                    - >-
                                                      input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio_per_programmazione_freeheating
                                              - alias: Ripeti Finchè Non Diventa Velocità 0
                                                repeat:
                                                  sequence:
                                                    - service: shell_command.vmc_master_velocita_0
                                                      data: {}
                                                  until:
                                                    - condition: template
                                                      value_template: >-
                                                        {{
                                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                                        0'}}
                                            alias: CASO PDR ON E INQUINANTI ON
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Nessuna Allerta' and
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Nessuna Allerta')}}
                                            sequence:
                                              - service: input_boolean.turn_on
                                                metadata: {}
                                                data: {}
                                                target:
                                                  entity_id:
                                                    - >-
                                                      input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio
                                                    - >-
                                                      input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio_per_programmazione_freeheating
                                              - alias: Ripeti Finchè Non Diventa Velocità 0
                                                repeat:
                                                  sequence:
                                                    - service: shell_command.vmc_master_velocita_0
                                                      data: {}
                                                  until:
                                                    - condition: template
                                                      value_template: >-
                                                        {{
                                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                                        0'}}
                                            alias: CASO PDR ON E INQUINANTI OFF
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Allerta' or
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Allerta')}}
                                            sequence:
                                              - service: input_boolean.turn_on
                                                metadata: {}
                                                data: {}
                                                target:
                                                  entity_id:
                                                    - >-
                                                      input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio_per_programmazione_freeheating
                                              - alias: Ripeti Finchè Non Diventa Velocità 0
                                                repeat:
                                                  sequence:
                                                    - service: shell_command.vmc_master_velocita_0
                                                      data: {}
                                                  until:
                                                    - condition: template
                                                      value_template: >-
                                                        {{
                                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                                        0'}}
                                            alias: CASO PDR OFF E INQUINANTI ON
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Nessuna Allerta' and
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Nessuna Allerta')}}
                                            sequence:
                                              - service: input_boolean.turn_on
                                                metadata: {}
                                                data: {}
                                                target:
                                                  entity_id:
                                                    - >-
                                                      input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio_per_programmazione_freeheating
                                              - alias: Ripeti Finchè Non Diventa Velocità 0
                                                repeat:
                                                  sequence:
                                                    - service: shell_command.vmc_master_velocita_0
                                                      data: {}
                                                  until:
                                                    - condition: template
                                                      value_template: >-
                                                        {{
                                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                                        0'}}
                                            alias: CASO PDR OFF E INQUINANTI OFF
                                    alias: >-
                                      Interruttore PdR ON e Interruttore Inquinanti
                                      OFF
                                  - conditions:
                                      - condition: and
                                        conditions:
                                          - alias: Interruttore PdR OFF
                                            condition: template
                                            value_template: >-
                                              {{
                                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr')=='off'}}
                                          - condition: template
                                            value_template: >-
                                              {{
                                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc')=='on'}}
                                            alias: Interruttore Inquinanti ON
                                    sequence:
                                      - choose:
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Allerta' or
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Allerta')}}
                                            sequence:
                                              - service: input_boolean.turn_on
                                                metadata: {}
                                                data: {}
                                                target:
                                                  entity_id:
                                                    - >-
                                                      input_boolean.vmc_master_spia_velocita_1_co2_o_voc
                                                    - >-
                                                      input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio_per_programmazione_freeheating
                                              - repeat:
                                                  sequence:
                                                    - service: shell_command.vmc_master_velocita_1
                                                      metadata: {}
                                                      data: {}
                                                  until:
                                                    - condition: template
                                                      value_template: >-
                                                        {{
                                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                                        1'}}
                                                alias: Ripeti Finchè Non Diventa Velocità 1
                                            alias: CASO PDR ON E INQUINANTI ON
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Nessuna Allerta' and
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Nessuna Allerta')}}
                                            sequence:
                                              - service: input_boolean.turn_on
                                                metadata: {}
                                                data: {}
                                                target:
                                                  entity_id:
                                                    - >-
                                                      input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio_per_programmazione_freeheating
                                              - alias: Ripeti Finchè Non Diventa Velocità 0
                                                repeat:
                                                  sequence:
                                                    - service: shell_command.vmc_master_velocita_0
                                                      data: {}
                                                  until:
                                                    - condition: template
                                                      value_template: >-
                                                        {{
                                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                                        0'}}
                                            alias: CASO PDR ON E INQUINANTI OFF
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Allerta' or
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Allerta')}}
                                            sequence:
                                              - service: input_boolean.turn_on
                                                metadata: {}
                                                data: {}
                                                target:
                                                  entity_id:
                                                    - >-
                                                      input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio_per_programmazione_freeheating
                                                    - >-
                                                      input_boolean.vmc_master_spia_velocita_1_co2_o_voc
                                              - repeat:
                                                  sequence:
                                                    - service: shell_command.vmc_master_velocita_1
                                                      metadata: {}
                                                      data: {}
                                                  until:
                                                    - condition: template
                                                      value_template: >-
                                                        {{
                                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                                        1'}}
                                                alias: Ripeti Finchè Non Diventa Velocità 1
                                            alias: CASO PDR OFF E INQUINANTI ON
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Nessuna Allerta' and
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Nessuna Allerta')}}
                                            sequence:
                                              - service: input_boolean.turn_on
                                                metadata: {}
                                                data: {}
                                                target:
                                                  entity_id: >-
                                                    input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio_per_programmazione_freeheating
                                              - alias: Ripeti Finchè Non Diventa Velocità 0
                                                repeat:
                                                  sequence:
                                                    - service: shell_command.vmc_master_velocita_0
                                                      data: {}
                                                  until:
                                                    - condition: template
                                                      value_template: >-
                                                        {{
                                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                                        0'}}
                                            alias: CASO PDR OFF E INQUINANTI OFF
                                    alias: >-
                                      Interruttore PdR OFF e Interruttore Inquinanti
                                      ON
                                  - conditions:
                                      - condition: and
                                        conditions:
                                          - alias: Interruttore PdR OFF
                                            condition: template
                                            value_template: >-
                                              {{
                                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr')=='off'}}
                                          - alias: Interruttore Inquinanti OFF
                                            condition: template
                                            value_template: >-
                                              {{
                                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc')=='off'}}
                                    sequence:
                                      - choose:
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Allerta' or
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Allerta')}}
                                            sequence:
                                              - service: input_boolean.turn_on
                                                metadata: {}
                                                data: {}
                                                target:
                                                  entity_id:
                                                    - >-
                                                      input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio_per_programmazione_freeheating
                                              - alias: Ripeti Finchè Non Diventa Velocità 0
                                                repeat:
                                                  sequence:
                                                    - service: shell_command.vmc_master_velocita_0
                                                      data: {}
                                                  until:
                                                    - condition: template
                                                      value_template: >-
                                                        {{
                                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                                        0'}}
                                            alias: CASO PDR ON E INQUINANTI ON
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Nessuna Allerta' and
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Nessuna Allerta')}}
                                            sequence:
                                              - service: input_boolean.turn_on
                                                metadata: {}
                                                data: {}
                                                target:
                                                  entity_id:
                                                    - >-
                                                      input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio_per_programmazione_freeheating
                                              - alias: Ripeti Finchè Non Diventa Velocità 0
                                                repeat:
                                                  sequence:
                                                    - service: shell_command.vmc_master_velocita_0
                                                      data: {}
                                                  until:
                                                    - condition: template
                                                      value_template: >-
                                                        {{
                                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                                        0'}}
                                            alias: CASO PDR ON E INQUINANTI OFF
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Allerta' or
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Allerta')}}
                                            sequence:
                                              - service: input_boolean.turn_on
                                                metadata: {}
                                                data: {}
                                                target:
                                                  entity_id:
                                                    - >-
                                                      input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio_per_programmazione_freeheating
                                              - alias: Ripeti Finchè Non Diventa Velocità 0
                                                repeat:
                                                  sequence:
                                                    - service: shell_command.vmc_master_velocita_0
                                                      data: {}
                                                  until:
                                                    - condition: template
                                                      value_template: >-
                                                        {{
                                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                                        0'}}
                                            alias: CASO PDR OFF E INQUINANTI ON
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Nessuna Allerta' and
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Nessuna Allerta')}}
                                            sequence:
                                              - service: input_boolean.turn_on
                                                metadata: {}
                                                data: {}
                                                target:
                                                  entity_id:
                                                    - >-
                                                      input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio_per_programmazione_freeheating
                                              - alias: Ripeti Finchè Non Diventa Velocità 0
                                                repeat:
                                                  sequence:
                                                    - service: shell_command.vmc_master_velocita_0
                                                      data: {}
                                                  until:
                                                    - condition: template
                                                      value_template: >-
                                                        {{
                                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                                        0'}}
                                            alias: CASO PDR OFF E INQUINANTI OFF
                                    alias: >-
                                      Interruttore PdR OFF e Interruttore Inquinanti
                                      OFF
                            alias: Spia Free Heating ON
                          - conditions:
                              - alias: Allerte Free Heating OFF
                                condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_alert_monitoraggio_free_heating_o_free_cooling_allert_interfaccia_avvisi')
                                  == "Nessuna Allerta Free Heating Programmato" or
                                  states('sensor.vmc_master_alert_monitoraggio_free_heating_o_free_cooling_allert_interfaccia_avvisi')
                                  == "Nessuna Allerta Free Heating Programmato,
                                  Presenza di Inquinanti" }}
                            sequence:
                              - choose:
                                  - conditions:
                                      - condition: and
                                        conditions:
                                          - condition: template
                                            value_template: >-
                                              {{
                                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr')=='on'}}
                                            alias: Interruttore PdR ON
                                          - condition: template
                                            value_template: >-
                                              {{
                                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc')=='on'}}
                                            alias: Interruttore Inquinanti ON
                                    sequence:
                                      - choose:
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Allerta' or
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Allerta')}}
                                            sequence:
                                              - service: input_boolean.turn_on
                                                metadata: {}
                                                data: {}
                                                target:
                                                  entity_id:
                                                    - >-
                                                      input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio
                                                    - >-
                                                      input_boolean.vmc_master_spia_velocita_freecooling_co2_o_voc
                                              - alias: >-
                                                  Ripeti Finchè Non Diventa Velocità
                                                  Freecooling
                                                repeat:
                                                  sequence:
                                                    - service: shell_command.vmc_master_freecooling
                                                      data: {}
                                                  until:
                                                    - condition: template
                                                      value_template: >-
                                                        {{
                                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Free
                                                        Cooling'}}
                                            alias: CASO PDR ON E INQUINANTI ON
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Nessuna Allerta' and
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Nessuna Allerta')}}
                                            sequence:
                                              - service: input_boolean.turn_on
                                                metadata: {}
                                                data: {}
                                                target:
                                                  entity_id: >-
                                                    input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio
                                              - alias: Ripeti Finchè Non Diventa Velocità 0
                                                repeat:
                                                  sequence:
                                                    - service: shell_command.vmc_master_velocita_0
                                                      data: {}
                                                  until:
                                                    - condition: template
                                                      value_template: >-
                                                        {{
                                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                                        0'}}
                                            alias: CASO PDR ON E INQUINANTI OFF
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Allerta' or
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Allerta')}}
                                            sequence:
                                              - service: input_boolean.turn_on
                                                metadata: {}
                                                data: {}
                                                target:
                                                  entity_id:
                                                    - >-
                                                      input_boolean.vmc_master_spia_velocita_freecooling_co2_o_voc
                                              - alias: >-
                                                  Ripeti Finchè Non Diventa Velocità
                                                  Freecooling
                                                repeat:
                                                  sequence:
                                                    - service: shell_command.vmc_master_freecooling
                                                      data: {}
                                                  until:
                                                    - condition: template
                                                      value_template: >-
                                                        {{
                                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Free
                                                        Cooling'}}
                                            alias: CASO PDR OFF E INQUINANTI ON
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Nessuna Allerta' and
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Nessuna Allerta')}}
                                            sequence:
                                              - alias: >-
                                                  Ripeti Finchè Non Diventa Velocità
                                                  Freecooling
                                                repeat:
                                                  sequence:
                                                    - service: shell_command.vmc_master_freecooling
                                                      data: {}
                                                  until:
                                                    - condition: template
                                                      value_template: >-
                                                        {{
                                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Free
                                                        Cooling'}}
                                            alias: CASO PDR OFF E INQUINANTI OFF
                                    alias: >-
                                      Interruttore PdR ON e Interruttore Inquinanti
                                      ON
                                  - conditions:
                                      - condition: and
                                        conditions:
                                          - condition: template
                                            value_template: >-
                                              {{
                                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr')=='on'}}
                                            alias: Interruttore PdR ON
                                          - alias: Interruttore Inquinanti OFF
                                            condition: template
                                            value_template: >-
                                              {{
                                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc')=='off'}}
                                    sequence:
                                      - choose:
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Allerta' or
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Allerta')}}
                                            sequence:
                                              - service: input_boolean.turn_on
                                                metadata: {}
                                                data: {}
                                                target:
                                                  entity_id:
                                                    - >-
                                                      input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio
                                              - alias: Ripeti Finchè Non Diventa Velocità 0
                                                repeat:
                                                  sequence:
                                                    - service: shell_command.vmc_master_velocita_0
                                                      data: {}
                                                  until:
                                                    - condition: template
                                                      value_template: >-
                                                        {{
                                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                                        0'}}
                                            alias: CASO PDR ON E INQUINANTI ON
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Nessuna Allerta' and
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Nessuna Allerta')}}
                                            sequence:
                                              - service: input_boolean.turn_on
                                                metadata: {}
                                                data: {}
                                                target:
                                                  entity_id: >-
                                                    input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio
                                              - alias: Ripeti Finchè Non Diventa Velocità 0
                                                repeat:
                                                  sequence:
                                                    - service: shell_command.vmc_master_velocita_0
                                                      data: {}
                                                  until:
                                                    - condition: template
                                                      value_template: >-
                                                        {{
                                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                                        0'}}
                                            alias: CASO PDR ON E INQUINANTI OFF
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Allerta' or
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Allerta')}}
                                            sequence:
                                              - alias: >-
                                                  Ripeti Finchè Non Diventa Velocità
                                                  Freecooling
                                                repeat:
                                                  sequence:
                                                    - service: shell_command.vmc_master_freecooling
                                                      data: {}
                                                  until:
                                                    - condition: template
                                                      value_template: >-
                                                        {{
                                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Free
                                                        Cooling'}}
                                            alias: CASO PDR OFF E INQUINANTI ON
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Nessuna Allerta' and
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Nessuna Allerta')}}
                                            sequence:
                                              - alias: >-
                                                  Ripeti Finchè Non Diventa Velocità
                                                  Freecooling
                                                repeat:
                                                  sequence:
                                                    - service: shell_command.vmc_master_freecooling
                                                      data: {}
                                                  until:
                                                    - condition: template
                                                      value_template: >-
                                                        {{
                                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Free
                                                        Cooling'}}
                                            alias: CASO PDR OFF E INQUINANTI OFF
                                    alias: >-
                                      Interruttore PdR ON e Interruttore Inquinanti
                                      OFF
                                  - conditions:
                                      - condition: and
                                        conditions:
                                          - alias: Interruttore PdR OFF
                                            condition: template
                                            value_template: >-
                                              {{
                                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr')=='off'}}
                                          - condition: template
                                            value_template: >-
                                              {{
                                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc')=='on'}}
                                            alias: Interruttore Inquinanti ON
                                    sequence:
                                      - choose:
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Allerta' or
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Allerta')}}
                                            sequence:
                                              - service: input_boolean.turn_on
                                                metadata: {}
                                                data: {}
                                                target:
                                                  entity_id:
                                                    - >-
                                                      input_boolean.vmc_master_spia_velocita_freecooling_co2_o_voc
                                              - alias: >-
                                                  Ripeti Finchè Non Diventa Velocità
                                                  Freecooling
                                                repeat:
                                                  sequence:
                                                    - service: shell_command.vmc_master_freecooling
                                                      data: {}
                                                  until:
                                                    - condition: template
                                                      value_template: >-
                                                        {{
                                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Free
                                                        Cooling'}}
                                            alias: CASO PDR ON E INQUINANTI ON
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Nessuna Allerta' and
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Nessuna Allerta')}}
                                            sequence:
                                              - alias: >-
                                                  Ripeti Finchè Non Diventa Velocità
                                                  Freecooling
                                                repeat:
                                                  sequence:
                                                    - service: shell_command.vmc_master_freecooling
                                                      data: {}
                                                  until:
                                                    - condition: template
                                                      value_template: >-
                                                        {{
                                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Free
                                                        Cooling'}}
                                            alias: CASO PDR ON E INQUINANTI OFF
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Allerta' or
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Allerta')}}
                                            sequence:
                                              - service: input_boolean.turn_on
                                                metadata: {}
                                                data: {}
                                                target:
                                                  entity_id:
                                                    - >-
                                                      input_boolean.vmc_master_spia_velocita_freecooling_co2_o_voc
                                              - alias: >-
                                                  Ripeti Finchè Non Diventa Velocità
                                                  Freecooling
                                                repeat:
                                                  sequence:
                                                    - service: shell_command.vmc_master_freecooling
                                                      data: {}
                                                  until:
                                                    - condition: template
                                                      value_template: >-
                                                        {{
                                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Free
                                                        Cooling'}}
                                            alias: CASO PDR OFF E INQUINANTI ON
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Nessuna Allerta' and
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Nessuna Allerta')}}
                                            sequence:
                                              - alias: >-
                                                  Ripeti Finchè Non Diventa Velocità
                                                  Freecooling
                                                repeat:
                                                  sequence:
                                                    - service: shell_command.vmc_master_freecooling
                                                      data: {}
                                                  until:
                                                    - condition: template
                                                      value_template: >-
                                                        {{
                                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Free
                                                        Cooling'}}
                                            alias: CASO PDR OFF E INQUINANTI OFF
                                    alias: >-
                                      Interruttore PdR OFF e Interruttore Inquinanti
                                      ON
                                  - conditions:
                                      - condition: and
                                        conditions:
                                          - alias: Interruttore PdR OFF
                                            condition: template
                                            value_template: >-
                                              {{
                                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr')=='off'}}
                                          - alias: Interruttore Inquinanti OFF
                                            condition: template
                                            value_template: >-
                                              {{
                                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc')=='off'}}
                                    sequence:
                                      - choose:
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Allerta' or
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Allerta')}}
                                            sequence:
                                              - alias: >-
                                                  Ripeti Finchè Non Diventa Velocità
                                                  Freecooling
                                                repeat:
                                                  sequence:
                                                    - service: shell_command.vmc_master_freecooling
                                                      data: {}
                                                  until:
                                                    - condition: template
                                                      value_template: >-
                                                        {{
                                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Free
                                                        Cooling'}}
                                            alias: CASO PDR ON E INQUINANTI ON
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Nessuna Allerta' and
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Nessuna Allerta')}}
                                            sequence:
                                              - alias: >-
                                                  Ripeti Finchè Non Diventa Velocità
                                                  Freecooling
                                                repeat:
                                                  sequence:
                                                    - service: shell_command.vmc_master_freecooling
                                                      data: {}
                                                  until:
                                                    - condition: template
                                                      value_template: >-
                                                        {{
                                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Free
                                                        Cooling'}}
                                            alias: CASO PDR ON E INQUINANTI OFF
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Allerta' or
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Allerta')}}
                                            sequence:
                                              - alias: >-
                                                  Ripeti Finchè Non Diventa Velocità
                                                  Freecooling
                                                repeat:
                                                  sequence:
                                                    - service: shell_command.vmc_master_freecooling
                                                      data: {}
                                                  until:
                                                    - condition: template
                                                      value_template: >-
                                                        {{
                                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Free
                                                        Cooling'}}
                                            alias: CASO PDR OFF E INQUINANTI ON
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Nessuna Allerta' and
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Nessuna Allerta')}}
                                            sequence:
                                              - alias: >-
                                                  Ripeti Finchè Non Diventa Velocità
                                                  Freecooling
                                                repeat:
                                                  sequence:
                                                    - service: shell_command.vmc_master_freecooling
                                                      data: {}
                                                  until:
                                                    - condition: template
                                                      value_template: >-
                                                        {{
                                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Free
                                                        Cooling'}}
                                            alias: CASO PDR OFF E INQUINANTI OFF
                                    alias: >-
                                      Interruttore PdR OFF e Interruttore Inquinanti
                                      OFF
                            alias: Spia Free Heating OFF
                    alias: Programmato Mese Free Heating
                  - conditions:
                      - alias: Verifica Programmato Mese Free Cooling
                        condition: template
                        value_template: >-
                          {{
                          states('sensor.vmc_master_status_mese_corrente_freeheating_o_freecooling')
                          == "Free Cooling" }}
                    sequence:
                      - alias: Spia Free Cooling ON o Spia Free Cooling OFF ?
                        choose:
                          - conditions:
                              - alias: Allerte Free Cooling ON
                                condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_alert_monitoraggio_free_heating_o_free_cooling_allert_interfaccia_avvisi')
                                  != "Nessuna Allerta Free Cooling Programmato" or
                                  states('sensor.vmc_master_alert_monitoraggio_free_heating_o_free_cooling_allert_interfaccia_avvisi')
                                  != "Nessuna Allerta Free Cooling Programmato,
                                  Presenza di Inquinanti" }}
                            sequence:
                              - choose:
                                  - conditions:
                                      - condition: template
                                        value_template: >-
                                          {{
                                          states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                          ne sconsiglia l\'impiego" and
                                          (states('sensor.vmc_master_alert_monitoraggio_co2')
                                          == 'Allerta' or
                                          states('sensor.vmc_master_alert_monitoraggio_voc')
                                          == 'Allerta')}}
                                    sequence:
                                      - service: input_boolean.turn_on
                                        metadata: {}
                                        data: {}
                                        target:
                                          entity_id:
                                            - >-
                                              input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio
                                            - >-
                                              input_boolean.vmc_master_spia_velocita_1_co2_o_voc
                                            - >-
                                              input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio_per_programmazione_freecooling
                                      - repeat:
                                          sequence:
                                            - service: shell_command.vmc_master_velocita_1
                                              metadata: {}
                                              data: {}
                                          until:
                                            - condition: template
                                              value_template: >-
                                                {{
                                                states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                                1'}}
                                        alias: Ripeti Finchè Non Diventa Velocità 1
                                    alias: CASO PDR ON E INQUINANTI ON
                                  - conditions:
                                      - condition: template
                                        value_template: >-
                                          {{
                                          states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                          ne sconsiglia l\'impiego" and
                                          (states('sensor.vmc_master_alert_monitoraggio_co2')
                                          == 'Nessuna Allerta' and
                                          states('sensor.vmc_master_alert_monitoraggio_voc')
                                          == 'Nessuna Allerta')}}
                                    sequence:
                                      - service: input_boolean.turn_on
                                        metadata: {}
                                        data: {}
                                        target:
                                          entity_id:
                                            - >-
                                              input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio_per_programmazione_freecooling
                                            - >-
                                              input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio
                                      - alias: Ripeti Finchè Non Diventa Velocità 0
                                        repeat:
                                          sequence:
                                            - service: shell_command.vmc_master_velocita_0
                                              data: {}
                                          until:
                                            - condition: template
                                              value_template: >-
                                                {{
                                                states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                                0'}}
                                    alias: CASO PDR ON E INQUINANTI OFF
                                  - conditions:
                                      - condition: template
                                        value_template: >-
                                          {{
                                          states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                          ne sconsiglia l\'impiego" and
                                          (states('sensor.vmc_master_alert_monitoraggio_co2')
                                          == 'Allerta' or
                                          states('sensor.vmc_master_alert_monitoraggio_voc')
                                          == 'Allerta')}}
                                    sequence:
                                      - service: input_boolean.turn_on
                                        metadata: {}
                                        data: {}
                                        target:
                                          entity_id:
                                            - >-
                                              input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio_per_programmazione_freecooling
                                            - >-
                                              input_boolean.vmc_master_spia_velocita_1_co2_o_voc
                                      - repeat:
                                          sequence:
                                            - service: shell_command.vmc_master_velocita_1
                                              metadata: {}
                                              data: {}
                                          until:
                                            - condition: template
                                              value_template: >-
                                                {{
                                                states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                                1'}}
                                        alias: Ripeti Finchè Non Diventa Velocità 1
                                    alias: CASO PDR OFF E INQUINANTI ON
                                  - conditions:
                                      - condition: template
                                        value_template: >-
                                          {{
                                          states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                          ne sconsiglia l\'impiego" and
                                          (states('sensor.vmc_master_alert_monitoraggio_co2')
                                          == 'Nessuna Allerta' and
                                          states('sensor.vmc_master_alert_monitoraggio_voc')
                                          == 'Nessuna Allerta')}}
                                    sequence:
                                      - service: input_boolean.turn_on
                                        metadata: {}
                                        data: {}
                                        target:
                                          entity_id: >-
                                            input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio_per_programmazione_freecooling
                                      - alias: Ripeti Finchè Non Diventa Velocità 0
                                        repeat:
                                          sequence:
                                            - service: shell_command.vmc_master_velocita_0
                                              data: {}
                                          until:
                                            - condition: template
                                              value_template: >-
                                                {{
                                                states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                                0'}}
                                    alias: CASO PDR OFF E INQUINANTI OFF
                            alias: Spia Free Cooling ON
                          - conditions:
                              - alias: Allerte Free Cooling OFF
                                condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_alert_monitoraggio_free_heating_o_free_cooling_allert_interfaccia_avvisi')
                                  == "Nessuna Allerta Free Cooling Programmato" or
                                  states('sensor.vmc_master_alert_monitoraggio_free_heating_o_free_cooling_allert_interfaccia_avvisi')
                                  == "Nessuna Allerta Free Cooling Programmato,
                                  Presenza di Inquinanti" }}
                            sequence:
                              - choose:
                                  - conditions:
                                      - condition: and
                                        conditions:
                                          - condition: template
                                            value_template: >-
                                              {{
                                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr')=='on'}}
                                            alias: Interruttore PdR ON
                                          - condition: template
                                            value_template: >-
                                              {{
                                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc')=='on'}}
                                            alias: Interruttore Inquinanti ON
                                    sequence:
                                      - choose:
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Allerta' or
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Allerta')}}
                                            sequence:
                                              - service: input_boolean.turn_on
                                                metadata: {}
                                                data: {}
                                                target:
                                                  entity_id:
                                                    - >-
                                                      input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio
                                                    - >-
                                                      input_boolean.vmc_master_spia_velocita_freecooling_co2_o_voc
                                              - alias: >-
                                                  Ripeti Finchè Non Diventa Velocità
                                                  Freecooling
                                                repeat:
                                                  sequence:
                                                    - service: shell_command.vmc_master_freecooling
                                                      data: {}
                                                  until:
                                                    - condition: template
                                                      value_template: >-
                                                        {{
                                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Free
                                                        Cooling'}}
                                            alias: CASO PDR ON E INQUINANTI ON
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Nessuna Allerta' and
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Nessuna Allerta')}}
                                            sequence:
                                              - service: input_boolean.turn_on
                                                metadata: {}
                                                data: {}
                                                target:
                                                  entity_id: >-
                                                    input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio
                                              - alias: Ripeti Finchè Non Diventa Velocità 0
                                                repeat:
                                                  sequence:
                                                    - service: shell_command.vmc_master_velocita_0
                                                      data: {}
                                                  until:
                                                    - condition: template
                                                      value_template: >-
                                                        {{
                                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                                        0'}}
                                            alias: CASO PDR ON E INQUINANTI OFF
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Allerta' or
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Allerta')}}
                                            sequence:
                                              - service: input_boolean.turn_on
                                                metadata: {}
                                                data: {}
                                                target:
                                                  entity_id:
                                                    - >-
                                                      input_boolean.vmc_master_spia_velocita_freecooling_co2_o_voc
                                              - alias: >-
                                                  Ripeti Finchè Non Diventa Velocità
                                                  Freecooling
                                                repeat:
                                                  sequence:
                                                    - service: shell_command.vmc_master_freecooling
                                                      data: {}
                                                  until:
                                                    - condition: template
                                                      value_template: >-
                                                        {{
                                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Free
                                                        Cooling'}}
                                            alias: CASO PDR OFF E INQUINANTI ON
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Nessuna Allerta' and
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Nessuna Allerta')}}
                                            sequence:
                                              - alias: >-
                                                  Ripeti Finchè Non Diventa Velocità
                                                  Freecooling
                                                repeat:
                                                  sequence:
                                                    - service: shell_command.vmc_master_freecooling
                                                      data: {}
                                                  until:
                                                    - condition: template
                                                      value_template: >-
                                                        {{
                                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Free
                                                        Cooling'}}
                                            alias: CASO PDR OFF E INQUINANTI OFF
                                    alias: >-
                                      Interruttore PdR ON e Interruttore Inquinanti
                                      ON
                                  - conditions:
                                      - condition: and
                                        conditions:
                                          - condition: template
                                            value_template: >-
                                              {{
                                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr')=='on'}}
                                            alias: Interruttore PdR ON
                                          - alias: Interruttore Inquinanti OFF
                                            condition: template
                                            value_template: >-
                                              {{
                                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc')=='off'}}
                                    sequence:
                                      - choose:
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Allerta' or
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Allerta')}}
                                            sequence:
                                              - service: input_boolean.turn_on
                                                metadata: {}
                                                data: {}
                                                target:
                                                  entity_id:
                                                    - >-
                                                      input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio
                                              - alias: Ripeti Finchè Non Diventa Velocità 0
                                                repeat:
                                                  sequence:
                                                    - service: shell_command.vmc_master_velocita_0
                                                      data: {}
                                                  until:
                                                    - condition: template
                                                      value_template: >-
                                                        {{
                                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                                        0'}}
                                            alias: CASO PDR ON E INQUINANTI ON
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Nessuna Allerta' and
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Nessuna Allerta')}}
                                            sequence:
                                              - service: input_boolean.turn_on
                                                metadata: {}
                                                data: {}
                                                target:
                                                  entity_id: >-
                                                    input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio
                                              - alias: Ripeti Finchè Non Diventa Velocità 0
                                                repeat:
                                                  sequence:
                                                    - service: shell_command.vmc_master_velocita_0
                                                      data: {}
                                                  until:
                                                    - condition: template
                                                      value_template: >-
                                                        {{
                                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                                        0'}}
                                            alias: CASO PDR ON E INQUINANTI OFF
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Allerta' or
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Allerta')}}
                                            sequence:
                                              - alias: >-
                                                  Ripeti Finchè Non Diventa Velocità
                                                  Freecooling
                                                repeat:
                                                  sequence:
                                                    - service: shell_command.vmc_master_freecooling
                                                      data: {}
                                                  until:
                                                    - condition: template
                                                      value_template: >-
                                                        {{
                                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Free
                                                        Cooling'}}
                                            alias: CASO PDR OFF E INQUINANTI ON
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Nessuna Allerta' and
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Nessuna Allerta')}}
                                            sequence:
                                              - alias: >-
                                                  Ripeti Finchè Non Diventa Velocità
                                                  Freecooling
                                                repeat:
                                                  sequence:
                                                    - service: shell_command.vmc_master_freecooling
                                                      data: {}
                                                  until:
                                                    - condition: template
                                                      value_template: >-
                                                        {{
                                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Free
                                                        Cooling'}}
                                            alias: CASO PDR OFF E INQUINANTI OFF
                                    alias: >-
                                      Interruttore PdR ON e Interruttore Inquinanti
                                      OFF
                                  - conditions:
                                      - condition: and
                                        conditions:
                                          - alias: Interruttore PdR OFF
                                            condition: template
                                            value_template: >-
                                              {{
                                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr')=='off'}}
                                          - condition: template
                                            value_template: >-
                                              {{
                                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc')=='on'}}
                                            alias: Interruttore Inquinanti ON
                                    sequence:
                                      - choose:
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Allerta' or
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Allerta')}}
                                            sequence:
                                              - service: input_boolean.turn_on
                                                metadata: {}
                                                data: {}
                                                target:
                                                  entity_id:
                                                    - >-
                                                      input_boolean.vmc_master_spia_velocita_freecooling_co2_o_voc
                                              - alias: >-
                                                  Ripeti Finchè Non Diventa Velocità
                                                  Freecooling
                                                repeat:
                                                  sequence:
                                                    - service: shell_command.vmc_master_freecooling
                                                      data: {}
                                                  until:
                                                    - condition: template
                                                      value_template: >-
                                                        {{
                                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Free
                                                        Cooling'}}
                                            alias: CASO PDR ON E INQUINANTI ON
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Nessuna Allerta' and
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Nessuna Allerta')}}
                                            sequence:
                                              - alias: >-
                                                  Ripeti Finchè Non Diventa Velocità
                                                  Freecooling
                                                repeat:
                                                  sequence:
                                                    - service: shell_command.vmc_master_freecooling
                                                      data: {}
                                                  until:
                                                    - condition: template
                                                      value_template: >-
                                                        {{
                                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Free
                                                        Cooling'}}
                                            alias: CASO PDR ON E INQUINANTI OFF
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Allerta' or
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Allerta')}}
                                            sequence:
                                              - service: input_boolean.turn_on
                                                metadata: {}
                                                data: {}
                                                target:
                                                  entity_id:
                                                    - >-
                                                      input_boolean.vmc_master_spia_velocita_freecooling_co2_o_voc
                                              - alias: >-
                                                  Ripeti Finchè Non Diventa Velocità
                                                  Freecooling
                                                repeat:
                                                  sequence:
                                                    - service: shell_command.vmc_master_freecooling
                                                      data: {}
                                                  until:
                                                    - condition: template
                                                      value_template: >-
                                                        {{
                                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Free
                                                        Cooling'}}
                                            alias: CASO PDR OFF E INQUINANTI ON
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Nessuna Allerta' and
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Nessuna Allerta')}}
                                            sequence:
                                              - alias: >-
                                                  Ripeti Finchè Non Diventa Velocità
                                                  Freecooling
                                                repeat:
                                                  sequence:
                                                    - service: shell_command.vmc_master_freecooling
                                                      data: {}
                                                  until:
                                                    - condition: template
                                                      value_template: >-
                                                        {{
                                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Free
                                                        Cooling'}}
                                            alias: CASO PDR OFF E INQUINANTI OFF
                                    alias: >-
                                      Interruttore PdR OFF e Interruttore Inquinanti
                                      ON
                                  - conditions:
                                      - condition: and
                                        conditions:
                                          - alias: Interruttore PdR OFF
                                            condition: template
                                            value_template: >-
                                              {{
                                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr')=='off'}}
                                          - alias: Interruttore Inquinanti OFF
                                            condition: template
                                            value_template: >-
                                              {{
                                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc')=='off'}}
                                    sequence:
                                      - choose:
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Allerta' or
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Allerta')}}
                                            sequence:
                                              - alias: >-
                                                  Ripeti Finchè Non Diventa Velocità
                                                  Freecooling
                                                repeat:
                                                  sequence:
                                                    - service: shell_command.vmc_master_freecooling
                                                      data: {}
                                                  until:
                                                    - condition: template
                                                      value_template: >-
                                                        {{
                                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Free
                                                        Cooling'}}
                                            alias: CASO PDR ON E INQUINANTI ON
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Nessuna Allerta' and
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Nessuna Allerta')}}
                                            sequence:
                                              - alias: >-
                                                  Ripeti Finchè Non Diventa Velocità
                                                  Freecooling
                                                repeat:
                                                  sequence:
                                                    - service: shell_command.vmc_master_freecooling
                                                      data: {}
                                                  until:
                                                    - condition: template
                                                      value_template: >-
                                                        {{
                                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Free
                                                        Cooling'}}
                                            alias: CASO PDR ON E INQUINANTI OFF
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Allerta' or
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Allerta')}}
                                            sequence:
                                              - alias: >-
                                                  Ripeti Finchè Non Diventa Velocità
                                                  Freecooling
                                                repeat:
                                                  sequence:
                                                    - service: shell_command.vmc_master_freecooling
                                                      data: {}
                                                  until:
                                                    - condition: template
                                                      value_template: >-
                                                        {{
                                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Free
                                                        Cooling'}}
                                            alias: CASO PDR OFF E INQUINANTI ON
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Nessuna Allerta' and
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Nessuna Allerta')}}
                                            sequence:
                                              - alias: >-
                                                  Ripeti Finchè Non Diventa Velocità
                                                  Freecooling
                                                repeat:
                                                  sequence:
                                                    - service: shell_command.vmc_master_freecooling
                                                      data: {}
                                                  until:
                                                    - condition: template
                                                      value_template: >-
                                                        {{
                                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Free
                                                        Cooling'}}
                                            alias: CASO PDR OFF E INQUINANTI OFF
                                    alias: >-
                                      Interruttore PdR OFF e Interruttore Inquinanti
                                      OFF
                            alias: Spia Free Cooling OFF
                    alias: Programmato Mese Free Cooling
                  - conditions:
                      - alias: Verifica Programmato Mese Disabilitato
                        condition: template
                        value_template: >-
                          {{
                          states('sensor.vmc_master_status_mese_corrente_freeheating_o_freecooling')
                          == "Disabilitata" }}
                    sequence:
                      - choose:
                          - conditions:
                              - condition: and
                                conditions:
                                  - condition: template
                                    value_template: >-
                                      {{
                                      states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr')=='on'}}
                                    alias: Interruttore PdR ON
                                  - condition: template
                                    value_template: >-
                                      {{
                                      states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc')=='on'}}
                                    alias: Interruttore Inquinanti ON
                            sequence:
                              - choose:
                                  - conditions:
                                      - condition: template
                                        value_template: >-
                                          {{
                                          states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                          ne sconsiglia l\'impiego" and
                                          (states('sensor.vmc_master_alert_monitoraggio_co2')
                                          == 'Allerta' or
                                          states('sensor.vmc_master_alert_monitoraggio_voc')
                                          == 'Allerta')}}
                                    sequence:
                                      - service: input_boolean.turn_on
                                        metadata: {}
                                        data: {}
                                        target:
                                          entity_id:
                                            - >-
                                              input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio
                                            - >-
                                              input_boolean.vmc_master_spia_velocita_freecooling_co2_o_voc
                                      - alias: >-
                                          Ripeti Finchè Non Diventa Velocità
                                          Freecooling
                                        repeat:
                                          sequence:
                                            - service: shell_command.vmc_master_freecooling
                                              data: {}
                                          until:
                                            - condition: template
                                              value_template: >-
                                                {{
                                                states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Free
                                                Cooling'}}
                                    alias: CASO PDR ON E INQUINANTI ON
                                  - conditions:
                                      - condition: template
                                        value_template: >-
                                          {{
                                          states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                          ne sconsiglia l\'impiego" and
                                          (states('sensor.vmc_master_alert_monitoraggio_co2')
                                          == 'Nessuna Allerta' and
                                          states('sensor.vmc_master_alert_monitoraggio_voc')
                                          == 'Nessuna Allerta')}}
                                    sequence:
                                      - service: input_boolean.turn_on
                                        metadata: {}
                                        data: {}
                                        target:
                                          entity_id: >-
                                            input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio
                                      - alias: Ripeti Finchè Non Diventa Velocità 0
                                        repeat:
                                          sequence:
                                            - service: shell_command.vmc_master_velocita_0
                                              data: {}
                                          until:
                                            - condition: template
                                              value_template: >-
                                                {{
                                                states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                                0'}}
                                    alias: CASO PDR ON E INQUINANTI OFF
                                  - conditions:
                                      - condition: template
                                        value_template: >-
                                          {{
                                          states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                          ne sconsiglia l\'impiego" and
                                          (states('sensor.vmc_master_alert_monitoraggio_co2')
                                          == 'Allerta' or
                                          states('sensor.vmc_master_alert_monitoraggio_voc')
                                          == 'Allerta')}}
                                    sequence:
                                      - service: input_boolean.turn_on
                                        metadata: {}
                                        data: {}
                                        target:
                                          entity_id:
                                            - >-
                                              input_boolean.vmc_master_spia_velocita_freecooling_co2_o_voc
                                      - alias: >-
                                          Ripeti Finchè Non Diventa Velocità
                                          Freecooling
                                        repeat:
                                          sequence:
                                            - service: shell_command.vmc_master_freecooling
                                              data: {}
                                          until:
                                            - condition: template
                                              value_template: >-
                                                {{
                                                states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Free
                                                Cooling'}}
                                    alias: CASO PDR OFF E INQUINANTI ON
                                  - conditions:
                                      - condition: template
                                        value_template: >-
                                          {{
                                          states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                          ne sconsiglia l\'impiego" and
                                          (states('sensor.vmc_master_alert_monitoraggio_co2')
                                          == 'Nessuna Allerta' and
                                          states('sensor.vmc_master_alert_monitoraggio_voc')
                                          == 'Nessuna Allerta')}}
                                    sequence:
                                      - alias: >-
                                          Ripeti Finchè Non Diventa Velocità
                                          Freecooling
                                        repeat:
                                          sequence:
                                            - service: shell_command.vmc_master_freecooling
                                              data: {}
                                          until:
                                            - condition: template
                                              value_template: >-
                                                {{
                                                states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Free
                                                Cooling'}}
                                    alias: CASO PDR OFF E INQUINANTI OFF
                            alias: Interruttore PdR ON e Interruttore Inquinanti ON
                          - conditions:
                              - condition: and
                                conditions:
                                  - condition: template
                                    value_template: >-
                                      {{
                                      states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr')=='on'}}
                                    alias: Interruttore PdR ON
                                  - alias: Interruttore Inquinanti OFF
                                    condition: template
                                    value_template: >-
                                      {{
                                      states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc')=='off'}}
                            sequence:
                              - choose:
                                  - conditions:
                                      - condition: template
                                        value_template: >-
                                          {{
                                          states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                          ne sconsiglia l\'impiego" and
                                          (states('sensor.vmc_master_alert_monitoraggio_co2')
                                          == 'Allerta' or
                                          states('sensor.vmc_master_alert_monitoraggio_voc')
                                          == 'Allerta')}}
                                    sequence:
                                      - service: input_boolean.turn_on
                                        metadata: {}
                                        data: {}
                                        target:
                                          entity_id:
                                            - >-
                                              input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio
                                      - alias: Ripeti Finchè Non Diventa Velocità 0
                                        repeat:
                                          sequence:
                                            - service: shell_command.vmc_master_velocita_0
                                              data: {}
                                          until:
                                            - condition: template
                                              value_template: >-
                                                {{
                                                states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                                0'}}
                                    alias: CASO PDR ON E INQUINANTI ON
                                  - conditions:
                                      - condition: template
                                        value_template: >-
                                          {{
                                          states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                          ne sconsiglia l\'impiego" and
                                          (states('sensor.vmc_master_alert_monitoraggio_co2')
                                          == 'Nessuna Allerta' and
                                          states('sensor.vmc_master_alert_monitoraggio_voc')
                                          == 'Nessuna Allerta')}}
                                    sequence:
                                      - service: input_boolean.turn_on
                                        metadata: {}
                                        data: {}
                                        target:
                                          entity_id: >-
                                            input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio
                                      - alias: Ripeti Finchè Non Diventa Velocità 0
                                        repeat:
                                          sequence:
                                            - service: shell_command.vmc_master_velocita_0
                                              data: {}
                                          until:
                                            - condition: template
                                              value_template: >-
                                                {{
                                                states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                                0'}}
                                    alias: CASO PDR ON E INQUINANTI OFF
                                  - conditions:
                                      - condition: template
                                        value_template: >-
                                          {{
                                          states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                          ne sconsiglia l\'impiego" and
                                          (states('sensor.vmc_master_alert_monitoraggio_co2')
                                          == 'Allerta' or
                                          states('sensor.vmc_master_alert_monitoraggio_voc')
                                          == 'Allerta')}}
                                    sequence:
                                      - alias: >-
                                          Ripeti Finchè Non Diventa Velocità
                                          Freecooling
                                        repeat:
                                          sequence:
                                            - service: shell_command.vmc_master_freecooling
                                              data: {}
                                          until:
                                            - condition: template
                                              value_template: >-
                                                {{
                                                states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Free
                                                Cooling'}}
                                    alias: CASO PDR OFF E INQUINANTI ON
                                  - conditions:
                                      - condition: template
                                        value_template: >-
                                          {{
                                          states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                          ne sconsiglia l\'impiego" and
                                          (states('sensor.vmc_master_alert_monitoraggio_co2')
                                          == 'Nessuna Allerta' and
                                          states('sensor.vmc_master_alert_monitoraggio_voc')
                                          == 'Nessuna Allerta')}}
                                    sequence:
                                      - alias: >-
                                          Ripeti Finchè Non Diventa Velocità
                                          Freecooling
                                        repeat:
                                          sequence:
                                            - service: shell_command.vmc_master_freecooling
                                              data: {}
                                          until:
                                            - condition: template
                                              value_template: >-
                                                {{
                                                states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Free
                                                Cooling'}}
                                    alias: CASO PDR OFF E INQUINANTI OFF
                            alias: Interruttore PdR ON e Interruttore Inquinanti OFF
                          - conditions:
                              - condition: and
                                conditions:
                                  - alias: Interruttore PdR OFF
                                    condition: template
                                    value_template: >-
                                      {{
                                      states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr')=='off'}}
                                  - condition: template
                                    value_template: >-
                                      {{
                                      states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc')=='on'}}
                                    alias: Interruttore Inquinanti ON
                            sequence:
                              - choose:
                                  - conditions:
                                      - condition: template
                                        value_template: >-
                                          {{
                                          states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                          ne sconsiglia l\'impiego" and
                                          (states('sensor.vmc_master_alert_monitoraggio_co2')
                                          == 'Allerta' or
                                          states('sensor.vmc_master_alert_monitoraggio_voc')
                                          == 'Allerta')}}
                                    sequence:
                                      - service: input_boolean.turn_on
                                        metadata: {}
                                        data: {}
                                        target:
                                          entity_id:
                                            - >-
                                              input_boolean.vmc_master_spia_velocita_freecooling_co2_o_voc
                                      - alias: >-
                                          Ripeti Finchè Non Diventa Velocità
                                          Freecooling
                                        repeat:
                                          sequence:
                                            - service: shell_command.vmc_master_freecooling
                                              data: {}
                                          until:
                                            - condition: template
                                              value_template: >-
                                                {{
                                                states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Free
                                                Cooling'}}
                                    alias: CASO PDR ON E INQUINANTI ON
                                  - conditions:
                                      - condition: template
                                        value_template: >-
                                          {{
                                          states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                          ne sconsiglia l\'impiego" and
                                          (states('sensor.vmc_master_alert_monitoraggio_co2')
                                          == 'Nessuna Allerta' and
                                          states('sensor.vmc_master_alert_monitoraggio_voc')
                                          == 'Nessuna Allerta')}}
                                    sequence:
                                      - alias: >-
                                          Ripeti Finchè Non Diventa Velocità
                                          Freecooling
                                        repeat:
                                          sequence:
                                            - service: shell_command.vmc_master_freecooling
                                              data: {}
                                          until:
                                            - condition: template
                                              value_template: >-
                                                {{
                                                states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Free
                                                Cooling'}}
                                    alias: CASO PDR ON E INQUINANTI OFF
                                  - conditions:
                                      - condition: template
                                        value_template: >-
                                          {{
                                          states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                          ne sconsiglia l\'impiego" and
                                          (states('sensor.vmc_master_alert_monitoraggio_co2')
                                          == 'Allerta' or
                                          states('sensor.vmc_master_alert_monitoraggio_voc')
                                          == 'Allerta')}}
                                    sequence:
                                      - service: input_boolean.turn_on
                                        metadata: {}
                                        data: {}
                                        target:
                                          entity_id:
                                            - >-
                                              input_boolean.vmc_master_spia_velocita_freecooling_co2_o_voc
                                      - alias: >-
                                          Ripeti Finchè Non Diventa Velocità
                                          Freecooling
                                        repeat:
                                          sequence:
                                            - service: shell_command.vmc_master_freecooling
                                              data: {}
                                          until:
                                            - condition: template
                                              value_template: >-
                                                {{
                                                states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Free
                                                Cooling'}}
                                    alias: CASO PDR OFF E INQUINANTI ON
                                  - conditions:
                                      - condition: template
                                        value_template: >-
                                          {{
                                          states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                          ne sconsiglia l\'impiego" and
                                          (states('sensor.vmc_master_alert_monitoraggio_co2')
                                          == 'Nessuna Allerta' and
                                          states('sensor.vmc_master_alert_monitoraggio_voc')
                                          == 'Nessuna Allerta')}}
                                    sequence:
                                      - alias: >-
                                          Ripeti Finchè Non Diventa Velocità
                                          Freecooling
                                        repeat:
                                          sequence:
                                            - service: shell_command.vmc_master_freecooling
                                              data: {}
                                          until:
                                            - condition: template
                                              value_template: >-
                                                {{
                                                states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Free
                                                Cooling'}}
                                    alias: CASO PDR OFF E INQUINANTI OFF
                            alias: Interruttore PdR OFF e Interruttore Inquinanti ON
                          - conditions:
                              - condition: and
                                conditions:
                                  - alias: Interruttore PdR OFF
                                    condition: template
                                    value_template: >-
                                      {{
                                      states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr')=='off'}}
                                  - alias: Interruttore Inquinanti OFF
                                    condition: template
                                    value_template: >-
                                      {{
                                      states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc')=='off'}}
                            sequence:
                              - choose:
                                  - conditions:
                                      - condition: template
                                        value_template: >-
                                          {{
                                          states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                          ne sconsiglia l\'impiego" and
                                          (states('sensor.vmc_master_alert_monitoraggio_co2')
                                          == 'Allerta' or
                                          states('sensor.vmc_master_alert_monitoraggio_voc')
                                          == 'Allerta')}}
                                    sequence:
                                      - alias: >-
                                          Ripeti Finchè Non Diventa Velocità
                                          Freecooling
                                        repeat:
                                          sequence:
                                            - service: shell_command.vmc_master_freecooling
                                              data: {}
                                          until:
                                            - condition: template
                                              value_template: >-
                                                {{
                                                states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Free
                                                Cooling'}}
                                    alias: CASO PDR ON E INQUINANTI ON
                                  - conditions:
                                      - condition: template
                                        value_template: >-
                                          {{
                                          states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                          ne sconsiglia l\'impiego" and
                                          (states('sensor.vmc_master_alert_monitoraggio_co2')
                                          == 'Nessuna Allerta' and
                                          states('sensor.vmc_master_alert_monitoraggio_voc')
                                          == 'Nessuna Allerta')}}
                                    sequence:
                                      - alias: >-
                                          Ripeti Finchè Non Diventa Velocità
                                          Freecooling
                                        repeat:
                                          sequence:
                                            - service: shell_command.vmc_master_freecooling
                                              data: {}
                                          until:
                                            - condition: template
                                              value_template: >-
                                                {{
                                                states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Free
                                                Cooling'}}
                                    alias: CASO PDR ON E INQUINANTI OFF
                                  - conditions:
                                      - condition: template
                                        value_template: >-
                                          {{
                                          states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                          ne sconsiglia l\'impiego" and
                                          (states('sensor.vmc_master_alert_monitoraggio_co2')
                                          == 'Allerta' or
                                          states('sensor.vmc_master_alert_monitoraggio_voc')
                                          == 'Allerta')}}
                                    sequence:
                                      - alias: >-
                                          Ripeti Finchè Non Diventa Velocità
                                          Freecooling
                                        repeat:
                                          sequence:
                                            - service: shell_command.vmc_master_freecooling
                                              data: {}
                                          until:
                                            - condition: template
                                              value_template: >-
                                                {{
                                                states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Free
                                                Cooling'}}
                                    alias: CASO PDR OFF E INQUINANTI ON
                                  - conditions:
                                      - condition: template
                                        value_template: >-
                                          {{
                                          states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                          ne sconsiglia l\'impiego" and
                                          (states('sensor.vmc_master_alert_monitoraggio_co2')
                                          == 'Nessuna Allerta' and
                                          states('sensor.vmc_master_alert_monitoraggio_voc')
                                          == 'Nessuna Allerta')}}
                                    sequence:
                                      - alias: >-
                                          Ripeti Finchè Non Diventa Velocità
                                          Freecooling
                                        repeat:
                                          sequence:
                                            - service: shell_command.vmc_master_freecooling
                                              data: {}
                                          until:
                                            - condition: template
                                              value_template: >-
                                                {{
                                                states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Free
                                                Cooling'}}
                                    alias: CASO PDR OFF E INQUINANTI OFF
                            alias: Interruttore PdR OFF e Interruttore Inquinanti OFF
                    alias: Mese Disabilitato
    mode: restart
    icon: mdi:fingerprint-off

#------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
#------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  vmc_master_calendario_fascia_2_on:
    alias: VMC Master - Calendario Fascia 2 On
    sequence:
      - choose:
          - conditions:
              - alias: Velocità 0 in Assenza di Congelamento e Delta Temperatura
                condition: and
                conditions:
                  - condition: state
                    entity_id: sensor.vmc_master_speed_2_fascia_calendario
                    state: Velocità 0
                  - condition: template
                    value_template: >-
                      {{(states('input_boolean.vmc_master_congelamento_verifica_soglia_valore_spia')==
                      'off' and
                      states('input_boolean.vmc_master_delta_temp_verifica_soglia_valore_spia')==
                      'off')}}
                    alias: Congelamento Assente e Delta Temperatura Assente
            sequence:
              - service: input_boolean.turn_off
                data: {}
                target:
                  entity_id:
                    - >-
                      input_boolean.vmc_master_spia_co2_o_voc_partenza_ritorno_velocita_0
                    - input_boolean.vmc_master_spia_velocita_1_co2_o_voc_pdr
                    - input_boolean.vmc_master_spia_velocita_0_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_1_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_2_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_3_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_4_co2_o_voc
                    - >-
                      input_boolean.vmc_master_spia_velocita_iperventilazione_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_notturna_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_freecooling_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_0_un_solo_avvio
                    - input_boolean.vmc_master_spia_velocita_1_un_solo_avvio
                    - input_boolean.vmc_master_spia_velocita_2_un_solo_avvio
                    - input_boolean.vmc_master_spia_velocita_3_un_solo_avvio
                    - input_boolean.vmc_master_spia_velocita_4_un_solo_avvio
                    - input_boolean.vmc_master_spia_velocita_notturna_un_solo_avvio
                    - >-
                      input_boolean.vmc_master_spia_velocita_iperventilazione_un_solo_avvio
                    - >-
                      input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio
                    - >-
                      input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio_per_programmazione_freecooling
                    - >-
                      input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio_per_programmazione_freeheating
              - choose:
                  - conditions:
                      - condition: and
                        conditions:
                          - condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr')=='on'}}
                            alias: Interruttore PdR ON
                          - condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc')=='on'}}
                            alias: Interruttore Inquinanti ON
                    sequence:
                      - choose:
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                                alias: Verifica CASO PDR ON E INQUINANTI ON
                            sequence:
                              - service: input_boolean.turn_on
                                data: {}
                                target:
                                  entity_id:
                                    - >-
                                      input_boolean.vmc_master_spia_velocita_1_co2_o_voc_pdr
                                    - >-
                                      input_boolean.vmc_master_spia_co2_o_voc_partenza_ritorno_velocita_0
                                    - input_boolean.vmc_master_spia_co2_o_voc
                                    - >-
                                      input_boolean.vmc_master_spia_velocita_1_co2_o_voc
                              - repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_velocita_1
                                      metadata: {}
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                        1'}}
                                alias: Ripeti Finchè Non Diventa Velocità 1
                            alias: CASO PDR ON E INQUINANTI ON
                          - conditions:
                              - alias: Verifica CASO PDR ON E INQUINANTI OFF
                                condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - alias: Ripeti Finchè Non Diventa Velocità 0
                                repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_velocita_0
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                        0'}}
                            alias: CASO PDR ON E INQUINANTI OFF
                          - conditions:
                              - alias: Verifica CASO PDR OFF E INQUINANTI ON
                                condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - service: input_boolean.turn_on
                                data: {}
                                target:
                                  entity_id:
                                    - >-
                                      input_boolean.vmc_master_spia_velocita_1_co2_o_voc_pdr
                                    - >-
                                      input_boolean.vmc_master_spia_co2_o_voc_partenza_ritorno_velocita_0
                                    - input_boolean.vmc_master_spia_co2_o_voc
                                    - >-
                                      input_boolean.vmc_master_spia_velocita_1_co2_o_voc
                              - repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_velocita_1
                                      metadata: {}
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                        1'}}
                                alias: Ripeti Finchè Non Diventa Velocità 1
                            alias: CASO PDR OFF E INQUINANTI ON
                          - conditions:
                              - alias: Verifica CASO PDR OFF E INQUINANTI OFF
                                condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - alias: Ripeti Finchè Non Diventa Velocità 0
                                repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_velocita_0
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                        0'}}
                            alias: CASO PDR OFF E INQUINANTI OFF
                    alias: Interruttore PdR ON e Interruttore Inquinanti ON
                  - conditions:
                      - condition: and
                        conditions:
                          - condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr')=='on'}}
                            alias: Interruttore PdR ON
                          - alias: Interruttore Inquinanti OFF
                            condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc')=='off'}}
                    sequence:
                      - choose:
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                                alias: Verifica CASO PDR ON E INQUINANTI ON
                            sequence:
                              - alias: Ripeti Finchè Non Diventa Velocità 0
                                repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_velocita_0
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                        0'}}
                            alias: CASO PDR ON E INQUINANTI ON
                          - conditions:
                              - alias: Verifica CASO PDR ON E INQUINANTI OFF
                                condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - alias: Ripeti Finchè Non Diventa Velocità 0
                                repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_velocita_0
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                        0'}}
                            alias: CASO PDR ON E INQUINANTI OFF
                          - conditions:
                              - alias: Verifica CASO PDR OFF E INQUINANTI ON
                                condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - alias: Ripeti Finchè Non Diventa Velocità 0
                                repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_velocita_0
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                        0'}}
                            alias: CASO PDR OFF E INQUINANTI ON
                          - conditions:
                              - alias: Verifica CASO PDR OFF E INQUINANTI OFF
                                condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - alias: Ripeti Finchè Non Diventa Velocità 0
                                repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_velocita_0
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                        0'}}
                            alias: CASO PDR OFF E INQUINANTI OFF
                    alias: Interruttore PdR ON e Interruttore Inquinanti OFF
                  - conditions:
                      - condition: and
                        conditions:
                          - alias: Interruttore PdR OFF
                            condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr')=='off'}}
                          - condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc')=='on'}}
                            alias: Interruttore Inquinanti ON
                    sequence:
                      - choose:
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                                alias: Verifica CASO PDR ON E INQUINANTI ON
                            sequence:
                              - service: input_boolean.turn_on
                                data: {}
                                target:
                                  entity_id:
                                    - >-
                                      input_boolean.vmc_master_spia_velocita_1_co2_o_voc_pdr
                                    - >-
                                      input_boolean.vmc_master_spia_co2_o_voc_partenza_ritorno_velocita_0
                                    - input_boolean.vmc_master_spia_co2_o_voc
                                    - >-
                                      input_boolean.vmc_master_spia_velocita_1_co2_o_voc
                              - repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_velocita_1
                                      metadata: {}
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                        1'}}
                                alias: Ripeti Finchè Non Diventa Velocità 1
                            alias: CASO PDR ON E INQUINANTI ON
                          - conditions:
                              - alias: Verifica CASO PDR ON E INQUINANTI OFF
                                condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - alias: Ripeti Finchè Non Diventa Velocità 0
                                repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_velocita_0
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                        0'}}
                            alias: CASO PDR ON E INQUINANTI OFF
                          - conditions:
                              - alias: Verifica CASO PDR OFF E INQUINANTI ON
                                condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - service: input_boolean.turn_on
                                data: {}
                                target:
                                  entity_id:
                                    - >-
                                      input_boolean.vmc_master_spia_velocita_1_co2_o_voc_pdr
                                    - >-
                                      input_boolean.vmc_master_spia_co2_o_voc_partenza_ritorno_velocita_0
                                    - input_boolean.vmc_master_spia_co2_o_voc
                                    - >-
                                      input_boolean.vmc_master_spia_velocita_1_co2_o_voc
                              - repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_velocita_1
                                      metadata: {}
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                        1'}}
                                alias: Ripeti Finchè Non Diventa Velocità 1
                            alias: CASO PDR OFF E INQUINANTI ON
                          - conditions:
                              - alias: Verifica CASO PDR OFF E INQUINANTI OFF
                                condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - alias: Ripeti Finchè Non Diventa Velocità 0
                                repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_velocita_0
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                        0'}}
                            alias: CASO PDR OFF E INQUINANTI OFF
                    alias: Interruttore PdR OFF e Interruttore Inquinanti ON
                  - conditions:
                      - condition: and
                        conditions:
                          - alias: Interruttore PdR OFF
                            condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr')=='off'}}
                          - alias: Interruttore Inquinanti OFF
                            condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc')=='off'}}
                    sequence:
                      - choose:
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                                alias: Verifica CASO PDR ON E INQUINANTI ON
                            sequence:
                              - alias: Ripeti Finchè Non Diventa Velocità 0
                                repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_velocita_0
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                        0'}}
                            alias: CASO PDR ON E INQUINANTI ON
                          - conditions:
                              - alias: Verifica CASO PDR ON E INQUINANTI OFF
                                condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - alias: Ripeti Finchè Non Diventa Velocità 0
                                repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_velocita_0
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                        0'}}
                            alias: CASO PDR ON E INQUINANTI OFF
                          - conditions:
                              - alias: Verifica CASO PDR OFF E INQUINANTI ON
                                condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - alias: Ripeti Finchè Non Diventa Velocità 0
                                repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_velocita_0
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                        0'}}
                            alias: CASO PDR OFF E INQUINANTI ON
                          - conditions:
                              - alias: Verifica CASO PDR OFF E INQUINANTI OFF
                                condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - alias: Ripeti Finchè Non Diventa Velocità 0
                                repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_velocita_0
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                        0'}}
                            alias: CASO PDR OFF E INQUINANTI OFF
                    alias: Interruttore PdR OFF e Interruttore Inquinanti OFF
          - conditions:
              - alias: Velocità 1 in Assenza di Congelamento e Delta Temperatura
                condition: and
                conditions:
                  - condition: state
                    entity_id: sensor.vmc_master_speed_2_fascia_calendario
                    state: Velocità 1
                  - condition: template
                    value_template: >-
                      {{(states('input_boolean.vmc_master_congelamento_verifica_soglia_valore_spia')==
                      'off' and
                      states('input_boolean.vmc_master_delta_temp_verifica_soglia_valore_spia')==
                      'off')}}
                    alias: Congelamento Assente e Delta Temperatura Assente
            sequence:
              - service: input_boolean.turn_off
                data: {}
                target:
                  entity_id:
                    - >-
                      input_boolean.vmc_master_spia_co2_o_voc_partenza_ritorno_velocita_0
                    - input_boolean.vmc_master_spia_velocita_1_co2_o_voc_pdr
                    - input_boolean.vmc_master_spia_velocita_0_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_1_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_2_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_3_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_4_co2_o_voc
                    - >-
                      input_boolean.vmc_master_spia_velocita_iperventilazione_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_notturna_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_freecooling_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_0_un_solo_avvio
                    - input_boolean.vmc_master_spia_velocita_1_un_solo_avvio
                    - input_boolean.vmc_master_spia_velocita_2_un_solo_avvio
                    - input_boolean.vmc_master_spia_velocita_3_un_solo_avvio
                    - input_boolean.vmc_master_spia_velocita_4_un_solo_avvio
                    - input_boolean.vmc_master_spia_velocita_notturna_un_solo_avvio
                    - >-
                      input_boolean.vmc_master_spia_velocita_iperventilazione_un_solo_avvio
                    - >-
                      input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio
                    - >-
                      input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio_per_programmazione_freecooling
                    - >-
                      input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio_per_programmazione_freeheating
              - choose:
                  - conditions:
                      - condition: and
                        conditions:
                          - condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr')=='on'}}
                            alias: Interruttore PdR ON
                          - condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc')=='on'}}
                            alias: Interruttore Inquinanti ON
                    sequence:
                      - choose:
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - service: input_boolean.turn_on
                                metadata: {}
                                data: {}
                                target:
                                  entity_id:
                                    - >-
                                      input_boolean.vmc_master_spia_velocita_1_un_solo_avvio
                                    - >-
                                      input_boolean.vmc_master_spia_velocita_1_co2_o_voc
                              - repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_velocita_1
                                      metadata: {}
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                        1'}}
                                alias: Ripeti Finchè Non Diventa Velocità 1
                            alias: CASO PDR ON E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - service: input_boolean.turn_on
                                metadata: {}
                                data: {}
                                target:
                                  entity_id: >-
                                    input_boolean.vmc_master_spia_velocita_1_un_solo_avvio
                              - alias: Ripeti Finchè Non Diventa Velocità 0
                                repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_velocita_0
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                        0'}}
                            alias: CASO PDR ON E INQUINANTI OFF
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - service: input_boolean.turn_on
                                metadata: {}
                                data: {}
                                target:
                                  entity_id:
                                    - >-
                                      input_boolean.vmc_master_spia_velocita_1_co2_o_voc
                              - repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_velocita_1
                                      metadata: {}
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                        1'}}
                                alias: Ripeti Finchè Non Diventa Velocità 1
                            alias: CASO PDR OFF E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_velocita_1
                                      metadata: {}
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                        1'}}
                                alias: Ripeti Finchè Non Diventa Velocità 1
                            alias: CASO PDR OFF E INQUINANTI OFF
                    alias: Interruttore PdR ON e Interruttore Inquinanti ON
                  - conditions:
                      - condition: and
                        conditions:
                          - condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr')=='on'}}
                            alias: Interruttore PdR ON
                          - alias: Interruttore Inquinanti OFF
                            condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc')=='off'}}
                    sequence:
                      - choose:
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - service: input_boolean.turn_on
                                metadata: {}
                                data: {}
                                target:
                                  entity_id:
                                    - >-
                                      input_boolean.vmc_master_spia_velocita_1_un_solo_avvio
                              - alias: Ripeti Finchè Non Diventa Velocità 0
                                repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_velocita_0
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                        0'}}
                            alias: CASO PDR ON E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - service: input_boolean.turn_on
                                metadata: {}
                                data: {}
                                target:
                                  entity_id: >-
                                    input_boolean.vmc_master_spia_velocita_1_un_solo_avvio
                              - alias: Ripeti Finchè Non Diventa Velocità 0
                                repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_velocita_0
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                        0'}}
                            alias: CASO PDR ON E INQUINANTI OFF
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_velocita_1
                                      metadata: {}
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                        1'}}
                                alias: Ripeti Finchè Non Diventa Velocità 1
                            alias: CASO PDR OFF E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_velocita_1
                                      metadata: {}
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                        1'}}
                                alias: Ripeti Finchè Non Diventa Velocità 1
                            alias: CASO PDR OFF E INQUINANTI OFF
                    alias: Interruttore PdR ON e Interruttore Inquinanti OFF
                  - conditions:
                      - condition: and
                        conditions:
                          - alias: Interruttore PdR OFF
                            condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr')=='off'}}
                          - condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc')=='on'}}
                            alias: Interruttore Inquinanti ON
                    sequence:
                      - choose:
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - service: input_boolean.turn_on
                                metadata: {}
                                data: {}
                                target:
                                  entity_id:
                                    - >-
                                      input_boolean.vmc_master_spia_velocita_1_co2_o_voc
                              - repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_velocita_1
                                      metadata: {}
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                        1'}}
                                alias: Ripeti Finchè Non Diventa Velocità 1
                            alias: CASO PDR ON E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - alias: Ripeti Finchè Non Diventa Velocità 1
                                repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_velocita_1
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                        1'}}
                            alias: CASO PDR ON E INQUINANTI OFF
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - service: input_boolean.turn_on
                                metadata: {}
                                data: {}
                                target:
                                  entity_id:
                                    - >-
                                      input_boolean.vmc_master_spia_velocita_1_co2_o_voc
                              - repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_velocita_1
                                      metadata: {}
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                        1'}}
                                alias: Ripeti Finchè Non Diventa Velocità 1
                            alias: CASO PDR OFF E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_velocita_1
                                      metadata: {}
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                        1'}}
                                alias: Ripeti Finchè Non Diventa Velocità 1
                            alias: CASO PDR OFF E INQUINANTI OFF
                    alias: Interruttore PdR OFF e Interruttore Inquinanti ON
                  - conditions:
                      - condition: and
                        conditions:
                          - alias: Interruttore PdR OFF
                            condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr')=='off'}}
                          - alias: Interruttore Inquinanti OFF
                            condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc')=='off'}}
                    sequence:
                      - choose:
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - alias: Ripeti Finchè Non Diventa Velocità 1
                                repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_velocita_1
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                        1'}}
                            alias: CASO PDR ON E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - alias: Ripeti Finchè Non Diventa Velocità 1
                                repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_velocita_1
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                        1'}}
                            alias: CASO PDR ON E INQUINANTI OFF
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_velocita_1
                                      metadata: {}
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                        1'}}
                                alias: Ripeti Finchè Non Diventa Velocità 1
                            alias: CASO PDR OFF E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_velocita_1
                                      metadata: {}
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                        1'}}
                                alias: Ripeti Finchè Non Diventa Velocità 1
                            alias: CASO PDR OFF E INQUINANTI OFF
                    alias: Interruttore PdR OFF e Interruttore Inquinanti OFF
          - conditions:
              - alias: Velocità 2 in Assenza di Congelamento e Delta Temperatura
                condition: and
                conditions:
                  - condition: state
                    entity_id: sensor.vmc_master_speed_2_fascia_calendario
                    state: Velocità 2
                  - condition: template
                    value_template: >-
                      {{(states('input_boolean.vmc_master_congelamento_verifica_soglia_valore_spia')==
                      'off' and
                      states('input_boolean.vmc_master_delta_temp_verifica_soglia_valore_spia')==
                      'off')}}
                    alias: Congelamento Assente e Delta Temperatura Assente
            sequence:
              - service: input_boolean.turn_off
                data: {}
                target:
                  entity_id:
                    - >-
                      input_boolean.vmc_master_spia_co2_o_voc_partenza_ritorno_velocita_0
                    - input_boolean.vmc_master_spia_velocita_1_co2_o_voc_pdr
                    - input_boolean.vmc_master_spia_velocita_0_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_1_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_2_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_3_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_4_co2_o_voc
                    - >-
                      input_boolean.vmc_master_spia_velocita_iperventilazione_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_notturna_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_freecooling_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_0_un_solo_avvio
                    - input_boolean.vmc_master_spia_velocita_1_un_solo_avvio
                    - input_boolean.vmc_master_spia_velocita_2_un_solo_avvio
                    - input_boolean.vmc_master_spia_velocita_3_un_solo_avvio
                    - input_boolean.vmc_master_spia_velocita_4_un_solo_avvio
                    - input_boolean.vmc_master_spia_velocita_notturna_un_solo_avvio
                    - >-
                      input_boolean.vmc_master_spia_velocita_iperventilazione_un_solo_avvio
                    - >-
                      input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio
                    - >-
                      input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio_per_programmazione_freecooling
                    - >-
                      input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio_per_programmazione_freeheating
              - choose:
                  - conditions:
                      - condition: and
                        conditions:
                          - condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr')=='on'}}
                            alias: Interruttore PdR ON
                          - condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc')=='on'}}
                            alias: Interruttore Inquinanti ON
                    sequence:
                      - choose:
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - service: input_boolean.turn_on
                                metadata: {}
                                data: {}
                                target:
                                  entity_id:
                                    - >-
                                      input_boolean.vmc_master_spia_velocita_2_un_solo_avvio
                                    - >-
                                      input_boolean.vmc_master_spia_velocita_2_co2_o_voc
                              - alias: Ripeti Finchè Non Diventa Velocità 2
                                repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_velocita_2
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                        2'}}
                            alias: CASO PDR ON E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - service: input_boolean.turn_on
                                metadata: {}
                                data: {}
                                target:
                                  entity_id: >-
                                    input_boolean.vmc_master_spia_velocita_2_un_solo_avvio
                              - alias: Ripeti Finchè Non Diventa Velocità 0
                                repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_velocita_0
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                        0'}}
                            alias: CASO PDR ON E INQUINANTI OFF
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - service: input_boolean.turn_on
                                metadata: {}
                                data: {}
                                target:
                                  entity_id:
                                    - >-
                                      input_boolean.vmc_master_spia_velocita_2_co2_o_voc
                              - alias: Ripeti Finchè Non Diventa Velocità 2
                                repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_velocita_2
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                        2'}}
                            alias: CASO PDR OFF E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - alias: Ripeti Finchè Non Diventa Velocità 2
                                repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_velocita_2
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                        2'}}
                            alias: CASO PDR OFF E INQUINANTI OFF
                    alias: Interruttore PdR ON e Interruttore Inquinanti ON
                  - conditions:
                      - condition: and
                        conditions:
                          - condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr')=='on'}}
                            alias: Interruttore PdR ON
                          - alias: Interruttore Inquinanti OFF
                            condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc')=='off'}}
                    sequence:
                      - choose:
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - service: input_boolean.turn_on
                                metadata: {}
                                data: {}
                                target:
                                  entity_id:
                                    - >-
                                      input_boolean.vmc_master_spia_velocita_2_un_solo_avvio
                              - alias: Ripeti Finchè Non Diventa Velocità 0
                                repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_velocita_0
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                        0'}}
                            alias: CASO PDR ON E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - service: input_boolean.turn_on
                                metadata: {}
                                data: {}
                                target:
                                  entity_id: >-
                                    input_boolean.vmc_master_spia_velocita_2_un_solo_avvio
                              - alias: Ripeti Finchè Non Diventa Velocità 0
                                repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_velocita_0
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                        0'}}
                            alias: CASO PDR ON E INQUINANTI OFF
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - alias: Ripeti Finchè Non Diventa Velocità 2
                                repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_velocita_2
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                        2'}}
                            alias: CASO PDR OFF E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - alias: Ripeti Finchè Non Diventa Velocità 2
                                repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_velocita_2
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                        2'}}
                            alias: CASO PDR OFF E INQUINANTI OFF
                    alias: Interruttore PdR ON e Interruttore Inquinanti OFF
                  - conditions:
                      - condition: and
                        conditions:
                          - alias: Interruttore PdR OFF
                            condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr')=='off'}}
                          - condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc')=='on'}}
                            alias: Interruttore Inquinanti ON
                    sequence:
                      - choose:
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - service: input_boolean.turn_on
                                metadata: {}
                                data: {}
                                target:
                                  entity_id:
                                    - >-
                                      input_boolean.vmc_master_spia_velocita_2_co2_o_voc
                              - alias: Ripeti Finchè Non Diventa Velocità 2
                                repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_velocita_2
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                        2'}}
                            alias: CASO PDR ON E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - alias: Ripeti Finchè Non Diventa Velocità 2
                                repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_velocita_2
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                        2'}}
                            alias: CASO PDR ON E INQUINANTI OFF
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - service: input_boolean.turn_on
                                metadata: {}
                                data: {}
                                target:
                                  entity_id:
                                    - >-
                                      input_boolean.vmc_master_spia_velocita_2_co2_o_voc
                              - alias: Ripeti Finchè Non Diventa Velocità 2
                                repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_velocita_2
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                        2'}}
                            alias: CASO PDR OFF E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - alias: Ripeti Finchè Non Diventa Velocità 2
                                repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_velocita_2
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                        2'}}
                            alias: CASO PDR OFF E INQUINANTI OFF
                    alias: Interruttore PdR OFF e Interruttore Inquinanti ON
                  - conditions:
                      - condition: and
                        conditions:
                          - alias: Interruttore PdR OFF
                            condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr')=='off'}}
                          - alias: Interruttore Inquinanti OFF
                            condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc')=='off'}}
                    sequence:
                      - choose:
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - alias: Ripeti Finchè Non Diventa Velocità 2
                                repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_velocita_2
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                        2'}}
                            alias: CASO PDR ON E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - alias: Ripeti Finchè Non Diventa Velocità 2
                                repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_velocita_2
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                        2'}}
                            alias: CASO PDR ON E INQUINANTI OFF
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - alias: Ripeti Finchè Non Diventa Velocità 2
                                repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_velocita_2
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                        2'}}
                            alias: CASO PDR OFF E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - alias: Ripeti Finchè Non Diventa Velocità 2
                                repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_velocita_2
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                        2'}}
                            alias: CASO PDR OFF E INQUINANTI OFF
                    alias: Interruttore PdR OFF e Interruttore Inquinanti OFF
          - conditions:
              - alias: Velocità 3 in Assenza di Congelamento e Delta Temperatura
                condition: and
                conditions:
                  - condition: state
                    entity_id: sensor.vmc_master_speed_2_fascia_calendario
                    state: Velocità 3
                  - condition: template
                    value_template: >-
                      {{(states('input_boolean.vmc_master_congelamento_verifica_soglia_valore_spia')==
                      'off' and
                      states('input_boolean.vmc_master_delta_temp_verifica_soglia_valore_spia')==
                      'off')}}
                    alias: Congelamento Assente e Delta Temperatura Assente
            sequence:
              - service: input_boolean.turn_off
                data: {}
                target:
                  entity_id:
                    - >-
                      input_boolean.vmc_master_spia_co2_o_voc_partenza_ritorno_velocita_0
                    - input_boolean.vmc_master_spia_velocita_1_co2_o_voc_pdr
                    - input_boolean.vmc_master_spia_velocita_0_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_1_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_2_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_3_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_4_co2_o_voc
                    - >-
                      input_boolean.vmc_master_spia_velocita_iperventilazione_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_notturna_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_freecooling_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_0_un_solo_avvio
                    - input_boolean.vmc_master_spia_velocita_1_un_solo_avvio
                    - input_boolean.vmc_master_spia_velocita_2_un_solo_avvio
                    - input_boolean.vmc_master_spia_velocita_3_un_solo_avvio
                    - input_boolean.vmc_master_spia_velocita_4_un_solo_avvio
                    - input_boolean.vmc_master_spia_velocita_notturna_un_solo_avvio
                    - >-
                      input_boolean.vmc_master_spia_velocita_iperventilazione_un_solo_avvio
                    - >-
                      input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio
                    - >-
                      input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio_per_programmazione_freecooling
                    - >-
                      input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio_per_programmazione_freeheating
              - choose:
                  - conditions:
                      - condition: and
                        conditions:
                          - condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr')=='on'}}
                            alias: Interruttore PdR ON
                          - condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc')=='on'}}
                            alias: Interruttore Inquinanti ON
                    sequence:
                      - choose:
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - service: input_boolean.turn_on
                                metadata: {}
                                data: {}
                                target:
                                  entity_id:
                                    - >-
                                      input_boolean.vmc_master_spia_velocita_3_un_solo_avvio
                                    - >-
                                      input_boolean.vmc_master_spia_velocita_3_co2_o_voc
                              - repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_velocita_3
                                      metadata: {}
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                        3'}}
                                alias: Ripeti Finchè Non Diventa Velocità 3
                            alias: CASO PDR ON E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - service: input_boolean.turn_on
                                metadata: {}
                                data: {}
                                target:
                                  entity_id: >-
                                    input_boolean.vmc_master_spia_velocita_3_un_solo_avvio
                              - alias: Ripeti Finchè Non Diventa Velocità 0
                                repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_velocita_0
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                        0'}}
                            alias: CASO PDR ON E INQUINANTI OFF
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - service: input_boolean.turn_on
                                metadata: {}
                                data: {}
                                target:
                                  entity_id:
                                    - >-
                                      input_boolean.vmc_master_spia_velocita_3_co2_o_voc
                              - repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_velocita_3
                                      metadata: {}
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                        3'}}
                                alias: Ripeti Finchè Non Diventa Velocità 3
                            alias: CASO PDR OFF E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_velocita_3
                                      metadata: {}
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                        3'}}
                                alias: Ripeti Finchè Non Diventa Velocità 3
                            alias: CASO PDR OFF E INQUINANTI OFF
                    alias: Interruttore PdR ON e Interruttore Inquinanti ON
                  - conditions:
                      - condition: and
                        conditions:
                          - condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr')=='on'}}
                            alias: Interruttore PdR ON
                          - alias: Interruttore Inquinanti OFF
                            condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc')=='off'}}
                    sequence:
                      - choose:
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - service: input_boolean.turn_on
                                metadata: {}
                                data: {}
                                target:
                                  entity_id:
                                    - >-
                                      input_boolean.vmc_master_spia_velocita_3_un_solo_avvio
                              - alias: Ripeti Finchè Non Diventa Velocità 0
                                repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_velocita_0
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                        0'}}
                            alias: CASO PDR ON E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - service: input_boolean.turn_on
                                metadata: {}
                                data: {}
                                target:
                                  entity_id: >-
                                    input_boolean.vmc_master_spia_velocita_3_un_solo_avvio
                              - alias: Ripeti Finchè Non Diventa Velocità 0
                                repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_velocita_0
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                        0'}}
                            alias: CASO PDR ON E INQUINANTI OFF
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_velocita_3
                                      metadata: {}
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                        3'}}
                                alias: Ripeti Finchè Non Diventa Velocità 3
                            alias: CASO PDR OFF E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_velocita_3
                                      metadata: {}
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                        3'}}
                                alias: Ripeti Finchè Non Diventa Velocità 3
                            alias: CASO PDR OFF E INQUINANTI OFF
                    alias: Interruttore PdR ON e Interruttore Inquinanti OFF
                  - conditions:
                      - condition: and
                        conditions:
                          - alias: Interruttore PdR OFF
                            condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr')=='off'}}
                          - condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc')=='on'}}
                            alias: Interruttore Inquinanti ON
                    sequence:
                      - choose:
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - service: input_boolean.turn_on
                                metadata: {}
                                data: {}
                                target:
                                  entity_id:
                                    - >-
                                      input_boolean.vmc_master_spia_velocita_3_co2_o_voc
                              - repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_velocita_3
                                      metadata: {}
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                        3'}}
                                alias: Ripeti Finchè Non Diventa Velocità 3
                            alias: CASO PDR ON E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - alias: Ripeti Finchè Non Diventa Velocità 3
                                repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_velocita_3
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                        3'}}
                            alias: CASO PDR ON E INQUINANTI OFF
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - service: input_boolean.turn_on
                                metadata: {}
                                data: {}
                                target:
                                  entity_id:
                                    - >-
                                      input_boolean.vmc_master_spia_velocita_3_co2_o_voc
                              - repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_velocita_3
                                      metadata: {}
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                        3'}}
                                alias: Ripeti Finchè Non Diventa Velocità 3
                            alias: CASO PDR OFF E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_velocita_3
                                      metadata: {}
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                        3'}}
                                alias: Ripeti Finchè Non Diventa Velocità 3
                            alias: CASO PDR OFF E INQUINANTI OFF
                    alias: Interruttore PdR OFF e Interruttore Inquinanti ON
                  - conditions:
                      - condition: and
                        conditions:
                          - alias: Interruttore PdR OFF
                            condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr')=='off'}}
                          - alias: Interruttore Inquinanti OFF
                            condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc')=='off'}}
                    sequence:
                      - choose:
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - alias: Ripeti Finchè Non Diventa Velocità 3
                                repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_velocita_3
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                        3'}}
                            alias: CASO PDR ON E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - alias: Ripeti Finchè Non Diventa Velocità 3
                                repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_velocita_3
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                        3'}}
                            alias: CASO PDR ON E INQUINANTI OFF
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_velocita_3
                                      metadata: {}
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                        3'}}
                                alias: Ripeti Finchè Non Diventa Velocità 3
                            alias: CASO PDR OFF E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_velocita_3
                                      metadata: {}
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                        3'}}
                                alias: Ripeti Finchè Non Diventa Velocità 3
                            alias: CASO PDR OFF E INQUINANTI OFF
                    alias: Interruttore PdR OFF e Interruttore Inquinanti OFF
          - conditions:
              - alias: Velocità 4 in Assenza di Congelamento e Delta Temperatura
                condition: and
                conditions:
                  - condition: state
                    entity_id: sensor.vmc_master_speed_2_fascia_calendario
                    state: Velocità 4
                  - condition: template
                    value_template: >-
                      {{(states('input_boolean.vmc_master_congelamento_verifica_soglia_valore_spia')==
                      'off' and
                      states('input_boolean.vmc_master_delta_temp_verifica_soglia_valore_spia')==
                      'off')}}
                    alias: Congelamento Assente e Delta Temperatura Assente
            sequence:
              - service: input_boolean.turn_off
                data: {}
                target:
                  entity_id:
                    - >-
                      input_boolean.vmc_master_spia_co2_o_voc_partenza_ritorno_velocita_0
                    - input_boolean.vmc_master_spia_velocita_1_co2_o_voc_pdr
                    - input_boolean.vmc_master_spia_velocita_0_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_1_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_2_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_3_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_4_co2_o_voc
                    - >-
                      input_boolean.vmc_master_spia_velocita_iperventilazione_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_notturna_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_freecooling_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_0_un_solo_avvio
                    - input_boolean.vmc_master_spia_velocita_1_un_solo_avvio
                    - input_boolean.vmc_master_spia_velocita_2_un_solo_avvio
                    - input_boolean.vmc_master_spia_velocita_3_un_solo_avvio
                    - input_boolean.vmc_master_spia_velocita_4_un_solo_avvio
                    - input_boolean.vmc_master_spia_velocita_notturna_un_solo_avvio
                    - >-
                      input_boolean.vmc_master_spia_velocita_iperventilazione_un_solo_avvio
                    - >-
                      input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio
                    - >-
                      input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio_per_programmazione_freecooling
                    - >-
                      input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio_per_programmazione_freeheating
              - choose:
                  - conditions:
                      - condition: and
                        conditions:
                          - condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr')=='on'}}
                            alias: Interruttore PdR ON
                          - condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc')=='on'}}
                            alias: Interruttore Inquinanti ON
                    sequence:
                      - choose:
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - service: input_boolean.turn_on
                                metadata: {}
                                data: {}
                                target:
                                  entity_id:
                                    - >-
                                      input_boolean.vmc_master_spia_velocita_4_un_solo_avvio
                                    - >-
                                      input_boolean.vmc_master_spia_velocita_4_co2_o_voc
                              - repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_velocita_4
                                      metadata: {}
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                        4'}}
                                alias: Ripeti Finchè Non Diventa Velocità 4
                            alias: CASO PDR ON E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - service: input_boolean.turn_on
                                metadata: {}
                                data: {}
                                target:
                                  entity_id: >-
                                    input_boolean.vmc_master_spia_velocita_4_un_solo_avvio
                              - alias: Ripeti Finchè Non Diventa Velocità 0
                                repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_velocita_0
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                        0'}}
                            alias: CASO PDR ON E INQUINANTI OFF
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - service: input_boolean.turn_on
                                metadata: {}
                                data: {}
                                target:
                                  entity_id:
                                    - >-
                                      input_boolean.vmc_master_spia_velocita_4_co2_o_voc
                              - repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_velocita_4
                                      metadata: {}
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                        4'}}
                                alias: Ripeti Finchè Non Diventa Velocità 4
                            alias: CASO PDR OFF E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_velocita_4
                                      metadata: {}
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                        4'}}
                                alias: Ripeti Finchè Non Diventa Velocità 4
                            alias: CASO PDR OFF E INQUINANTI OFF
                    alias: Interruttore PdR ON e Interruttore Inquinanti ON
                  - conditions:
                      - condition: and
                        conditions:
                          - condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr')=='on'}}
                            alias: Interruttore PdR ON
                          - alias: Interruttore Inquinanti OFF
                            condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc')=='off'}}
                    sequence:
                      - choose:
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - service: input_boolean.turn_on
                                metadata: {}
                                data: {}
                                target:
                                  entity_id:
                                    - >-
                                      input_boolean.vmc_master_spia_velocita_4_un_solo_avvio
                              - alias: Ripeti Finchè Non Diventa Velocità 0
                                repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_velocita_0
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                        0'}}
                            alias: CASO PDR ON E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - service: input_boolean.turn_on
                                metadata: {}
                                data: {}
                                target:
                                  entity_id: >-
                                    input_boolean.vmc_master_spia_velocita_4_un_solo_avvio
                              - alias: Ripeti Finchè Non Diventa Velocità 0
                                repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_velocita_0
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                        0'}}
                            alias: CASO PDR ON E INQUINANTI OFF
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_velocita_4
                                      metadata: {}
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                        4'}}
                                alias: Ripeti Finchè Non Diventa Velocità 4
                            alias: CASO PDR OFF E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_velocita_4
                                      metadata: {}
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                        4'}}
                                alias: Ripeti Finchè Non Diventa Velocità 4
                            alias: CASO PDR OFF E INQUINANTI OFF
                    alias: Interruttore PdR ON e Interruttore Inquinanti OFF
                  - conditions:
                      - condition: and
                        conditions:
                          - alias: Interruttore PdR OFF
                            condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr')=='off'}}
                          - condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc')=='on'}}
                            alias: Interruttore Inquinanti ON
                    sequence:
                      - choose:
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - service: input_boolean.turn_on
                                metadata: {}
                                data: {}
                                target:
                                  entity_id:
                                    - >-
                                      input_boolean.vmc_master_spia_velocita_4_co2_o_voc
                              - repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_velocita_4
                                      metadata: {}
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                        4'}}
                                alias: Ripeti Finchè Non Diventa Velocità 4
                            alias: CASO PDR ON E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - alias: Ripeti Finchè Non Diventa Velocità 4
                                repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_velocita_4
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                        4'}}
                            alias: CASO PDR ON E INQUINANTI OFF
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - service: input_boolean.turn_on
                                metadata: {}
                                data: {}
                                target:
                                  entity_id:
                                    - >-
                                      input_boolean.vmc_master_spia_velocita_4_co2_o_voc
                              - repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_velocita_4
                                      metadata: {}
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                        4'}}
                                alias: Ripeti Finchè Non Diventa Velocità 4
                            alias: CASO PDR OFF E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_velocita_4
                                      metadata: {}
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                        4'}}
                                alias: Ripeti Finchè Non Diventa Velocità 4
                            alias: CASO PDR OFF E INQUINANTI OFF
                    alias: Interruttore PdR OFF e Interruttore Inquinanti ON
                  - conditions:
                      - condition: and
                        conditions:
                          - alias: Interruttore PdR OFF
                            condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr')=='off'}}
                          - alias: Interruttore Inquinanti OFF
                            condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc')=='off'}}
                    sequence:
                      - choose:
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - alias: Ripeti Finchè Non Diventa Velocità 4
                                repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_velocita_4
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                        4'}}
                            alias: CASO PDR ON E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - alias: Ripeti Finchè Non Diventa Velocità 4
                                repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_velocita_4
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                        4'}}
                            alias: CASO PDR ON E INQUINANTI OFF
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_velocita_4
                                      metadata: {}
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                        4'}}
                                alias: Ripeti Finchè Non Diventa Velocità 4
                            alias: CASO PDR OFF E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_velocita_4
                                      metadata: {}
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                        4'}}
                                alias: Ripeti Finchè Non Diventa Velocità 4
                            alias: CASO PDR OFF E INQUINANTI OFF
                    alias: Interruttore PdR OFF e Interruttore Inquinanti OFF
          - conditions:
              - alias: Velocità Notturna in Assenza di Congelamento e Delta Temperatura
                condition: and
                conditions:
                  - condition: state
                    entity_id: sensor.vmc_master_speed_2_fascia_calendario
                    state: Notturna
                  - condition: template
                    value_template: >-
                      {{(states('input_boolean.vmc_master_congelamento_verifica_soglia_valore_spia')==
                      'off' and
                      states('input_boolean.vmc_master_delta_temp_verifica_soglia_valore_spia')==
                      'off')}}
                    alias: Congelamento Assente e Delta Temperatura Assente
            sequence:
              - service: input_boolean.turn_off
                data: {}
                target:
                  entity_id:
                    - >-
                      input_boolean.vmc_master_spia_co2_o_voc_partenza_ritorno_velocita_0
                    - input_boolean.vmc_master_spia_velocita_1_co2_o_voc_pdr
                    - input_boolean.vmc_master_spia_velocita_0_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_1_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_2_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_3_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_4_co2_o_voc
                    - >-
                      input_boolean.vmc_master_spia_velocita_iperventilazione_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_notturna_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_freecooling_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_0_un_solo_avvio
                    - input_boolean.vmc_master_spia_velocita_1_un_solo_avvio
                    - input_boolean.vmc_master_spia_velocita_2_un_solo_avvio
                    - input_boolean.vmc_master_spia_velocita_3_un_solo_avvio
                    - input_boolean.vmc_master_spia_velocita_4_un_solo_avvio
                    - input_boolean.vmc_master_spia_velocita_notturna_un_solo_avvio
                    - >-
                      input_boolean.vmc_master_spia_velocita_iperventilazione_un_solo_avvio
                    - >-
                      input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio
                    - >-
                      input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio_per_programmazione_freecooling
                    - >-
                      input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio_per_programmazione_freeheating
              - choose:
                  - conditions:
                      - condition: and
                        conditions:
                          - condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr')=='on'}}
                            alias: Interruttore PdR ON
                          - condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc')=='on'}}
                            alias: Interruttore Inquinanti ON
                    sequence:
                      - choose:
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - service: input_boolean.turn_on
                                metadata: {}
                                data: {}
                                target:
                                  entity_id:
                                    - >-
                                      input_boolean.vmc_master_spia_velocita_notturna_un_solo_avvio
                                    - >-
                                      input_boolean.vmc_master_spia_velocita_notturna_co2_o_voc
                              - alias: Ripeti Finchè Non Diventa Velocità Notturna
                                repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_notturna
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Notturna'}}
                            alias: CASO PDR ON E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - service: input_boolean.turn_on
                                metadata: {}
                                data: {}
                                target:
                                  entity_id: >-
                                    input_boolean.vmc_master_spia_velocita_notturna_un_solo_avvio
                              - alias: Ripeti Finchè Non Diventa Velocità 0
                                repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_velocita_0
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                        0'}}
                            alias: CASO PDR ON E INQUINANTI OFF
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - service: input_boolean.turn_on
                                metadata: {}
                                data: {}
                                target:
                                  entity_id:
                                    - >-
                                      input_boolean.vmc_master_spia_velocita_notturna_co2_o_voc
                              - alias: Ripeti Finchè Non Diventa Velocità Notturna
                                repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_notturna
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Notturna'}}
                            alias: CASO PDR OFF E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - alias: Ripeti Finchè Non Diventa Velocità Notturna
                                repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_notturna
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Notturna'}}
                            alias: CASO PDR OFF E INQUINANTI OFF
                    alias: Interruttore PdR ON e Interruttore Inquinanti ON
                  - conditions:
                      - condition: and
                        conditions:
                          - condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr')=='on'}}
                            alias: Interruttore PdR ON
                          - alias: Interruttore Inquinanti OFF
                            condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc')=='off'}}
                    sequence:
                      - choose:
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - service: input_boolean.turn_on
                                metadata: {}
                                data: {}
                                target:
                                  entity_id:
                                    - >-
                                      input_boolean.vmc_master_spia_velocita_notturna_un_solo_avvio
                              - alias: Ripeti Finchè Non Diventa Velocità 0
                                repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_velocita_0
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                        0'}}
                            alias: CASO PDR ON E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - service: input_boolean.turn_on
                                metadata: {}
                                data: {}
                                target:
                                  entity_id: >-
                                    input_boolean.vmc_master_spia_velocita_notturna_un_solo_avvio
                              - alias: Ripeti Finchè Non Diventa Velocità 0
                                repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_velocita_0
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                        0'}}
                            alias: CASO PDR ON E INQUINANTI OFF
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - alias: Ripeti Finchè Non Diventa Velocità Notturna
                                repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_notturna
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Notturna'}}
                            alias: CASO PDR OFF E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - alias: Ripeti Finchè Non Diventa Velocità Notturna
                                repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_notturna
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Notturna'}}
                            alias: CASO PDR OFF E INQUINANTI OFF
                    alias: Interruttore PdR ON e Interruttore Inquinanti OFF
                  - conditions:
                      - condition: and
                        conditions:
                          - alias: Interruttore PdR OFF
                            condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr')=='off'}}
                          - condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc')=='on'}}
                            alias: Interruttore Inquinanti ON
                    sequence:
                      - choose:
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - service: input_boolean.turn_on
                                metadata: {}
                                data: {}
                                target:
                                  entity_id:
                                    - >-
                                      input_boolean.vmc_master_spia_velocita_notturna_co2_o_voc
                              - alias: Ripeti Finchè Non Diventa Velocità Notturna
                                repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_notturna
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Notturna'}}
                            alias: CASO PDR ON E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - alias: Ripeti Finchè Non Diventa Velocità Notturna
                                repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_notturna
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Notturna'}}
                            alias: CASO PDR ON E INQUINANTI OFF
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - service: input_boolean.turn_on
                                metadata: {}
                                data: {}
                                target:
                                  entity_id:
                                    - >-
                                      input_boolean.vmc_master_spia_velocita_notturna_co2_o_voc
                              - alias: Ripeti Finchè Non Diventa Velocità Notturna
                                repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_notturna
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Notturna'}}
                            alias: CASO PDR OFF E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - alias: Ripeti Finchè Non Diventa Velocità Notturna
                                repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_notturna
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Notturna'}}
                            alias: CASO PDR OFF E INQUINANTI OFF
                    alias: Interruttore PdR OFF e Interruttore Inquinanti ON
                  - conditions:
                      - condition: and
                        conditions:
                          - alias: Interruttore PdR OFF
                            condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr')=='off'}}
                          - alias: Interruttore Inquinanti OFF
                            condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc')=='off'}}
                    sequence:
                      - choose:
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - alias: Ripeti Finchè Non Diventa Velocità Notturna
                                repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_notturna
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Notturna'}}
                            alias: CASO PDR ON E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - alias: Ripeti Finchè Non Diventa Velocità Notturna
                                repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_notturna
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Notturna'}}
                            alias: CASO PDR ON E INQUINANTI OFF
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - alias: Ripeti Finchè Non Diventa Velocità Notturna
                                repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_notturna
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Notturna'}}
                            alias: CASO PDR OFF E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - alias: Ripeti Finchè Non Diventa Velocità Notturna
                                repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_notturna
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Notturna'}}
                            alias: CASO PDR OFF E INQUINANTI OFF
                    alias: Interruttore PdR OFF e Interruttore Inquinanti OFF
          - conditions:
              - alias: >-
                  Velocità Iperventilazione in Assenza di Congelamento e Delta
                  Temperatura
                condition: and
                conditions:
                  - condition: state
                    entity_id: sensor.vmc_master_speed_2_fascia_calendario
                    state: Iperventilazione
                  - condition: template
                    value_template: >-
                      {{(states('input_boolean.vmc_master_congelamento_verifica_soglia_valore_spia')==
                      'off' and
                      states('input_boolean.vmc_master_delta_temp_verifica_soglia_valore_spia')==
                      'off')}}
                    alias: Congelamento Assente e Delta Temperatura Assente
            sequence:
              - service: input_boolean.turn_off
                data: {}
                target:
                  entity_id:
                    - >-
                      input_boolean.vmc_master_spia_co2_o_voc_partenza_ritorno_velocita_0
                    - input_boolean.vmc_master_spia_velocita_1_co2_o_voc_pdr
                    - input_boolean.vmc_master_spia_velocita_0_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_1_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_2_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_3_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_4_co2_o_voc
                    - >-
                      input_boolean.vmc_master_spia_velocita_iperventilazione_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_notturna_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_freecooling_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_0_un_solo_avvio
                    - input_boolean.vmc_master_spia_velocita_1_un_solo_avvio
                    - input_boolean.vmc_master_spia_velocita_2_un_solo_avvio
                    - input_boolean.vmc_master_spia_velocita_3_un_solo_avvio
                    - input_boolean.vmc_master_spia_velocita_4_un_solo_avvio
                    - input_boolean.vmc_master_spia_velocita_notturna_un_solo_avvio
                    - >-
                      input_boolean.vmc_master_spia_velocita_iperventilazione_un_solo_avvio
                    - >-
                      input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio
                    - >-
                      input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio_per_programmazione_freecooling
                    - >-
                      input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio_per_programmazione_freeheating
              - choose:
                  - conditions:
                      - condition: and
                        conditions:
                          - condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr')=='on'}}
                            alias: Interruttore PdR ON
                          - condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc')=='on'}}
                            alias: Interruttore Inquinanti ON
                    sequence:
                      - choose:
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - service: input_boolean.turn_on
                                metadata: {}
                                data: {}
                                target:
                                  entity_id:
                                    - >-
                                      input_boolean.vmc_master_spia_velocita_iperventilazione_un_solo_avvio
                                    - >-
                                      input_boolean.vmc_master_spia_velocita_iperventilazione_co2_o_voc
                              - alias: >-
                                  Ripeti Finchè Non Diventa Velocità
                                  Iperventilazione
                                repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_iperventilazione
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Iperventilazione'}}
                            alias: CASO PDR ON E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - service: input_boolean.turn_on
                                metadata: {}
                                data: {}
                                target:
                                  entity_id: >-
                                    input_boolean.vmc_master_spia_velocita_iperventilazione_un_solo_avvio
                              - alias: Ripeti Finchè Non Diventa Velocità 0
                                repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_velocita_0
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                        0'}}
                            alias: CASO PDR ON E INQUINANTI OFF
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - service: input_boolean.turn_on
                                metadata: {}
                                data: {}
                                target:
                                  entity_id:
                                    - >-
                                      input_boolean.vmc_master_spia_velocita_iperventilazione_co2_o_voc
                              - alias: >-
                                  Ripeti Finchè Non Diventa Velocità
                                  Iperventilazione
                                repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_iperventilazione
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Iperventilazione'}}
                            alias: CASO PDR OFF E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - alias: >-
                                  Ripeti Finchè Non Diventa Velocità
                                  Iperventilazione
                                repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_iperventilazione
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Iperventilazione'}}
                            alias: CASO PDR OFF E INQUINANTI OFF
                    alias: Interruttore PdR ON e Interruttore Inquinanti ON
                  - conditions:
                      - condition: and
                        conditions:
                          - condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr')=='on'}}
                            alias: Interruttore PdR ON
                          - alias: Interruttore Inquinanti OFF
                            condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc')=='off'}}
                    sequence:
                      - choose:
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - service: input_boolean.turn_on
                                metadata: {}
                                data: {}
                                target:
                                  entity_id:
                                    - >-
                                      input_boolean.vmc_master_spia_velocita_iperventilazione_un_solo_avvio
                              - alias: Ripeti Finchè Non Diventa Velocità 0
                                repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_velocita_0
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                        0'}}
                            alias: CASO PDR ON E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - service: input_boolean.turn_on
                                metadata: {}
                                data: {}
                                target:
                                  entity_id: >-
                                    input_boolean.vmc_master_spia_velocita_iperventilazione_un_solo_avvio
                              - alias: Ripeti Finchè Non Diventa Velocità 0
                                repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_velocita_0
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                        0'}}
                            alias: CASO PDR ON E INQUINANTI OFF
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - alias: >-
                                  Ripeti Finchè Non Diventa Velocità
                                  Iperventilazione
                                repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_iperventilazione
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Iperventilazione'}}
                            alias: CASO PDR OFF E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - alias: >-
                                  Ripeti Finchè Non Diventa Velocità
                                  Iperventilazione
                                repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_iperventilazione
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Iperventilazione'}}
                            alias: CASO PDR OFF E INQUINANTI OFF
                    alias: Interruttore PdR ON e Interruttore Inquinanti OFF
                  - conditions:
                      - condition: and
                        conditions:
                          - alias: Interruttore PdR OFF
                            condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr')=='off'}}
                          - condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc')=='on'}}
                            alias: Interruttore Inquinanti ON
                    sequence:
                      - choose:
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - service: input_boolean.turn_on
                                metadata: {}
                                data: {}
                                target:
                                  entity_id:
                                    - >-
                                      input_boolean.vmc_master_spia_velocita_iperventilazione_co2_o_voc
                              - alias: >-
                                  Ripeti Finchè Non Diventa Velocità
                                  Iperventilazione
                                repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_iperventilazione
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Iperventilazione'}}
                            alias: CASO PDR ON E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - alias: >-
                                  Ripeti Finchè Non Diventa Velocità
                                  Iperventilazione
                                repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_iperventilazione
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Iperventilazione'}}
                            alias: CASO PDR ON E INQUINANTI OFF
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - service: input_boolean.turn_on
                                metadata: {}
                                data: {}
                                target:
                                  entity_id:
                                    - >-
                                      input_boolean.vmc_master_spia_velocita_iperventilazione_co2_o_voc
                              - alias: >-
                                  Ripeti Finchè Non Diventa Velocità
                                  Iperventilazione
                                repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_iperventilazione
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Iperventilazione'}}
                            alias: CASO PDR OFF E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - alias: >-
                                  Ripeti Finchè Non Diventa Velocità
                                  Iperventilazione
                                repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_iperventilazione
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Iperventilazione'}}
                            alias: CASO PDR OFF E INQUINANTI OFF
                    alias: Interruttore PdR OFF e Interruttore Inquinanti ON
                  - conditions:
                      - condition: and
                        conditions:
                          - alias: Interruttore PdR OFF
                            condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr')=='off'}}
                          - alias: Interruttore Inquinanti OFF
                            condition: template
                            value_template: >-
                              {{
                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc')=='off'}}
                    sequence:
                      - choose:
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - alias: >-
                                  Ripeti Finchè Non Diventa Velocità
                                  Iperventilazione
                                repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_iperventilazione
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Iperventilazione'}}
                            alias: CASO PDR ON E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - alias: >-
                                  Ripeti Finchè Non Diventa Velocità
                                  Iperventilazione
                                repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_iperventilazione
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Iperventilazione'}}
                            alias: CASO PDR ON E INQUINANTI OFF
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Allerta' or
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Allerta')}}
                            sequence:
                              - alias: >-
                                  Ripeti Finchè Non Diventa Velocità
                                  Iperventilazione
                                repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_iperventilazione
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Iperventilazione'}}
                            alias: CASO PDR OFF E INQUINANTI ON
                          - conditions:
                              - condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                  ne sconsiglia l\'impiego" and
                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                  == 'Nessuna Allerta' and
                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                  == 'Nessuna Allerta')}}
                            sequence:
                              - alias: >-
                                  Ripeti Finchè Non Diventa Velocità
                                  Iperventilazione
                                repeat:
                                  sequence:
                                    - service: shell_command.vmc_master_iperventilazione
                                      data: {}
                                  until:
                                    - condition: template
                                      value_template: >-
                                        {{
                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Iperventilazione'}}
                            alias: CASO PDR OFF E INQUINANTI OFF
                    alias: Interruttore PdR OFF e Interruttore Inquinanti OFF
          - conditions:
              - alias: >-
                  Velocità Free Cool./Heat. in Assenza di Congelamento e Delta
                  Temperatura
                condition: and
                conditions:
                  - condition: state
                    entity_id: sensor.vmc_master_speed_2_fascia_calendario
                    state: Free Cool./Heat.
                  - condition: template
                    value_template: >-
                      {{(states('input_boolean.vmc_master_congelamento_verifica_soglia_valore_spia')==
                      'off' and
                      states('input_boolean.vmc_master_delta_temp_verifica_soglia_valore_spia')==
                      'off')}}
                    alias: Congelamento Assente e Delta Temperatura Assente
            sequence:
              - service: input_boolean.turn_off
                data: {}
                target:
                  entity_id:
                    - >-
                      input_boolean.vmc_master_spia_co2_o_voc_partenza_ritorno_velocita_0
                    - input_boolean.vmc_master_spia_velocita_1_co2_o_voc_pdr
                    - input_boolean.vmc_master_spia_velocita_0_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_1_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_2_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_3_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_4_co2_o_voc
                    - >-
                      input_boolean.vmc_master_spia_velocita_iperventilazione_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_notturna_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_freecooling_co2_o_voc
                    - input_boolean.vmc_master_spia_velocita_0_un_solo_avvio
                    - input_boolean.vmc_master_spia_velocita_1_un_solo_avvio
                    - input_boolean.vmc_master_spia_velocita_2_un_solo_avvio
                    - input_boolean.vmc_master_spia_velocita_3_un_solo_avvio
                    - input_boolean.vmc_master_spia_velocita_4_un_solo_avvio
                    - input_boolean.vmc_master_spia_velocita_notturna_un_solo_avvio
                    - >-
                      input_boolean.vmc_master_spia_velocita_iperventilazione_un_solo_avvio
                    - >-
                      input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio
                    - >-
                      input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio_per_programmazione_freecooling
                    - >-
                      input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio_per_programmazione_freeheating
              - choose:
                  - conditions:
                      - alias: Verifica Programmato Mese Free Heating
                        condition: template
                        value_template: >-
                          {{
                          states('sensor.vmc_master_status_mese_corrente_freeheating_o_freecooling')
                          == "Free Heating" }}
                    sequence:
                      - alias: Spia Free Heating ON o Spia Free Heating OFF ?
                        choose:
                          - conditions:
                              - alias: Allerte Free Heating ON
                                condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_alert_monitoraggio_free_heating_o_free_cooling_allert_interfaccia_avvisi')
                                  != "Nessuna Allerta Free Heating Programmato" or
                                  states('sensor.vmc_master_alert_monitoraggio_free_heating_o_free_cooling_allert_interfaccia_avvisi')
                                  != "Nessuna Allerta Free Heating Programmato,
                                  Presenza di Inquinanti" }}
                            sequence:
                              - choose:
                                  - conditions:
                                      - condition: and
                                        conditions:
                                          - condition: template
                                            value_template: >-
                                              {{
                                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr')=='on'}}
                                            alias: Interruttore PdR ON
                                          - condition: template
                                            value_template: >-
                                              {{
                                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc')=='on'}}
                                            alias: Interruttore Inquinanti ON
                                    sequence:
                                      - choose:
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Allerta' or
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Allerta')}}
                                            sequence:
                                              - service: input_boolean.turn_on
                                                metadata: {}
                                                data: {}
                                                target:
                                                  entity_id:
                                                    - >-
                                                      input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio
                                                    - >-
                                                      input_boolean.vmc_master_spia_velocita_1_co2_o_voc
                                                    - >-
                                                      input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio_per_programmazione_freeheating
                                              - repeat:
                                                  sequence:
                                                    - service: shell_command.vmc_master_velocita_1
                                                      metadata: {}
                                                      data: {}
                                                  until:
                                                    - condition: template
                                                      value_template: >-
                                                        {{
                                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                                        1'}}
                                                alias: Ripeti Finchè Non Diventa Velocità 1
                                            alias: CASO PDR ON E INQUINANTI ON
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Nessuna Allerta' and
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Nessuna Allerta')}}
                                            sequence:
                                              - service: input_boolean.turn_on
                                                metadata: {}
                                                data: {}
                                                target:
                                                  entity_id:
                                                    - >-
                                                      input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio_per_programmazione_freeheating
                                                    - >-
                                                      input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio
                                              - alias: Ripeti Finchè Non Diventa Velocità 0
                                                repeat:
                                                  sequence:
                                                    - service: shell_command.vmc_master_velocita_0
                                                      data: {}
                                                  until:
                                                    - condition: template
                                                      value_template: >-
                                                        {{
                                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                                        0'}}
                                            alias: CASO PDR ON E INQUINANTI OFF
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Allerta' or
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Allerta')}}
                                            sequence:
                                              - service: input_boolean.turn_on
                                                metadata: {}
                                                data: {}
                                                target:
                                                  entity_id:
                                                    - >-
                                                      input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio_per_programmazione_freeheating
                                                    - >-
                                                      input_boolean.vmc_master_spia_velocita_1_co2_o_voc
                                              - repeat:
                                                  sequence:
                                                    - service: shell_command.vmc_master_velocita_1
                                                      metadata: {}
                                                      data: {}
                                                  until:
                                                    - condition: template
                                                      value_template: >-
                                                        {{
                                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                                        1'}}
                                                alias: Ripeti Finchè Non Diventa Velocità 1
                                            alias: CASO PDR OFF E INQUINANTI ON
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Nessuna Allerta' and
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Nessuna Allerta')}}
                                            sequence:
                                              - service: input_boolean.turn_on
                                                metadata: {}
                                                data: {}
                                                target:
                                                  entity_id: >-
                                                    input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio_per_programmazione_freeheating
                                              - alias: Ripeti Finchè Non Diventa Velocità 0
                                                repeat:
                                                  sequence:
                                                    - service: shell_command.vmc_master_velocita_0
                                                      data: {}
                                                  until:
                                                    - condition: template
                                                      value_template: >-
                                                        {{
                                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                                        0'}}
                                            alias: CASO PDR OFF E INQUINANTI OFF
                                    alias: >-
                                      Interruttore PdR ON e Interruttore Inquinanti
                                      ON
                                  - conditions:
                                      - condition: and
                                        conditions:
                                          - condition: template
                                            value_template: >-
                                              {{
                                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr')=='on'}}
                                            alias: Interruttore PdR ON
                                          - alias: Interruttore Inquinanti OFF
                                            condition: template
                                            value_template: >-
                                              {{
                                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc')=='off'}}
                                    sequence:
                                      - choose:
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Allerta' or
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Allerta')}}
                                            sequence:
                                              - service: input_boolean.turn_on
                                                metadata: {}
                                                data: {}
                                                target:
                                                  entity_id:
                                                    - >-
                                                      input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio
                                                    - >-
                                                      input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio_per_programmazione_freeheating
                                              - alias: Ripeti Finchè Non Diventa Velocità 0
                                                repeat:
                                                  sequence:
                                                    - service: shell_command.vmc_master_velocita_0
                                                      data: {}
                                                  until:
                                                    - condition: template
                                                      value_template: >-
                                                        {{
                                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                                        0'}}
                                            alias: CASO PDR ON E INQUINANTI ON
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Nessuna Allerta' and
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Nessuna Allerta')}}
                                            sequence:
                                              - service: input_boolean.turn_on
                                                metadata: {}
                                                data: {}
                                                target:
                                                  entity_id:
                                                    - >-
                                                      input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio
                                                    - >-
                                                      input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio_per_programmazione_freeheating
                                              - alias: Ripeti Finchè Non Diventa Velocità 0
                                                repeat:
                                                  sequence:
                                                    - service: shell_command.vmc_master_velocita_0
                                                      data: {}
                                                  until:
                                                    - condition: template
                                                      value_template: >-
                                                        {{
                                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                                        0'}}
                                            alias: CASO PDR ON E INQUINANTI OFF
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Allerta' or
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Allerta')}}
                                            sequence:
                                              - service: input_boolean.turn_on
                                                metadata: {}
                                                data: {}
                                                target:
                                                  entity_id:
                                                    - >-
                                                      input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio_per_programmazione_freeheating
                                              - alias: Ripeti Finchè Non Diventa Velocità 0
                                                repeat:
                                                  sequence:
                                                    - service: shell_command.vmc_master_velocita_0
                                                      data: {}
                                                  until:
                                                    - condition: template
                                                      value_template: >-
                                                        {{
                                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                                        0'}}
                                            alias: CASO PDR OFF E INQUINANTI ON
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Nessuna Allerta' and
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Nessuna Allerta')}}
                                            sequence:
                                              - service: input_boolean.turn_on
                                                metadata: {}
                                                data: {}
                                                target:
                                                  entity_id:
                                                    - >-
                                                      input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio_per_programmazione_freeheating
                                              - alias: Ripeti Finchè Non Diventa Velocità 0
                                                repeat:
                                                  sequence:
                                                    - service: shell_command.vmc_master_velocita_0
                                                      data: {}
                                                  until:
                                                    - condition: template
                                                      value_template: >-
                                                        {{
                                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                                        0'}}
                                            alias: CASO PDR OFF E INQUINANTI OFF
                                    alias: >-
                                      Interruttore PdR ON e Interruttore Inquinanti
                                      OFF
                                  - conditions:
                                      - condition: and
                                        conditions:
                                          - alias: Interruttore PdR OFF
                                            condition: template
                                            value_template: >-
                                              {{
                                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr')=='off'}}
                                          - condition: template
                                            value_template: >-
                                              {{
                                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc')=='on'}}
                                            alias: Interruttore Inquinanti ON
                                    sequence:
                                      - choose:
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Allerta' or
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Allerta')}}
                                            sequence:
                                              - service: input_boolean.turn_on
                                                metadata: {}
                                                data: {}
                                                target:
                                                  entity_id:
                                                    - >-
                                                      input_boolean.vmc_master_spia_velocita_1_co2_o_voc
                                                    - >-
                                                      input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio_per_programmazione_freeheating
                                              - repeat:
                                                  sequence:
                                                    - service: shell_command.vmc_master_velocita_1
                                                      metadata: {}
                                                      data: {}
                                                  until:
                                                    - condition: template
                                                      value_template: >-
                                                        {{
                                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                                        1'}}
                                                alias: Ripeti Finchè Non Diventa Velocità 1
                                            alias: CASO PDR ON E INQUINANTI ON
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Nessuna Allerta' and
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Nessuna Allerta')}}
                                            sequence:
                                              - service: input_boolean.turn_on
                                                metadata: {}
                                                data: {}
                                                target:
                                                  entity_id:
                                                    - >-
                                                      input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio_per_programmazione_freeheating
                                              - alias: Ripeti Finchè Non Diventa Velocità 0
                                                repeat:
                                                  sequence:
                                                    - service: shell_command.vmc_master_velocita_0
                                                      data: {}
                                                  until:
                                                    - condition: template
                                                      value_template: >-
                                                        {{
                                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                                        0'}}
                                            alias: CASO PDR ON E INQUINANTI OFF
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Allerta' or
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Allerta')}}
                                            sequence:
                                              - service: input_boolean.turn_on
                                                metadata: {}
                                                data: {}
                                                target:
                                                  entity_id:
                                                    - >-
                                                      input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio_per_programmazione_freeheating
                                                    - >-
                                                      input_boolean.vmc_master_spia_velocita_1_co2_o_voc
                                              - repeat:
                                                  sequence:
                                                    - service: shell_command.vmc_master_velocita_1
                                                      metadata: {}
                                                      data: {}
                                                  until:
                                                    - condition: template
                                                      value_template: >-
                                                        {{
                                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                                        1'}}
                                                alias: Ripeti Finchè Non Diventa Velocità 1
                                            alias: CASO PDR OFF E INQUINANTI ON
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Nessuna Allerta' and
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Nessuna Allerta')}}
                                            sequence:
                                              - service: input_boolean.turn_on
                                                metadata: {}
                                                data: {}
                                                target:
                                                  entity_id: >-
                                                    input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio_per_programmazione_freeheating
                                              - alias: Ripeti Finchè Non Diventa Velocità 0
                                                repeat:
                                                  sequence:
                                                    - service: shell_command.vmc_master_velocita_0
                                                      data: {}
                                                  until:
                                                    - condition: template
                                                      value_template: >-
                                                        {{
                                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                                        0'}}
                                            alias: CASO PDR OFF E INQUINANTI OFF
                                    alias: >-
                                      Interruttore PdR OFF e Interruttore Inquinanti
                                      ON
                                  - conditions:
                                      - condition: and
                                        conditions:
                                          - alias: Interruttore PdR OFF
                                            condition: template
                                            value_template: >-
                                              {{
                                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr')=='off'}}
                                          - alias: Interruttore Inquinanti OFF
                                            condition: template
                                            value_template: >-
                                              {{
                                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc')=='off'}}
                                    sequence:
                                      - choose:
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Allerta' or
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Allerta')}}
                                            sequence:
                                              - service: input_boolean.turn_on
                                                metadata: {}
                                                data: {}
                                                target:
                                                  entity_id:
                                                    - >-
                                                      input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio_per_programmazione_freeheating
                                              - alias: Ripeti Finchè Non Diventa Velocità 0
                                                repeat:
                                                  sequence:
                                                    - service: shell_command.vmc_master_velocita_0
                                                      data: {}
                                                  until:
                                                    - condition: template
                                                      value_template: >-
                                                        {{
                                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                                        0'}}
                                            alias: CASO PDR ON E INQUINANTI ON
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Nessuna Allerta' and
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Nessuna Allerta')}}
                                            sequence:
                                              - service: input_boolean.turn_on
                                                metadata: {}
                                                data: {}
                                                target:
                                                  entity_id:
                                                    - >-
                                                      input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio_per_programmazione_freeheating
                                              - alias: Ripeti Finchè Non Diventa Velocità 0
                                                repeat:
                                                  sequence:
                                                    - service: shell_command.vmc_master_velocita_0
                                                      data: {}
                                                  until:
                                                    - condition: template
                                                      value_template: >-
                                                        {{
                                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                                        0'}}
                                            alias: CASO PDR ON E INQUINANTI OFF
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Allerta' or
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Allerta')}}
                                            sequence:
                                              - service: input_boolean.turn_on
                                                metadata: {}
                                                data: {}
                                                target:
                                                  entity_id:
                                                    - >-
                                                      input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio_per_programmazione_freeheating
                                              - alias: Ripeti Finchè Non Diventa Velocità 0
                                                repeat:
                                                  sequence:
                                                    - service: shell_command.vmc_master_velocita_0
                                                      data: {}
                                                  until:
                                                    - condition: template
                                                      value_template: >-
                                                        {{
                                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                                        0'}}
                                            alias: CASO PDR OFF E INQUINANTI ON
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Nessuna Allerta' and
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Nessuna Allerta')}}
                                            sequence:
                                              - service: input_boolean.turn_on
                                                metadata: {}
                                                data: {}
                                                target:
                                                  entity_id:
                                                    - >-
                                                      input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio_per_programmazione_freeheating
                                              - alias: Ripeti Finchè Non Diventa Velocità 0
                                                repeat:
                                                  sequence:
                                                    - service: shell_command.vmc_master_velocita_0
                                                      data: {}
                                                  until:
                                                    - condition: template
                                                      value_template: >-
                                                        {{
                                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                                        0'}}
                                            alias: CASO PDR OFF E INQUINANTI OFF
                                    alias: >-
                                      Interruttore PdR OFF e Interruttore Inquinanti
                                      OFF
                            alias: Spia Free Heating ON
                          - conditions:
                              - alias: Allerte Free Heating OFF
                                condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_alert_monitoraggio_free_heating_o_free_cooling_allert_interfaccia_avvisi')
                                  == "Nessuna Allerta Free Heating Programmato" or
                                  states('sensor.vmc_master_alert_monitoraggio_free_heating_o_free_cooling_allert_interfaccia_avvisi')
                                  == "Nessuna Allerta Free Heating Programmato,
                                  Presenza di Inquinanti" }}
                            sequence:
                              - choose:
                                  - conditions:
                                      - condition: and
                                        conditions:
                                          - condition: template
                                            value_template: >-
                                              {{
                                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr')=='on'}}
                                            alias: Interruttore PdR ON
                                          - condition: template
                                            value_template: >-
                                              {{
                                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc')=='on'}}
                                            alias: Interruttore Inquinanti ON
                                    sequence:
                                      - choose:
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Allerta' or
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Allerta')}}
                                            sequence:
                                              - service: input_boolean.turn_on
                                                metadata: {}
                                                data: {}
                                                target:
                                                  entity_id:
                                                    - >-
                                                      input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio
                                                    - >-
                                                      input_boolean.vmc_master_spia_velocita_freecooling_co2_o_voc
                                              - alias: >-
                                                  Ripeti Finchè Non Diventa Velocità
                                                  Freecooling
                                                repeat:
                                                  sequence:
                                                    - service: shell_command.vmc_master_freecooling
                                                      data: {}
                                                  until:
                                                    - condition: template
                                                      value_template: >-
                                                        {{
                                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Free
                                                        Cooling'}}
                                            alias: CASO PDR ON E INQUINANTI ON
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Nessuna Allerta' and
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Nessuna Allerta')}}
                                            sequence:
                                              - service: input_boolean.turn_on
                                                metadata: {}
                                                data: {}
                                                target:
                                                  entity_id: >-
                                                    input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio
                                              - alias: Ripeti Finchè Non Diventa Velocità 0
                                                repeat:
                                                  sequence:
                                                    - service: shell_command.vmc_master_velocita_0
                                                      data: {}
                                                  until:
                                                    - condition: template
                                                      value_template: >-
                                                        {{
                                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                                        0'}}
                                            alias: CASO PDR ON E INQUINANTI OFF
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Allerta' or
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Allerta')}}
                                            sequence:
                                              - service: input_boolean.turn_on
                                                metadata: {}
                                                data: {}
                                                target:
                                                  entity_id:
                                                    - >-
                                                      input_boolean.vmc_master_spia_velocita_freecooling_co2_o_voc
                                              - alias: >-
                                                  Ripeti Finchè Non Diventa Velocità
                                                  Freecooling
                                                repeat:
                                                  sequence:
                                                    - service: shell_command.vmc_master_freecooling
                                                      data: {}
                                                  until:
                                                    - condition: template
                                                      value_template: >-
                                                        {{
                                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Free
                                                        Cooling'}}
                                            alias: CASO PDR OFF E INQUINANTI ON
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Nessuna Allerta' and
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Nessuna Allerta')}}
                                            sequence:
                                              - alias: >-
                                                  Ripeti Finchè Non Diventa Velocità
                                                  Freecooling
                                                repeat:
                                                  sequence:
                                                    - service: shell_command.vmc_master_freecooling
                                                      data: {}
                                                  until:
                                                    - condition: template
                                                      value_template: >-
                                                        {{
                                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Free
                                                        Cooling'}}
                                            alias: CASO PDR OFF E INQUINANTI OFF
                                    alias: >-
                                      Interruttore PdR ON e Interruttore Inquinanti
                                      ON
                                  - conditions:
                                      - condition: and
                                        conditions:
                                          - condition: template
                                            value_template: >-
                                              {{
                                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr')=='on'}}
                                            alias: Interruttore PdR ON
                                          - alias: Interruttore Inquinanti OFF
                                            condition: template
                                            value_template: >-
                                              {{
                                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc')=='off'}}
                                    sequence:
                                      - choose:
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Allerta' or
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Allerta')}}
                                            sequence:
                                              - service: input_boolean.turn_on
                                                metadata: {}
                                                data: {}
                                                target:
                                                  entity_id:
                                                    - >-
                                                      input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio
                                              - alias: Ripeti Finchè Non Diventa Velocità 0
                                                repeat:
                                                  sequence:
                                                    - service: shell_command.vmc_master_velocita_0
                                                      data: {}
                                                  until:
                                                    - condition: template
                                                      value_template: >-
                                                        {{
                                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                                        0'}}
                                            alias: CASO PDR ON E INQUINANTI ON
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Nessuna Allerta' and
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Nessuna Allerta')}}
                                            sequence:
                                              - service: input_boolean.turn_on
                                                metadata: {}
                                                data: {}
                                                target:
                                                  entity_id: >-
                                                    input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio
                                              - alias: Ripeti Finchè Non Diventa Velocità 0
                                                repeat:
                                                  sequence:
                                                    - service: shell_command.vmc_master_velocita_0
                                                      data: {}
                                                  until:
                                                    - condition: template
                                                      value_template: >-
                                                        {{
                                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                                        0'}}
                                            alias: CASO PDR ON E INQUINANTI OFF
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Allerta' or
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Allerta')}}
                                            sequence:
                                              - alias: >-
                                                  Ripeti Finchè Non Diventa Velocità
                                                  Freecooling
                                                repeat:
                                                  sequence:
                                                    - service: shell_command.vmc_master_freecooling
                                                      data: {}
                                                  until:
                                                    - condition: template
                                                      value_template: >-
                                                        {{
                                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Free
                                                        Cooling'}}
                                            alias: CASO PDR OFF E INQUINANTI ON
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Nessuna Allerta' and
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Nessuna Allerta')}}
                                            sequence:
                                              - alias: >-
                                                  Ripeti Finchè Non Diventa Velocità
                                                  Freecooling
                                                repeat:
                                                  sequence:
                                                    - service: shell_command.vmc_master_freecooling
                                                      data: {}
                                                  until:
                                                    - condition: template
                                                      value_template: >-
                                                        {{
                                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Free
                                                        Cooling'}}
                                            alias: CASO PDR OFF E INQUINANTI OFF
                                    alias: >-
                                      Interruttore PdR ON e Interruttore Inquinanti
                                      OFF
                                  - conditions:
                                      - condition: and
                                        conditions:
                                          - alias: Interruttore PdR OFF
                                            condition: template
                                            value_template: >-
                                              {{
                                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr')=='off'}}
                                          - condition: template
                                            value_template: >-
                                              {{
                                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc')=='on'}}
                                            alias: Interruttore Inquinanti ON
                                    sequence:
                                      - choose:
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Allerta' or
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Allerta')}}
                                            sequence:
                                              - service: input_boolean.turn_on
                                                metadata: {}
                                                data: {}
                                                target:
                                                  entity_id:
                                                    - >-
                                                      input_boolean.vmc_master_spia_velocita_freecooling_co2_o_voc
                                              - alias: >-
                                                  Ripeti Finchè Non Diventa Velocità
                                                  Freecooling
                                                repeat:
                                                  sequence:
                                                    - service: shell_command.vmc_master_freecooling
                                                      data: {}
                                                  until:
                                                    - condition: template
                                                      value_template: >-
                                                        {{
                                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Free
                                                        Cooling'}}
                                            alias: CASO PDR ON E INQUINANTI ON
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Nessuna Allerta' and
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Nessuna Allerta')}}
                                            sequence:
                                              - alias: >-
                                                  Ripeti Finchè Non Diventa Velocità
                                                  Freecooling
                                                repeat:
                                                  sequence:
                                                    - service: shell_command.vmc_master_freecooling
                                                      data: {}
                                                  until:
                                                    - condition: template
                                                      value_template: >-
                                                        {{
                                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Free
                                                        Cooling'}}
                                            alias: CASO PDR ON E INQUINANTI OFF
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Allerta' or
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Allerta')}}
                                            sequence:
                                              - service: input_boolean.turn_on
                                                metadata: {}
                                                data: {}
                                                target:
                                                  entity_id:
                                                    - >-
                                                      input_boolean.vmc_master_spia_velocita_freecooling_co2_o_voc
                                              - alias: >-
                                                  Ripeti Finchè Non Diventa Velocità
                                                  Freecooling
                                                repeat:
                                                  sequence:
                                                    - service: shell_command.vmc_master_freecooling
                                                      data: {}
                                                  until:
                                                    - condition: template
                                                      value_template: >-
                                                        {{
                                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Free
                                                        Cooling'}}
                                            alias: CASO PDR OFF E INQUINANTI ON
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Nessuna Allerta' and
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Nessuna Allerta')}}
                                            sequence:
                                              - alias: >-
                                                  Ripeti Finchè Non Diventa Velocità
                                                  Freecooling
                                                repeat:
                                                  sequence:
                                                    - service: shell_command.vmc_master_freecooling
                                                      data: {}
                                                  until:
                                                    - condition: template
                                                      value_template: >-
                                                        {{
                                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Free
                                                        Cooling'}}
                                            alias: CASO PDR OFF E INQUINANTI OFF
                                    alias: >-
                                      Interruttore PdR OFF e Interruttore Inquinanti
                                      ON
                                  - conditions:
                                      - condition: and
                                        conditions:
                                          - alias: Interruttore PdR OFF
                                            condition: template
                                            value_template: >-
                                              {{
                                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr')=='off'}}
                                          - alias: Interruttore Inquinanti OFF
                                            condition: template
                                            value_template: >-
                                              {{
                                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc')=='off'}}
                                    sequence:
                                      - choose:
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Allerta' or
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Allerta')}}
                                            sequence:
                                              - alias: >-
                                                  Ripeti Finchè Non Diventa Velocità
                                                  Freecooling
                                                repeat:
                                                  sequence:
                                                    - service: shell_command.vmc_master_freecooling
                                                      data: {}
                                                  until:
                                                    - condition: template
                                                      value_template: >-
                                                        {{
                                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Free
                                                        Cooling'}}
                                            alias: CASO PDR ON E INQUINANTI ON
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Nessuna Allerta' and
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Nessuna Allerta')}}
                                            sequence:
                                              - alias: >-
                                                  Ripeti Finchè Non Diventa Velocità
                                                  Freecooling
                                                repeat:
                                                  sequence:
                                                    - service: shell_command.vmc_master_freecooling
                                                      data: {}
                                                  until:
                                                    - condition: template
                                                      value_template: >-
                                                        {{
                                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Free
                                                        Cooling'}}
                                            alias: CASO PDR ON E INQUINANTI OFF
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Allerta' or
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Allerta')}}
                                            sequence:
                                              - alias: >-
                                                  Ripeti Finchè Non Diventa Velocità
                                                  Freecooling
                                                repeat:
                                                  sequence:
                                                    - service: shell_command.vmc_master_freecooling
                                                      data: {}
                                                  until:
                                                    - condition: template
                                                      value_template: >-
                                                        {{
                                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Free
                                                        Cooling'}}
                                            alias: CASO PDR OFF E INQUINANTI ON
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Nessuna Allerta' and
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Nessuna Allerta')}}
                                            sequence:
                                              - alias: >-
                                                  Ripeti Finchè Non Diventa Velocità
                                                  Freecooling
                                                repeat:
                                                  sequence:
                                                    - service: shell_command.vmc_master_freecooling
                                                      data: {}
                                                  until:
                                                    - condition: template
                                                      value_template: >-
                                                        {{
                                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Free
                                                        Cooling'}}
                                            alias: CASO PDR OFF E INQUINANTI OFF
                                    alias: >-
                                      Interruttore PdR OFF e Interruttore Inquinanti
                                      OFF
                            alias: Spia Free Heating OFF
                    alias: Programmato Mese Free Heating
                  - conditions:
                      - alias: Verifica Programmato Mese Free Cooling
                        condition: template
                        value_template: >-
                          {{
                          states('sensor.vmc_master_status_mese_corrente_freeheating_o_freecooling')
                          == "Free Cooling" }}
                    sequence:
                      - alias: Spia Free Cooling ON o Spia Free Cooling OFF ?
                        choose:
                          - conditions:
                              - alias: Allerte Free Cooling ON
                                condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_alert_monitoraggio_free_heating_o_free_cooling_allert_interfaccia_avvisi')
                                  != "Nessuna Allerta Free Cooling Programmato" or
                                  states('sensor.vmc_master_alert_monitoraggio_free_heating_o_free_cooling_allert_interfaccia_avvisi')
                                  != "Nessuna Allerta Free Cooling Programmato,
                                  Presenza di Inquinanti" }}
                            sequence:
                              - choose:
                                  - conditions:
                                      - condition: template
                                        value_template: >-
                                          {{
                                          states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                          ne sconsiglia l\'impiego" and
                                          (states('sensor.vmc_master_alert_monitoraggio_co2')
                                          == 'Allerta' or
                                          states('sensor.vmc_master_alert_monitoraggio_voc')
                                          == 'Allerta')}}
                                    sequence:
                                      - service: input_boolean.turn_on
                                        metadata: {}
                                        data: {}
                                        target:
                                          entity_id:
                                            - >-
                                              input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio
                                            - >-
                                              input_boolean.vmc_master_spia_velocita_1_co2_o_voc
                                            - >-
                                              input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio_per_programmazione_freecooling
                                      - repeat:
                                          sequence:
                                            - service: shell_command.vmc_master_velocita_1
                                              metadata: {}
                                              data: {}
                                          until:
                                            - condition: template
                                              value_template: >-
                                                {{
                                                states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                                1'}}
                                        alias: Ripeti Finchè Non Diventa Velocità 1
                                    alias: CASO PDR ON E INQUINANTI ON
                                  - conditions:
                                      - condition: template
                                        value_template: >-
                                          {{
                                          states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                          ne sconsiglia l\'impiego" and
                                          (states('sensor.vmc_master_alert_monitoraggio_co2')
                                          == 'Nessuna Allerta' and
                                          states('sensor.vmc_master_alert_monitoraggio_voc')
                                          == 'Nessuna Allerta')}}
                                    sequence:
                                      - service: input_boolean.turn_on
                                        metadata: {}
                                        data: {}
                                        target:
                                          entity_id:
                                            - >-
                                              input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio_per_programmazione_freecooling
                                            - >-
                                              input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio
                                      - alias: Ripeti Finchè Non Diventa Velocità 0
                                        repeat:
                                          sequence:
                                            - service: shell_command.vmc_master_velocita_0
                                              data: {}
                                          until:
                                            - condition: template
                                              value_template: >-
                                                {{
                                                states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                                0'}}
                                    alias: CASO PDR ON E INQUINANTI OFF
                                  - conditions:
                                      - condition: template
                                        value_template: >-
                                          {{
                                          states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                          ne sconsiglia l\'impiego" and
                                          (states('sensor.vmc_master_alert_monitoraggio_co2')
                                          == 'Allerta' or
                                          states('sensor.vmc_master_alert_monitoraggio_voc')
                                          == 'Allerta')}}
                                    sequence:
                                      - service: input_boolean.turn_on
                                        metadata: {}
                                        data: {}
                                        target:
                                          entity_id:
                                            - >-
                                              input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio_per_programmazione_freecooling
                                            - >-
                                              input_boolean.vmc_master_spia_velocita_1_co2_o_voc
                                      - repeat:
                                          sequence:
                                            - service: shell_command.vmc_master_velocita_1
                                              metadata: {}
                                              data: {}
                                          until:
                                            - condition: template
                                              value_template: >-
                                                {{
                                                states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                                1'}}
                                        alias: Ripeti Finchè Non Diventa Velocità 1
                                    alias: CASO PDR OFF E INQUINANTI ON
                                  - conditions:
                                      - condition: template
                                        value_template: >-
                                          {{
                                          states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                          ne sconsiglia l\'impiego" and
                                          (states('sensor.vmc_master_alert_monitoraggio_co2')
                                          == 'Nessuna Allerta' and
                                          states('sensor.vmc_master_alert_monitoraggio_voc')
                                          == 'Nessuna Allerta')}}
                                    sequence:
                                      - service: input_boolean.turn_on
                                        metadata: {}
                                        data: {}
                                        target:
                                          entity_id: >-
                                            input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio_per_programmazione_freecooling
                                      - alias: Ripeti Finchè Non Diventa Velocità 0
                                        repeat:
                                          sequence:
                                            - service: shell_command.vmc_master_velocita_0
                                              data: {}
                                          until:
                                            - condition: template
                                              value_template: >-
                                                {{
                                                states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                                0'}}
                                    alias: CASO PDR OFF E INQUINANTI OFF
                            alias: Spia Free Cooling ON
                          - conditions:
                              - alias: Allerte Free Cooling OFF
                                condition: template
                                value_template: >-
                                  {{
                                  states('sensor.vmc_master_alert_monitoraggio_free_heating_o_free_cooling_allert_interfaccia_avvisi')
                                  == "Nessuna Allerta Free Cooling Programmato" or
                                  states('sensor.vmc_master_alert_monitoraggio_free_heating_o_free_cooling_allert_interfaccia_avvisi')
                                  == "Nessuna Allerta Free Cooling Programmato,
                                  Presenza di Inquinanti" }}
                            sequence:
                              - choose:
                                  - conditions:
                                      - condition: and
                                        conditions:
                                          - condition: template
                                            value_template: >-
                                              {{
                                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr')=='on'}}
                                            alias: Interruttore PdR ON
                                          - condition: template
                                            value_template: >-
                                              {{
                                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc')=='on'}}
                                            alias: Interruttore Inquinanti ON
                                    sequence:
                                      - choose:
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Allerta' or
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Allerta')}}
                                            sequence:
                                              - service: input_boolean.turn_on
                                                metadata: {}
                                                data: {}
                                                target:
                                                  entity_id:
                                                    - >-
                                                      input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio
                                                    - >-
                                                      input_boolean.vmc_master_spia_velocita_freecooling_co2_o_voc
                                              - alias: >-
                                                  Ripeti Finchè Non Diventa Velocità
                                                  Freecooling
                                                repeat:
                                                  sequence:
                                                    - service: shell_command.vmc_master_freecooling
                                                      data: {}
                                                  until:
                                                    - condition: template
                                                      value_template: >-
                                                        {{
                                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Free
                                                        Cooling'}}
                                            alias: CASO PDR ON E INQUINANTI ON
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Nessuna Allerta' and
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Nessuna Allerta')}}
                                            sequence:
                                              - service: input_boolean.turn_on
                                                metadata: {}
                                                data: {}
                                                target:
                                                  entity_id: >-
                                                    input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio
                                              - alias: Ripeti Finchè Non Diventa Velocità 0
                                                repeat:
                                                  sequence:
                                                    - service: shell_command.vmc_master_velocita_0
                                                      data: {}
                                                  until:
                                                    - condition: template
                                                      value_template: >-
                                                        {{
                                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                                        0'}}
                                            alias: CASO PDR ON E INQUINANTI OFF
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Allerta' or
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Allerta')}}
                                            sequence:
                                              - service: input_boolean.turn_on
                                                metadata: {}
                                                data: {}
                                                target:
                                                  entity_id:
                                                    - >-
                                                      input_boolean.vmc_master_spia_velocita_freecooling_co2_o_voc
                                              - alias: >-
                                                  Ripeti Finchè Non Diventa Velocità
                                                  Freecooling
                                                repeat:
                                                  sequence:
                                                    - service: shell_command.vmc_master_freecooling
                                                      data: {}
                                                  until:
                                                    - condition: template
                                                      value_template: >-
                                                        {{
                                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Free
                                                        Cooling'}}
                                            alias: CASO PDR OFF E INQUINANTI ON
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Nessuna Allerta' and
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Nessuna Allerta')}}
                                            sequence:
                                              - alias: >-
                                                  Ripeti Finchè Non Diventa Velocità
                                                  Freecooling
                                                repeat:
                                                  sequence:
                                                    - service: shell_command.vmc_master_freecooling
                                                      data: {}
                                                  until:
                                                    - condition: template
                                                      value_template: >-
                                                        {{
                                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Free
                                                        Cooling'}}
                                            alias: CASO PDR OFF E INQUINANTI OFF
                                    alias: >-
                                      Interruttore PdR ON e Interruttore Inquinanti
                                      ON
                                  - conditions:
                                      - condition: and
                                        conditions:
                                          - condition: template
                                            value_template: >-
                                              {{
                                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr')=='on'}}
                                            alias: Interruttore PdR ON
                                          - alias: Interruttore Inquinanti OFF
                                            condition: template
                                            value_template: >-
                                              {{
                                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc')=='off'}}
                                    sequence:
                                      - choose:
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Allerta' or
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Allerta')}}
                                            sequence:
                                              - service: input_boolean.turn_on
                                                metadata: {}
                                                data: {}
                                                target:
                                                  entity_id:
                                                    - >-
                                                      input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio
                                              - alias: Ripeti Finchè Non Diventa Velocità 0
                                                repeat:
                                                  sequence:
                                                    - service: shell_command.vmc_master_velocita_0
                                                      data: {}
                                                  until:
                                                    - condition: template
                                                      value_template: >-
                                                        {{
                                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                                        0'}}
                                            alias: CASO PDR ON E INQUINANTI ON
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Nessuna Allerta' and
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Nessuna Allerta')}}
                                            sequence:
                                              - service: input_boolean.turn_on
                                                metadata: {}
                                                data: {}
                                                target:
                                                  entity_id: >-
                                                    input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio
                                              - alias: Ripeti Finchè Non Diventa Velocità 0
                                                repeat:
                                                  sequence:
                                                    - service: shell_command.vmc_master_velocita_0
                                                      data: {}
                                                  until:
                                                    - condition: template
                                                      value_template: >-
                                                        {{
                                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                                        0'}}
                                            alias: CASO PDR ON E INQUINANTI OFF
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Allerta' or
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Allerta')}}
                                            sequence:
                                              - alias: >-
                                                  Ripeti Finchè Non Diventa Velocità
                                                  Freecooling
                                                repeat:
                                                  sequence:
                                                    - service: shell_command.vmc_master_freecooling
                                                      data: {}
                                                  until:
                                                    - condition: template
                                                      value_template: >-
                                                        {{
                                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Free
                                                        Cooling'}}
                                            alias: CASO PDR OFF E INQUINANTI ON
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Nessuna Allerta' and
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Nessuna Allerta')}}
                                            sequence:
                                              - alias: >-
                                                  Ripeti Finchè Non Diventa Velocità
                                                  Freecooling
                                                repeat:
                                                  sequence:
                                                    - service: shell_command.vmc_master_freecooling
                                                      data: {}
                                                  until:
                                                    - condition: template
                                                      value_template: >-
                                                        {{
                                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Free
                                                        Cooling'}}
                                            alias: CASO PDR OFF E INQUINANTI OFF
                                    alias: >-
                                      Interruttore PdR ON e Interruttore Inquinanti
                                      OFF
                                  - conditions:
                                      - condition: and
                                        conditions:
                                          - alias: Interruttore PdR OFF
                                            condition: template
                                            value_template: >-
                                              {{
                                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr')=='off'}}
                                          - condition: template
                                            value_template: >-
                                              {{
                                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc')=='on'}}
                                            alias: Interruttore Inquinanti ON
                                    sequence:
                                      - choose:
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Allerta' or
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Allerta')}}
                                            sequence:
                                              - service: input_boolean.turn_on
                                                metadata: {}
                                                data: {}
                                                target:
                                                  entity_id:
                                                    - >-
                                                      input_boolean.vmc_master_spia_velocita_freecooling_co2_o_voc
                                              - alias: >-
                                                  Ripeti Finchè Non Diventa Velocità
                                                  Freecooling
                                                repeat:
                                                  sequence:
                                                    - service: shell_command.vmc_master_freecooling
                                                      data: {}
                                                  until:
                                                    - condition: template
                                                      value_template: >-
                                                        {{
                                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Free
                                                        Cooling'}}
                                            alias: CASO PDR ON E INQUINANTI ON
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Nessuna Allerta' and
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Nessuna Allerta')}}
                                            sequence:
                                              - alias: >-
                                                  Ripeti Finchè Non Diventa Velocità
                                                  Freecooling
                                                repeat:
                                                  sequence:
                                                    - service: shell_command.vmc_master_freecooling
                                                      data: {}
                                                  until:
                                                    - condition: template
                                                      value_template: >-
                                                        {{
                                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Free
                                                        Cooling'}}
                                            alias: CASO PDR ON E INQUINANTI OFF
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Allerta' or
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Allerta')}}
                                            sequence:
                                              - service: input_boolean.turn_on
                                                metadata: {}
                                                data: {}
                                                target:
                                                  entity_id:
                                                    - >-
                                                      input_boolean.vmc_master_spia_velocita_freecooling_co2_o_voc
                                              - alias: >-
                                                  Ripeti Finchè Non Diventa Velocità
                                                  Freecooling
                                                repeat:
                                                  sequence:
                                                    - service: shell_command.vmc_master_freecooling
                                                      data: {}
                                                  until:
                                                    - condition: template
                                                      value_template: >-
                                                        {{
                                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Free
                                                        Cooling'}}
                                            alias: CASO PDR OFF E INQUINANTI ON
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Nessuna Allerta' and
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Nessuna Allerta')}}
                                            sequence:
                                              - alias: >-
                                                  Ripeti Finchè Non Diventa Velocità
                                                  Freecooling
                                                repeat:
                                                  sequence:
                                                    - service: shell_command.vmc_master_freecooling
                                                      data: {}
                                                  until:
                                                    - condition: template
                                                      value_template: >-
                                                        {{
                                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Free
                                                        Cooling'}}
                                            alias: CASO PDR OFF E INQUINANTI OFF
                                    alias: >-
                                      Interruttore PdR OFF e Interruttore Inquinanti
                                      ON
                                  - conditions:
                                      - condition: and
                                        conditions:
                                          - alias: Interruttore PdR OFF
                                            condition: template
                                            value_template: >-
                                              {{
                                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr')=='off'}}
                                          - alias: Interruttore Inquinanti OFF
                                            condition: template
                                            value_template: >-
                                              {{
                                              states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc')=='off'}}
                                    sequence:
                                      - choose:
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Allerta' or
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Allerta')}}
                                            sequence:
                                              - alias: >-
                                                  Ripeti Finchè Non Diventa Velocità
                                                  Freecooling
                                                repeat:
                                                  sequence:
                                                    - service: shell_command.vmc_master_freecooling
                                                      data: {}
                                                  until:
                                                    - condition: template
                                                      value_template: >-
                                                        {{
                                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Free
                                                        Cooling'}}
                                            alias: CASO PDR ON E INQUINANTI ON
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Nessuna Allerta' and
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Nessuna Allerta')}}
                                            sequence:
                                              - alias: >-
                                                  Ripeti Finchè Non Diventa Velocità
                                                  Freecooling
                                                repeat:
                                                  sequence:
                                                    - service: shell_command.vmc_master_freecooling
                                                      data: {}
                                                  until:
                                                    - condition: template
                                                      value_template: >-
                                                        {{
                                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Free
                                                        Cooling'}}
                                            alias: CASO PDR ON E INQUINANTI OFF
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Allerta' or
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Allerta')}}
                                            sequence:
                                              - alias: >-
                                                  Ripeti Finchè Non Diventa Velocità
                                                  Freecooling
                                                repeat:
                                                  sequence:
                                                    - service: shell_command.vmc_master_freecooling
                                                      data: {}
                                                  until:
                                                    - condition: template
                                                      value_template: >-
                                                        {{
                                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Free
                                                        Cooling'}}
                                            alias: CASO PDR OFF E INQUINANTI ON
                                          - conditions:
                                              - condition: template
                                                value_template: >-
                                                  {{
                                                  states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                                  ne sconsiglia l\'impiego" and
                                                  (states('sensor.vmc_master_alert_monitoraggio_co2')
                                                  == 'Nessuna Allerta' and
                                                  states('sensor.vmc_master_alert_monitoraggio_voc')
                                                  == 'Nessuna Allerta')}}
                                            sequence:
                                              - alias: >-
                                                  Ripeti Finchè Non Diventa Velocità
                                                  Freecooling
                                                repeat:
                                                  sequence:
                                                    - service: shell_command.vmc_master_freecooling
                                                      data: {}
                                                  until:
                                                    - condition: template
                                                      value_template: >-
                                                        {{
                                                        states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Free
                                                        Cooling'}}
                                            alias: CASO PDR OFF E INQUINANTI OFF
                                    alias: >-
                                      Interruttore PdR OFF e Interruttore Inquinanti
                                      OFF
                            alias: Spia Free Cooling OFF
                    alias: Programmato Mese Free Cooling
                  - conditions:
                      - alias: Verifica Programmato Mese Disabilitato
                        condition: template
                        value_template: >-
                          {{
                          states('sensor.vmc_master_status_mese_corrente_freeheating_o_freecooling')
                          == "Disabilitata" }}
                    sequence:
                      - choose:
                          - conditions:
                              - condition: and
                                conditions:
                                  - condition: template
                                    value_template: >-
                                      {{
                                      states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr')=='on'}}
                                    alias: Interruttore PdR ON
                                  - condition: template
                                    value_template: >-
                                      {{
                                      states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc')=='on'}}
                                    alias: Interruttore Inquinanti ON
                            sequence:
                              - choose:
                                  - conditions:
                                      - condition: template
                                        value_template: >-
                                          {{
                                          states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                          ne sconsiglia l\'impiego" and
                                          (states('sensor.vmc_master_alert_monitoraggio_co2')
                                          == 'Allerta' or
                                          states('sensor.vmc_master_alert_monitoraggio_voc')
                                          == 'Allerta')}}
                                    sequence:
                                      - service: input_boolean.turn_on
                                        metadata: {}
                                        data: {}
                                        target:
                                          entity_id:
                                            - >-
                                              input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio
                                            - >-
                                              input_boolean.vmc_master_spia_velocita_freecooling_co2_o_voc
                                      - alias: >-
                                          Ripeti Finchè Non Diventa Velocità
                                          Freecooling
                                        repeat:
                                          sequence:
                                            - service: shell_command.vmc_master_freecooling
                                              data: {}
                                          until:
                                            - condition: template
                                              value_template: >-
                                                {{
                                                states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Free
                                                Cooling'}}
                                    alias: CASO PDR ON E INQUINANTI ON
                                  - conditions:
                                      - condition: template
                                        value_template: >-
                                          {{
                                          states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                          ne sconsiglia l\'impiego" and
                                          (states('sensor.vmc_master_alert_monitoraggio_co2')
                                          == 'Nessuna Allerta' and
                                          states('sensor.vmc_master_alert_monitoraggio_voc')
                                          == 'Nessuna Allerta')}}
                                    sequence:
                                      - service: input_boolean.turn_on
                                        metadata: {}
                                        data: {}
                                        target:
                                          entity_id: >-
                                            input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio
                                      - alias: Ripeti Finchè Non Diventa Velocità 0
                                        repeat:
                                          sequence:
                                            - service: shell_command.vmc_master_velocita_0
                                              data: {}
                                          until:
                                            - condition: template
                                              value_template: >-
                                                {{
                                                states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                                0'}}
                                    alias: CASO PDR ON E INQUINANTI OFF
                                  - conditions:
                                      - condition: template
                                        value_template: >-
                                          {{
                                          states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                          ne sconsiglia l\'impiego" and
                                          (states('sensor.vmc_master_alert_monitoraggio_co2')
                                          == 'Allerta' or
                                          states('sensor.vmc_master_alert_monitoraggio_voc')
                                          == 'Allerta')}}
                                    sequence:
                                      - service: input_boolean.turn_on
                                        metadata: {}
                                        data: {}
                                        target:
                                          entity_id:
                                            - >-
                                              input_boolean.vmc_master_spia_velocita_freecooling_co2_o_voc
                                      - alias: >-
                                          Ripeti Finchè Non Diventa Velocità
                                          Freecooling
                                        repeat:
                                          sequence:
                                            - service: shell_command.vmc_master_freecooling
                                              data: {}
                                          until:
                                            - condition: template
                                              value_template: >-
                                                {{
                                                states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Free
                                                Cooling'}}
                                    alias: CASO PDR OFF E INQUINANTI ON
                                  - conditions:
                                      - condition: template
                                        value_template: >-
                                          {{
                                          states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                          ne sconsiglia l\'impiego" and
                                          (states('sensor.vmc_master_alert_monitoraggio_co2')
                                          == 'Nessuna Allerta' and
                                          states('sensor.vmc_master_alert_monitoraggio_voc')
                                          == 'Nessuna Allerta')}}
                                    sequence:
                                      - alias: >-
                                          Ripeti Finchè Non Diventa Velocità
                                          Freecooling
                                        repeat:
                                          sequence:
                                            - service: shell_command.vmc_master_freecooling
                                              data: {}
                                          until:
                                            - condition: template
                                              value_template: >-
                                                {{
                                                states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Free
                                                Cooling'}}
                                    alias: CASO PDR OFF E INQUINANTI OFF
                            alias: Interruttore PdR ON e Interruttore Inquinanti ON
                          - conditions:
                              - condition: and
                                conditions:
                                  - condition: template
                                    value_template: >-
                                      {{
                                      states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr')=='on'}}
                                    alias: Interruttore PdR ON
                                  - alias: Interruttore Inquinanti OFF
                                    condition: template
                                    value_template: >-
                                      {{
                                      states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc')=='off'}}
                            sequence:
                              - choose:
                                  - conditions:
                                      - condition: template
                                        value_template: >-
                                          {{
                                          states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                          ne sconsiglia l\'impiego" and
                                          (states('sensor.vmc_master_alert_monitoraggio_co2')
                                          == 'Allerta' or
                                          states('sensor.vmc_master_alert_monitoraggio_voc')
                                          == 'Allerta')}}
                                    sequence:
                                      - service: input_boolean.turn_on
                                        metadata: {}
                                        data: {}
                                        target:
                                          entity_id:
                                            - >-
                                              input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio
                                      - alias: Ripeti Finchè Non Diventa Velocità 0
                                        repeat:
                                          sequence:
                                            - service: shell_command.vmc_master_velocita_0
                                              data: {}
                                          until:
                                            - condition: template
                                              value_template: >-
                                                {{
                                                states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                                0'}}
                                    alias: CASO PDR ON E INQUINANTI ON
                                  - conditions:
                                      - condition: template
                                        value_template: >-
                                          {{
                                          states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                          ne sconsiglia l\'impiego" and
                                          (states('sensor.vmc_master_alert_monitoraggio_co2')
                                          == 'Nessuna Allerta' and
                                          states('sensor.vmc_master_alert_monitoraggio_voc')
                                          == 'Nessuna Allerta')}}
                                    sequence:
                                      - service: input_boolean.turn_on
                                        metadata: {}
                                        data: {}
                                        target:
                                          entity_id: >-
                                            input_boolean.vmc_master_spia_velocita_freecooling_un_solo_avvio
                                      - alias: Ripeti Finchè Non Diventa Velocità 0
                                        repeat:
                                          sequence:
                                            - service: shell_command.vmc_master_velocita_0
                                              data: {}
                                          until:
                                            - condition: template
                                              value_template: >-
                                                {{
                                                states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Velocità
                                                0'}}
                                    alias: CASO PDR ON E INQUINANTI OFF
                                  - conditions:
                                      - condition: template
                                        value_template: >-
                                          {{
                                          states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                          ne sconsiglia l\'impiego" and
                                          (states('sensor.vmc_master_alert_monitoraggio_co2')
                                          == 'Allerta' or
                                          states('sensor.vmc_master_alert_monitoraggio_voc')
                                          == 'Allerta')}}
                                    sequence:
                                      - alias: >-
                                          Ripeti Finchè Non Diventa Velocità
                                          Freecooling
                                        repeat:
                                          sequence:
                                            - service: shell_command.vmc_master_freecooling
                                              data: {}
                                          until:
                                            - condition: template
                                              value_template: >-
                                                {{
                                                states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Free
                                                Cooling'}}
                                    alias: CASO PDR OFF E INQUINANTI ON
                                  - conditions:
                                      - condition: template
                                        value_template: >-
                                          {{
                                          states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                          ne sconsiglia l\'impiego" and
                                          (states('sensor.vmc_master_alert_monitoraggio_co2')
                                          == 'Nessuna Allerta' and
                                          states('sensor.vmc_master_alert_monitoraggio_voc')
                                          == 'Nessuna Allerta')}}
                                    sequence:
                                      - alias: >-
                                          Ripeti Finchè Non Diventa Velocità
                                          Freecooling
                                        repeat:
                                          sequence:
                                            - service: shell_command.vmc_master_freecooling
                                              data: {}
                                          until:
                                            - condition: template
                                              value_template: >-
                                                {{
                                                states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Free
                                                Cooling'}}
                                    alias: CASO PDR OFF E INQUINANTI OFF
                            alias: Interruttore PdR ON e Interruttore Inquinanti OFF
                          - conditions:
                              - condition: and
                                conditions:
                                  - alias: Interruttore PdR OFF
                                    condition: template
                                    value_template: >-
                                      {{
                                      states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr')=='off'}}
                                  - condition: template
                                    value_template: >-
                                      {{
                                      states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc')=='on'}}
                                    alias: Interruttore Inquinanti ON
                            sequence:
                              - choose:
                                  - conditions:
                                      - condition: template
                                        value_template: >-
                                          {{
                                          states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                          ne sconsiglia l\'impiego" and
                                          (states('sensor.vmc_master_alert_monitoraggio_co2')
                                          == 'Allerta' or
                                          states('sensor.vmc_master_alert_monitoraggio_voc')
                                          == 'Allerta')}}
                                    sequence:
                                      - service: input_boolean.turn_on
                                        metadata: {}
                                        data: {}
                                        target:
                                          entity_id:
                                            - >-
                                              input_boolean.vmc_master_spia_velocita_freecooling_co2_o_voc
                                      - alias: >-
                                          Ripeti Finchè Non Diventa Velocità
                                          Freecooling
                                        repeat:
                                          sequence:
                                            - service: shell_command.vmc_master_freecooling
                                              data: {}
                                          until:
                                            - condition: template
                                              value_template: >-
                                                {{
                                                states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Free
                                                Cooling'}}
                                    alias: CASO PDR ON E INQUINANTI ON
                                  - conditions:
                                      - condition: template
                                        value_template: >-
                                          {{
                                          states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                          ne sconsiglia l\'impiego" and
                                          (states('sensor.vmc_master_alert_monitoraggio_co2')
                                          == 'Nessuna Allerta' and
                                          states('sensor.vmc_master_alert_monitoraggio_voc')
                                          == 'Nessuna Allerta')}}
                                    sequence:
                                      - alias: >-
                                          Ripeti Finchè Non Diventa Velocità
                                          Freecooling
                                        repeat:
                                          sequence:
                                            - service: shell_command.vmc_master_freecooling
                                              data: {}
                                          until:
                                            - condition: template
                                              value_template: >-
                                                {{
                                                states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Free
                                                Cooling'}}
                                    alias: CASO PDR ON E INQUINANTI OFF
                                  - conditions:
                                      - condition: template
                                        value_template: >-
                                          {{
                                          states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                          ne sconsiglia l\'impiego" and
                                          (states('sensor.vmc_master_alert_monitoraggio_co2')
                                          == 'Allerta' or
                                          states('sensor.vmc_master_alert_monitoraggio_voc')
                                          == 'Allerta')}}
                                    sequence:
                                      - service: input_boolean.turn_on
                                        metadata: {}
                                        data: {}
                                        target:
                                          entity_id:
                                            - >-
                                              input_boolean.vmc_master_spia_velocita_freecooling_co2_o_voc
                                      - alias: >-
                                          Ripeti Finchè Non Diventa Velocità
                                          Freecooling
                                        repeat:
                                          sequence:
                                            - service: shell_command.vmc_master_freecooling
                                              data: {}
                                          until:
                                            - condition: template
                                              value_template: >-
                                                {{
                                                states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Free
                                                Cooling'}}
                                    alias: CASO PDR OFF E INQUINANTI ON
                                  - conditions:
                                      - condition: template
                                        value_template: >-
                                          {{
                                          states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                          ne sconsiglia l\'impiego" and
                                          (states('sensor.vmc_master_alert_monitoraggio_co2')
                                          == 'Nessuna Allerta' and
                                          states('sensor.vmc_master_alert_monitoraggio_voc')
                                          == 'Nessuna Allerta')}}
                                    sequence:
                                      - alias: >-
                                          Ripeti Finchè Non Diventa Velocità
                                          Freecooling
                                        repeat:
                                          sequence:
                                            - service: shell_command.vmc_master_freecooling
                                              data: {}
                                          until:
                                            - condition: template
                                              value_template: >-
                                                {{
                                                states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Free
                                                Cooling'}}
                                    alias: CASO PDR OFF E INQUINANTI OFF
                            alias: Interruttore PdR OFF e Interruttore Inquinanti ON
                          - conditions:
                              - condition: and
                                conditions:
                                  - alias: Interruttore PdR OFF
                                    condition: template
                                    value_template: >-
                                      {{
                                      states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_pdr')=='off'}}
                                  - alias: Interruttore Inquinanti OFF
                                    condition: template
                                    value_template: >-
                                      {{
                                      states('input_boolean.vmc_master_opzioni_accendi_spegni_vmc_vs_co2_e_voc')=='off'}}
                            sequence:
                              - choose:
                                  - conditions:
                                      - condition: template
                                        value_template: >-
                                          {{
                                          states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                          ne sconsiglia l\'impiego" and
                                          (states('sensor.vmc_master_alert_monitoraggio_co2')
                                          == 'Allerta' or
                                          states('sensor.vmc_master_alert_monitoraggio_voc')
                                          == 'Allerta')}}
                                    sequence:
                                      - alias: >-
                                          Ripeti Finchè Non Diventa Velocità
                                          Freecooling
                                        repeat:
                                          sequence:
                                            - service: shell_command.vmc_master_freecooling
                                              data: {}
                                          until:
                                            - condition: template
                                              value_template: >-
                                                {{
                                                states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Free
                                                Cooling'}}
                                    alias: CASO PDR ON E INQUINANTI ON
                                  - conditions:
                                      - condition: template
                                        value_template: >-
                                          {{
                                          states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')=="Se
                                          ne sconsiglia l\'impiego" and
                                          (states('sensor.vmc_master_alert_monitoraggio_co2')
                                          == 'Nessuna Allerta' and
                                          states('sensor.vmc_master_alert_monitoraggio_voc')
                                          == 'Nessuna Allerta')}}
                                    sequence:
                                      - alias: >-
                                          Ripeti Finchè Non Diventa Velocità
                                          Freecooling
                                        repeat:
                                          sequence:
                                            - service: shell_command.vmc_master_freecooling
                                              data: {}
                                          until:
                                            - condition: template
                                              value_template: >-
                                                {{
                                                states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Free
                                                Cooling'}}
                                    alias: CASO PDR ON E INQUINANTI OFF
                                  - conditions:
                                      - condition: template
                                        value_template: >-
                                          {{
                                          states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                          ne sconsiglia l\'impiego" and
                                          (states('sensor.vmc_master_alert_monitoraggio_co2')
                                          == 'Allerta' or
                                          states('sensor.vmc_master_alert_monitoraggio_voc')
                                          == 'Allerta')}}
                                    sequence:
                                      - alias: >-
                                          Ripeti Finchè Non Diventa Velocità
                                          Freecooling
                                        repeat:
                                          sequence:
                                            - service: shell_command.vmc_master_freecooling
                                              data: {}
                                          until:
                                            - condition: template
                                              value_template: >-
                                                {{
                                                states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Free
                                                Cooling'}}
                                    alias: CASO PDR OFF E INQUINANTI ON
                                  - conditions:
                                      - condition: template
                                        value_template: >-
                                          {{
                                          states('sensor.vmc_master_punto_di_rugiada_verifica_confronto')!="Se
                                          ne sconsiglia l\'impiego" and
                                          (states('sensor.vmc_master_alert_monitoraggio_co2')
                                          == 'Nessuna Allerta' and
                                          states('sensor.vmc_master_alert_monitoraggio_voc')
                                          == 'Nessuna Allerta')}}
                                    sequence:
                                      - alias: >-
                                          Ripeti Finchè Non Diventa Velocità
                                          Freecooling
                                        repeat:
                                          sequence:
                                            - service: shell_command.vmc_master_freecooling
                                              data: {}
                                          until:
                                            - condition: template
                                              value_template: >-
                                                {{
                                                states('sensor.vmc_master_status_ventola_lettura_codice_interpretato')=='Free
                                                Cooling'}}
                                    alias: CASO PDR OFF E INQUINANTI OFF
                            alias: Interruttore PdR OFF e Interruttore Inquinanti OFF
                    alias: Mese Disabilitato
    mode: restart
    icon: mdi:fingerprint-off
#------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
#------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

################### Fine Creazione Scripts ##############################################################################################################################################################################

################### Inizio Creazione dei Servizi ovvero i Comandi da impartire alla VMC ################################################################################################################################# [CONFIGURAZIONE 0 RICHIAMI] [INTERFACCIA, PIU’ RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI]
shell_command: 
  vmc_master_rimuovi_caratteri_di_ritorno: find /config/packages/vmc_helty_flow/master -type f -name "*.sh" -exec sed -i 's/\r$//' {} \;                                         # [AUTOMAZIONE] TROVA E RIMUOVE CARATTERI DI RITORNO IN TUTTI I FILES *.sh CONTENUTI NELLA CARTELLA
  vmc_master_aggiorna_indirizzo_ip:        bash /config/packages/vmc_helty_flow/master/vmc_master_script_cambio_ip.sh   {{ states('input_text.vmc_master_ip_insert') }}          # [AUTOMAZIONE] TROVA E SOSTITUISCE NEL FILE CORRENTE L'INDIRIZZO IP INSERITO NELL'INTERFACCIA, SE VIENE LANCIATO SENZA SPECIFICARE UN INDIRIZZO IP DI DEFAULT VERRA' INSERITO NEL FILE CORRENTE 192.168.1.160
  vmc_master_cambia_nome:                  bash /config/packages/vmc_helty_flow/master/vmc_master_script_cambio_nome.sh {{ states('input_text.vmc_master_nome_da_inserire') }}   # [AUTOMAZIONE] INVIO COMANDO PER CAMBIARE NOME ALLA VMC 
  vmc_master_freecooling:                  timeout 2s echo -e "VMWH0000007" | nc 192.168.1.160 5001                                                                              # [CONFIGURAZIONE] [INTERFACCIA] [AUTOMAZIONE] INVIO COMANDO Free Cool./Heat. ALLA VMC
  vmc_master_notturna:                     timeout 2s echo -e "VMWH0000006" | nc 192.168.1.160 5001                                                                              # [CONFIGURAZIONE] [INTERFACCIA] [AUTOMAZIONE] INVIO COMANDO NOTTURNA         ALLA VMC
  vmc_master_iperventilazione:             timeout 2s echo -e "VMWH0000005" | nc 192.168.1.160 5001                                                                              # [CONFIGURAZIONE] [INTERFACCIA] [AUTOMAZIONE] INVIO COMANDO IPERVENTILAZIONE ALLA VMC
  vmc_master_velocita_4:                   timeout 2s echo -e "VMWH0000004" | nc 192.168.1.160 5001                                                                              # [CONFIGURAZIONE] [INTERFACCIA] [AUTOMAZIONE] INVIO COMANDO VELOCITA' 4      ALLA VMC
  vmc_master_velocita_3:                   timeout 2s echo -e "VMWH0000003" | nc 192.168.1.160 5001                                                                              # [CONFIGURAZIONE] [INTERFACCIA] [AUTOMAZIONE] INVIO COMANDO VELOCITA' 3      ALLA VMC
  vmc_master_velocita_2:                   timeout 2s echo -e "VMWH0000002" | nc 192.168.1.160 5001                                                                              # [CONFIGURAZIONE] [INTERFACCIA] [AUTOMAZIONE] INVIO COMANDO VELOCITA' 2      ALLA VMC
  vmc_master_velocita_1:                   timeout 2s echo -e "VMWH0000001" | nc 192.168.1.160 5001                                                                              # [CONFIGURAZIONE] [INTERFACCIA] [AUTOMAZIONE] INVIO COMANDO VELOCITA' 1      ALLA VMC
  vmc_master_velocita_0:                   timeout 2s echo -e "VMWH0000000" | nc 192.168.1.160 5001                                                                              # [CONFIGURAZIONE] [INTERFACCIA] [AUTOMAZIONE] INVIO COMANDO VELOCITA' 0      ALLA VMC
  vmc_master_sensori_on:                   timeout 2s echo -e "VMWH0300000" | nc 192.168.1.160 5001                                                                              # [CONFIGURAZIONE] [INTERFACCIA] [AUTOMAZIONE]  INVIO COMANDO SENSORI  ON     ALLA VMC PER ACCENDERE   I SENSORI DELLA VMC; I valori rilevati dai sensori nella schermata INFO dell'App Mobile saranno disponibili e i relativi allarmi verrano segnalati
  vmc_master_sensori_off:                  timeout 2s echo -e "VMWH0300002" | nc 192.168.1.160 5001                                                                              # [CONFIGURAZIONE] [INTERFACCIA] [AUTOMAZIONE] INVIO COMANDO SENSORI  OFF     ALLA VMC PER DISATTIVARE I SENSORI DELLA VMC; I valori rilevati dai sensori nella schermata INFO dell'App Mobile NON saranno disponibili e i relativi allarmi NON verrano segnalati
  vmc_master_pannello_led_on:              timeout 2s echo -e "VMWH0100010" | nc 192.168.1.160 5001                                                                              # [CONFIGURAZIONE] [INTERFACCIA] [AUTOMAZIONE] INVIO COMANDO PANNELLO LED ON  ALLA VMC PER ATTIVARE    IL LED PANNELLO DEI COMANDI 
  vmc_master_pannello_led_off:             timeout 2s echo -e "VMWH0100000" | nc 192.168.1.160 5001                                                                              # [CONFIGURAZIONE] [INTERFACCIA] [AUTOMAZIONE] INVIO COMANDO PANNELLO LED OFF ALLA VMC PER DISATTIVARE IL LED PANNELLO DEI COMANDI
 ################### Fine Creazione dei Servizi ovvero i Comandi da impartire alla VMC   ###################################################################################################################################
