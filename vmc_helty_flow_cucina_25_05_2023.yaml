###########################################################################################################################################################################################################################
#                                                                                                                                                                                                                         #
#                                                                                VMC HELTY FLOW PLUS RELEASE 25-05-2023                                                                                                   #
# SVILUPPATO DA DANILO ROBOTTI, ALLE PRIME ARMI CON HOME ASSISTANT                                                                                                                                                        #
# SI INVITA A DIVULGARE IL CODICE PER RENDERLO SEMPRE PIU' EFFICACIE ED EFFICIENTE, ANCHE AL SOTTOSCRITTO! :)                                                                                                             #
# EMAIL: danilo.robotti@gmail.com                                                                                                                                                                                         #
#                                                                                                                                                                                                                         #
###########################################################################################################################################################################################################################

################### Sensori della VMC  ####################################################################################################################################################################################
#                                                                                                                                                                                                                         #
# I SENSORI PRINCIPALI UTILIZZATI PER L'ESTRAZIONE DEI DATI CONTENUTI NELLA VMC SONO:                                                                                                                                     #
#                                                                                                                                                                                                                         #
# - VMC_CUCINA_STATUS_IP                                                                                                                                                                                                  #
# - VMC_CUCINA_STATUS_VENTOLA                                                                                                                                                                                             #
# - VMC_CUCINA_SENSORI                                                                                                                                                                                                    #
# - VMC_CUCINA_NOME                                                                                                                                                                                                       #
# - VMC_CUCINA_LAN                                                                                                                                                                                                        #
#                                                                                                                                                                                                                         #
# I SENSORI SECONDARI PRINCIPALI UTILIZZATI PER LA RESTITUZIONE DELLA LETTURA DEI DATI ESTRATTI NELLA VMC:                                                                                                                #
#                                                                                                                                                                                                                         #
# - vmc_cucina_status_ip_interfaccia                                                                                                                                                                                      #
# - vmc_cucina_nome_status                                                                                                                                                                                                #
# - vmc_cucina_status_ventola_lettura_codice_interpretato                                                                                                                                                                 #
# - vmc_cucina_status_sensori_lettura_codice_interpretato                                                                                                                                                                 #
# - vmc_cucina_status_led_pannello_lettura_codice_interpretato                                                                                                                                                            #
#                                                                                                                                                                                                                         #
# - vmc_cucina_temp_interna_positivo_negativo  [FORMULA DA VERIFICARE (INDICE ARRAY) E/O METODO , NON AVENDO MAI VISUALIZZATO UNA TEMPERATURA NEGATIVA]                                                                   #
# - vmc_cucina_temp_esterna_positivo_negativo  [FORMULA DA VERIFICARE (INDICE ARRAY) E/O METODO , NON AVENDO MAI VISUALIZZATO UNA TEMPERATURA NEGATIVA]                                                                   #
# - vmc_cucina_temp_interna_status                                                                                                                                                                                        #
# - vmc_cucina_temp_esterna_status                                                                                                                                                                                        #
# - vmc_cucina_umidita_interna_status                                                                                                                                                                                     #
# - vmc_cucina_umidita_esterna_status          [SENSORE DI LETTURA UMIDITA' ESTERNA  MEMORIZZATA NELL'INTEGRAZIONE OPENWEATHERMAP, LO STESSO DOVRA' ESSERE INSTALLATO IN HOME ASSISTANT                                   #
#                                                                                                                                                                                                                         #
# - vmc_cucina_umidita_interna_status_verifica_soglia                                                                                                                                                                     #
# - vmc_cucina_congelamento_verifica_soglia                                                                                                                                                                               #
# - vmc_cucina_delta_temp_verifica_soglia                                                                                                                                                                                 #
# - vmc_cucina_punto_di_rugiada_interno                                                                                                                                                                                   #
# - vmc_cucina_punto_di_rugiada_esterno                                                                                                                                                                                   #
# - vmc_cucina_punto_di_rugiada_verifica_confronto                                                                                                                                                                        #
# - vmc_cucina_umidita_assoluta_interna                                                                                                                                                                                   #
# - vmc_cucina_umidita_assoluta_esterna                                                                                                                                                                                   #
# - vmc_cucina_alert_monitoraggio                                                                                                                                                                                         #
# - vmc_cucina_status_calcolo_portata_ventola                                                                                                                                                                             #
# - vmc_cucina_status_accensione_vmc_tramite_calendario                                                                                                                                                                   #
# - vmc_cucina_status_spegnimento_vmc_tramite_calendario                                                                                                                                                                  #
#                                                                                                                                                                                                                         #
# I SENSORI SECONDARI PRINCIPALI UTILIZZATI PER RACCOLTA DEI DATI (INPUT ETICHETTE) CORRRELATI AI RISPETTIVI SENSORI IMPIEGATI NELL'INTERFACCIA GRAFICA                                                                   #
#                                                                                                                                                                                                                         #
# - vmc_cucina_volume_da_inserire                                                                                                                                                                                         #
# - vmc_cucina_accensione_[giorno]                                                                                                                                                                                        #
# - vmc_cucina_spegnimento_[giorno]                                                                                                                                                                                       #
#                                                                                                                                                                                                                         #
#                                                                                                                                                                                                                         #
#     LETTURA OGNI n SECONDI SULLO STATUS DELLA VENTOLA ATTRAVERSO IL SENSORE VMC_CUCINA_STATUS_VENTOLA, CHE ASSUME IL VALORE LETTO NELL'INDICE [1] DELL'ARRAY, TRAMITE IL COMANDO PAYLOAD "VMGH?" INVIATO ALLA VMC       #
#                                                                                                                                                                                                                         #
#     ES: DI OUTPUT DI DEFAULT DELLA VMC:  VMGO,00001,00000,00000,00000,00000,00000,00000,00000,00000,00000,00000,00000,00000,00000,00000                                                                                 #
#     POSIZIONE INDICE ARRAY:              [0]  [1]   [2]   [3]   [4]   [5]   [6]   [7]   [8]   [9]   [10]  [11]  [12]  [13]  [14]  [15]                                                                                  #
#                                                                                                                                                                                                                         #
#                                               00000 = VELOCITA' 0     , ATTRAVERSO L'AUTOMAZIONE, LANCIA IL SERVIZIO: vmc_cucina_velocita_0                                                                             #
#                                               00001 = VELOCITA' 1     , ATTRAVERSO L'AUTOMAZIONE, LANCIA IL SERVIZIO: vmc_cucina_velocita_1                                                                             #
#                                               00002 = VELOCITA' 2     , ATTRAVERSO L'AUTOMAZIONE, LANCIA IL SERVIZIO: vmc_cucina_velocita_2                                                                             #
#                                               00003 = VELOCITA' 3     , ATTRAVERSO L'AUTOMAZIONE, LANCIA IL SERVIZIO: vmc_cucina_velocita_3                                                                             #
#                                               00004 = VELOCITA' 4     , ATTRAVERSO L'AUTOMAZIONE, LANCIA IL SERVIZIO: vmc_cucina_velocita_4                                                                             #
#                                               00005 = IPERVENTILAZIONE, ATTRAVERSO L'AUTOMAZIONE, LANCIA IL SERVIZIO: vmc_cucina_iperventilazione                                                                       #
#                                               00006 = NOTTE           , ATTRAVERSO L'AUTOMAZIONE, LANCIA IL SERVIZIO: vmc_cucina_notte                                                                                  #
#                                               00007 = FREECOOLING     , ATTRAVERSO L'AUTOMAZIONE, LANCIA IL SERVIZIO: vmc_cucina_freecooling                                                                            #
#                                                                                                                                                                                                                         #
###########################################################################################################################################################################################################################

################### Inizio Creazione Sensori Principali della VMC  ########################################################################################################################################################
sensor:
  - platform: command_line                     # [CONFIGURAZIONE, 0 RICHIAMI] CREAZIONE DEL SENSORE PER VERIFICARE SE LA VMC E' ON LINE O MENO
    name: VMC_CUCINA_STATUS_IP
    command: ping -c 1 192.168.1.160 >/dev/null && echo 'ON-Line' || echo 'OFF-Line'
    scan_interval:
      seconds: 60                              # OGNI N° SECONDI RIPETE LA SCANSIONE [IL VALORE IMPATTA SULL'AUTOMAZIONE "ID Verifica ogni N° Secondi", PERTANTO, ASSICURARSI DI IMPOSTARE NELL'AUTOMAZIONE "ID Verifica ogni N° Secondi" UN VALORE MINORE O UGUALE; PIU' IL VALORE E' BASSO PIù IL SISTEMA DIVENTA IN REAL-TIME]

  - platform: tcp
    name: VMC_CUCINA_STATUS_VENTOLA            # [CONFIGURAZIONE, PIU’ RICHIAMI] [INTERFACCIA, PIU’ RICHIAMI] CREAZIONE DEL SENSORE LETTURA STATI DI VENTILAZIONE; N.b non tutti i valori sono identificabili
    host: 192.168.1.160                        # INDIRIZZO IP DELLA VMC CUCINA
    port: 5001                                 # PORTA 5001 DELLA VMC IMPOSTAZIONE DI DEFAULT
    timeout: 15
    payload: "VMGH?"                           # INVIO COMANDO VMGH? ALLA VMC CUCINA, PER OTTENERE INFORMAZIONI SULLO STATO DI VENTILAZIONE DELLA VMC]
    scan_interval:                             # OGNI n SECONDI RIPETE LA SCANSIONE [SE SI COMANDA LA VMC CON IL TELECOMANDO L'AUTOMAZIONE LO RILEVERA' AD OGNI scan_interval -> seconds]
      seconds: 5                               # OGNI N° SECONDI RIPETE LA SCANSIONE

  - platform: tcp
    name: VMC_CUCINA_SENSORI                   # [CONFIGURAZIONE, PIU’ RICHIAMI] [INTERFACCIA, PIU’ RICHIAMI] CREAZIONE DEL SENSORE LETTURA SENSORI; N.b non tutti i valori sono identificabili
    host: 192.168.1.160                        # INDIRIZZO IP DELLA VMC CUCINA
    port: 5001                                 # PORTA 5001 DELLA VMC IMPOSTAZIONE DI DEFAULT
    timeout: 15
    payload: "VMGI?"                           # INVIO COMANDO VMGI? ALLA VMC CUCINA, PER OTTENERE INFORMAZIONI SUI SENSORI DELLA VMC]
    scan_interval:
      seconds: 1200                            # OGNI N° SECONDI RIPETE LA SCANSIONE

  - platform: tcp
    name: VMC_CUCINA_NOME                      # [CONFIGURAZIONE, PIU’ RICHIAMI] [INTERFACCIA, PIU’ RICHIAMI] CREAZIONE DEL SENSORE LETTURA NOME DELLA VMC
    host: 192.168.1.160                        # INDIRIZZO IP DELLA VMC CUCINA
    port: 5001                                 # PORTA 5001 DELLA VMC IMPOSTAZIONE DI DEFAULT
    timeout: 15
    payload: "VMNM?"                           # INVIO COMANDO VMNM? ALLA VMC CUCINA, PER OTTENERE INFORMAZIONI SUL NOME DELLA VMC]
    scan_interval:
      seconds: 43200                           # OGNI N° SECONDI RIPETE LA SCANSIONE

  - platform: tcp
    name: VMC_CUCINA_LAN                       # [CONFIGURAZIONE, 0 RICHIAMI] [INTERFACCIA, PIU’ RICHIAMI] CREAZIONE DEL SENSORE LETTURA DATI LAN DELLA VMC; N.b non tutti i valori sono identificabili
    host: 192.168.1.160                        # INDIRIZZO IP DELLA VMC CUCINA
    port: 5001                                 # PORTA 5001 DELLA VMC IMPOSTAZIONE DI DEFAULT
    timeout: 15
    payload: "VMSL?"                           # INVIO COMANDO VMSL? ALLA VMC CUCINA, PER OTTENERE INFORMAZIONI SUI DATI LAN DELLA VMC]
    scan_interval:
      seconds: 43200                           # OGNI N° SECONDI RIPETE LA SCANSIONE
################### Fine Creazione Sensori Principali della VMC  ##########################################################################################################################################################

################### Inizio Creazione Sensori di Lettura Collegamento tramite Status IP, Nome, Stato Ventola, Stato Sensoristico, Stato Led Pannello della VMC  ############################################################
  - platform: template
    sensors:
      vmc_cucina_status_ip_interfaccia:                                        # [CONFIGURAZIONE 0 RICHIAMI] [INTERFACCIA, PIU’ RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI] SENSORE IMPIEGATO PER LA VISUALIZZAZIONE NELL'INTERFACCIA SE LA VMC E' IN RETE O MENO
        friendly_name: "Status VMC"
        value_template: >
          {% set stati = ['OFF-Line'] %}
          {{ 'OFF-Line' if states('sensor.vmc_cucina_status_ip') in stati else 'ON-Line' }}
        icon_template: >
          {% if states('sensor.vmc_cucina_status_ip') == 'OFF-Line' %}
            mdi:fan-alert
          {% else %}
            mdi:fan-chevron-down
          {% endif %}

      vmc_cucina_nome_status:                                                  # [CONFIGURAZIONE 0 RICHIAMI] [INTERFACCIA PIU’ RICHIAMI] SENSORE DI VERIFICA DI AVVENUTA LETTURA NOME MEMORIZZATA NELLA VMC
        friendly_name: "Nome"
        value_template: >
          {% set stati = ['unknown', 'unavailable'] %}
          {% set vmc_nome = states('sensor.vmc_cucina_nome') %}
          {% if vmc_nome.split(" ")|length >= 2 %}
            {{ vmc_nome.split(" ")[1] }}
          {% else %}
            Non disponibile
          {% endif %}
        icon_template: mdi:label-variant

      vmc_cucina_ip:                                                           # [CONFIGURAZIONE 0 RICHIAMI] [INTERFACCIA PIU’ RICHIAMI] SENSORE PER VISUALIZZARE L'IP NELL'INTERFACCIA
        friendly_name: "Internet Protocol Address"
        value_template: >
            192.168.1.168 su Porta 5001
        icon_template: mdi:ip

      vmc_cucina_status_ventola_lettura_codice:                                # [CONFIGURAZIONE 0 RICHIAMI] SENSORE DI LETTURA DEI DATI "VELOCITA'" MEMORIZZATI NELLA VMC, PREVIA VERIFICA DI AVVENUTA LETTURA DEI DATI "VELOCITA'" MEMORIZZATI NELLA VMC
        friendly_name: "Codice Status Ventilazione"
        value_template: >
          {% set stati = ['unknown', 'unavailable'] %}
          {% set valid_stati = ['00000', '00001', '00002', '00003', '00004', '00005', '00006', '00007'] %}
          {{ 'Non disponibile' if states('sensor.vmc_cucina_status_ventola') in stati else 
          (states('sensor.vmc_cucina_status_ventola').split(',')[1] if states('sensor.vmc_cucina_status_ventola').split(',')[1] in valid_stati else 'Non disponibile') }}
        icon_template: mdi:code-array       

      vmc_cucina_status_ventola_lettura_codice_interpretato:                   # [CONFIGURAZIONE 0 RICHIAMI] [INTERFACCIA, PIU’ RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI] SENSORE DI INTERPRETAZIONE DELLA LETTURA DEI DATI "VELOCITA'" MEMORIZZATI NELLA VMC CONVERITA IN "STRINGA", PREVIA VERIFICA DI AVVENUTA LETTURA DEI DATI "VELOCITA'"" MEMORIZZATI NELLA VMC
        friendly_name: "Status Ventilazione"
        value_template: >
          {% set stati = ['unknown', 'unavailable'] %}
          {% set codici = {'00000': 'Velocità 0', '00001': 'Velocità 1', '00002': 'Velocità 2', '00003': 'Velocità 3', 
                           '00004': 'Velocità 4', '00005': 'Iperventilazione', '00006': 'Notturna', '00007': 'Free Cooling'} %}
          {{ 'Non disponibile' if states('sensor.vmc_cucina_status_ventola') in stati else 
          (codici.get(states('sensor.vmc_cucina_status_ventola').split(',')[1], 'Non disponibile')) }}
        icon_template: mdi:fan    
 
      vmc_cucina_status_sensori_lettura_codice_interpretato:                   # [CONFIGURAZIONE 0 RICHIAMI] [INTERFACCIA PIU’ RICHIAMI] SENSORE DI INTERPRETAZIONE DELL'ATTIVAZIONE O MENO DELLE ROUTINE MEMORIZZATE NELLA VMC (ES. SE PRESENTE ALLARME UMIDITA' -> MASSIMA VELOCITA'), CORRELATE AI SENSORI DELLA VMC CONVERITA IN "STRINGA", PREVIA VERIFICA DI AVVENUTA LETTURA DEI DATI "VELOCITA'" MEMORIZZATI NELLA VMC
        friendly_name: "Status Routine Sensori"
        value_template: >
          {% set stati = ['unknown', 'unavailable'] %}
          {% set codici = {'00003': 'Spenti', '00001': 'Accesi', '00002': 'Spenti', '00000': 'Accesi'} %}
          {{ 'Non disponibile' if states('sensor.vmc_cucina_status_ventola') in stati else 
          (codici.get(states('sensor.vmc_cucina_status_ventola').split(',')[4], 'Non disponibile')) }}
        icon_template: mdi:chip     

      vmc_cucina_status_led_pannello_lettura_codice_interpretato:              # [CONFIGURAZIONE 0 RICHIAMI] [INTERFACCIA PIU’ RICHIAMI] SENSORE DI INTERPRETAZIONE DELLA LETTURA DELL'ATTIVAZIONE O MENO DEL PANNELLO LED MEMORIZZATI NELLA VMC, PREVIA VERIFICA DI AVVENUTA LETTURA DEI DATI "VELOCITA'" MEMORIZZATI NELLA VMC
        friendly_name: "Status Led Pannello"
        value_template: >
          {% set stati = ['unknown', 'unavailable'] %}
          {% set codici = {'00000': 'Spento'} %}
          {{ 'Non disponibile' if states('sensor.vmc_cucina_status_ventola') in stati else 
          (codici.get(states('sensor.vmc_cucina_status_ventola').split(',')[14], 'Acceso')) }}
        icon_template: mdi:led-on    
################### Fine Creazione Sensori di Lettura Collegamento tramite Status IP, Nome, Stato Ventola, Stato Sensoristico, Stato Led Pannello della VMC  #################################################################

################### Inizio Creazione Sensori di Lettura Temp. Interna, Esterna, Umidità della VMC  #################################################################################################################
      vmc_cucina_temp_interna_positivo_negativo:                               # [CONFIGURAZIONE, PIU’ RICHIAMI] SENSORE PER DETERMINARE SE IL VALORE DELLA TEMEPARTURA INTERNA SARA' POSITIVA O NEGATIVA; ATTENZIONE E' UNA PRESUNZIONE DELLO SCRIVENTE IN QUANTO NON HO MAI VISUALIZZATO UNA TEMPERATURA NEGATIVA NELLA VMC, VERIFICA CHE NELLA POSIZIONE DELL'ARRAY [1] IL PRIMO NUMERO E' 1 ES. [10200], OVVERO -20,0 °C
        friendly_name: "Segno Temperatura Interna"
        value_template: >
          {% set stati = ['unknown', 'unavailable'] %}
          {% if states('sensor.vmc_cucina_sensori') in stati %}
            Non disponibile
          {% else %} 
            {% if int(states('sensor.vmc_cucina_sensori').split(',')[1][0]) == 1 %}
             negativo
            {% else %}
              positivo
            {% endif %}
          {% endif %}
        icon_template: mdi:home-thermometer

      vmc_cucina_temp_esterna_positivo_negativo:                               # [CONFIGURAZIONE, PIU’ RICHIAMI] SENSORE PER DETERMINARE SE IL VALORE DELLA TEMEPARTURA ESTERNA SARA' POSITIVA O NEGATIVA; ATTENZIONE E' UNA PRESUNZIONE DELLO SCRIVENTE IN QUANTO NON HO MAI VISUALIZZATO UNA TEMPERATURA NEGATIVA NELLA VMC, VERIFICA CHE NELLA POSIZIONE DELL'ARRAY [2] IL PRIMO NUMERO E' 1 ES. [10300], OVVERO -30,0 °C
        friendly_name: "Segno Temperatura Interna"
        value_template: >
          {% set stati = ['unknown', 'unavailable'] %}
          {% if states('sensor.vmc_cucina_sensori') in stati %}
            Non disponibile
          {% else %} 
            {% if int(states('sensor.vmc_cucina_sensori').split(',')[2][0]) == 1 %}
             negativo
            {% else %}
              positivo
            {% endif %}
          {% endif %}
        icon_template: mdi:home-thermometer-outline 

      vmc_cucina_temp_interna_status:                                          # [CONFIGURAZIONE, PIU’ RICHIAMI] [INTERFACCIA, PIU’ RICHIAMI] SENSORE DI LETTURA TEMPERATURA INTERNA MEMORIZZATA NELLA VMC + OFFSET MANUALE, PREVIA VERIFICA DI AVVENUTA LETTURA DEI DATI "SENSORI" MEMORIZZATI NELLA VMC; ATTENZIONE NELLA PRESUNZIONE NEL CALCOLO DI VERIFICA SE LA TEMPERATURA E' POSITIVA O NEGATIVA; SE IL PRIMO VALORE DEL PRIMO CAMPO [1] DELL'ARRAY E' 1 IL CALCOLO VERRA' ESEGUITO ESCLUDENDO IL PRIMO VALORE [1][1:] ES. 10200 -> 0200 -> -20,0 °C
        friendly_name: "Temperatura [°C]" 
        value_template: >
          {% set stati = ['unknown', 'unavailable'] %}
          {% if states('sensor.vmc_cucina_sensori') in stati %}
            Non disponibile
          {% else %} 
            {% set raw_temp = states('sensor.vmc_cucina_sensori') %}
            {% set temp_interna_positivo = float(int(raw_temp.split(',')[1]) / 10) + float(states('input_number.vmc_cucina_offset_temp_interna')) %}
            {% set temp_interna_negativo = (- (float(int(raw_temp.split(',')[1][1:]) / 10))) + float(states('input_number.vmc_cucina_offset_temp_interna')) %}
            {% if states('sensor.vmc_cucina_temp_interna_positivo_negativo') == "negativo" %}
              {{ temp_interna_negativo | round(1) }}
            {% else %}
              {{ temp_interna_positivo | round(1) }}
            {% endif %}
          {% endif %}
        icon_template: mdi:home-thermometer

      vmc_cucina_temp_esterna_status:                                          # [CONFIGURAZIONE, PIU’ RICHIAMI] [INTERFACCIA, PIU’ RICHIAMI] SENSORE DI LETTURA TEMPERATURA INTERNA MEMORIZZATA NELLA VMC + OFFSET MANUALE, PREVIA VERIFICA DI AVVENUTA LETTURA DEI DATI "SENSORI" MEMORIZZATI NELLA VMC; ATTENZIONE NELLA PRESUNZIONE NEL CALCOLO DI VERIFICA SE LA TEMPERATURA E' POSITIVA O NEGATIVA; SE IL PRIMO VALORE DEL SECONDO CAMPO [2] DELL'ARRAY E' 1 IL CALCOLO VERRA' ESEGUITO ESCLUDENDO IL PRIMO VALORE [2][1:] ES. 10200 -> 0200 -> -20,0 °C
        friendly_name: "Temperatura Esterna [°C]" 
        value_template: >
          {% set stati = ['unknown', 'unavailable'] %}
          {% if states('sensor.vmc_cucina_sensori') in stati %}
            Non disponibile
          {% else %} 
            {% set raw_temp = states('sensor.vmc_cucina_sensori') %}
            {% set temp_esterna_positivo = float(int(raw_temp.split(',')[2]) / 10) + float(states('input_number.vmc_cucina_offset_temp_esterna')) %}
            {% set temp_esterna_negativo = (- (float(int(raw_temp.split(',')[2][1:]) / 10))) + float(states('input_number.vmc_cucina_offset_temp_esterna')) %}
            {% if states('sensor.vmc_cucina_temp_esterna_positivo_negativo') == "negativo" %}
              {{ temp_esterna_negativo | round(1) }}
            {% else %}
              {{ temp_esterna_positivo | round(1) }}
            {% endif %}
          {% endif %}
        icon_template: mdi:home-thermometer-outline

      vmc_cucina_temp_interna_status_senza_offset:                             # [CONFIGURAZIONE, PIU’ RICHIAMI] SENSORE DI LETTURA TEMPERATURA INTERNA MEMORIZZATA NELLA VMC SENZA OFFSET MANUALE, PREVIA VERIFICA DI AVVENUTA LETTURA DEI DATI "SENSORI" MEMORIZZATI NELLA VMC; ATTENZIONE NELLA PRESUNZIONE NEL CALCOLO DI VERIFICA SE LA TEMPERATURA E' POSITIVA O NEGATIVA; SE IL PRIMO VALORE DEL PRIMO CAMPO [1] DELL'ARRAY E' 1 IL CALCOLO VERRA' ESEGUITO ESCLUDENDO IL PRIMO VALORE [1][1:] ES. 10200 -> 0200 -> -20,0 °C
        friendly_name: "Temperatura OffSet disattivato [°C]" 
        value_template: >
          {% set stati = ['unknown', 'unavailable'] %}
          {% if states('sensor.vmc_cucina_sensori') in stati %}
            Non disponibile
          {% else %} 
            {% set raw_temp = states('sensor.vmc_cucina_sensori') %}
            {% set temp_interna_positivo = float(int(raw_temp.split(',')[1]) / 10) %}
            {% set temp_interna_negativo = (- (float(int(raw_temp.split(',')[1][1:]) / 10))) %}
            {% if states('sensor.vmc_cucina_temp_interna_positivo_negativo') == "negativo" %}
              {{ temp_interna_negativo | round(1) }}
            {% else %}
              {{ temp_interna_positivo | round(1) }}
            {% endif %}
          {% endif %}
        icon_template: mdi:home-thermometer

      vmc_cucina_temp_esterna_status_senza_offset:                             # [CONFIGURAZIONE, PIU’ RICHIAMI] SENSORE DI LETTURA TEMPERATURA INTERNA MEMORIZZATA NELLA VMC SENZA OFFSET MANUALE, PREVIA VERIFICA DI AVVENUTA LETTURA DEI DATI "SENSORI" MEMORIZZATI NELLA VMC; ATTENZIONE NELLA PRESUNZIONE NEL CALCOLO DI VERIFICA SE LA TEMPERATURA E' POSITIVA O NEGATIVA; SE IL PRIMO VALORE DEL SECONDO CAMPO [2] DELL'ARRAY E' 1 IL CALCOLO VERRA' ESEGUITO ESCLUDENDO IL PRIMO VALORE [2][1:] ES. 10200 -> 0200 -> -20,0 °C
        friendly_name: "Temperatura Esterna OffSet disattivato [°C]" 
        value_template: >
          {% set stati = ['unknown', 'unavailable'] %}
          {% if states('sensor.vmc_cucina_sensori') in stati %}
            Non disponibile
          {% else %} 
            {% set raw_temp = states('sensor.vmc_cucina_sensori') %}
            {% set temp_esterna_positivo = float(int(raw_temp.split(',')[2]) / 10) %}
            {% set temp_esterna_negativo = (- (float(int(raw_temp.split(',')[2][1:]) / 10))) %}
            {% if states('sensor.vmc_cucina_temp_esterna_positivo_negativo') == "negativo" %}
              {{ temp_esterna_negativo | round(1) }}
            {% else %}
              {{ temp_esterna_positivo | round(1) }}
            {% endif %}
          {% endif %}
        icon_template: mdi:home-thermometer-outline

      vmc_cucina_umidita_interna_status:                                       # [CONFIGURAZIONE, PIU’ RICHIAMI] [INTERFACCIA, PIU’ RICHIAMI] SENSORE DI LETTURA UMIDITA' INTERNA  MEMORIZZATA NELLA VMC + OFFSET MANUALE, PREVIA VERIFICA DI AVVENUTA LETTURA DEI DATI "SENSORI" MEMORIZZATI NELLA VMC
        friendly_name: "Umidità [%]"
        value_template: >
          {% set stati = ['unknown', 'unavailable'] %}
          {% if states('sensor.vmc_cucina_sensori') in stati %}
            Non disponibile
          {% else %}         
            {% set umidita_relativa = float(int(states('sensor.vmc_cucina_sensori').split(',')[3]) / 10) + float(states('input_number.vmc_cucina_offset_umidita_interna')) %}
            {% if umidita_relativa > 0 and umidita_relativa <= 100 %}
              {{ umidita_relativa }}
            {% elif umidita_relativa <= 0 %}
              [Non Calcolabile]
            {% elif umidita_relativa > 100 %}
              100
            {% endif %}
          {% endif %}   
        icon_template: mdi:water-percent

      vmc_cucina_umidita_esterna_status:                                       # [CONFIGURAZIONE, PIU’ RICHIAMI] [INTERFACCIA, PIU’ RICHIAMI] SENSORE DI LETTURA UMIDITA' ESTERNA  MEMORIZZATA NELL'INTEGRAZIONE OPENWEATHERMAP, LO STESSO DEVE ESSERE INSTALLATO IN HOME ASSISTANT + OFFSET MANUALE, PREVIA VERIFICA DI AVVENUTA LETTURA DEI DATI "SENSORI" MEMORIZZATI NELLA VMC
        friendly_name: "Umidità Esterna by OpenWeatherMap [%]"
        value_template: >
          {% set stati = ['unknown', 'unavailable'] %}
          {% if states('sensor.vmc_cucina_sensori') in stati %}
            Non disponibile
          {% else %}
            {% set umidita_relativa_esterna = states('sensor.openweathermap_humidity') | float + float(states('input_number.vmc_cucina_offset_umidita_esterna')) %}
            {% if umidita_relativa_esterna > 0 and umidita_relativa_esterna <= 100 %}
              {{ umidita_relativa_esterna }}
            {% elif umidita_relativa_esterna <= 0 %}
              [Non Calcolabile]
            {% elif umidita_relativa_esterna > 100 %}
              100
            {% endif %}
          {% endif %}             
        icon_template: mdi:water-percent

################### Fine Creazione Sensori di Lettura Temp. Interna, Esterna, Umidità della VMC  ################################################################################################################################################

################### Inizio Creazione Sensori per l'INTERFACCIA per la Lettura Umidità Verifica Superamento Lim. Δ P. di Rugiada, VMC Congelamento ≤ -18 [°C] Temp. Esterna ?, VMC Diff. Temp. Int-Est > 23 [°C] ? della VMC  ###################
      vmc_cucina_umidita_interna_status_verifica_soglia_valore:                # [CONFIGURAZIONE 0 RICHIAMI] [INTERFACCIA, PIU’ RICHIAMI] SENSORE MONITORAGGIO UMIDITA' INTERNA LETTA DALLA VMC
        friendly_name: "Livello di Umidità"
        value_template: >
          {% set stati = ['unknown', 'unavailable'] %}
          {% if states('sensor.vmc_cucina_sensori') in stati %}
            Non disponibile
          {% else %}                 
            {% set umidita_soglia = states('sensor.vmc_cucina_umidita_interna_status') %}
            {% if umidita_soglia != '[Non Calcolabile]' %}
              {% set umidita_soglia = float(umidita_soglia) %}
              {% if umidita_soglia > 0 and umidita_soglia <= 35 %}
                Umidità al {{ umidita_soglia }}%. Possibile Secchezza, Disidratazione. Si consiglia di umidificare la stanza.
              {% elif umidita_soglia > 35 and umidita_soglia <= 65 %}
                Umidità al {{ umidita_soglia }}%. Situazione normale.
              {% elif umidita_soglia > 65 and umidita_soglia <= 100 %}
                Umidità al {{ umidita_soglia }}%. Potrebbe verificarsi una proliferazione di muffe e batteri. Si consiglia di deumidificare la stanza.
              {% else %}
                [Non Calcolabile]
              {% endif %}
            {% else %}
              [Non Calcolabile]
            {% endif %}
          {% endif %}   
        icon_template: mdi:water-percent

      vmc_cucina_punto_di_rugiada_verifica_confronto_valore:                   # [CONFIGURAZIONE 0 RICHIAMI] [INTERFACCIA, PIU’ RICHIAMI] SENSORE DI MONITORAGGIO DEL PUNTO DI RUGIADA ESTERNO - PUNTO DI RUGIADA INTERNO < DELTA (OVVERO IL VALORE DEL SENSORE vmc_cucina_offset_verifica_impiego_vmc [°C]); DIVERSAMENTE NON DEVE ESSERE IMPIEGATA LA VMC
        friendly_name: "Verifica Superamento Lim. Δ P. di Rugiada"
        value_template: >
          {% set stati = ['unknown', 'unavailable'] %}
          {% if states('sensor.vmc_cucina_sensori') in stati %}
            Non disponibile
          {% else %}
            {% set PdRi = states('sensor.vmc_cucina_punto_di_rugiada_interno') | float(0) %}
            {% set PdRe = states('sensor.vmc_cucina_punto_di_rugiada_esterno') | float(0) %}
            {% set Delta = states('input_number.vmc_cucina_offset_verifica_impiego_vmc') | float(0) %}
            {% if (states('sensor.vmc_cucina_punto_di_rugiada_interno') != '[Non Calcolabile]') and (states('sensor.vmc_cucina_punto_di_rugiada_esterno') != '[Non Calcolabile]') %}
              {% if (PdRe - PdRi) < Delta %}
                Δ P. di Rugiada rilevato {{ (PdRe - PdRi)|round(2) }} °C minore di {{states('input_number.vmc_cucina_offset_verifica_impiego_vmc')}} °C del valore settato.
              {% elif (PdRe - PdRi) == Delta %}
                Δ P. di Rugiada rilevato {{ (PdRe - PdRi)|round(2) }} °C uguale a {{states('input_number.vmc_cucina_offset_verifica_impiego_vmc')}} °C del valore settato.              
              {% else %}
                Δ P. di Rugiada rilevato {{ (PdRe - PdRi)|round(2) }} °C maggiore di {{states('input_number.vmc_cucina_offset_verifica_impiego_vmc')}} °C del valore settato.
              {% endif %}
            {% else %}
              [Non Calcolabile]
            {% endif %}
          {% endif %}
        icon_template: mdi:hvac

      vmc_cucina_congelamento_verifica_soglia_valore:                          # [CONFIGURAZIONE 0 RICHIAMI] [INTERFACCIA PIU’ RICHIAMI] SENSORE MONITORAGGIO CONGELAMENTO INTERNO NELLA VMC SENZA OFFSET -> BLOCCO DELL'UNITA' PER DEFAULT, IMPARTITO DAL COSTRUTTORE
        friendly_name: "VMC Congelamento ≤ -18 [°C] Temp. Esterna ?"
        value_template: >
          {% set stati = ['unknown', 'unavailable'] %}
          {% if states('sensor.vmc_cucina_sensori') in stati %}
            Non disponibile
          {% else %}   
            {% set congelamento = states('sensor.vmc_cucina_temp_esterna_status_senza_offset') | float(0) %}
            {% if congelamento <= -18 %}
              Arresto della VMC per congelamento imposto dal Costruttore. Temperatura rilevata {{congelamento}} °C, indipendentemente dagli Offset settati.
            {% elif congelamento > -18 and congelamento <= -15 %}
              VMC in prossimità di Arresto per congelamento. Temperatura rilevata {{congelamento}} °C, indipendentemente dagli Offset settati.
            {% else %}
              La Temperatura Esterna rilevata è di {{states('sensor.vmc_cucina_temp_esterna_status')}} °C, non c'è pericolo di Congelamento della VMC, indipendentemente dagli Offset settati.
            {% endif %}
          {% endif %}   
        icon_template: mdi:hvac

      vmc_cucina_delta_temp_verifica_soglia_valore:                            # [CONFIGURAZIONE 0 RICHIAMI] [INTERFACCIA, PIU’ RICHIAMI] SENSORE MONITORAGGIO DIFFERENZA DI TEMPERATURA (> 23 GRADI [°C]) NELLA VMC SENZA OFFSET -> VELOCITA' 1 DELL'UNITA' PER DEFAULT, IMPARTITO DAL COSTRUTTORE
        friendly_name: "VMC Diff. Temp. Int-Est > 23 [°C] ?"
        value_template: >
          {% set stati = ['unknown', 'unavailable'] %}
          {% if states('sensor.vmc_cucina_sensori') in stati %}
            Non disponibile
          {% else %}
            {% set temperatura_esterna = states('sensor.vmc_cucina_temp_esterna_status_senza_offset') | float(0) %}
            {% set temperatura_interna = states('sensor.vmc_cucina_temp_interna_status_senza_offset') | float(0) %}
            {% if temperatura_esterna == 'Non disponibile' or temperatura_interna == 'Non disponibile' %}
              [Non Disponibile]
            {% else %}
              {% set delta = (temperatura_interna - temperatura_esterna) | round(1) %}
              {% if delta > 23 %}
                Rilevata una Differenza tra la Temp. Interna e Temp. Esterna di {{delta}} °C. La Velocità verrà impostata su 1 dal Costruttore della VMC indipendentemente dagli Offset settati.
              {% elif delta >= 20 and delta <= 23 %}
                Rilevata una Differenza tra la Temp. Interna e Temp. Esterna di {{delta}} °C. Possibile prossimo cambio di Velocità a 1, imposto dal Costruttore della VMC indipendentemente dagli Offset settati.
              {% else %}
                Rilevata una Differenza tra la Temp. Interna e Temp. Esterna di {{delta}} °C. Non è previsto nessun cambio di Velocità indipendentemente dagli Offset settati.
              {% endif %}
            {% endif %}
          {% endif %}
        icon_template: mdi:hvac
################### Fine Creazione Sensori per l'INTERFACCIA per la Lettura Umidità, Verifica Superamento Lim. Δ P. di Rugiada, VMC Congelamento ≤ -18 [°C] Temp. Esterna ?, VMC Diff. Temp. Int-Est > 23 [°C] ? della VMC  ###################

################### Inizio Creazione Sensori di Monitoraggio per fare scattare i PopUp ove richiesto #############################################################################################################################
      vmc_cucina_umidita_interna_status_verifica_soglia:                       # [CONFIGURAZIONE POP-UP, PIU’ RICHIAMI] [INTERFACCIA, PIU’ RICHIAMI] SENSORE MONITORAGGIO UMIDITA' INTERNA LETTA DALLA VMC
        friendly_name: "Livello di Umidità"
        value_template: >
          {% set stati = ['unknown', 'unavailable'] %}
          {% if states('sensor.vmc_cucina_sensori') in stati %}
            Non disponibile
          {% else %}                 
            {% set umidita_soglia = states('sensor.vmc_cucina_umidita_interna_status') %}
            {% if umidita_soglia != '[Non Calcolabile]' %}
              {% set umidita_soglia = float(umidita_soglia) %}
              {% if umidita_soglia >= 1 and umidita_soglia <= 35 %}
                Possibile Secchezza, Disidratazione
              {% elif umidita_soglia > 35 and umidita_soglia <= 65 %}
                Normale
              {% elif umidita_soglia > 65 and umidita_soglia <= 100 %}
                Possibile Muffe, Batteri
              {% else %}
                [Non Calcolabile]
              {% endif %}
            {% else %}
              [Non Calcolabile]
            {% endif %}
          {% endif %}   
        icon_template: mdi:water-percent

      vmc_cucina_congelamento_verifica_soglia:                                 # [CONFIGURAZIONE POP-UP, PIU’ RICHIAMI] [INTERFACCIA, PIU’ RICHIAMI] SENSORE MONITORAGGIO CONGELAMENTO INTERNO NELLA VMC SENZA OFFSET -> BLOCCO DELL'UNITA' PER DEFAULT, IMPARTITO DAL COSTRUTTORE
        friendly_name: "VMC Congelamento ≤ -18 [°C] Temp. Esterna ?"
        value_template: >
          {% set stati = ['unknown', 'unavailable'] %}
          {% if states('sensor.vmc_cucina_sensori') in stati %}
            Non disponibile
          {% else %}
            {% set congelamento = states('sensor.vmc_cucina_temp_esterna_status_senza_offset') | float(0) %}
            {% if congelamento == 'Non disponibile' %}
              [Non Disponibile]
            {% elif congelamento <= -18 %}
              Si
            {% elif congelamento > -18 and congelamento <= -15 %}
              [No ma Prossimo]
            {% else %}
              No
            {% endif %}
          {% endif %}
        icon_template: mdi:snowflake-thermometer

      vmc_cucina_delta_temp_verifica_soglia:                                   # [CONFIGURAZIONE POP-UP, PIU’ RICHIAMI] [INTERFACCIA, PIU’ RICHIAMI] SENSORE MONITORAGGIO DIFFERENZA DI TEMPERATURA (> 23 GRADI [°C]) NELLA VMC SENZA OFFSET -> VELOCITA' 1 DELL'UNITA' PER DEFAULT, IMPARTITO DAL COSTRUTTORE
        friendly_name: "VMC Diff. Temp. Int-Est > 23 [°C] ?"
        value_template: >
          {% set stati = ['unknown', 'unavailable'] %}
          {% if states('sensor.vmc_cucina_sensori') in stati %}
            Non disponibile
          {% else %}
            {% set temperatura_esterna = states('sensor.vmc_cucina_temp_esterna_status_senza_offset') | float(0) %}
            {% set temperatura_interna = states('sensor.vmc_cucina_temp_interna_status_senza_offset') | float(0) %}
            {% if temperatura_esterna == 'Non disponibile' or temperatura_interna == 'Non disponibile' %}
              [Non Disponibile]
            {% else %}
              {% set delta = (temperatura_interna - temperatura_esterna) | round(1) %}
              {% if delta > 23 %}
                Si
              {% elif delta >= 20 and delta <= 23 %}
                [No ma Prossimo]
              {% else %}
                No
              {% endif %}
            {% endif %}
          {% endif %}
        icon_template: mdi:hvac

      vmc_cucina_punto_di_rugiada_interno:                                     # [CONFIGURAZIONE, PIU’ RICHIAMI] [INTERFACCIA, PIU’ RICHIAMI] SENSORE DI MONITORAGIO DEL PUNTO DI RUGIADA INTERNO, IN FUNZIONE DELLA TEMEPRATURA INTERNA ED UMIDITA' INTERNA LETTA DALLA VMC
        friendly_name: "Punto di Rugiada [°C]"
        value_template: >
          {% set stati = ['unknown', 'unavailable'] %}
          {% if states('sensor.vmc_cucina_sensori') in stati %}
            Non disponibile
          {% else %}  
            {% set Rh = states('sensor.vmc_cucina_umidita_interna_status') | float(0) %}
            {% set Tc = states('sensor.vmc_cucina_temp_interna_status') | float(0) %}
            {% set Es = 6.11 * 10**((7.5*Tc)/(237.7+Tc)) %}
            {% set E = Es * Rh / 100 %}
            {% if ( ( Rh > 0 ) and ( Rh <= 100 ) and ( E > 0 ) ) %}
              {% set Dp = (-430.22 + 237.7 * log(E)) / (-log(E) + 19.08) %}
                {{ Dp|round(2) }}
            {% else %}
                [Non Calcolabile]
            {% endif %}
          {% endif %}
        icon_template: mdi:thermometer-water
        
      vmc_cucina_punto_di_rugiada_esterno:                                     # [CONFIGURAZIONE, PIU’ RICHIAMI] [INTERFACCIA, PIU’ RICHIAMI] SENSORE DI MONITORAGIO DEL PUNTO DI RUGIADA ESTERNO, IN FUNZIONE DELLA TEMEPRATURA ESTERNA LETTA DALLA VMC E DALL'UMNIDITA' ESTERNA LETTA DALL'INTEGRAZIONE DI OPENWEATHERMAP
        friendly_name: "Punto di Rugiada Esterno [°C]"
        value_template: >
          {% set stati = ['unknown', 'unavailable'] %}
          {% if states('sensor.vmc_cucina_sensori') in stati %}
            Non disponibile
          {% else %}  
            {% set Rh = states('sensor.vmc_cucina_umidita_esterna_status') | float(0) %}
            {% set Tc = states('sensor.vmc_cucina_temp_esterna_status') | float(0) %}
            {% set Es = 6.11 * 10**((7.5*Tc)/(237.7+Tc)) %}
            {% set E = Es * Rh / 100 %}
            {% if ( ( Rh > 0 ) and ( Rh <= 100 ) and ( E > 0 ) ) %}
              {% set Dp = (-430.22 + 237.7 * log(E)) / (-log(E) + 19.08) %}
                {{ Dp|round(2) }}
            {% else %}
                [Non Calcolabile]
            {% endif %}
          {% endif %}
        icon_template: mdi:water-thermometer-outline

      vmc_cucina_punto_di_rugiada_verifica_confronto:                          # [CONFIGURAZIONE POP-UP, PIU’ RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI] [INTERFACCIA, PIU’ RICHIAMI] SENSORE DI MONITORAGGIO DEL PUNTO DI RUGIADA ESTERNO - PUNTO DI RUGIADA INTERNO < DELTA (OVVERO IL VALORE DEL SENSORE vmc_cucina_offset_verifica_impiego_vmc [°C]); DIVERSAMENTE NON DEVE ESSERE IMPIEGATA LA VMC
        friendly_name: "Verifica Superamento Lim. Δ P. di Rugiada"
        value_template: >
          {% set stati = ['unknown', 'unavailable'] %}
          {% if states('sensor.vmc_cucina_sensori') in stati %}
           Non disponibile
          {% else %}
            {% set PdRi = states('sensor.vmc_cucina_punto_di_rugiada_interno') | float(0) %}
            {% set PdRe = states('sensor.vmc_cucina_punto_di_rugiada_esterno') | float(0) %}
            {% set Delta = states('input_number.vmc_cucina_offset_verifica_impiego_vmc') | float(0) %}
            {% if (states('sensor.vmc_cucina_punto_di_rugiada_interno') != '[Non Calcolabile]') and (states('sensor.vmc_cucina_punto_di_rugiada_esterno') != '[Non Calcolabile]') %}
              {% if (PdRe - PdRi) < Delta %}
                Si può impiegare
              {% else %}
                Se ne sconsiglia l'impiego
              {% endif %}
            {% else %}
              [Non Calcolabile]
            {% endif %}
          {% endif %}
        icon_template: mdi:hvac

      vmc_cucina_umidita_assoluta_interna:                                     # [CONFIGURAZIONE O RICHIAMI] [INTERFACCIA, PIU’ RICHIAMI] SENSORE DI MONITORAGGIO DELL' UMIDITA' ASSOLUTA INTERNA
        friendly_name: "Umidità Assoluta [g/m³]"
        value_template: >
          {% set stati = ['unknown', 'unavailable'] %}
          {% if states('sensor.vmc_cucina_sensori') in stati %}
            Non disponibile
          {% else %}
            {% set h = states('sensor.vmc_cucina_umidita_interna_status') | float(0) %}
            {% set t = states('sensor.vmc_cucina_temp_interna_status') | float(0) %}
            {% if h <= 0 or h == "Non Calcolabile" or t <= 0 %}
              [Non Calcolabile] 
            {% else %}
              {{ (h*6.112*2.1674*e**((t*17.67)/(t+243.5))/(t+273.15))|round(2) }}
            {% endif %}
          {% endif %}
        icon_template: mdi:cloud-percent-outline

      vmc_cucina_umidita_assoluta_esterna:                                     # [CONFIGURAZIONE 0 RICHIAMI] [INTERFACCIA, PIU’ RICHIAMI] SENSORE DI MONITORAGGIO DELL' UMIDITA' ASSOLUTA INTERNA
        friendly_name: "Umidità Assoluta Esterna [g/m³]"
        value_template: >
          {% set stati = ['unknown', 'unavailable'] %}
          {% if states('sensor.vmc_cucina_sensori') in stati %}
            Non disponibile
          {% else %}
            {% set h = states('sensor.vmc_cucina_umidita_esterna_status') | float(0) %}
            {% set t = states('sensor.vmc_cucina_temp_esterna_status') | float(0) %}
            {% if h <= 0 or h == "Non Calcolabile" or t <= 0 %}
              [Non Calcolabile] 
            {% else %}
              {{ (h*6.112*2.1674*e**((t*17.67)/(t+243.5))/(t+273.15))|round(2) }}
            {% endif %}
          {% endif %}
        icon_template: mdi:cloud-percent-outline

      vmc_cucina_status_portata_ventola_lettura_codice_interpretato:           # [CONFIGURAZIONE, PIU’ RICHIAMI] [INTERFACCIA, PIU’ RICHIAMI] SENSORE DI LETTURA DEI DATI "VELOCITA'" MEMORIZZATI NELLA VMC CONVERITA IN PORTATA D'ARIA m3/h [AD ESCLUSIONE DELLA VELOCITA' NOTTURNA E FREE COOLING], PREVIA VERIFICA DI AVVENUTA LETTURA DEI DATI "VELOCITA'"" MEMORIZZATI NELLA VMC
        friendly_name: "Portata d'Aria [M³/h]"
        value_template: >
          {% set stati = ['unknown', 'unavailable'] %}
          {% set codici = {'00000': '-', '00001': '10', '00002': '17', '00003': '26', 
                           '00004': '37', '00005': '42', '00006': '10', '00007': '-'} %}
          {{ 'Non disponibile' if states('sensor.vmc_cucina_status_ventola') in stati 
            else (codici.get(states('sensor.vmc_cucina_status_ventola').split(',')[1], 'Non disponibile')) }}
        icon_template: mdi:window-open-variant  

      vmc_cucina_status_calcolo_portata_ventola:                               # [CONFIGURAZIONE 0 RICHIAMI] [INTERFACCIA, PIU’ RICHIAMI] SENSORE PER IL CALCOLO IN MINUTI NECESSARI PER UN CAMBIO TOTALE DELL'AMBIENTE
        friendly_name: "Tempo ricambio aria"
        value_template: >
          {% set stati = ['unknown', 'unavailable'] %}
          {% if states('sensor.vmc_cucina_sensori') in stati %}
            Non disponibile
          {% else %}
            {% if states('sensor.vmc_cucina_status_portata_ventola_lettura_codice_interpretato') not in ['-', '0'] %}
              {% set volume = states('input_number.vmc_cucina_volume_da_inserire') | float(0) %}
              {% set portata = states('sensor.vmc_cucina_status_portata_ventola_lettura_codice_interpretato') | float(0) %}
              {% if portata != 0 %}
              {% set tempo_minuti = ((volume/portata)*60)|round(0) %}
              {% set ore = tempo_minuti // 60 %}
              {% set minuti = tempo_minuti % 60 %}
                {% if ore == 0 %}
                  {{ minuti }} minuti
                {% elif minuti == 0 %}
                  {{ ore }} ore
                {% else %}
                  {{ ore }} ore e {{ minuti }} minuti
                {% endif %}
              {% else %}
                -
              {% endif %}
            {% else %}
              -
            {% endif %}
          {% endif %}
        icon_template: mdi:home-clock-outline
################### Fine Creazione Sensori di Monitoraggio per fare scattare i PopUp ove richiesto ###########################################################################################################################

########################################################################################### INIZIO SENSORI PER POP-UP MONITORAGGIO ###########################################################################################
      vmc_cucina_alert_monitoraggio_umidita:                                    # [CONFIGURAZIONE, PIU’ RICHIAMI] [INTERFACCIA, PIU’ RICHIAMI] SENSORE POP-UP MONITORAGGIO UMIDITA'
        friendly_name: "Verifica Monitoraggio Umidità"
        value_template: >
          {% set stati = ['unknown', 'unavailable'] %}
          {% if states('sensor.vmc_cucina_sensori') in stati %}
            Non disponibile
          {% else %}
            {% set umidità = states('sensor.vmc_cucina_umidita_interna_status_verifica_soglia') %}
            {% if (umidità == 'Possibile Secchezza, Disidratazione') or (umidità == 'Possibile Muffe, Batteri') %}
              Allerta
            {% else %}
              Nessuna Allerta
            {% endif %}
          {% endif %}
        icon_template: mdi:alarm-light-outline

      vmc_cucina_alert_monitoraggio_pdr:                                        # [CONFIGURAZIONE, PIU’ RICHIAMI] [INTERFACCIA, PIU’ RICHIAMI] SENSORE POP-UP MONITORAGGIO Verifica uso VMC? OVVERO SUPERAMENTO DEL Set Lim. Δ Punto di Rugiada
        friendly_name: "Verifica Monitoraggio Superamento Lim. Punto di Rugiada"
        value_template: >
          {% set stati = ['unknown', 'unavailable'] %}
          {% if states('sensor.vmc_cucina_sensori') in stati %}
            Non disponibile
          {% else %}
            {% set PdRvc = states('sensor.vmc_cucina_punto_di_rugiada_verifica_confronto') %}            
            {% if ( PdRvc == 'Se ne sconsiglia l\'impiego' ) %}
              Allerta
            {% else %}
              Nessuna Allerta
            {% endif %}
          {% endif %}
        icon_template: mdi:alarm-light-outline

      vmc_cucina_alert_monitoraggio_congelamento:                               # [CONFIGURAZIONE, PIU’ RICHIAMI] [INTERFACCIA, PIU’ RICHIAMI] SENSORE POP-UP MONITORAGGIO VMC Congelamento ≤ -18 [°C] Temp. Esterna ?
        friendly_name: "Verifica Monitoraggio Congelamento"
        value_template: >
          {% set stati = ['unknown', 'unavailable'] %}
          {% if states('sensor.vmc_cucina_sensori') in stati %}
            Non disponibile
          {% else %}
            {% set congelamento = states('sensor.vmc_cucina_congelamento_verifica_soglia') %}            
            {% if ( (congelamento == 'Si') or (congelamento == '[No ma Prossimo]') ) %}
              Allerta
            {% else %}
              Nessuna Allerta
            {% endif %}
          {% endif %}
        icon_template: mdi:alarm-light-outline

      vmc_cucina_alert_monitoraggio_delta:                                      # [CONFIGURAZIONE, PIU’ RICHIAMI] [INTERFACCIA, PIU’ RICHIAMI] SENSORE POP-UP MONITORAGGIO VMC Diff. Temp. Int-Est > 23 [°C] ?
        friendly_name: "Verifica Monitoraggio"
        value_template: >
          {% set stati = ['unknown', 'unavailable'] %}
          {% if states('sensor.vmc_cucina_sensori') in stati %}
            Non disponibile
          {% else %}
            {% set delta = states('sensor.vmc_cucina_delta_temp_verifica_soglia') %}
            {% if ( (delta == 'Si') or(delta == '[No ma Prossimo]') ) %}
              Allerta
            {% else %}
              Nessuna Allerta
            {% endif %}
          {% endif %}
        icon_template: mdi:alarm-light-outline
   
      vmc_cucina_alert_monitoraggio_totale:                                    # [CONFIGURAZIONE] SENSORE ALLERTA MONITORAGGIO TOTALE: Umidità, PdR, Congelamento, Delta
        friendly_name: "Status Monitoraggio"
        value_template: >
          {% set stati = ['unknown', 'unavailable'] %}
          {% if states('sensor.vmc_cucina_sensori') in stati %}
            Non disponibile
          {% else %}
            {% set umidità = states('sensor.vmc_cucina_alert_monitoraggio_umidita') %}
            {% set PdRvc = states('sensor.vmc_cucina_alert_monitoraggio_pdr') %}            
            {% set congelamento = states('sensor. vmc_cucina_alert_monitoraggio_congelamento') %}            
            {% set delta = states('sensor.vmc_cucina_alert_monitoraggio_delta') %}
            {% if ( (umidità == 'Allerta' ) or (PdRvc =='Allerta') or (congelamento == 'Allerta') or (delta =='Allerta') ) %}
              Allerta
            {% else %}
              Nessuna Allerta
            {% endif %}
          {% endif %}
        icon_template: mdi:incognito-circle
########################################################################################### FINE SENSORI PER POP-UP MONITORAGGIO #####################################################################################################

################### Inizio Creazione Sensori Interfaccia Calendario  #################################################################################################################################################################
########################################################################################################################
# LOGICA DI FUNZIONAMENTO DEGLI ORARI NELLE FASCE DI INSERIMENTO NEL CALENDARIO, LE VERIFICHE DEVONO ESSERE TUTTE TRUE #
# Accensione  1° <  Spegnimento 1° True                                                                                #
# Accensione  1° <  Accensione  2° True                                                                                #
# Spegnimento 1° <  Spegnimento 2° True                                                                                #
# Accensiore  2° <  Spegnimento 2° True                                                                                #
# Accensiore  2° >  Spegnimento 1° True                                                                                #
# Accensione  1° <> Spegnimento 1° True                                                                                #
# Accensione  1° <> Accensione  2° True                                                                                #
# Spegnimento 1° <> Spegnimento 2° True                                                                                #
# Spegnimento 1° <> Accensione  2° True                                                                                #
# Accensione  2° <> Spegnimento 2° True                                                                                #
# Verifica Calendario Acceso:      True                                                                                #
########################################################################################################################

      vmc_cucina_status_accensione_vmc_tramite_calendario:                     # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI] [INTERFACCIA, PIU’ RICHIAMI] SENSORE DI VERIFICA 1° FASCIA ACCENSIONE SE GLI ORARI SONO STATI INSERITI CORRETTAMENTE, DIVERSAMENTE MOSTRERA' "DISABILITATA"
        friendly_name: "1° Accensione programmata"
        value_template: >-
          {% set stati = ['unknown', 'unavailable'] %}
          {% if states('sensor.vmc_cucina_sensori') in stati %}
            Non disponibile
          {% else %}        
            {% set weekday = now().weekday() %}
            {% if weekday == 0 and states('input_datetime.vmc_cucina_accensione_lunedi') < states('input_datetime.vmc_cucina_spegnimento_lunedi') and states('input_datetime.vmc_cucina_accensione_lunedi') != states('input_datetime.vmc_cucina_spegnimento_lunedi') and states('input_datetime.vmc_cucina_accensione_lunedi_2') < states('input_datetime.vmc_cucina_spegnimento_lunedi_2') and states('input_datetime.vmc_cucina_accensione_lunedi_2') != states('input_datetime.vmc_cucina_spegnimento_lunedi_2') and states('input_datetime.vmc_cucina_accensione_lunedi') < states('input_datetime.vmc_cucina_accensione_lunedi_2') and states('input_datetime.vmc_cucina_spegnimento_lunedi') < states('input_datetime.vmc_cucina_spegnimento_lunedi_2') and states('input_datetime.vmc_cucina_accensione_lunedi') != states('input_datetime.vmc_cucina_accensione_lunedi_2') and states('input_datetime.vmc_cucina_spegnimento_lunedi') != states('input_datetime.vmc_cucina_spegnimento_lunedi_2') and states('input_datetime.vmc_cucina_spegnimento_lunedi') != states('input_datetime.vmc_cucina_accensione_lunedi_2') and states('input_datetime.vmc_cucina_accensione_lunedi_2') > states('input_datetime.vmc_cucina_spegnimento_lunedi') and states('input_boolean.vmc_cucina_opzioni_accendi_spegni_vmc_vs_calendario') == 'on' %}
              Lunedi, {{ states('input_datetime.vmc_cucina_accensione_lunedi')[0:5] }}
            {% elif weekday == 1 and states('input_datetime.vmc_cucina_accensione_martedi') < states('input_datetime.vmc_cucina_spegnimento_martedi') and states('input_datetime.vmc_cucina_accensione_martedi') != states('input_datetime.vmc_cucina_spegnimento_martedi') and states('input_datetime.vmc_cucina_accensione_martedi_2') < states('input_datetime.vmc_cucina_spegnimento_martedi_2') and states('input_datetime.vmc_cucina_accensione_martedi_2') != states('input_datetime.vmc_cucina_spegnimento_martedi_2') and states('input_datetime.vmc_cucina_accensione_martedi') < states('input_datetime.vmc_cucina_accensione_martedi_2') and states('input_datetime.vmc_cucina_spegnimento_martedi') < states('input_datetime.vmc_cucina_spegnimento_martedi_2') and states('input_datetime.vmc_cucina_accensione_martedi') != states('input_datetime.vmc_cucina_accensione_martedi_2') and states('input_datetime.vmc_cucina_spegnimento_martedi') != states('input_datetime.vmc_cucina_spegnimento_martedi_2') and states('input_datetime.vmc_cucina_spegnimento_martedi') != states('input_datetime.vmc_cucina_accensione_martedi_2') and states('input_datetime.vmc_cucina_accensione_martedi_2') > states('input_datetime.vmc_cucina_spegnimento_martedi') and states('input_boolean.vmc_cucina_opzioni_accendi_spegni_vmc_vs_calendario') == 'on' %}
              Martedi, {{ states('input_datetime.vmc_cucina_accensione_martedi')[0:5] }}
            {% elif weekday == 2 and states('input_datetime.vmc_cucina_accensione_mercoledi') < states('input_datetime.vmc_cucina_spegnimento_mercoledi') and states('input_datetime.vmc_cucina_accensione_mercoledi') != states('input_datetime.vmc_cucina_spegnimento_mercoledi') and states('input_datetime.vmc_cucina_accensione_mercoledi_2') < states('input_datetime.vmc_cucina_spegnimento_mercoledi_2') and states('input_datetime.vmc_cucina_accensione_mercoledi_2') != states('input_datetime.vmc_cucina_spegnimento_mercoledi_2') and states('input_datetime.vmc_cucina_accensione_mercoledi') < states('input_datetime.vmc_cucina_accensione_mercoledi_2') and states('input_datetime.vmc_cucina_spegnimento_mercoledi') < states('input_datetime.vmc_cucina_spegnimento_mercoledi_2') and states('input_datetime.vmc_cucina_accensione_mercoledi') != states('input_datetime.vmc_cucina_accensione_mercoledi_2') and states('input_datetime.vmc_cucina_spegnimento_mercoledi') != states('input_datetime.vmc_cucina_spegnimento_mercoledi_2') and states('input_datetime.vmc_cucina_spegnimento_mercoledi') != states('input_datetime.vmc_cucina_accensione_mercoledi_2') and states('input_datetime.vmc_cucina_accensione_mercoledi_2') > states('input_datetime.vmc_cucina_spegnimento_mercoledi') and states('input_boolean.vmc_cucina_opzioni_accendi_spegni_vmc_vs_calendario') == 'on' %}
              Mercoledi, {{ states('input_datetime.vmc_cucina_accensione_mercoledi')[0:5] }}
            {% elif weekday == 3 and states('input_datetime.vmc_cucina_accensione_giovedi') < states('input_datetime.vmc_cucina_spegnimento_giovedi') and states('input_datetime.vmc_cucina_accensione_giovedi') != states('input_datetime.vmc_cucina_spegnimento_giovedi') and states('input_datetime.vmc_cucina_accensione_giovedi_2') < states('input_datetime.vmc_cucina_spegnimento_giovedi_2') and states('input_datetime.vmc_cucina_accensione_giovedi_2') != states('input_datetime.vmc_cucina_spegnimento_giovedi_2') and states('input_datetime.vmc_cucina_accensione_giovedi') < states('input_datetime.vmc_cucina_accensione_giovedi_2') and states('input_datetime.vmc_cucina_spegnimento_giovedi') < states('input_datetime.vmc_cucina_spegnimento_giovedi_2') and states('input_datetime.vmc_cucina_accensione_giovedi') != states('input_datetime.vmc_cucina_accensione_giovedi_2') and states('input_datetime.vmc_cucina_spegnimento_giovedi') != states('input_datetime.vmc_cucina_spegnimento_giovedi_2') and states('input_datetime.vmc_cucina_spegnimento_giovedi') != states('input_datetime.vmc_cucina_accensione_giovedi_2') and states('input_datetime.vmc_cucina_accensione_giovedi_2') > states('input_datetime.vmc_cucina_spegnimento_giovedi') and states('input_boolean.vmc_cucina_opzioni_accendi_spegni_vmc_vs_calendario') == 'on' %}
              Giovedi, {{ states('input_datetime.vmc_cucina_accensione_giovedi')[0:5] }}
            {% elif weekday == 4 and states('input_datetime.vmc_cucina_accensione_venerdi') < states('input_datetime.vmc_cucina_spegnimento_venerdi') and states('input_datetime.vmc_cucina_accensione_venerdi') != states('input_datetime.vmc_cucina_spegnimento_venerdi') and states('input_datetime.vmc_cucina_accensione_venerdi_2') < states('input_datetime.vmc_cucina_spegnimento_venerdi_2') and states('input_datetime.vmc_cucina_accensione_venerdi_2') != states('input_datetime.vmc_cucina_spegnimento_venerdi_2') and states('input_datetime.vmc_cucina_accensione_venerdi') < states('input_datetime.vmc_cucina_accensione_venerdi_2') and states('input_datetime.vmc_cucina_spegnimento_venerdi') < states('input_datetime.vmc_cucina_spegnimento_venerdi_2') and states('input_datetime.vmc_cucina_accensione_venerdi') != states('input_datetime.vmc_cucina_accensione_venerdi_2') and states('input_datetime.vmc_cucina_spegnimento_venerdi') != states('input_datetime.vmc_cucina_spegnimento_venerdi_2') and states('input_datetime.vmc_cucina_spegnimento_venerdi') != states('input_datetime.vmc_cucina_accensione_venerdi_2') and states('input_datetime.vmc_cucina_accensione_venerdi_2') > states('input_datetime.vmc_cucina_spegnimento_venerdi') and states('input_boolean.vmc_cucina_opzioni_accendi_spegni_vmc_vs_calendario') == 'on' %}
              Venerdi, {{ states('input_datetime.vmc_cucina_accensione_venerdi')[0:5] }}
            {% elif weekday == 5 and states('input_datetime.vmc_cucina_accensione_sabato') < states('input_datetime.vmc_cucina_spegnimento_sabato') and states('input_datetime.vmc_cucina_accensione_sabato') != states('input_datetime.vmc_cucina_spegnimento_sabato') and states('input_datetime.vmc_cucina_accensione_sabato_2') < states('input_datetime.vmc_cucina_spegnimento_sabato_2') and states('input_datetime.vmc_cucina_accensione_sabato_2') != states('input_datetime.vmc_cucina_spegnimento_sabato_2') and states('input_datetime.vmc_cucina_accensione_sabato') < states('input_datetime.vmc_cucina_accensione_sabato_2') and states('input_datetime.vmc_cucina_spegnimento_sabato') < states('input_datetime.vmc_cucina_spegnimento_sabato_2') and states('input_datetime.vmc_cucina_accensione_sabato') != states('input_datetime.vmc_cucina_accensione_sabato_2') and states('input_datetime.vmc_cucina_spegnimento_sabato') != states('input_datetime.vmc_cucina_spegnimento_sabato_2') and states('input_datetime.vmc_cucina_spegnimento_sabato') != states('input_datetime.vmc_cucina_accensione_sabato_2') and states('input_datetime.vmc_cucina_accensione_sabato_2') > states('input_datetime.vmc_cucina_spegnimento_sabato') and states('input_boolean.vmc_cucina_opzioni_accendi_spegni_vmc_vs_calendario') == 'on' %}
              Sabato, {{ states('input_datetime.vmc_cucina_accensione_sabato')[0:5] }}
            {% elif weekday == 6 and states('input_datetime.vmc_cucina_accensione_domenica') < states('input_datetime.vmc_cucina_spegnimento_domenica') and states('input_datetime.vmc_cucina_accensione_domenica') != states('input_datetime.vmc_cucina_spegnimento_domenica') and states('input_datetime.vmc_cucina_accensione_domenica_2') < states('input_datetime.vmc_cucina_spegnimento_domenica_2') and states('input_datetime.vmc_cucina_accensione_domenica_2') != states('input_datetime.vmc_cucina_spegnimento_domenica_2') and states('input_datetime.vmc_cucina_accensione_domenica') < states('input_datetime.vmc_cucina_accensione_domenica_2') and states('input_datetime.vmc_cucina_spegnimento_domenica') < states('input_datetime.vmc_cucina_spegnimento_domenica_2') and states('input_datetime.vmc_cucina_accensione_domenica') != states('input_datetime.vmc_cucina_accensione_domenica_2') and states('input_datetime.vmc_cucina_spegnimento_domenica') != states('input_datetime.vmc_cucina_spegnimento_domenica_2') and states('input_datetime.vmc_cucina_spegnimento_domenica') != states('input_datetime.vmc_cucina_accensione_domenica_2') and states('input_datetime.vmc_cucina_accensione_domenica_2') > states('input_datetime.vmc_cucina_spegnimento_domenica') and states('input_boolean.vmc_cucina_opzioni_accendi_spegni_vmc_vs_calendario') == 'on' %}
              Domenica, {{ states('input_datetime.vmc_cucina_accensione_domenica')[0:5] }}
              {% else %}
                Disabilitata
              {% endif %}
          {% endif %}            
        icon_template: mdi:timer-play-outline

      vmc_cucina_status_accensione_vmc_tramite_calendario_2:                   #  [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI] [INTERFACCIA, PIU’ RICHIAMI] SENSORE DI VERIFICA 2° FASCIA ACCENSIONE SE GLI ORARI SONO STATI INSERITI CORRETTAMENTE, DIVERSAMENTE MOSTRERA' "DISABILITATA"
        friendly_name: "2° Accensione programmata"
        value_template: >-
          {% set stati = ['unknown', 'unavailable'] %}
          {% if states('sensor.vmc_cucina_sensori') in stati %}
            Non disponibile
          {% else %}        
            {% set weekday = now().weekday() %}
            {% if weekday == 0 and states('input_datetime.vmc_cucina_accensione_lunedi') < states('input_datetime.vmc_cucina_spegnimento_lunedi') and states('input_datetime.vmc_cucina_accensione_lunedi') != states('input_datetime.vmc_cucina_spegnimento_lunedi') and states('input_datetime.vmc_cucina_accensione_lunedi_2') < states('input_datetime.vmc_cucina_spegnimento_lunedi_2') and states('input_datetime.vmc_cucina_accensione_lunedi_2') != states('input_datetime.vmc_cucina_spegnimento_lunedi_2') and states('input_datetime.vmc_cucina_accensione_lunedi') < states('input_datetime.vmc_cucina_accensione_lunedi_2') and states('input_datetime.vmc_cucina_spegnimento_lunedi') < states('input_datetime.vmc_cucina_spegnimento_lunedi_2') and states('input_datetime.vmc_cucina_accensione_lunedi') != states('input_datetime.vmc_cucina_accensione_lunedi_2') and states('input_datetime.vmc_cucina_spegnimento_lunedi') != states('input_datetime.vmc_cucina_spegnimento_lunedi_2') and states('input_datetime.vmc_cucina_spegnimento_lunedi') != states('input_datetime.vmc_cucina_accensione_lunedi_2') and states('input_datetime.vmc_cucina_accensione_lunedi_2') > states('input_datetime.vmc_cucina_spegnimento_lunedi') and states('input_boolean.vmc_cucina_opzioni_accendi_spegni_vmc_vs_calendario') == 'on' %}
              Lunedi, {{ states('input_datetime.vmc_cucina_accensione_lunedi_2')[0:5] }}
            {% elif weekday == 1 and states('input_datetime.vmc_cucina_accensione_martedi') < states('input_datetime.vmc_cucina_spegnimento_martedi') and states('input_datetime.vmc_cucina_accensione_martedi') != states('input_datetime.vmc_cucina_spegnimento_martedi') and states('input_datetime.vmc_cucina_accensione_martedi_2') < states('input_datetime.vmc_cucina_spegnimento_martedi_2') and states('input_datetime.vmc_cucina_accensione_martedi_2') != states('input_datetime.vmc_cucina_spegnimento_martedi_2') and states('input_datetime.vmc_cucina_accensione_martedi') < states('input_datetime.vmc_cucina_accensione_martedi_2') and states('input_datetime.vmc_cucina_spegnimento_martedi') < states('input_datetime.vmc_cucina_spegnimento_martedi_2') and states('input_datetime.vmc_cucina_accensione_martedi') != states('input_datetime.vmc_cucina_accensione_martedi_2') and states('input_datetime.vmc_cucina_spegnimento_martedi') != states('input_datetime.vmc_cucina_spegnimento_martedi_2') and states('input_datetime.vmc_cucina_spegnimento_martedi') != states('input_datetime.vmc_cucina_accensione_martedi_2') and states('input_datetime.vmc_cucina_accensione_martedi_2') > states('input_datetime.vmc_cucina_spegnimento_martedi') and states('input_boolean.vmc_cucina_opzioni_accendi_spegni_vmc_vs_calendario') == 'on' %}
              Martedi, {{ states('input_datetime.vmc_cucina_accensione_martedi_2')[0:5] }}
            {% elif weekday == 2 and states('input_datetime.vmc_cucina_accensione_mercoledi') < states('input_datetime.vmc_cucina_spegnimento_mercoledi') and states('input_datetime.vmc_cucina_accensione_mercoledi') != states('input_datetime.vmc_cucina_spegnimento_mercoledi') and states('input_datetime.vmc_cucina_accensione_mercoledi_2') < states('input_datetime.vmc_cucina_spegnimento_mercoledi_2') and states('input_datetime.vmc_cucina_accensione_mercoledi_2') != states('input_datetime.vmc_cucina_spegnimento_mercoledi_2') and states('input_datetime.vmc_cucina_accensione_mercoledi') < states('input_datetime.vmc_cucina_accensione_mercoledi_2') and states('input_datetime.vmc_cucina_spegnimento_mercoledi') < states('input_datetime.vmc_cucina_spegnimento_mercoledi_2') and states('input_datetime.vmc_cucina_accensione_mercoledi') != states('input_datetime.vmc_cucina_accensione_mercoledi_2') and states('input_datetime.vmc_cucina_spegnimento_mercoledi') != states('input_datetime.vmc_cucina_spegnimento_mercoledi_2') and states('input_datetime.vmc_cucina_spegnimento_mercoledi') != states('input_datetime.vmc_cucina_accensione_mercoledi_2') and states('input_datetime.vmc_cucina_accensione_mercoledi_2') > states('input_datetime.vmc_cucina_spegnimento_mercoledi') and states('input_boolean.vmc_cucina_opzioni_accendi_spegni_vmc_vs_calendario') == 'on' %}
              Mercoledi, {{ states('input_datetime.vmc_cucina_accensione_mercoledi_2')[0:5] }}
            {% elif weekday == 3 and states('input_datetime.vmc_cucina_accensione_giovedi') < states('input_datetime.vmc_cucina_spegnimento_giovedi') and states('input_datetime.vmc_cucina_accensione_giovedi') != states('input_datetime.vmc_cucina_spegnimento_giovedi') and states('input_datetime.vmc_cucina_accensione_giovedi_2') < states('input_datetime.vmc_cucina_spegnimento_giovedi_2') and states('input_datetime.vmc_cucina_accensione_giovedi_2') != states('input_datetime.vmc_cucina_spegnimento_giovedi_2') and states('input_datetime.vmc_cucina_accensione_giovedi') < states('input_datetime.vmc_cucina_accensione_giovedi_2') and states('input_datetime.vmc_cucina_spegnimento_giovedi') < states('input_datetime.vmc_cucina_spegnimento_giovedi_2') and states('input_datetime.vmc_cucina_accensione_giovedi') != states('input_datetime.vmc_cucina_accensione_giovedi_2') and states('input_datetime.vmc_cucina_spegnimento_giovedi') != states('input_datetime.vmc_cucina_spegnimento_giovedi_2') and states('input_datetime.vmc_cucina_spegnimento_giovedi') != states('input_datetime.vmc_cucina_accensione_giovedi_2') and states('input_datetime.vmc_cucina_accensione_giovedi_2') > states('input_datetime.vmc_cucina_spegnimento_giovedi') and states('input_boolean.vmc_cucina_opzioni_accendi_spegni_vmc_vs_calendario') == 'on' %}
              Giovedi, {{ states('input_datetime.vmc_cucina_accensione_giovedi_2')[0:5] }}
            {% elif weekday == 4 and states('input_datetime.vmc_cucina_accensione_venerdi') < states('input_datetime.vmc_cucina_spegnimento_venerdi') and states('input_datetime.vmc_cucina_accensione_venerdi') != states('input_datetime.vmc_cucina_spegnimento_venerdi') and states('input_datetime.vmc_cucina_accensione_venerdi_2') < states('input_datetime.vmc_cucina_spegnimento_venerdi_2') and states('input_datetime.vmc_cucina_accensione_venerdi_2') != states('input_datetime.vmc_cucina_spegnimento_venerdi_2') and states('input_datetime.vmc_cucina_accensione_venerdi') < states('input_datetime.vmc_cucina_accensione_venerdi_2') and states('input_datetime.vmc_cucina_spegnimento_venerdi') < states('input_datetime.vmc_cucina_spegnimento_venerdi_2') and states('input_datetime.vmc_cucina_accensione_venerdi') != states('input_datetime.vmc_cucina_accensione_venerdi_2') and states('input_datetime.vmc_cucina_spegnimento_venerdi') != states('input_datetime.vmc_cucina_spegnimento_venerdi_2') and states('input_datetime.vmc_cucina_spegnimento_venerdi') != states('input_datetime.vmc_cucina_accensione_venerdi_2') and states('input_datetime.vmc_cucina_accensione_venerdi_2') > states('input_datetime.vmc_cucina_spegnimento_venerdi') and states('input_boolean.vmc_cucina_opzioni_accendi_spegni_vmc_vs_calendario') == 'on' %}
              Venerdi, {{ states('input_datetime.vmc_cucina_accensione_venerdi_2')[0:5] }}
            {% elif weekday == 5 and states('input_datetime.vmc_cucina_accensione_sabato') < states('input_datetime.vmc_cucina_spegnimento_sabato') and states('input_datetime.vmc_cucina_accensione_sabato') != states('input_datetime.vmc_cucina_spegnimento_sabato') and states('input_datetime.vmc_cucina_accensione_sabato_2') < states('input_datetime.vmc_cucina_spegnimento_sabato_2') and states('input_datetime.vmc_cucina_accensione_sabato_2') != states('input_datetime.vmc_cucina_spegnimento_sabato_2') and states('input_datetime.vmc_cucina_accensione_sabato') < states('input_datetime.vmc_cucina_accensione_sabato_2') and states('input_datetime.vmc_cucina_spegnimento_sabato') < states('input_datetime.vmc_cucina_spegnimento_sabato_2') and states('input_datetime.vmc_cucina_accensione_sabato') != states('input_datetime.vmc_cucina_accensione_sabato_2') and states('input_datetime.vmc_cucina_spegnimento_sabato') != states('input_datetime.vmc_cucina_spegnimento_sabato_2') and states('input_datetime.vmc_cucina_spegnimento_sabato') != states('input_datetime.vmc_cucina_accensione_sabato_2') and states('input_datetime.vmc_cucina_accensione_sabato_2') > states('input_datetime.vmc_cucina_spegnimento_sabato') and states('input_boolean.vmc_cucina_opzioni_accendi_spegni_vmc_vs_calendario') == 'on' %}
              Sabato, {{ states('input_datetime.vmc_cucina_accensione_sabato_2')[0:5] }}
            {% elif weekday == 6 and states('input_datetime.vmc_cucina_accensione_domenica') < states('input_datetime.vmc_cucina_spegnimento_domenica') and states('input_datetime.vmc_cucina_accensione_domenica') != states('input_datetime.vmc_cucina_spegnimento_domenica') and states('input_datetime.vmc_cucina_accensione_domenica_2') < states('input_datetime.vmc_cucina_spegnimento_domenica_2') and states('input_datetime.vmc_cucina_accensione_domenica_2') != states('input_datetime.vmc_cucina_spegnimento_domenica_2') and states('input_datetime.vmc_cucina_accensione_domenica') < states('input_datetime.vmc_cucina_accensione_domenica_2') and states('input_datetime.vmc_cucina_spegnimento_domenica') < states('input_datetime.vmc_cucina_spegnimento_domenica_2') and states('input_datetime.vmc_cucina_accensione_domenica') != states('input_datetime.vmc_cucina_accensione_domenica_2') and states('input_datetime.vmc_cucina_spegnimento_domenica') != states('input_datetime.vmc_cucina_spegnimento_domenica_2') and states('input_datetime.vmc_cucina_spegnimento_domenica') != states('input_datetime.vmc_cucina_accensione_domenica_2') and states('input_datetime.vmc_cucina_accensione_domenica_2') > states('input_datetime.vmc_cucina_spegnimento_domenica') and states('input_boolean.vmc_cucina_opzioni_accendi_spegni_vmc_vs_calendario') == 'on' %}
              Domenica, {{ states('input_datetime.vmc_cucina_accensione_domenica_2')[0:5] }}
              {% else %}
                Disabilitata
              {% endif %}
          {% endif %}            
        icon_template: mdi:timer-play-outline

      vmc_cucina_status_spegnimento_vmc_tramite_calendario:                    # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI] [INTERFACCIA, PIU’ RICHIAMI]  SENSORE DI VERIFICA 1° FASCIA SPEGNIMENTO SE GLI ORARI SONO STATI INSERITI CORRETTAMENTE, DIVERSAMENTE MOSTRERA' "DISABILITATO"
        friendly_name: "1° Spegnimento programmato"
        value_template: >-
          {% set stati = ['unknown', 'unavailable'] %}
          {% if states('sensor.vmc_cucina_sensori') in stati %}
            Non disponibile
          {% else %}        
            {% set weekday = now().weekday() %}
            {% if weekday == 0 and states('input_datetime.vmc_cucina_accensione_lunedi') < states('input_datetime.vmc_cucina_spegnimento_lunedi') and states('input_datetime.vmc_cucina_accensione_lunedi') != states('input_datetime.vmc_cucina_spegnimento_lunedi') and states('input_datetime.vmc_cucina_accensione_lunedi_2') < states('input_datetime.vmc_cucina_spegnimento_lunedi_2') and states('input_datetime.vmc_cucina_accensione_lunedi_2') != states('input_datetime.vmc_cucina_spegnimento_lunedi_2') and states('input_datetime.vmc_cucina_accensione_lunedi') < states('input_datetime.vmc_cucina_accensione_lunedi_2') and states('input_datetime.vmc_cucina_spegnimento_lunedi') < states('input_datetime.vmc_cucina_spegnimento_lunedi_2') and states('input_datetime.vmc_cucina_accensione_lunedi') != states('input_datetime.vmc_cucina_accensione_lunedi_2') and states('input_datetime.vmc_cucina_spegnimento_lunedi') != states('input_datetime.vmc_cucina_spegnimento_lunedi_2') and states('input_datetime.vmc_cucina_spegnimento_lunedi') != states('input_datetime.vmc_cucina_accensione_lunedi_2') and states('input_datetime.vmc_cucina_accensione_lunedi_2') > states('input_datetime.vmc_cucina_spegnimento_lunedi') and states('input_boolean.vmc_cucina_opzioni_accendi_spegni_vmc_vs_calendario') == 'on' %}
              Lunedi, {{ states('input_datetime.vmc_cucina_spegnimento_lunedi')[0:5] }}
            {% elif weekday == 1 and states('input_datetime.vmc_cucina_accensione_martedi') < states('input_datetime.vmc_cucina_spegnimento_martedi') and states('input_datetime.vmc_cucina_accensione_martedi') != states('input_datetime.vmc_cucina_spegnimento_martedi') and states('input_datetime.vmc_cucina_accensione_martedi_2') < states('input_datetime.vmc_cucina_spegnimento_martedi_2') and states('input_datetime.vmc_cucina_accensione_martedi_2') != states('input_datetime.vmc_cucina_spegnimento_martedi_2') and states('input_datetime.vmc_cucina_accensione_martedi') < states('input_datetime.vmc_cucina_accensione_martedi_2') and states('input_datetime.vmc_cucina_spegnimento_martedi') < states('input_datetime.vmc_cucina_spegnimento_martedi_2') and states('input_datetime.vmc_cucina_accensione_martedi') != states('input_datetime.vmc_cucina_accensione_martedi_2') and states('input_datetime.vmc_cucina_spegnimento_martedi') != states('input_datetime.vmc_cucina_spegnimento_martedi_2') and states('input_datetime.vmc_cucina_spegnimento_martedi') != states('input_datetime.vmc_cucina_accensione_martedi_2') and states('input_datetime.vmc_cucina_accensione_martedi_2') > states('input_datetime.vmc_cucina_spegnimento_martedi') and states('input_boolean.vmc_cucina_opzioni_accendi_spegni_vmc_vs_calendario') == 'on' %}
              Martedi, {{ states('input_datetime.vmc_cucina_spegnimento_martedi')[0:5] }}
            {% elif weekday == 2 and states('input_datetime.vmc_cucina_accensione_mercoledi') < states('input_datetime.vmc_cucina_spegnimento_mercoledi') and states('input_datetime.vmc_cucina_accensione_mercoledi') != states('input_datetime.vmc_cucina_spegnimento_mercoledi') and states('input_datetime.vmc_cucina_accensione_mercoledi_2') < states('input_datetime.vmc_cucina_spegnimento_mercoledi_2') and states('input_datetime.vmc_cucina_accensione_mercoledi_2') != states('input_datetime.vmc_cucina_spegnimento_mercoledi_2') and states('input_datetime.vmc_cucina_accensione_mercoledi') < states('input_datetime.vmc_cucina_accensione_mercoledi_2') and states('input_datetime.vmc_cucina_spegnimento_mercoledi') < states('input_datetime.vmc_cucina_spegnimento_mercoledi_2') and states('input_datetime.vmc_cucina_accensione_mercoledi') != states('input_datetime.vmc_cucina_accensione_mercoledi_2') and states('input_datetime.vmc_cucina_spegnimento_mercoledi') != states('input_datetime.vmc_cucina_spegnimento_mercoledi_2') and states('input_datetime.vmc_cucina_spegnimento_mercoledi') != states('input_datetime.vmc_cucina_accensione_mercoledi_2') and states('input_datetime.vmc_cucina_accensione_mercoledi_2') > states('input_datetime.vmc_cucina_spegnimento_mercoledi') and states('input_boolean.vmc_cucina_opzioni_accendi_spegni_vmc_vs_calendario') == 'on' %}
              Mercoledi, {{ states('input_datetime.vmc_cucina_spegnimento_mercoledi')[0:5] }}
            {% elif weekday == 3 and states('input_datetime.vmc_cucina_accensione_giovedi') < states('input_datetime.vmc_cucina_spegnimento_giovedi') and states('input_datetime.vmc_cucina_accensione_giovedi') != states('input_datetime.vmc_cucina_spegnimento_giovedi') and states('input_datetime.vmc_cucina_accensione_giovedi_2') < states('input_datetime.vmc_cucina_spegnimento_giovedi_2') and states('input_datetime.vmc_cucina_accensione_giovedi_2') != states('input_datetime.vmc_cucina_spegnimento_giovedi_2') and states('input_datetime.vmc_cucina_accensione_giovedi') < states('input_datetime.vmc_cucina_accensione_giovedi_2') and states('input_datetime.vmc_cucina_spegnimento_giovedi') < states('input_datetime.vmc_cucina_spegnimento_giovedi_2') and states('input_datetime.vmc_cucina_accensione_giovedi') != states('input_datetime.vmc_cucina_accensione_giovedi_2') and states('input_datetime.vmc_cucina_spegnimento_giovedi') != states('input_datetime.vmc_cucina_spegnimento_giovedi_2') and states('input_datetime.vmc_cucina_spegnimento_giovedi') != states('input_datetime.vmc_cucina_accensione_giovedi_2') and states('input_datetime.vmc_cucina_accensione_giovedi_2') > states('input_datetime.vmc_cucina_spegnimento_giovedi') and states('input_boolean.vmc_cucina_opzioni_accendi_spegni_vmc_vs_calendario') == 'on' %}
              Giovedi, {{ states('input_datetime.vmc_cucina_spegnimento_giovedi')[0:5] }}
            {% elif weekday == 4 and states('input_datetime.vmc_cucina_accensione_venerdi') < states('input_datetime.vmc_cucina_spegnimento_venerdi') and states('input_datetime.vmc_cucina_accensione_venerdi') != states('input_datetime.vmc_cucina_spegnimento_venerdi') and states('input_datetime.vmc_cucina_accensione_venerdi_2') < states('input_datetime.vmc_cucina_spegnimento_venerdi_2') and states('input_datetime.vmc_cucina_accensione_venerdi_2') != states('input_datetime.vmc_cucina_spegnimento_venerdi_2') and states('input_datetime.vmc_cucina_accensione_venerdi') < states('input_datetime.vmc_cucina_accensione_venerdi_2') and states('input_datetime.vmc_cucina_spegnimento_venerdi') < states('input_datetime.vmc_cucina_spegnimento_venerdi_2') and states('input_datetime.vmc_cucina_accensione_venerdi') != states('input_datetime.vmc_cucina_accensione_venerdi_2') and states('input_datetime.vmc_cucina_spegnimento_venerdi') != states('input_datetime.vmc_cucina_spegnimento_venerdi_2') and states('input_datetime.vmc_cucina_spegnimento_venerdi') != states('input_datetime.vmc_cucina_accensione_venerdi_2') and states('input_datetime.vmc_cucina_accensione_venerdi_2') > states('input_datetime.vmc_cucina_spegnimento_venerdi') and states('input_boolean.vmc_cucina_opzioni_accendi_spegni_vmc_vs_calendario') == 'on' %}
              Venerdi, {{ states('input_datetime.vmc_cucina_spegnimento_venerdi')[0:5] }}
            {% elif weekday == 5 and states('input_datetime.vmc_cucina_accensione_sabato') < states('input_datetime.vmc_cucina_spegnimento_sabato') and states('input_datetime.vmc_cucina_accensione_sabato') != states('input_datetime.vmc_cucina_spegnimento_sabato') and states('input_datetime.vmc_cucina_accensione_sabato_2') < states('input_datetime.vmc_cucina_spegnimento_sabato_2') and states('input_datetime.vmc_cucina_accensione_sabato_2') != states('input_datetime.vmc_cucina_spegnimento_sabato_2') and states('input_datetime.vmc_cucina_accensione_sabato') < states('input_datetime.vmc_cucina_accensione_sabato_2') and states('input_datetime.vmc_cucina_spegnimento_sabato') < states('input_datetime.vmc_cucina_spegnimento_sabato_2') and states('input_datetime.vmc_cucina_accensione_sabato') != states('input_datetime.vmc_cucina_accensione_sabato_2') and states('input_datetime.vmc_cucina_spegnimento_sabato') != states('input_datetime.vmc_cucina_spegnimento_sabato_2') and states('input_datetime.vmc_cucina_spegnimento_sabato') != states('input_datetime.vmc_cucina_accensione_sabato_2') and states('input_datetime.vmc_cucina_accensione_sabato_2') > states('input_datetime.vmc_cucina_spegnimento_sabato') and states('input_boolean.vmc_cucina_opzioni_accendi_spegni_vmc_vs_calendario') == 'on' %}
              Sabato, {{ states('input_datetime.vmc_cucina_spegnimento_sabato')[0:5] }}
            {% elif weekday == 6 and states('input_datetime.vmc_cucina_accensione_domenica') < states('input_datetime.vmc_cucina_spegnimento_domenica') and states('input_datetime.vmc_cucina_accensione_domenica') != states('input_datetime.vmc_cucina_spegnimento_domenica') and states('input_datetime.vmc_cucina_accensione_domenica_2') < states('input_datetime.vmc_cucina_spegnimento_domenica_2') and states('input_datetime.vmc_cucina_accensione_domenica_2') != states('input_datetime.vmc_cucina_spegnimento_domenica_2') and states('input_datetime.vmc_cucina_accensione_domenica') < states('input_datetime.vmc_cucina_accensione_domenica_2') and states('input_datetime.vmc_cucina_spegnimento_domenica') < states('input_datetime.vmc_cucina_spegnimento_domenica_2') and states('input_datetime.vmc_cucina_accensione_domenica') != states('input_datetime.vmc_cucina_accensione_domenica_2') and states('input_datetime.vmc_cucina_spegnimento_domenica') != states('input_datetime.vmc_cucina_spegnimento_domenica_2') and states('input_datetime.vmc_cucina_spegnimento_domenica') != states('input_datetime.vmc_cucina_accensione_domenica_2') and states('input_datetime.vmc_cucina_accensione_domenica_2') > states('input_datetime.vmc_cucina_spegnimento_domenica') and states('input_boolean.vmc_cucina_opzioni_accendi_spegni_vmc_vs_calendario') == 'on' %}
              Domenica, {{ states('input_datetime.vmc_cucina_spegnimento_domenica')[0:5] }}
              {% else %}
                Disabilitata
              {% endif %}
          {% endif %}         
        icon_template: mdi:timer-stop-outline

      vmc_cucina_status_spegnimento_vmc_tramite_calendario_2:                  # vmc_cucina_status_spegnimento_vmc_tramite_calendario SENSORE DI VERIFICA 2° FASCIA SPEGNIMENTO SE GLI ORARI SONO STATI INSERITI CORRETTAMENTE, DIVERSAMENTE MOSTRERA' "DISABILITATO"
        friendly_name: "2° Spegnimento programmato"
        value_template: >-
          {% set stati = ['unknown', 'unavailable'] %}
          {% if states('sensor.vmc_cucina_sensori') in stati %}
            Non disponibile
          {% else %}        
            {% set weekday = now().weekday() %}
            {% if weekday == 0 and states('input_datetime.vmc_cucina_accensione_lunedi') < states('input_datetime.vmc_cucina_spegnimento_lunedi') and states('input_datetime.vmc_cucina_accensione_lunedi') != states('input_datetime.vmc_cucina_spegnimento_lunedi') and states('input_datetime.vmc_cucina_accensione_lunedi_2') < states('input_datetime.vmc_cucina_spegnimento_lunedi_2') and states('input_datetime.vmc_cucina_accensione_lunedi_2') != states('input_datetime.vmc_cucina_spegnimento_lunedi_2') and states('input_datetime.vmc_cucina_accensione_lunedi') < states('input_datetime.vmc_cucina_accensione_lunedi_2') and states('input_datetime.vmc_cucina_spegnimento_lunedi') < states('input_datetime.vmc_cucina_spegnimento_lunedi_2') and states('input_datetime.vmc_cucina_accensione_lunedi') != states('input_datetime.vmc_cucina_accensione_lunedi_2') and states('input_datetime.vmc_cucina_spegnimento_lunedi') != states('input_datetime.vmc_cucina_spegnimento_lunedi_2') and states('input_datetime.vmc_cucina_spegnimento_lunedi') != states('input_datetime.vmc_cucina_accensione_lunedi_2') and states('input_datetime.vmc_cucina_accensione_lunedi_2') > states('input_datetime.vmc_cucina_spegnimento_lunedi') and states('input_boolean.vmc_cucina_opzioni_accendi_spegni_vmc_vs_calendario') == 'on' %}
              Lunedi, {{ states('input_datetime.vmc_cucina_spegnimento_lunedi_2')[0:5] }}
            {% elif weekday == 1 and states('input_datetime.vmc_cucina_accensione_martedi') < states('input_datetime.vmc_cucina_spegnimento_martedi') and states('input_datetime.vmc_cucina_accensione_martedi') != states('input_datetime.vmc_cucina_spegnimento_martedi') and states('input_datetime.vmc_cucina_accensione_martedi_2') < states('input_datetime.vmc_cucina_spegnimento_martedi_2') and states('input_datetime.vmc_cucina_accensione_martedi_2') != states('input_datetime.vmc_cucina_spegnimento_martedi_2') and states('input_datetime.vmc_cucina_accensione_martedi') < states('input_datetime.vmc_cucina_accensione_martedi_2') and states('input_datetime.vmc_cucina_spegnimento_martedi') < states('input_datetime.vmc_cucina_spegnimento_martedi_2') and states('input_datetime.vmc_cucina_accensione_martedi') != states('input_datetime.vmc_cucina_accensione_martedi_2') and states('input_datetime.vmc_cucina_spegnimento_martedi') != states('input_datetime.vmc_cucina_spegnimento_martedi_2') and states('input_datetime.vmc_cucina_spegnimento_martedi') != states('input_datetime.vmc_cucina_accensione_martedi_2') and states('input_datetime.vmc_cucina_accensione_martedi_2') > states('input_datetime.vmc_cucina_spegnimento_martedi') and states('input_boolean.vmc_cucina_opzioni_accendi_spegni_vmc_vs_calendario') == 'on' %}
              Martedi, {{ states('input_datetime.vmc_cucina_spegnimento_martedi_2')[0:5] }}
            {% elif weekday == 2 and states('input_datetime.vmc_cucina_accensione_mercoledi') < states('input_datetime.vmc_cucina_spegnimento_mercoledi') and states('input_datetime.vmc_cucina_accensione_mercoledi') != states('input_datetime.vmc_cucina_spegnimento_mercoledi') and states('input_datetime.vmc_cucina_accensione_mercoledi_2') < states('input_datetime.vmc_cucina_spegnimento_mercoledi_2') and states('input_datetime.vmc_cucina_accensione_mercoledi_2') != states('input_datetime.vmc_cucina_spegnimento_mercoledi_2') and states('input_datetime.vmc_cucina_accensione_mercoledi') < states('input_datetime.vmc_cucina_accensione_mercoledi_2') and states('input_datetime.vmc_cucina_spegnimento_mercoledi') < states('input_datetime.vmc_cucina_spegnimento_mercoledi_2') and states('input_datetime.vmc_cucina_accensione_mercoledi') != states('input_datetime.vmc_cucina_accensione_mercoledi_2') and states('input_datetime.vmc_cucina_spegnimento_mercoledi') != states('input_datetime.vmc_cucina_spegnimento_mercoledi_2') and states('input_datetime.vmc_cucina_spegnimento_mercoledi') != states('input_datetime.vmc_cucina_accensione_mercoledi_2') and states('input_datetime.vmc_cucina_accensione_mercoledi_2') > states('input_datetime.vmc_cucina_spegnimento_mercoledi') and states('input_boolean.vmc_cucina_opzioni_accendi_spegni_vmc_vs_calendario') == 'on' %}
              Mercoledi, {{ states('input_datetime.vmc_cucina_spegnimento_mercoledi_2')[0:5] }}
            {% elif weekday == 3 and states('input_datetime.vmc_cucina_accensione_giovedi') < states('input_datetime.vmc_cucina_spegnimento_giovedi') and states('input_datetime.vmc_cucina_accensione_giovedi') != states('input_datetime.vmc_cucina_spegnimento_giovedi') and states('input_datetime.vmc_cucina_accensione_giovedi_2') < states('input_datetime.vmc_cucina_spegnimento_giovedi_2') and states('input_datetime.vmc_cucina_accensione_giovedi_2') != states('input_datetime.vmc_cucina_spegnimento_giovedi_2') and states('input_datetime.vmc_cucina_accensione_giovedi') < states('input_datetime.vmc_cucina_accensione_giovedi_2') and states('input_datetime.vmc_cucina_spegnimento_giovedi') < states('input_datetime.vmc_cucina_spegnimento_giovedi_2') and states('input_datetime.vmc_cucina_accensione_giovedi') != states('input_datetime.vmc_cucina_accensione_giovedi_2') and states('input_datetime.vmc_cucina_spegnimento_giovedi') != states('input_datetime.vmc_cucina_spegnimento_giovedi_2') and states('input_datetime.vmc_cucina_spegnimento_giovedi') != states('input_datetime.vmc_cucina_accensione_giovedi_2') and states('input_datetime.vmc_cucina_accensione_giovedi_2') > states('input_datetime.vmc_cucina_spegnimento_giovedi') and states('input_boolean.vmc_cucina_opzioni_accendi_spegni_vmc_vs_calendario') == 'on' %}
              Giovedi, {{ states('input_datetime.vmc_cucina_spegnimento_giovedi_2')[0:5] }}
            {% elif weekday == 4 and states('input_datetime.vmc_cucina_accensione_venerdi') < states('input_datetime.vmc_cucina_spegnimento_venerdi') and states('input_datetime.vmc_cucina_accensione_venerdi') != states('input_datetime.vmc_cucina_spegnimento_venerdi') and states('input_datetime.vmc_cucina_accensione_venerdi_2') < states('input_datetime.vmc_cucina_spegnimento_venerdi_2') and states('input_datetime.vmc_cucina_accensione_venerdi_2') != states('input_datetime.vmc_cucina_spegnimento_venerdi_2') and states('input_datetime.vmc_cucina_accensione_venerdi') < states('input_datetime.vmc_cucina_accensione_venerdi_2') and states('input_datetime.vmc_cucina_spegnimento_venerdi') < states('input_datetime.vmc_cucina_spegnimento_venerdi_2') and states('input_datetime.vmc_cucina_accensione_venerdi') != states('input_datetime.vmc_cucina_accensione_venerdi_2') and states('input_datetime.vmc_cucina_spegnimento_venerdi') != states('input_datetime.vmc_cucina_spegnimento_venerdi_2') and states('input_datetime.vmc_cucina_spegnimento_venerdi') != states('input_datetime.vmc_cucina_accensione_venerdi_2') and states('input_datetime.vmc_cucina_accensione_venerdi_2') > states('input_datetime.vmc_cucina_spegnimento_venerdi') and states('input_boolean.vmc_cucina_opzioni_accendi_spegni_vmc_vs_calendario') == 'on' %}
              Venerdi, {{ states('input_datetime.vmc_cucina_spegnimento_venerdi_2')[0:5] }}
            {% elif weekday == 5 and states('input_datetime.vmc_cucina_accensione_sabato') < states('input_datetime.vmc_cucina_spegnimento_sabato') and states('input_datetime.vmc_cucina_accensione_sabato') != states('input_datetime.vmc_cucina_spegnimento_sabato') and states('input_datetime.vmc_cucina_accensione_sabato_2') < states('input_datetime.vmc_cucina_spegnimento_sabato_2') and states('input_datetime.vmc_cucina_accensione_sabato_2') != states('input_datetime.vmc_cucina_spegnimento_sabato_2') and states('input_datetime.vmc_cucina_accensione_sabato') < states('input_datetime.vmc_cucina_accensione_sabato_2') and states('input_datetime.vmc_cucina_spegnimento_sabato') < states('input_datetime.vmc_cucina_spegnimento_sabato_2') and states('input_datetime.vmc_cucina_accensione_sabato') != states('input_datetime.vmc_cucina_accensione_sabato_2') and states('input_datetime.vmc_cucina_spegnimento_sabato') != states('input_datetime.vmc_cucina_spegnimento_sabato_2') and states('input_datetime.vmc_cucina_spegnimento_sabato') != states('input_datetime.vmc_cucina_accensione_sabato_2') and states('input_datetime.vmc_cucina_accensione_sabato_2') > states('input_datetime.vmc_cucina_spegnimento_sabato') and states('input_boolean.vmc_cucina_opzioni_accendi_spegni_vmc_vs_calendario') == 'on' %}
              Sabato, {{ states('input_datetime.vmc_cucina_spegnimento_sabato_2')[0:5] }}
            {% elif weekday == 6 and states('input_datetime.vmc_cucina_accensione_domenica') < states('input_datetime.vmc_cucina_spegnimento_domenica') and states('input_datetime.vmc_cucina_accensione_domenica') != states('input_datetime.vmc_cucina_spegnimento_domenica') and states('input_datetime.vmc_cucina_accensione_domenica_2') < states('input_datetime.vmc_cucina_spegnimento_domenica_2') and states('input_datetime.vmc_cucina_accensione_domenica_2') != states('input_datetime.vmc_cucina_spegnimento_domenica_2') and states('input_datetime.vmc_cucina_accensione_domenica') < states('input_datetime.vmc_cucina_accensione_domenica_2') and states('input_datetime.vmc_cucina_spegnimento_domenica') < states('input_datetime.vmc_cucina_spegnimento_domenica_2') and states('input_datetime.vmc_cucina_accensione_domenica') != states('input_datetime.vmc_cucina_accensione_domenica_2') and states('input_datetime.vmc_cucina_spegnimento_domenica') != states('input_datetime.vmc_cucina_spegnimento_domenica_2') and states('input_datetime.vmc_cucina_spegnimento_domenica') != states('input_datetime.vmc_cucina_accensione_domenica_2') and states('input_datetime.vmc_cucina_accensione_domenica_2') > states('input_datetime.vmc_cucina_spegnimento_domenica') and states('input_boolean.vmc_cucina_opzioni_accendi_spegni_vmc_vs_calendario') == 'on' %}
              Domenica, {{ states('input_datetime.vmc_cucina_spegnimento_domenica_2')[0:5] }}
              {% else %}
                Disabilitata
              {% endif %}
          {% endif %}         
        icon_template: mdi:timer-stop-outline
################### Fine Creazione Sensori Interfaccia Calendario  #################################################################################################################################################################

################### Inizio Creazione Lettura Valore Etichette ###############################################################################################################################################################
      vmc_cucina_speed_1_fascia_calendario:                                    # [CONFIGURAZIONE 0 RICHIAMI] SENSORE DI LETTURA DEL VALORE INSERITO TRAMITE INTERFACCIA, NEL SENSORE input_select vmc_cucina_speed
        friendly_name: "Set Velocità 1° Fascia Calendario"
        value_template: "{{ states('input_select.vmc_cucina_speed_1_fascia_calendario') | default('') }}"

      vmc_cucina_speed_2_fascia_calendario:                                    # [CONFIGURAZIONE 0 RICHIAMI] SENSORE DI LETTURA DEL VALORE INSERITO TRAMITE INTERFACCIA, NEL SENSORE input_select vmc_cucina_speed
        friendly_name: "Set Velocità 2° Fascia Calendario"
        value_template: "{{ states('input_select.vmc_cucina_speed_2_fascia_calendario') | default('') }}"
################### Fine Creazione Lettura Valore Etichette ###############################################################################################################################################################

################### Inizio Creazione Etichette Interfaccia Lovelace ################################################################################################################################################################
input_select:
  vmc_cucina_speed_1_fascia_calendario:                                        # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU' RICHIAMI] [INTERFACCIA, PIU' RICHIAMI] SENSORE DI MEMORIZZAZIONE DELLA VELOCITA' CHE SI DESIDERA IMPOSTARE NELLA VMC
    name: "Set Velocità 1° Fascia Calendario"
    options:
      - Velocità 0
      - Velocità 1
      - Velocità 2
      - Velocità 3
      - Velocità 4
      - Notturna
      - Iperventilazione
      - Free Cooling
    icon: mdi:fan    

  vmc_cucina_speed_2_fascia_calendario:                                        # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU' RICHIAMI] [INTERFACCIA, PIU' RICHIAMI] SENSORE DI MEMORIZZAZIONE DELLA VELOCITA' CHE SI DESIDERA IMPOSTARE NELLA VMC
    name: "Set Velocità 2° Fascia Calendario"
    options:
      - Velocità 0
      - Velocità 1
      - Velocità 2
      - Velocità 3
      - Velocità 4
      - Notturna
      - Iperventilazione
      - Free Cooling
    icon: mdi:fan    

input_number:
  vmc_cucina_offset_temp_interna:                                              # [CONFIGURAZIONE, PIU’ RICHIAMI] [INTERFACCIA PIU’ RICHIAMI] SENSORE DI MEMORIZZAZIONE DELL'OFFSET PER LA TEMPERATURA INTERNA CHE VERRA' SOMMATA NEL SENSORE vmc_cucina_temp_interna_status
    name: "Offset Temperatura"
    min: -50
    max: 50
    step: 0.1
    unit_of_measurement: "°C"
    icon: mdi:counter

  vmc_cucina_offset_temp_esterna:                                              # [CONFIGURAZIONE, PIU’ RICHIAMI] [INTERFACCIA PIU’ RICHIAMI] SENSORE DI MEMORIZZAZIONE DELL'OFFSET PER LA TEMPERATURA ESTERNA CHE VERRA' SOMMATA NEL SENSORE vmc_cucina_temp_esterna_status
    name: "Offset Temperatura Esterna"
    min: -50
    max: 50
    step: 0.1
    unit_of_measurement: "°C"
    icon: mdi:counter

  vmc_cucina_offset_umidita_interna:                                           # [CONFIGURAZIONE, PIU’ RICHIAMI] [INTERFACCIA PIU’ RICHIAMI] SENSORE DI MEMORIZZAZIONE DELL'OFFSET PER L'UMIDITA' INTERNA CHE VERRA' SOMMATA NEL SENSORE vmc_cucina_umidita_interna_status
    name: "Offset Umidità"
    min: -100
    max: 100
    step: 0.1
    unit_of_measurement: "%"
    icon: mdi:counter
    
  vmc_cucina_offset_umidita_esterna:                                           # [CONFIGURAZIONE, PIU’ RICHIAMI] [INTERFACCIA PIU’ RICHIAMI] SENSORE DI MEMORIZZAZIONE DELL'OFFSET PER L'UMIDITA' ESTERNA CHE VERRA' SOMMATA NEL SENSORE vmc_cucina_umidita_esterna_status
    name: "Offset Umidità Esterna"
    min: -100
    max: 100
    step: 0.1
    unit_of_measurement: "%"
    icon: mdi:counter

  vmc_cucina_offset_verifica_impiego_vmc:                                      # [CONFIGURAZIONE, PIU’ RICHIAMI] [INTERFACCIA PIU’ RICHIAMI]  SENSORE DI CONFRONTO CON LA DIFFERENZA TRA IL PUNTO DI RUGIADA ESTERNO - IL PUNTO DI RUGIADA INTERNO, SE MINORE SI PUO' IMPIEGARE LA VMC, DIVERSAMENTE NON SI PUO' IMPIEGARE LA VMC
    name: "Set Lim. Δ Punto di Rugiada"
    min: 0
    max: 10
    step: 1
    unit_of_measurement: "°C"
    icon: mdi:counter

  vmc_cucina_volume_da_inserire:                                               # [CONFIGURAZIONE, PIU’ RICHIAMI] [INTERFACCIA PIU’ RICHIAMI]  SENSORE PER L'ACQUISIZIONE DEL VOLUME IMPIEGATO PER IL CALCOLO DEL TEMPO NECESSARIO PER RINNOVARE TUTTA L'ARIA, TRAMITE IL SENSORE vmc_cucina_status_calcolo_portata_ventola
    name: "Volume ambiente"
    min: 0
    max: 1000
    step: 0.5
    mode: box
    unit_of_measurement: "[M³]"
    icon: mdi:cube-scan
################### Fine Creazione Etichette Interfaccia Lovelace  ############################################################################################################################################################################

################### Inizio Creazione Switch Booleani impiegati nell'Interfaccia Lovelace per mostrare o meno le Opzioni ####################################################################################
input_boolean: 
  vmc_cucina_opzioni_vmc:                                                      # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU' RICHIAMI] [INTERFACCIA, PIU' RICHIAMI]    name: "Telecomando"
    name: "Telecomando"
    initial: false
    icon: mdi:remote-tv

  vmc_cucina_opzioni_offset_sensori:                                           # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU' RICHIAMI] [INTERFACCIA, PIU' RICHIAMI]
    name: "Opzioni"
    initial: false
    icon: mdi:format-list-checkbox

  vmc_cucina_opzioni_monitoraggio_sensori:                                     # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU' RICHIAMI] [INTERFACCIA, PIU' RICHIAMI]
    name: "Monitoraggio"
    initial: false
    icon: mdi:alarm-bell

  vmc_cucina_opzioni_calendario:                                               # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU' RICHIAMI] [INTERFACCIA, PIU' RICHIAMI]
    name: "Calendario"
    initial: false
    icon: mdi:calendar-multiselect

  vmc_cucina_opzioni_lettura_sensori:                                          # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU' RICHIAMI] [INTERFACCIA, PIU' RICHIAMI]
    name: "Informazioni"
    initial: false
    icon: mdi:memory

  vmc_cucina_opzioni_accendi_spegni_vmc_vs_pdr:                                # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU' RICHIAMI] [INTERFACCIA, PIU' RICHIAMI]  VERIFICA IL VALORE DEL SENZORE vmc_cucina_punto_di_rugiada_verifica_confronto OVVERO SE IL VALORE DIVENTE "SE NE SCONSIGLIA L'IMPIEGO"; SOLAMENTE SE VIENE ACCESO (ON), LA VMC VERRA' SPENTA IN AUTOMATICO SE IL VALORE DIVENTA "SE NE SCONSIGLIA L'IMPIEGO" 
    name: "VMC ON/OFF, in Funzione del Lim. Δ P. di Rugiada"
    icon: mdi:light-switch-off

  vmc_cucina_opzioni_accendi_spegni_vmc_vs_calendario:                         # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU' RICHIAMI] [INTERFACCIA, PIU' RICHIAMI]  VERIFICA SE RENDERE AUTONOMA LA VMC, SE "ON" VERRA' IMPIEGATO IL CALENDARIO AVVIANDO IN AUTONOMIA L'ACCENSIONE E LO SPEGNIMENTO; SE "OFF" NON VERRA' IMPIEGATO IL CALENDARIO PERTENDO L'AUTONOMIA DI ACCENSIONE E SPEGNIMENTO AUTOMATICO
    name: "VMC ON/OFF, in Funzione del Calendario"
    icon: mdi:light-switch-off

################### Fine Creazione Switch Booleani impiegati nell'Interfaccia Lovelace per mostrare o meno le Opzioni ####################################################################################

################### Inizio Creazione Switch Booleani impiegati nell'Automazione, per valutare la Velocità in caso di Black-Out e/o SUPERAMENTO DEL Set Lim. Δ Punto di Rugiada ##############################################################

  vmc_cucina_spia_velocita_0:                                                  # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI] SENSORE TRACCIAMENTO VELOCITA' 0, IN CASO DI BLACK-OUT
    name: "Spia Velocità 0"
    initial: false
    icon: mdi:memory

  vmc_cucina_spia_velocita_1:                                                  # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI] SENSORE TRACCIAMENTO VELOCITA' 1, IN CASO DI BLACK-OUT
    name: "Spia Velocità 1"
    initial: false
    icon: mdi:memory

  vmc_cucina_spia_velocita_2:                                                  # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI] SENSORE TRACCIAMENTO VELOCITA' 2, IN CASO DI BLACK-OUT
    name: "Spia Velocità 2"
    initial: false
    icon: mdi:memory

  vmc_cucina_spia_velocita_3:                                                  # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI] SENSORE TRACCIAMENTO VELOCITA' 3, IN CASO DI BLACK-OUT
    name: "Spia Velocità 3"
    initial: false
    icon: mdi:memory
    
  vmc_cucina_spia_velocita_4:                                                  # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI] SENSORE TRACCIAMENTO VELOCITA' 4, IN CASO DI BLACK-OUT
    name: "Spia Velocità 4"
    initial: false
    icon: mdi:memory

  vmc_cucina_spia_velocita_iperventilazione:                       # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI] SENSORE TRACCIAMENTO VELOCITA' IPERVENTILAZIONE, IN CASO DI BLACK-OUT
    name: "Spia Velocità Iperventilazione"
    initial: false
    icon: mdi:memory

  vmc_cucina_spia_velocita_notturna:                                           # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI] SENSORE TRACCIAMENTO VELOCITA' NOTTURNA, IN CASO DI BLACK-OUT
    name: "Spia Velocità Notturna"
    initial: false
    icon: mdi:memory

  vmc_cucina_spia_velocita_freecooling:                                        # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI] SENSORE TRACCIAMENTO VELOCITA' FREE-COOLING, IN CASO DI BLACK-OUT
    name: "Spia Velocità Free Cooling"
    initial: false
    icon: mdi:memory    

  vmc_cucina_spia_calendario_lunedi_1:                                        # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU' RICHIAMI] SENSORE TRACCIAMENTO, QUANDO SI E' ALL'INTERNO DEL LUNEDì 1° FASCIA DEL CALENDARIO
    name: "Spia all'interno del Calendario Lunedì 1°"
    initial: false
    icon: mdi:memory

  vmc_cucina_spia_calendario_lunedi_2:                                        # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU' RICHIAMI] SENSORE TRACCIAMENTO, QUANDO SI E' ALL'INTERNO DEL LUNEDì 2° FASCIA DEL CALENDARIO
    name: "Spia all'interno del Calendario Lunedì 2°"
    initial: false
    icon: mdi:memory

  vmc_cucina_spia_calendario_martedi_1:                                        # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU' RICHIAMI] SENSORE TRACCIAMENTO, QUANDO SI E' ALL'INTERNO DEL MARTEDì 1° FASCIA DEL CALENDARIO
    name: "Spia all'interno del Calendario Martedì 1°"
    initial: false
    icon: mdi:memory

  vmc_cucina_spia_calendario_martedi_2:                                        # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU' RICHIAMI] SENSORE TRACCIAMENTO, QUANDO SI E' ALL'INTERNO DEL MARTEDì 2° FASCIA DEL CALENDARIO
    name: "Spia all'interno del Calendario Martedì 2°"
    initial: false
    icon: mdi:memory

  vmc_cucina_spia_calendario_mercoledi_1:                                        # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU' RICHIAMI] SENSORE TRACCIAMENTO, QUANDO SI E' ALL'INTERNO DEL MERCOLEDì 1° FASCIA DEL CALENDARIO
    name: "Spia all'interno del Calendario Mercoledì 1°"
    initial: false
    icon: mdi:memory

  vmc_cucina_spia_calendario_mercoledi_2:                                        # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU' RICHIAMI] SENSORE TRACCIAMENTO, QUANDO SI E' ALL'INTERNO DEL MERCOLEDì 2° FASCIA DEL CALENDARIO
    name: "Spia all'interno del Calendario Mercoledì 2°"
    initial: false
    icon: mdi:memory

  vmc_cucina_spia_calendario_giovedi_1:                                        # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU' RICHIAMI] SENSORE TRACCIAMENTO, QUANDO SI E' ALL'INTERNO DEL GIOVEDì 1° FASCIA DEL CALENDARIO
    name: "Spia all'interno del Calendario Giovedì 1°"
    initial: false
    icon: mdi:memory

  vmc_cucina_spia_calendario_giovedi_2:                                        # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU' RICHIAMI] SENSORE TRACCIAMENTO, QUANDO SI E' ALL'INTERNO DEL GIOVEDì 2° FASCIA DEL CALENDARIO
    name: "Spia all'interno del Calendario Giovedì 2°"
    initial: false
    icon: mdi:memory

  vmc_cucina_spia_calendario_venerdi_1:                                        # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU' RICHIAMI] SENSORE TRACCIAMENTO, QUANDO SI E' ALL'INTERNO DEL VENERDì 1° FASCIA DEL CALENDARIO
    name: "Spia all'interno del Calendario Venerdì 1°"
    initial: false
    icon: mdi:memory

  vmc_cucina_spia_calendario_venerdi_2:                                        # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU' RICHIAMI] SENSORE TRACCIAMENTO, QUANDO SI E' ALL'INTERNO DEL VENERDì 2° FASCIA DEL CALENDARIO
    name: "Spia all'interno del Calendario Venerdì 2°"
    initial: false
    icon: mdi:memory

  vmc_cucina_spia_calendario_sabato_1:                                        # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU' RICHIAMI] SENSORE TRACCIAMENTO, QUANDO SI E' ALL'INTERNO DEL SABATO 1° FASCIA DEL CALENDARIO
    name: "Spia all'interno del Calendario Sabato 1°"
    initial: false
    icon: mdi:memory

  vmc_cucina_spia_calendario_sabato_2:                                        # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU' RICHIAMI] SENSORE TRACCIAMENTO, QUANDO SI E' ALL'INTERNO DEL SABATO 2° FASCIA DEL CALENDARIO
    name: "Spia all'interno del Calendario Sabato 2°"
    initial: false
    icon: mdi:memory

  vmc_cucina_spia_calendario_domenica_1:                                        # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU' RICHIAMI] SENSORE TRACCIAMENTO, QUANDO SI E' ALL'INTERNO DEL DOMENICA 1° FASCIA DEL CALENDARIO
    name: "Spia all'interno del Calendario Domenica 1°"
    initial: false
    icon: mdi:memory

  vmc_cucina_spia_calendario_domenica_2:                                        # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU' RICHIAMI] SENSORE TRACCIAMENTO, QUANDO SI E' ALL'INTERNO DEL DOMENICA 2° FASCIA DEL CALENDARIO
    name: "Spia all'interno del Calendario Domenica 2°"
    initial: false
    icon: mdi:memory



  vmc_cucina_spia_velocita_0_un_solo_avvio:                                    # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU' RICHIAMI] SENSORE DI SUPPORTO NELL'AUTOMAZIONE PER IL RIPRISTINO DELLA VELOCITA' 0, IN CASO SUPERAMENTO del Lim. Δ P. di Rugiada
    name: "Spia Velocità 0 1° Avvio"
    initial: false
    icon: mdi:memory

  vmc_cucina_spia_velocita_1_un_solo_avvio:                                    # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU' RICHIAMI] SENSORE DI SUPPORTO NELL'AUTOMAZIONE PER IL RIPRISTINO DELLA VELOCITA' 1, IN CASO SUPERAMENTO del Lim. Δ P. di Rugiada
    name: "Spia Velocità 1 1° Avvio"
    initial: false
    icon: mdi:memory

  vmc_cucina_spia_velocita_2_un_solo_avvio:                                    # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU' RICHIAMI] SENSORE DI SUPPORTO NELL'AUTOMAZIONE PER IL RIPRISTINO DELLA VELOCITA' 2, IN CASO SUPERAMENTO del Lim. Δ P. di Rugiada
    name: "Spia Velocità 2 1° Avvio"
    initial: false
    icon: mdi:memory

  vmc_cucina_spia_velocita_3_un_solo_avvio:                                    # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU' RICHIAMI] SENSORE DI SUPPORTO NELL'AUTOMAZIONE PER IL RIPRISTINO DELLA VELOCITA' 3, IN CASO SUPERAMENTO del Lim. Δ P. di Rugiada
    name: "Spia Velocità 3 1° Avvio"
    initial: false
    icon: mdi:memory

  vmc_cucina_spia_velocita_4_un_solo_avvio:                                    # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU' RICHIAMI] SENSORE DI SUPPORTO NELL'AUTOMAZIONE PER IL RIPRISTINO DELLA VELOCITA' 4, IN CASO SUPERAMENTO del Lim. Δ P. di Rugiada
    name: "Spia Velocità 4 1° Avvio"
    initial: false
    icon: mdi:memory

  vmc_cucina_spia_velocita_iperventilazione_un_solo_avvio:                     # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU' RICHIAMI] SENSORE DI SUPPORTO NELL'AUTOMAZIONE PER IL RIPRISTINO DELLA VELOCITA' IPERVENTILAZIONE, IN CASO SUPERAMENTO del Lim. Δ P. di Rugiada
    name: "Spia Velocità Iperventilazione 1° Avvio"
    initial: false
    icon: mdi:memory

  vmc_cucina_spia_velocita_notturna_un_solo_avvio:                             # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU' RICHIAMI] SENSORE DI SUPPORTO NELL'AUTOMAZIONE PER IL RIPRISTINO DELLA VELOCITA' NOTTURNA, IN CASO SUPERAMENTO del Lim. Δ P. di Rugiada
    name: "Spia Velocità notturna 1° Avvio"
    initial: false
    icon: mdi:memory

  vmc_cucina_spia_velocita_freecooling_un_solo_avvio:                          # [CONFIGURAZIONE 0 RICHIAMI] [AUTOMAZIONE, PIU' RICHIAMI] SENSORE DI SUPPORTO NELL'AUTOMAZIONE PER IL RIPRISTINO DELLA VELOCITA' FREE-COOLING, IN CASO SUPERAMENTO del Lim. Δ P. di Rugiada
    name: "Spia Velocità freecooling 1° Avvio"
    initial: false
    icon: mdi:memory
################### Fine Creazione Switch Booleani impiegati nell'Automazione, per valutare la Velocità in caso di Black-Out e/o SUPERAMENTO DEL Set Lim. Δ Punto di Rugiada ##############################################

################### Inizio Creazione input datetime per l'accensione e lo spegnimento della VMC per ogni giorno della settimana ###########################################################################################
input_datetime:
  vmc_cucina_accensione_lunedi:                                                # [CONFIGURAZIONE, PIU’ RICHIAMI] [INTERFACCIA, PIU’ RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI] 
    name: "Lun. 1°"
    has_date: false
    has_time: true
    icon: mdi:timer-play-outline

  vmc_cucina_spegnimento_lunedi:                                               # [CONFIGURAZIONE, PIU’ RICHIAMI] [INTERFACCIA, PIU’ RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI]
    name: "Lun. 1°"
    has_date: false
    has_time: true
    icon: mdi:timer-stop-outline

  vmc_cucina_accensione_lunedi_2:                                              # [CONFIGURAZIONE, PIU’ RICHIAMI] [INTERFACCIA, PIU’ RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI]
    name: "Lun. 2°"
    has_date: false
    has_time: true
    icon: mdi:timer-play-outline
    
  vmc_cucina_spegnimento_lunedi_2:                                             # [CONFIGURAZIONE, PIU’ RICHIAMI] [INTERFACCIA, PIU’ RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI]
    name: "Lun. 2°"
    has_date: false
    has_time: true
    icon: mdi:timer-stop-outline

  vmc_cucina_accensione_martedi:                                               # [CONFIGURAZIONE, PIU’ RICHIAMI] [INTERFACCIA, PIU’ RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI]
    name: "Mar. 1°"
    has_date: false
    has_time: true
    icon: mdi:timer-play-outline

  vmc_cucina_spegnimento_martedi:                                              # [CONFIGURAZIONE, PIU’ RICHIAMI] [INTERFACCIA, PIU’ RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI]
    name: "Mar. 1°"
    has_date: false
    has_time: true
    icon: mdi:timer-stop-outline
    
  vmc_cucina_accensione_martedi_2:                                             # [CONFIGURAZIONE, PIU’ RICHIAMI] [INTERFACCIA, PIU’ RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI]
    name: "Mar. 2°"
    has_date: false
    has_time: true
    icon: mdi:timer-play-outline
    
  vmc_cucina_spegnimento_martedi_2:                                            # [CONFIGURAZIONE, PIU’ RICHIAMI] [INTERFACCIA, PIU’ RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI]
    name: "Mar. 2°"
    has_date: false
    has_time: true
    icon: mdi:timer-stop-outline
    
  vmc_cucina_accensione_mercoledi:                                             # [CONFIGURAZIONE, PIU’ RICHIAMI] [INTERFACCIA, PIU’ RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI]
    name: "Mer. 1°"
    has_date: false
    has_time: true
    icon: mdi:timer-play-outline

  vmc_cucina_spegnimento_mercoledi:                                            # [CONFIGURAZIONE, PIU’ RICHIAMI] [INTERFACCIA, PIU’ RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI]
    name: "Mer. 1°"
    has_date: false
    has_time: true
    icon: mdi:timer-stop-outline

  vmc_cucina_accensione_mercoledi_2:                                           # [CONFIGURAZIONE, PIU’ RICHIAMI] [INTERFACCIA, PIU’ RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI]
    name: "Mer. 2°"
    has_date: false
    has_time: true
    icon: mdi:timer-play-outline
    
  vmc_cucina_spegnimento_mercoledi_2:                                          # [CONFIGURAZIONE, PIU’ RICHIAMI] [INTERFACCIA, PIU’ RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI]
    name: "Mer. 2°"
    has_date: false
    has_time: true
    icon: mdi:timer-stop-outline

  vmc_cucina_accensione_giovedi:                                               # [CONFIGURAZIONE, PIU’ RICHIAMI] [INTERFACCIA, PIU’ RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI]
    name: "Gio. 1°"
    has_date: false
    has_time: true
    icon: mdi:timer-play-outline

  vmc_cucina_spegnimento_giovedi:                                              # [CONFIGURAZIONE, PIU’ RICHIAMI] [INTERFACCIA, PIU’ RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI]
    name: "Gio. 1°"
    has_date: false
    has_time: true
    icon: mdi:timer-stop-outline

  vmc_cucina_accensione_giovedi_2:                                             # [CONFIGURAZIONE, PIU’ RICHIAMI] [INTERFACCIA, PIU’ RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI]
    name: "Gio. 2°"
    has_date: false
    has_time: true
    icon: mdi:timer-play-outline

  vmc_cucina_spegnimento_giovedi_2:                                            # [CONFIGURAZIONE, PIU’ RICHIAMI] [INTERFACCIA, PIU’ RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI]
    name: "Gio. 2°"
    has_date: false
    has_time: true
    icon: mdi:timer-stop-outline
    
  vmc_cucina_accensione_venerdi:                                               # [CONFIGURAZIONE, PIU’ RICHIAMI] [INTERFACCIA, PIU’ RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI]
    name: "Ven. 1°"
    has_date: false
    has_time: true
    icon: mdi:timer-play-outline

  vmc_cucina_spegnimento_venerdi:                                              # [CONFIGURAZIONE, PIU’ RICHIAMI] [INTERFACCIA, PIU’ RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI]
    name: "Ven. 1°"
    has_date: false
    has_time: true
    icon: mdi:timer-stop-outline

  vmc_cucina_accensione_venerdi_2:                                             # [CONFIGURAZIONE, PIU’ RICHIAMI] [INTERFACCIA, PIU’ RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI]
    name: "Ven. 2°"
    has_date: false
    has_time: true
    icon: mdi:timer-play-outline

  vmc_cucina_spegnimento_venerdi_2:                                            # [CONFIGURAZIONE, PIU’ RICHIAMI] [INTERFACCIA, PIU’ RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI]
    name: "Ven. 2°"
    has_date: false
    has_time: true
    icon: mdi:timer-stop-outline
    
  vmc_cucina_accensione_sabato:                                                # [CONFIGURAZIONE, PIU’ RICHIAMI] [INTERFACCIA, PIU’ RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI]
    name: "Sab. 1°"
    has_date: false
    has_time: true
    icon: mdi:timer-play-outline

  vmc_cucina_spegnimento_sabato:                                               # [CONFIGURAZIONE, PIU’ RICHIAMI] [INTERFACCIA, PIU’ RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI]
    name: "Sab. 1°"
    has_date: false
    has_time: true
    icon: mdi:timer-stop-outline

  vmc_cucina_accensione_sabato_2:                                              # [CONFIGURAZIONE, PIU’ RICHIAMI] [INTERFACCIA, PIU’ RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI]
    name: "Sab. 2°"
    has_date: false
    has_time: true
    icon: mdi:timer-play-outline
    
  vmc_cucina_spegnimento_sabato_2:                                             # [CONFIGURAZIONE, PIU’ RICHIAMI] [INTERFACCIA, PIU’ RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI]
    name: "Sab. 2°"
    has_date: false
    has_time: true
    icon: mdi:timer-stop-outline
    
  vmc_cucina_accensione_domenica:                                              # [CONFIGURAZIONE, PIU’ RICHIAMI] [INTERFACCIA, PIU’ RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI]
    name: "Dom. 1°"
    has_date: false
    has_time: true
    icon: mdi:timer-play-outline

  vmc_cucina_spegnimento_domenica:                                             # [CONFIGURAZIONE, PIU’ RICHIAMI] [INTERFACCIA, PIU’ RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI]
    name: "Dom. 1°"
    has_date: false
    has_time: true
    icon: mdi:timer-stop-outline

  vmc_cucina_accensione_domenica_2:                                            # [CONFIGURAZIONE, PIU’ RICHIAMI] [INTERFACCIA, PIU’ RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI]
    name: "Dom. 2°"
    has_date: false
    has_time: true
    icon: mdi:timer-play-outline
    
  vmc_cucina_spegnimento_domenica_2:                                           # [CONFIGURAZIONE, PIU’ RICHIAMI] [INTERFACCIA, PIU’ RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI]
    name: "Dom. 2°"
    has_date: false
    has_time: true
    icon: mdi:timer-stop-outline
################### Fine Creazione input datetime per l'accensione e lo spegnimento della VMC per ogni giorno della settimana ###########################################################################################

################### Inizio Creazione Scripts ############################################################################################################################################################################
script:
  vmc_cucina_upgrade_sensors:
    alias: Aggiorna i Sensori Manualmente
    sequence:
      - service: homeassistant.update_entity
        target:
          entity_id:
            - sensor.vmc_cucina_status_ip
            - sensor.vmc_cucina_status_ventola
            - sensor.vmc_cucina_sensori
            - sensor.vmc_cucina_nome
            - sensor.vmc_cucina_lan
            - sensor.openweathermap_humidity
    mode: restart
    icon: mdi:cursor-pointer   
################### Fine Creazione Scripts ##############################################################################################################################################################################

################### Inizio Creazione dei Servizi ovvero i Comandi da impartire alla VMC ################################################################################################################################# [CONFIGURAZIONE 0 RICHIAMI] [INTERFACCIA, PIU’ RICHIAMI] [AUTOMAZIONE, PIU’ RICHIAMI]
shell_command: 
  vmc_cucina_freecooling: timeout 15s echo -e "VMWH0000007" | nc 192.168.1.160 5001                                   # [CONFIGURAZIONE] [INTERFACCIA] [AUTOMAZIONE] INVIO COMANDO FREE COOLING     ALLA VMC
  vmc_cucina_notturna: timeout 15s echo -e "VMWH0000006" | nc 192.168.1.160 5001                                      # [CONFIGURAZIONE] [INTERFACCIA] [AUTOMAZIONE] INVIO COMANDO NOTTURNA         ALLA VMC
  vmc_cucina_iperventilazione: timeout 15s echo -e "VMWH0000005" | nc 192.168.1.160 5001                              # [CONFIGURAZIONE] [INTERFACCIA] [AUTOMAZIONE] INVIO COMANDO IPERVENTILAZIONE ALLA VMC
  vmc_cucina_velocita_4: timeout 15s echo -e "VMWH0000004" | nc 192.168.1.160 5001                                    # [CONFIGURAZIONE] [INTERFACCIA] [AUTOMAZIONE] INVIO COMANDO VELOCITA' 4      ALLA VMC
  vmc_cucina_velocita_3: timeout 15s echo -e "VMWH0000003" | nc 192.168.1.160 5001                                    # [CONFIGURAZIONE] [INTERFACCIA] [AUTOMAZIONE] INVIO COMANDO VELOCITA' 3      ALLA VMC
  vmc_cucina_velocita_2: timeout 15s echo -e "VMWH0000002" | nc 192.168.1.160 5001                                    # [CONFIGURAZIONE] [INTERFACCIA] [AUTOMAZIONE] INVIO COMANDO VELOCITA' 2      ALLA VMC
  vmc_cucina_velocita_1: timeout 15s echo -e "VMWH0000001" | nc 192.168.1.160 5001                                    # [CONFIGURAZIONE] [INTERFACCIA] [AUTOMAZIONE] INVIO COMANDO VELOCITA' 1      ALLA VMC
  vmc_cucina_velocita_0: timeout 15s echo -e "VMWH0000000" | nc 192.168.1.160 5001                                    # [CONFIGURAZIONE] [INTERFACCIA] [AUTOMAZIONE] INVIO COMANDO VELOCITA' 0      ALLA VMC
  vmc_cucina_sensori_on: timeout 15s echo -e "VMWH0300000" | nc 192.168.1.160 5001                                    # [CONFIGURAZIONE] [INTERFACCIA] [AUTOMAZIONE]  INVIO COMANDO SENSORI  ON     ALLA VMC PER ACCENDERE   I SENSORI, DISATTIVANDO IN MANIERA AUTOMATICA LO STATO DI FUNZIONAMENTO IMPOSTATO DALL'UTENTE
  vmc_cucina_sensori_off: timeout 15s echo -e "VMWH0300002" | nc 192.168.1.160 5001                                   # [CONFIGURAZIONE] [INTERFACCIA] [AUTOMAZIONE] INVIO COMANDO SENSORI  OFF     ALLA VMC PER DISATTIVARE I SENSORI, MANTENENDO LO STATO DI FUNZIONAMENTO IMPOSTATO DALL'UTENTE
  vmc_cucina_pannello_led_on: timeout 15s echo -e "VMWH0100010" | nc 192.168.1.160 5001                               # [CONFIGURAZIONE] [INTERFACCIA] [AUTOMAZIONE] INVIO COMANDO PANNELLO LED ON  ALLA VMC PER ATTIVARE    IL LED PANNELLO DEI COMANDI 
  vmc_cucina_pannello_led_off: timeout 15s echo -e "VMWH0100000" | nc 192.168.1.160 5001                              # [CONFIGURAZIONE] [INTERFACCIA] [AUTOMAZIONE] INVIO COMANDO PANNELLO LED OFF ALLA VMC PER DISATTIVARE IL LED PANNELLO DEI COMANDI
 ################### Fine Creazione dei Servizi ovvero i Comandi da impartire alla VMC   ###################################################################################################################################